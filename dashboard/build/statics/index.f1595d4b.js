var Ac=Object.defineProperty;var Dc=(t,s,r)=>s in t?Ac(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r;var ee=(t,s,r)=>(Dc(t,typeof s!="symbol"?s+"":s,r),r);import{i as Bi,B as Ic,a as Pc,b as Ec,j as fl,d as Oe,U as Fa,z as Tc,r as zc,f as Nc,Q as Rc,e as Lc,m as Yt,$ as Mc,c as se,X as Qi,R as Ji,N as xn,I as De,g as vn,h as n,F as x,k as e,l as I,n as Dr,o as Uc,p as Ha,q as $t,s as Oc,t as Wc,u as Fc,v as Hc,w as Wr,x as Zr,L as bl,C as vi,y as qe,A as Le,M as hi,D as Is,E as Be,G as pi,H as gr,J as U,K as yl,T as h,S as Bc,P as Vc,O as Ia,V as wn,W as Ps,Y as Ba,Z as Sl,_ as $c,a0 as sr,a1 as jr,a2 as rr,a3 as d,a4 as io,a5 as L,a6 as Yi,a7 as O,a8 as Zi,a9 as Kt,aa as Dt,ab as qt,ac as Tt,ad as Jt,ae as It,af as me,ag as He,ah as ge,ai as nr,aj as Wt,ak as Rr,al as xe,am as Kc,an as mi,ao as Va,ap as qc,aq as $a,ar as en,as as Fr,at as Pn,au as Mr,av as Ur,aw as Bn,ax as ji,ay as fr,az as Jc,aA as Yc,aB as Gc,aC as Xc,aD as Qc,aE as Zc,aF as jc,aG as ed,aH as td,aI as ea,aJ as xl,aK as vl,aL as mt,aM as Es,aN as ao,aO as rd,aP as nd,aQ as sd,aR as wl,aS as kl,aT as Or,aU as pt,aV as $n,aW as Kn,aX as qn,aY as us,aZ as Jn,a_ as Wn,a$ as id,b0 as ad,b1 as od,b2 as ld,b3 as Us,b4 as cd,b5 as dd,b6 as an,b7 as _s,b8 as Fn,b9 as rt,ba as cn,bb as ta,bc as Et,bd as Ze,be as vr,bf as Ka,bg as ud,bh as dn,bi as Tn,bj as hd,bk as gi,bl as on,bm as qa,bn as Ja,bo as Cl,bp as ci,bq as Vi,br as pd,bs as md,bt as _l,bu as gd,bv as fd,bw as Ya,bx as Al,by as Dl,bz as bd,bA as yd,bB as Sd,bC as Il,bD as xd,bE as vd,bF as wd,bG as di,bH as oo,bI as hs,bJ as ps,bK as or,bL as ms,bM as lr,bN as kd,bO as Cd,bP as Vn,bQ as _d,bR as er,bS as Ad,bT as kt,bU as vt,bV as Pl,bW as El,bX as Tl,bY as Dd,bZ as zl,b_ as as,b$ as yn,c0 as Ot,c1 as Ke,c2 as sn,c3 as Me,c4 as Ti,c5 as bs,c6 as Nl,c7 as Rl,c8 as Ll,c9 as lo,ca as Dn,cb as Ml,cc as Ul,cd as Ol,ce as fi,cf as Lr,cg as Id,ch as Pd,ci as Wl,cj as Ed,ck as Td,cl as Ts,cm as zs,cn as wi,co as Fl,cp as zd,cq as As,cr as ks,cs as $i,ct as Nd,cu as Hl,cv as Ga,cw as Ar,cx as Bl,cy as Os,cz as Rd,cA as Ld,cB as Md,cC as Vl,cD as $l,cE as Ud,cF as Od,cG as Kl,cH as Wd,cI as Fd,cJ as Hd,cK as Bd,cL as Vd,cM as $d,cN as Kd,cO as Xa,cP as qd,cQ as jn,cR as Jd,cS as Yd,cT as Gd,cU as Xd,cV as Qd,cW as Zd,cX as jd,cY as eu,cZ as tu,c_ as ru}from"./vendor.1aa304ea.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerpolicy&&(a.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?a.credentials="include":i.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}})();Bi.use(Ic).use(Pc).use(Ec).init({debug:{}.NODE_ENV==="development",returnNull:!1,fallbackLng:"en",interpolation:{escapeValue:!1},react:{useSuspense:!1},load:"languageOnly",detection:{caches:["localStorage","sessionStorage","cookie"]},backend:{loadPath:fl(["/","statics/locales/{{lng}}.json"])}},function(t,s){t?console.error("i18next initialization error:",t):console.log("i18next initialized successfully with language:",Bi.language),Oe.locale(Bi.language)});Bi.on("languageChanged",t=>{console.log("Language changed to:",t),Oe.locale(t)});Fa("zh-cn",Tc);Fa("ru",zc);Fa("fa",Nc);const ii=new Rc,Ki=(t,s)=>{const r=document.querySelector('meta[name="theme-color"]'),o={dark:"#0f172a",light:"#f6f8ff",default:"#f6f8ff","ultra-dark":"#091212",moontone:"#0f1930",purple:"#1a1031",green:"#071c10",custom:s||"#f6f8ff"},i=s||o[t]||o.default;r==null||r.setAttribute("content",i)},nu=Lc({shadows:{outline:"0 0 0 2px var(--chakra-colors-primary-200)"},fonts:{body:'Vazirmatn,Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol",sans-serif'},colors:{"light-border":"#d2d2d4",bg:{light:"var(--bg-light)",dark:"var(--bg-dark)"},surface:{light:"var(--surface-light)",dark:"var(--surface-dark)"},primary:{50:"var(--primary-50)",100:"var(--primary-100)",200:"var(--primary-200)",300:"var(--primary-300)",400:"var(--primary-400)",500:"var(--primary-500)",600:"var(--primary-600)",700:"var(--primary-700)",800:"var(--primary-800)",900:"var(--primary-900)"},gray:{750:"#222C3B"}},styles:{global:{":root":{"--primary-50":"#9cb7f2","--primary-100":"#88a9ef","--primary-200":"#749aec","--primary-300":"#618ce9","--primary-400":"#4d7de7","--primary-500":"#396fe4","--primary-600":"#3364cd","--primary-700":"#2e59b6","--primary-800":"#284ea0","--primary-900":"#224389","--bg-light":"#f6f8ff","--bg-dark":"#0f172a","--surface-light":"#ffffff","--surface-dark":"#141f35"},".rb-theme-dark":{"--primary-50":"#1a202c","--primary-100":"#2d3748","--primary-200":"#4a5568","--primary-300":"#718096","--primary-400":"#a0aec0","--primary-500":"#cbd5e0","--primary-600":"#e2e8f0","--primary-700":"#f7fafc","--primary-800":"#ffffff","--primary-900":"#ffffff","--bg-light":"#1a202c","--bg-dark":"#0b1524","--surface-light":"#232c3d","--surface-dark":"#121c2c"},body:{backgroundColor:"var(--bg-light)"},"[data-theme='dark'] body, .chakra-ui-dark body":{backgroundColor:"var(--bg-dark)"},".rb-theme-ultra-dark":{"--primary-50":"#e6fffa","--primary-100":"#b2f5ea","--primary-200":"#81e6d9","--primary-300":"#4fd1c5","--primary-400":"#38b2ac","--primary-500":"#319795","--primary-600":"#2c7a7b","--primary-700":"#285e61","--primary-800":"#234e52","--primary-900":"#1b4046","--bg-light":"#edfafa","--bg-dark":"#091212","--surface-light":"#ffffff","--surface-dark":"#0f1f1f"},".rb-theme-moontone":{"--primary-50":"#ebf8ff","--primary-100":"#dbeafe","--primary-200":"#bfdbfe","--primary-300":"#93c5fd","--primary-400":"#60a5fa","--primary-500":"#3b82f6","--primary-600":"#2563eb","--primary-700":"#1d4ed8","--primary-800":"#1e40af","--primary-900":"#172554","--bg-light":"#f5f7ff","--bg-dark":"#0f1930","--surface-light":"#ffffff","--surface-dark":"#172544"},".rb-theme-purple":{"--primary-50":"#f5f3ff","--primary-100":"#ede9fe","--primary-200":"#ddd6fe","--primary-300":"#c4b5fd","--primary-400":"#a78bfa","--primary-500":"#7c3aed","--primary-600":"#6d28d9","--primary-700":"#5b21b6","--primary-800":"#4c1d95","--primary-900":"#3b0f73","--bg-light":"#f8f2ff","--bg-dark":"#1a1031","--surface-light":"#ffffff","--surface-dark":"#261547"},".rb-theme-green":{"--primary-50":"#ecfdf5","--primary-100":"#d1fae5","--primary-200":"#a7f3d0","--primary-300":"#6ee7b7","--primary-400":"#34d399","--primary-500":"#10b981","--primary-600":"#059669","--primary-700":"#047857","--primary-800":"#065f46","--primary-900":"#064e3b","--bg-light":"#eefdf4","--bg-dark":"#071c10","--surface-light":"#ffffff","--surface-dark":"#0f2a18"}}},components:{Card:{baseStyle:t=>({container:{bg:Yt("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:Yt("blackAlpha.100","whiteAlpha.200")(t),boxShadow:"none"}})},Modal:{baseStyle:t=>({dialog:{bg:Yt("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:Yt("blackAlpha.100","whiteAlpha.200")(t),borderRadius:"lg",boxShadow:Yt("xl","dark-lg")(t)},header:{borderBottomWidth:"1px",borderColor:Yt("blackAlpha.100","whiteAlpha.200")(t)},footer:{borderTopWidth:"1px",borderColor:Yt("blackAlpha.100","whiteAlpha.200")(t)}})},Drawer:{baseStyle:t=>({dialog:{bg:Yt("surface.light","surface.dark")(t),borderColor:Yt("blackAlpha.100","whiteAlpha.200")(t),borderWidth:"0"}})},Menu:{baseStyle:t=>({list:{bg:Yt("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:Yt("blackAlpha.100","whiteAlpha.200")(t),boxShadow:Yt("lg","dark-lg")(t)},item:{_hover:{bg:Yt("blackAlpha.50","whiteAlpha.100")(t)},_focus:{bg:Yt("blackAlpha.50","whiteAlpha.100")(t)}}})},Popover:{baseStyle:t=>({content:{bg:Yt("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:Yt("blackAlpha.100","whiteAlpha.200")(t),boxShadow:Yt("lg","dark-lg")(t)},header:{borderBottomWidth:"1px",borderColor:Yt("blackAlpha.100","whiteAlpha.200")(t)},footer:{borderTopWidth:"1px",borderColor:Yt("blackAlpha.100","whiteAlpha.200")(t)}})},Accordion:{baseStyle:t=>({container:{borderTopWidth:"0",borderBottomWidth:"1px",borderColor:Yt("blackAlpha.100","whiteAlpha.200")(t),_last:{borderBottomWidth:"1px"}},button:{bg:"transparent",_hover:{bg:Yt("blackAlpha.50","whiteAlpha.100")(t)},_expanded:{bg:Yt("blackAlpha.50","whiteAlpha.100")(t)}},panel:{bg:Yt("surface.light","surface.dark")(t)}})},Alert:{baseStyle:{container:{borderRadius:"6px",fontSize:"sm"}}},Select:{baseStyle:{field:{_dark:{borderColor:"gray.600",borderRadius:"6px"},_light:{borderRadius:"6px"}}}},FormHelperText:{baseStyle:{fontSize:"xs"}},FormLabel:{baseStyle:{fontSize:"sm",fontWeight:"medium",mb:"1",_dark:{color:"gray.300"}}},Input:{baseStyle:{addon:{_dark:{borderColor:"gray.600",_placeholder:{color:"gray.500"}}},field:{_focusVisible:{boxShadow:"none",borderColor:"primary.200",outlineColor:"primary.200"},_dark:{borderColor:"gray.600",_disabled:{color:"gray.400",borderColor:"gray.500"},_placeholder:{color:"gray.500"}}}}},Table:{baseStyle:{table:{borderCollapse:"separate",borderSpacing:0},thead:{borderBottomColor:"light-border"},th:{background:"#F9FAFB",borderColor:"light-border !important",borderBottomColor:"light-border !important",borderTop:"1px solid ",borderTopColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border !important"},_last:{borderRight:"1px solid",borderColor:"light-border !important"},_dark:{borderColor:"gray.600 !important",background:"gray.750"}},td:{transition:"all .1s ease-out",borderColor:"light-border",borderBottomColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_last:{borderRight:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_dark:{borderColor:"gray.600",borderBottomColor:"gray.600 !important"}},tr:{"&.interactive":{cursor:"pointer",_hover:{"& > td":{bg:"gray.200"},_dark:{"& > td":{bg:"gray.750"}}}},_last:{"& > td":{_first:{borderBottomLeftRadius:"8px"},_last:{borderBottomRightRadius:"8px"}}}}}},Button:{variants:{outline:t=>({borderColor:Yt("blackAlpha.300","whiteAlpha.300")(t),_hover:{bg:Yt("blackAlpha.50","whiteAlpha.100")(t)},_active:{bg:Yt("blackAlpha.100","whiteAlpha.200")(t)}})}}}});const Gi=()=>localStorage.getItem("token"),su=t=>{localStorage.setItem("token",t)},iu=()=>{localStorage.removeItem("token")},au=Mc.create({baseURL:"https://bot.mazholl.com:8585/api"}),ou=(t,s={})=>(Gi()&&(s.headers={...(s==null?void 0:s.headers)||{},Authorization:`Bearer ${Gi()}`}),au(t,s)),Ee=ou,lu=se(Qi,{baseStyle:{w:4,h:4}}),Sr=Ji.forwardRef(({disabled:t,step:s,label:r,className:o,startAdornment:i,endAdornment:a,type:l="text",placeholder:c,onChange:u,onBlur:p,name:m,value:g,onClick:S,error:y,clearable:A=!1,...f},D)=>{const F=()=>{u&&u({target:{value:"",name:m}})},{size:Z="md"}=f,ae=l=="number"?xn:De,v=l=="number"?vn:Ji.Fragment,M=l=="number"?{keepWithinRange:!0,precision:5,format:T=>isNaN(parseFloat(String(T)))||Number(parseFloat(String(T)).toFixed(5))===0?T:Number(parseFloat(String(T)).toFixed(5)),min:typeof f.min=="number"?f.min:f.min!==void 0?Number(f.min):0,step:s,name:m,type:l,placeholder:c,onBlur:p,onClick:S,disabled:t,flexGrow:1,size:Z,onChange:(T,Q)=>{!u||u({target:{value:T,valueAsNumber:Q,name:m}})}}:{};return n(x,{isInvalid:!!y,children:[r&&e(I,{children:r}),n(Dr,{size:Z,w:"full",rounded:"md",_focusWithin:{outline:"2px solid",outlineColor:"primary.200"},bg:t?"gray.100":"transparent",_dark:{bg:t?"gray.600":"transparent"},children:[i&&e(Uc,{children:i}),n(v,{...M,children:[e(ae,{name:m,ref:D,step:s,className:Ha(o),type:l,placeholder:c,onChange:l==="number"?void 0:u,onBlur:p,value:l==="number"?void 0:g,onClick:S,disabled:t,flexGrow:1,_focusVisible:{outline:"none",borderTopColor:"transparent",borderRightColor:"transparent",borderBottomColor:"transparent"},_disabled:{cursor:"not-allowed"},...f,roundedLeft:i?"0":"md",roundedRight:a?"0":"md"}),l=="number"&&e($t,{children:n(Oc,{children:[e(Wc,{}),e(Fc,{})]})})]}),a&&e(Hc,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",children:a}),A&&g&&g.length&&e(Wr,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",onClick:F,cursor:"pointer",children:e(lu,{})})]}),!!y&&e(Zr,{children:y})]})}),Pa="/statics/logo.e8dba2f4.svg",cu=se(bl,{baseStyle:{w:4,h:4}}),du=se(vi,{baseStyle:{w:4,h:4}}),uu=({actions:t})=>{const{i18n:s}=qe(),r=Le("surface.light","surface.dark"),o=Le("blackAlpha.50","whiteAlpha.100"),i=Le("blackAlpha.200","whiteAlpha.200"),a=Le("gray.800","gray.100"),l=u=>{s.changeLanguage(u)};return n(hi,{placement:"bottom-end",children:[e(Is,{as:Be,size:"sm",variant:"outline",icon:e(cu,{}),position:"relative"}),e(pi,{minW:{base:"70vw",sm:"160px"},zIndex:9999,bg:r,borderColor:i,color:a,children:[{code:"en",label:"English",flag:"US"},{code:"fa",label:"\u067E\u0627\u0631\u0633\u06CC",flag:"IR"},{code:"zh-cn",label:"\u4E2D\u6587",flag:"CN"},{code:"ru",label:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",flag:"RU"}].map(({code:u,label:p,flag:m})=>e(gr,{fontSize:"sm",onClick:()=>l(u),_hover:{bg:o},children:n(U,{justify:"space-between",w:"full",children:[n(U,{spacing:2,children:[e(yl,{countryCode:m,svg:!0,style:{width:"16px",height:"12px"}}),e(h,{children:p})]}),s.language===u&&e(du,{})]})},u))})]})},co="rb-theme",uo="rb-custom-themes",hu=["--primary-50","--primary-100","--primary-200","--primary-300","--primary-400","--primary-500","--primary-600","--primary-700","--primary-800","--primary-900"],ho=[{key:"light",accent:"#f7fafc",colorModeTarget:"light"},{key:"dark",accent:"#1a202c",colorModeTarget:"dark",className:"rb-theme-dark"},{key:"default",accent:"#396fe4"},{key:"ultra-dark",accent:"#319795",className:"rb-theme-ultra-dark"},{key:"moontone",accent:"#3b82f6",className:"rb-theme-moontone"},{key:"purple",accent:"#7c3aed",className:"rb-theme-purple"},{key:"green",accent:"#10b981",className:"rb-theme-green"}],po=[{key:"sunset",light:{primary:"#f97316",bg:"#fdf5ef",surface:"#fff2e5"},dark:{primary:"#fb923c",bg:"#1f130c",surface:"#2d1a12"}},{key:"ocean",light:{primary:"#0284c7",bg:"#f3f9ff",surface:"#e7f3ff"},dark:{primary:"#38bdf8",bg:"#0b1620",surface:"#132233"}},{key:"forest",light:{primary:"#16a34a",bg:"#f3faf4",surface:"#e8f7ea"},dark:{primary:"#22c55e",bg:"#0b1610",surface:"#14251a"}}],Er={primary:"#396fe4",bg:"#f6f8ff",surface:"#ffffff"},Tr={primary:"#4f46e5",bg:"#0f172a",surface:"#141f35"},la=.14,ca=.22,mo=se(vi,{baseStyle:{w:4,h:4}}),go=se(Bc,{baseStyle:{w:4,h:4}}),pu=se(Vc,{baseStyle:{w:4,h:4}}),mu=se(Ia,{baseStyle:{w:4,h:4}}),gu=se(wn,{baseStyle:{w:4,h:4}}),fo=se(Ps,{baseStyle:{w:4,h:4}}),fu=se(Ba,{baseStyle:{w:4,h:4}}),bu=se(Sl,{baseStyle:{w:4,h:4}}),yu=se($c,{baseStyle:{w:4,h:4}}),ql=(t,s=0,r=1)=>Math.min(r,Math.max(s,t)),Ea=t=>{const s=t.replace("#",""),r=parseInt(s,16);if(s.length===3){const o=r>>8&15,i=r>>4&15,a=r&15;return{r:o<<4|o,g:i<<4|i,b:a<<4|a}}return{r:r>>16&255,g:r>>8&255,b:r&255}},Jl=(t,s,r)=>{const o=i=>i.toString(16).padStart(2,"0");return`#${o(t)}${o(s)}${o(r)}`},Su=(t,s,r)=>{t/=255,s/=255,r/=255;const o=Math.max(t,s,r),i=Math.min(t,s,r);let a=0,l=0;const c=(o+i)/2;if(o!==i){const u=o-i;switch(l=c>.5?u/(2-o-i):u/(o+i),o){case t:a=(s-r)/u+(s<r?6:0);break;case s:a=(r-t)/u+2;break;default:a=(t-s)/u+4}a/=6}return{h:a,s:l,l:c}},xu=(t,s,r)=>{let o,i,a;if(s===0)o=i=a=r;else{const l=(p,m,g)=>(g<0&&(g+=1),g>1&&(g-=1),g<.16666666666666666?p+(m-p)*6*g:g<.5?m:g<.6666666666666666?p+(m-p)*(.6666666666666666-g)*6:p),c=r<.5?r*(1+s):r+s-r*s,u=2*r-c;o=l(u,c,t+1/3),i=l(u,c,t),a=l(u,c,t-1/3)}return{r:Math.round(o*255),g:Math.round(i*255),b:Math.round(a*255)}},da=t=>{try{const{r:s,g:r,b:o}=Ea(t),{h:i,s:a,l}=Su(s,r,o);return[["50",.4],["100",.28],["200",.18],["300",.08],["400",.04],["500",0],["600",-.06],["700",-.12],["800",-.18],["900",-.26]].reduce((u,[p,m])=>{const{r:g,g:S,b:y}=xu(i,a,ql(l+m));return u[`--primary-${p}`]=Jl(g,S,y),u},{})}catch{return{}}},vu=(t,s,r)=>{const o=ql(r,0,1),i=Ea(t),a=Ea(s),l=(c,u)=>Math.round(c*(1-o)+u*o);return Jl(l(i.r,a.r),l(i.g,a.g),l(i.b,a.b))},ys=(t,s,r,o)=>{try{return vu(t,s,r)}catch{return o}},wu=()=>{const t=document.documentElement;hu.forEach(s=>t.style.removeProperty(s)),t.style.removeProperty("--bg-light"),t.style.removeProperty("--bg-dark"),t.style.removeProperty("--surface-light"),t.style.removeProperty("--surface-dark")},ku=(t,s)=>{const r=document.documentElement;Object.entries(t).forEach(([o,i])=>r.style.setProperty(o,i)),r.style.setProperty("--bg-light",s.bgLight),r.style.setProperty("--bg-dark",s.bgDark),r.style.setProperty("--surface-light",s.surfaceLight),r.style.setProperty("--surface-dark",s.surfaceDark)},ua=()=>{try{return crypto.randomUUID()}catch{return Math.random().toString(36).slice(2,10)}},bo=()=>({name:"",light:{...Er},dark:{...Tr}}),pr=(t,s)=>/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(t)?t:s,Yl=({minimal:t=!1,portalContainer:s,trigger:r="icon",triggerLabel:o})=>{const{t:i}=qe(),a=sr(),{colorMode:l,toggleColorMode:c}=jr(),u=rr(),p=rr(),m=Le("surface.light","surface.dark"),g=Le("blackAlpha.50","whiteAlpha.100"),S=Le("blackAlpha.200","whiteAlpha.200"),y=Le("gray.800","gray.100"),A=Le("gray.600","gray.300"),f=Le("blackAlpha.400","blackAlpha.700"),D=d.exports.useMemo(()=>({".chakra-menu__group__title":{fontSize:"xs",textTransform:"uppercase",letterSpacing:"wider",fontWeight:"semibold",color:A}}),[A]),[F,Z]=d.exports.useState(()=>{try{return localStorage.getItem(co)||"default"}catch{return"default"}}),[ae,v]=d.exports.useState(()=>{try{const _=localStorage.getItem(uo);if(!_)return[];const P=JSON.parse(_);return Array.isArray(P)?P.map(Y=>{var E,G,he,Re,tt,je;const te=pr(((E=Y.light)==null?void 0:E.primary)||Er.primary,Er.primary),ie=pr(((G=Y.light)==null?void 0:G.bg)||Er.bg,Er.bg),q=ys(ie,te,la,Er.surface),B=pr(((he=Y.light)==null?void 0:he.surface)||q,q),ue=pr(((Re=Y.dark)==null?void 0:Re.primary)||Tr.primary,Tr.primary),be=pr(((tt=Y.dark)==null?void 0:tt.bg)||Tr.bg,Tr.bg),Ie=ys(be,ue,ca,Tr.surface),N=pr(((je=Y.dark)==null?void 0:je.surface)||Ie,Ie);return{id:Y.id||ua(),name:Y.name||"Custom",light:{primary:te,bg:ie,surface:B},dark:{primary:ue,bg:be,surface:N}}}):[]}catch{return[]}}),[M,T]=d.exports.useState(bo),[Q,_e]=d.exports.useState(null),[ke,W]=d.exports.useState("");d.exports.useEffect(()=>{try{localStorage.setItem(uo,JSON.stringify(ae))}catch{}},[ae]),d.exports.useEffect(()=>{try{localStorage.setItem(co,F)}catch{}},[F]),d.exports.useEffect(()=>{F.startsWith("custom:")&&(ae.some(P=>`custom:${P.id}`===F)||Z("default"))},[F,ae]),d.exports.useEffect(()=>{const _=document.documentElement;Array.from(_.classList).filter(Y=>Y.startsWith("rb-theme-")).forEach(Y=>_.classList.remove(Y)),wu();const P=ho.find(Y=>Y.key===F);if(P){P.className&&_.classList.add(P.className),Ki(P.key);return}if(F.startsWith("custom:")){const Y=ae.find(q=>`custom:${q.id}`===F);if(!Y)return;const te=l==="dark"?Y.dark:Y.light,ie=da(te.primary);ku(ie,{bgLight:Y.light.bg,bgDark:Y.dark.bg,surfaceLight:Y.light.surface,surfaceDark:Y.dark.surface}),Ki("custom",l==="dark"?Y.dark.bg:Y.light.bg)}else Ki("default")},[F,ae,l]);const oe=d.exports.useCallback(_=>{_.colorModeTarget&&l!==_.colorModeTarget&&c(),Z(_.key)},[l,c]),R=_=>{Z(`custom:${_}`)},le=_=>{_e(null),T(_?{name:i(`theme.presets.${_.key}.name`),light:{..._.light},dark:{..._.dark}}:bo()),u.onOpen()},w=_=>{_e(_.id),T({name:_.name,light:{..._.light},dark:{..._.dark}}),u.onOpen()},H=()=>{const _=M.name.trim()||i("theme.untitled"),P=pr(M.light.primary,Er.primary),Y=pr(M.light.bg,Er.bg),te=ys(Y,P,la,Er.surface),ie=pr(M.light.surface,te),q=pr(M.dark.primary,Tr.primary),B=pr(M.dark.bg,Tr.bg),ue=ys(B,q,ca,Tr.surface),be=pr(M.dark.surface,ue),Ie={id:Q||ua(),name:_,light:{primary:P,bg:Y,surface:ie},dark:{primary:q,bg:B,surface:be}};v(N=>Q?N.map(E=>E.id===Q?Ie:E):[...N,Ie]),Z(`custom:${Ie.id}`),u.onClose(),_e(null),a({status:"success",title:i("theme.customSaved")})},ce=_=>{v(P=>P.filter(Y=>Y.id!==_)),F===`custom:${_}`&&Z("default"),a({status:"info",title:i("theme.customDeleted")})},j=()=>{Z("default"),a({status:"info",title:i("theme.resetSuccess")})},fe=async()=>{if(!ae.length){a({status:"warning",title:i("theme.exportEmpty")});return}const _=ae.map(({id:Y,...te})=>te),P=JSON.stringify(_,null,2);try{await navigator.clipboard.writeText(P),a({status:"success",title:i("theme.exportSuccess")})}catch{try{const Y=new Blob([P],{type:"application/json"}),te=URL.createObjectURL(Y),ie=document.createElement("a");ie.href=te,ie.download="rebecca-themes.json",ie.click(),URL.revokeObjectURL(te),a({status:"success",title:i("theme.exportSuccessDownload")})}catch{a({status:"error",title:i("theme.exportError")})}}},Ae=()=>{try{const _=JSON.parse(ke),Y=(Array.isArray(_)?_:[_]).map(te=>{var G,he,Re,tt,je,we;const ie=pr(((G=te==null?void 0:te.light)==null?void 0:G.primary)||Er.primary,Er.primary),q=pr(((he=te==null?void 0:te.light)==null?void 0:he.bg)||Er.bg,Er.bg),B=ys(q,ie,la,Er.surface),ue=pr(((Re=te==null?void 0:te.light)==null?void 0:Re.surface)||B,B),be=pr(((tt=te==null?void 0:te.dark)==null?void 0:tt.primary)||Tr.primary,Tr.primary),Ie=pr(((je=te==null?void 0:te.dark)==null?void 0:je.bg)||Tr.bg,Tr.bg),N=ys(Ie,be,ca,Tr.surface),E=pr(((we=te==null?void 0:te.dark)==null?void 0:we.surface)||N,N);return{id:ua(),name:(te==null?void 0:te.name)||"Custom",light:{primary:ie,bg:q,surface:ue},dark:{primary:be,bg:Ie,surface:E}}}).filter(te=>te.name);if(!Y.length){a({status:"warning",title:i("theme.importError")});return}v(te=>[...te,...Y]),p.onClose(),W(""),a({status:"success",title:i("theme.importSuccess")})}catch{a({status:"error",title:i("theme.importError")})}},Pe=d.exports.useCallback((_,P)=>{_.preventDefault(),_.stopPropagation(),P()},[]),Te=d.exports.useMemo(()=>da(M.light.primary),[M.light.primary]),J=d.exports.useMemo(()=>da(M.dark.primary),[M.dark.primary]),Ce=_=>{const P=M[_],Y=_==="dark"?J:Te,te=Y["--primary-500"]||P.primary,ie=Y["--primary-300"]||Y["--primary-400"]||te,q=_==="dark"?"whiteAlpha.900":"gray.800",B=_==="dark"?"whiteAlpha.700":"gray.600",ue=_==="dark"?"whiteAlpha.200":"blackAlpha.200",be=_==="dark"?"whiteAlpha.300":"blackAlpha.100";return e(L,{borderWidth:"1px",borderRadius:"md",bg:P.bg,p:4,borderColor:ue,children:n(ge,{spacing:3,children:[e(h,{fontWeight:"semibold",color:q,children:i(_==="dark"?"theme.customPreviewDark":"theme.customPreviewLight")}),e(L,{borderRadius:"lg",bg:P.surface,p:4,borderWidth:"1px",borderColor:ue,children:n(ge,{spacing:2,children:[e(h,{fontSize:"lg",fontWeight:"bold",color:q,children:i("theme.previewSampleTitle")}),e(h,{fontSize:"sm",color:B,children:i("theme.previewSampleBody")}),e(O,{size:"sm",bg:te,color:"white",_hover:{opacity:.9},alignSelf:"flex-start",children:i("theme.previewSampleAction")}),n(U,{spacing:2,pt:2,children:[e(L,{flex:"1",h:"2",borderRadius:"full",bg:ie,opacity:.8}),e(L,{flex:"1",h:"2",borderRadius:"full",bg:te,opacity:.9})]})]})}),n(U,{spacing:1,pt:1,flexWrap:"wrap",children:[e(L,{w:6,h:6,borderRadius:"sm",bg:P.bg,borderWidth:"1px",borderColor:be}),e(L,{w:6,h:6,borderRadius:"sm",bg:P.surface,borderWidth:"1px",borderColor:be}),Object.entries(Y).map(([Ie,N])=>e(L,{w:6,h:6,borderRadius:"sm",bg:N,borderWidth:"1px",borderColor:be,title:Ie},Ie))]})]})})},$=n(pi,{minW:{base:"82vw",sm:"240px"},maxW:"320px",zIndex:9999,bg:m,color:y,borderColor:S,maxH:"70vh",overflowY:"auto",children:[e(io,{title:i("theme.builtIn"),sx:D,children:ho.map(_=>{const P=F===_.key;return e(gr,{onClick:()=>oe(_),_hover:{bg:g},children:n(U,{justify:"space-between",w:"full",children:[n(U,{children:[e(L,{w:"4",h:"3",bg:_.accent,borderRadius:"xs",borderWidth:"1px",borderColor:S}),e(h,{children:i(`theme.${_.key}`)})]}),P&&e(mo,{})]})},_.key)})}),!t&&n($t,{children:[e(Yi,{borderColor:S}),n(io,{title:i("theme.customGroup"),sx:D,children:[ae.length?ae.map(_=>{const P=F===`custom:${_.id}`;return e(gr,{onClick:()=>R(_.id),_hover:{bg:g},children:n(U,{justify:"space-between",w:"full",children:[n(U,{children:[e(L,{w:"4",h:"3",bg:"transparent",bgGradient:`linear(to-r, ${_.light.surface}, ${_.light.primary})`,borderRadius:"xs",borderWidth:"1px",borderColor:S}),e(h,{children:_.name})]}),n(U,{spacing:1,children:[P&&e(mo,{}),[{icon:e(mu,{}),label:i("theme.edit"),onClick:()=>w(_)},{icon:e(gu,{}),label:i("theme.delete"),onClick:()=>ce(_.id)}].map(({icon:Y,label:te,onClick:ie})=>e(L,{as:"span",role:"button",tabIndex:0,"aria-label":te,onClick:q=>Pe(q,ie),onKeyDown:q=>{(q.key==="Enter"||q.key===" ")&&Pe(q,ie)},cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",w:6,h:6,borderRadius:"md",transition:"background-color 0.2s ease",_hover:{bg:g},_focusVisible:{outline:"2px solid",outlineColor:"primary.400",outlineOffset:"2px"},children:Y},te))]})]})},_.id)}):e(gr,{isDisabled:!0,children:i("theme.noCustom")}),e(gr,{icon:e(pu,{}),onClick:()=>le(),_hover:{bg:g},children:i("theme.createCustom")})]}),e(Yi,{borderColor:S}),e(gr,{icon:e(fo,{}),onClick:()=>le(po[0]),_hover:{bg:g},children:i("theme.quickPreset")}),e(gr,{icon:e(fu,{}),onClick:fe,_hover:{bg:g},children:i("theme.export")}),e(gr,{icon:e(bu,{}),onClick:()=>p.onOpen(),_hover:{bg:g},children:i("theme.import")}),e(gr,{icon:e(yu,{}),onClick:j,_hover:{bg:g},children:i("theme.reset")})]})]}),X=r==="icon"?e(Is,{as:Be,size:"sm",variant:"outline",icon:e(go,{}),position:"relative"}):e(Is,{as:O,w:"full",justifyContent:"space-between",variant:"ghost",rightIcon:e(go,{}),children:o||i("theme.triggerLabel","Theme")});return n($t,{children:[n(hi,{placement:"bottom-end",children:[X,s?e(Zi,{containerRef:s,children:$}):$]}),n(Kt,{isOpen:u.isOpen,onClose:u.onClose,isCentered:!0,size:"xl",children:[e(Dt,{bg:f,backdropFilter:"blur(4px)"}),n(qt,{mx:4,bg:m,borderColor:S,borderWidth:"1px",color:y,children:[e(Tt,{color:y,children:i(Q?"theme.editThemeTitle":"theme.customTitle")}),e(Jt,{}),e(It,{children:n(me,{spacing:6,align:"stretch",children:[n(x,{children:[e(I,{color:A,children:i("theme.customName")}),e(De,{placeholder:i("theme.customNamePlaceholder")||"",value:M.name,onChange:_=>T(P=>({...P,name:_.target.value}))})]}),n(He,{columns:{base:1,md:2},spacing:4,children:[Ce("light"),Ce("dark")]}),n(He,{columns:{base:1,md:2},spacing:4,children:[n(ge,{spacing:4,children:[n(x,{children:[e(I,{color:A,children:i("theme.lightPrimary")}),e(De,{type:"color",value:M.light.primary,onChange:_=>T(P=>({...P,light:{...P.light,primary:_.target.value}}))}),e(nr,{color:A,children:i("theme.lightPrimaryHint")})]}),n(x,{children:[e(I,{color:A,children:i("theme.lightSurface")}),e(De,{type:"color",value:M.light.surface,onChange:_=>T(P=>({...P,light:{...P.light,surface:_.target.value}}))}),e(nr,{color:A,children:i("theme.lightSurfaceHint")})]}),n(x,{children:[e(I,{color:A,children:i("theme.lightBackground")}),e(De,{type:"color",value:M.light.bg,onChange:_=>T(P=>({...P,light:{...P.light,bg:_.target.value}}))})]})]}),n(ge,{spacing:4,children:[n(x,{children:[e(I,{color:A,children:i("theme.darkPrimary")}),e(De,{type:"color",value:M.dark.primary,onChange:_=>T(P=>({...P,dark:{...P.dark,primary:_.target.value}}))}),e(nr,{color:A,children:i("theme.darkPrimaryHint")})]}),n(x,{children:[e(I,{color:A,children:i("theme.darkSurface")}),e(De,{type:"color",value:M.dark.surface,onChange:_=>T(P=>({...P,dark:{...P.dark,surface:_.target.value}}))}),e(nr,{color:A,children:i("theme.darkSurfaceHint")})]}),n(x,{children:[e(I,{color:A,children:i("theme.darkBackground")}),e(De,{type:"color",value:M.dark.bg,onChange:_=>T(P=>({...P,dark:{...P.dark,bg:_.target.value}}))})]})]})]}),n(L,{children:[n(U,{mb:2,children:[e(fo,{}),e(h,{fontWeight:"semibold",children:i("theme.presets")})]}),e(He,{columns:{base:1,md:3},spacing:3,children:po.map(_=>e(O,{size:"sm",variant:"outline",onClick:()=>T({name:i(`theme.presets.${_.key}.name`),light:{..._.light},dark:{..._.dark}}),children:i(`theme.presets.${_.key}.name`)},_.key))})]})]})}),n(Wt,{children:[e(O,{variant:"ghost",mr:3,onClick:u.onClose,children:i("cancel")}),e(O,{colorScheme:"primary",onClick:H,children:i(Q?"theme.customUpdate":"theme.customSave")})]})]})]}),n(Kt,{isOpen:p.isOpen,onClose:p.onClose,size:"lg",isCentered:!0,children:[e(Dt,{bg:f,backdropFilter:"blur(4px)"}),n(qt,{mx:4,bg:m,borderColor:S,borderWidth:"1px",color:y,children:[e(Tt,{color:y,children:i("theme.importTitle")}),e(Jt,{}),e(It,{children:n(me,{spacing:4,align:"stretch",children:[e(h,{fontSize:"sm",color:A,children:i("theme.importDescription")}),e(Rr,{rows:8,placeholder:i("theme.importPlaceholder")||"",value:ke,onChange:_=>W(_.target.value),bg:"transparent",borderColor:S,color:y})]})}),n(Wt,{children:[e(O,{variant:"ghost",mr:3,onClick:p.onClose,children:i("cancel")}),e(O,{colorScheme:"primary",onClick:Ae,children:i("theme.importAction")})]})]})]})]})},Cu=xe.object({username:xe.string().min(1,"login.fieldRequired"),password:xe.string().min(1,"login.fieldRequired")}),_u=se("img",{baseStyle:{w:12,h:12}}),Au=se(Kc,{baseStyle:{w:5,h:5,strokeWidth:"2px"}}),Du=se(mi,{baseStyle:{w:4,h:4}}),Iu=se(Va,{baseStyle:{w:4,h:4}}),yo=()=>{var A,f;const[t,s]=d.exports.useState(""),[r,o]=d.exports.useState(!1),[i,a]=d.exports.useState(!1),l=qc(),{t:c}=qe(),{colorMode:u}=jr();let p=$a();const{register:m,formState:{errors:g},handleSubmit:S}=en({resolver:ji(Cu)});d.exports.useEffect(()=>{iu(),p.pathname!=="/login"&&l("/login",{replace:!0})},[]);const y=D=>{s("");const F=new FormData;F.append("username",D.username),F.append("password",D.password),F.append("grant_type","password"),o(!0),Ee("/admin/token",{method:"post",body:F}).then(({access_token:Z})=>{console.log("Token received:",Z),su(Z),l("/")}).catch(Z=>{var ae,v;s(((v=(ae=Z.response)==null?void 0:ae._data)==null?void 0:v.detail)||"Login failed")}).finally(()=>o(!1))};return e(me,{justifyContent:"center",minH:"100vh",p:"6",w:"full",children:e(Fr,{maxW:"500px",w:"full",bg:"surface.light",_dark:{bg:"surface.dark",borderColor:"whiteAlpha.200"},borderWidth:"1px",borderColor:"light-border",boxShadow:"md",children:n(Pn,{children:[n(U,{justifyContent:"end",spacing:2,mb:6,children:[e(uu,{}),e(Yl,{minimal:!0})]}),n(me,{alignItems:"center",w:"full",spacing:4,children:[e(_u,{src:Pa,alt:c("appName")||"Rebecca",filter:u==="dark"?"brightness(0) invert(1)":"none"}),e(h,{fontSize:"2xl",fontWeight:"semibold",children:c("login.loginYourAccount")}),e(h,{color:"gray.600",_dark:{color:"gray.400"},children:c("login.welcomeBack")})]}),e(L,{w:"full",pt:"4",children:e("form",{onSubmit:S(y),children:n(me,{spacing:4,children:[e(x,{children:e(Sr,{w:"full",placeholder:c("username"),...m("username"),error:c((A=g==null?void 0:g.username)==null?void 0:A.message)})}),n(x,{isInvalid:!!g.password,children:[n(Dr,{children:[e(De,{w:"full",type:i?"text":"password",placeholder:c("password"),...m("password")}),e(Wr,{children:e(Be,{"aria-label":i?c("admins.hidePassword","Hide"):c("admins.showPassword","Show"),size:"sm",variant:"ghost",onClick:()=>a(!i),icon:i?e(Iu,{}):e(Du,{})})})]}),e(Zr,{children:(f=g.password)==null?void 0:f.message})]}),t&&n(Mr,{status:"error",rounded:"md",children:[e(Ur,{}),e(Bn,{children:t})]}),n(O,{isLoading:r,type:"submit",w:"full",colorScheme:"primary",children:[e(Au,{marginRight:1}),c("login")]})]})})})]})})})};var Ve=(t=>(t.Standard="standard",t.Reseller="reseller",t.Sudo="sudo",t.FullAccess="full_access",t))(Ve||{}),ln=(t=>(t.Active="active",t.Disabled="disabled",t.Deleted="deleted",t))(ln||{}),it=(t=>(t.Create="create",t.Delete="delete",t.ResetUsage="reset_usage",t.Revoke="revoke",t.CreateOnHold="create_on_hold",t.AllowUnlimitedData="allow_unlimited_data",t.AllowUnlimitedExpire="allow_unlimited_expire",t.AllowNextPlan="allow_next_plan",t.AdvancedActions="advanced_actions",t))(it||{}),br=(t=>(t.View="can_view",t.Edit="can_edit",t.ManageSudo="can_manage_sudo",t))(br||{}),Ct=(t=>(t.Usage="usage",t.Admins="admins",t.Services="services",t.Hosts="hosts",t.Nodes="nodes",t.Integrations="integrations",t.Xray="xray",t))(Ct||{});const Pu=t=>JSON.parse(JSON.stringify(t)),So={users:{[it.Create]:!0,[it.Delete]:!0,[it.ResetUsage]:!0,[it.Revoke]:!0,[it.CreateOnHold]:!0,[it.AllowUnlimitedData]:!0,[it.AllowUnlimitedExpire]:!0,[it.AllowNextPlan]:!0,[it.AdvancedActions]:!0,max_data_limit_per_user:null},admin_management:{[br.View]:!1,[br.Edit]:!1,[br.ManageSudo]:!1},sections:{[Ct.Usage]:!1,[Ct.Admins]:!1,[Ct.Services]:!1,[Ct.Hosts]:!1,[Ct.Nodes]:!1,[Ct.Integrations]:!1,[Ct.Xray]:!1}},Eu={users:{[it.Create]:!0,[it.Delete]:!0,[it.ResetUsage]:!0,[it.Revoke]:!0,[it.CreateOnHold]:!0,[it.AllowUnlimitedData]:!0,[it.AllowUnlimitedExpire]:!0,[it.AllowNextPlan]:!0,[it.AdvancedActions]:!0,max_data_limit_per_user:null},admin_management:{[br.View]:!0,[br.Edit]:!0,[br.ManageSudo]:!1},sections:{[Ct.Usage]:!0,[Ct.Admins]:!0,[Ct.Services]:!0,[Ct.Hosts]:!0,[Ct.Nodes]:!0,[Ct.Integrations]:!0,[Ct.Xray]:!0}},Tu={users:{[it.Create]:!0,[it.Delete]:!0,[it.ResetUsage]:!0,[it.Revoke]:!0,[it.CreateOnHold]:!0,[it.AllowUnlimitedData]:!0,[it.AllowUnlimitedExpire]:!0,[it.AllowNextPlan]:!0,[it.AdvancedActions]:!0,max_data_limit_per_user:null},admin_management:{[br.View]:!0,[br.Edit]:!0,[br.ManageSudo]:!0},sections:{[Ct.Usage]:!0,[Ct.Admins]:!0,[Ct.Services]:!0,[Ct.Hosts]:!0,[Ct.Nodes]:!0,[Ct.Integrations]:!0,[Ct.Xray]:!0}},xo={[Ve.Standard]:So,[Ve.Reseller]:So,[Ve.Sudo]:Eu,[Ve.FullAccess]:Tu},bi=(t=Ve.Standard)=>{var s;return Pu((s=xo[t])!=null?s:xo[Ve.Standard])},vo=t=>typeof t=="object"&&t!==null&&!Array.isArray(t),Gl=(t,s)=>{const r={...t};return Object.entries(s).forEach(([o,i])=>{if(i!==void 0){if(vo(i)&&vo(r[o])){r[o]=Gl(r[o],i);return}r[o]=i}}),r},zu=(t,s)=>s?Gl(bi(t),s):bi(t),zi=bi(Ve.Standard),Nu=async()=>await Ee("/admin"),xr=()=>{const{data:t,isError:s,isLoading:r,isSuccess:o,error:i}=fr({queryFn:()=>Nu()}),a={role:Ve.Standard,permissions:bi(Ve.Standard),telegram_id:"",username:"",users_usage:0,status:ln.Active,disabled_reason:null},l=(t==null?void 0:t.role)||Ve.Standard,c=t!=null&&t.permissions?zu(l,t.permissions):bi(l);return{userData:t?{...t,role:l,permissions:c}:{...a,role:l,permissions:c},getUserIsPending:r,getUserIsSuccess:o,getUserIsError:s,getUserError:i}},Ru=()=>Ee("/ads"),Lu=(t=!0)=>fr({queryKey:["ads"],queryFn:Ru,enabled:t,staleTime:1e3*60*30,cacheTime:1e3*60*60}),Mu=({ad:t,compact:s=!1,ratio:r,maxSize:o})=>{const i=Le("gray.200","whiteAlpha.200"),a=Le("gray.600","gray.300"),l=Le("primary.600","primary.200"),c=s?2:3,u=s?2:3,p=t.type==="image"||Boolean(t.image_url),m=r!=null?r:s?3/1:1,g=o!=null?o:460,S=p?e(Jc,{ratio:m,w:"full",children:e(Yc,{alt:t.title||t.text||"Advertisement",borderRadius:"md",objectFit:"contain",src:t.image_url,w:"100%",h:"100%"})}):n(ge,{spacing:1,children:[t.title&&e(h,{fontSize:s?"sm":"md",fontWeight:"semibold",children:t.title}),t.text&&e(h,{fontSize:s?"xs":"sm",color:a,noOfLines:s?3:4,children:t.text})]}),y=n(L,{borderColor:i,borderWidth:"1px",borderRadius:"md",bg:Le("white","gray.800"),px:u,py:c,w:"full",maxW:`${g}px`,shadow:"sm",transition:"box-shadow 0.2s ease",_hover:{shadow:"md"},children:[S,!p&&t.cta&&e(h,{fontSize:s?"xs":"sm",fontWeight:"semibold",color:l,mt:t.image_url?2:3,children:t.cta})]});return t.link?e(Gc,{href:t.link,isExternal:!0,display:"block",_hover:{textDecoration:"none"},children:y}):y},Uu=t=>(t||"en").split(/[-_]/)[0].toLowerCase(),Ou=(t,s,r)=>{var l,c,u;if(!t)return;const o=Uu(r),i=(c=(l=t.locales)==null?void 0:l[o])==null?void 0:c[s];if(i!=null&&i.length)return i[0];const a=(u=t.default)==null?void 0:u[s];return a==null?void 0:a[0]},zn={baseStyle:{w:5,h:5}},Wu=se(Xc,zn),Fu=se(Qc,zn),Hu=se(Zc,zn),ha=se(jc,zn),Bu=se(ed,zn),Vu=se(td,zn),$u=se(ea,zn),Ku=se(xl,zn),qu=se(vl,zn),wo=se("img",{baseStyle:{w:8,h:8}}),ko=({collapsed:t,inDrawer:s=!1,onRequestExpand:r})=>{var ke;const{t:o,i18n:i}=qe(),a=$a(),{colorMode:l}=jr(),{userData:c,getUserIsSuccess:u}=xr(),p=u,{data:m}=Lu(p),g=i.language||"en",S=p?Ou(m,"sidebar",g):void 0,y=d.exports.useMemo(()=>{switch(c.role){case Ve.FullAccess:return o("admins.roles.fullAccess","Full access");case Ve.Sudo:return o("admins.roles.sudo","Sudo");case Ve.Standard:default:return o("admins.roles.standard","Standard")}},[o,c.role]),A=(ke=c.permissions)==null?void 0:ke.sections,f=Boolean(A==null?void 0:A[Ct.Usage]),D=Boolean(A==null?void 0:A[Ct.Admins]),F=Boolean(A==null?void 0:A[Ct.Services]),ae=[...[A!=null&&A[Ct.Hosts]?{title:o("header.hostSettings"),url:"/hosts",icon:Hu}:null,A!=null&&A[Ct.Nodes]?{title:o("header.nodeSettings"),url:"/node-settings",icon:Bu}:null,A!=null&&A[Ct.Integrations]?{title:o("header.integrationSettings","Master Settings"),url:"/integrations",icon:ha}:null,A!=null&&A[Ct.Xray]?{title:o("header.xraySettings"),url:"/xray-settings",icon:ha}:null].filter(Boolean)],v=()=>{s&&r&&r()};F&&ae.unshift({title:o("services.menu","Services"),url:"/services",icon:Ku});const M=ae.some(W=>a.pathname===W.url),[T,Q]=d.exports.useState(M);d.exports.useEffect(()=>{M&&Q(!0)},[M]);const _e=[{title:o("dashboard"),url:"/",icon:Wu},{title:o("users"),url:"/users",icon:Fu}];return f&&_e.push({title:o("usage.menu","Usage"),url:"/usage",icon:qu}),D&&_e.push({title:o("admins","Admins"),url:"/admins",icon:Vu}),ae.length>0&&_e.push({title:o("header.settings"),icon:ha,subItems:ae}),e(L,{w:s?"full":t?"16":"60",h:s?"100%":"100vh",maxH:s?"100%":"100vh",bg:"surface.light",borderRight:s?void 0:"1px",borderColor:s?void 0:"light-border",_dark:{bg:"surface.dark",borderColor:s?void 0:"whiteAlpha.200"},transition:"width 0.3s",position:s?"relative":"fixed",top:s?void 0:"0",left:s?void 0:"0",overflowY:"auto",overflowX:"hidden",flexShrink:0,children:n(me,{spacing:2,p:t?2:4,align:"stretch",h:"100%",justify:"space-between",children:[n(L,{flex:"1",overflowY:"auto",children:[t?e(U,{justify:"center",mb:6,children:e(mt,{label:"Rebecca",placement:"right",hasArrow:!0,children:e(wo,{src:Pa,alt:"Rebecca",filter:l==="dark"?"brightness(0) invert(1)":"none"})})}):n(U,{spacing:3,align:"center",mb:6,px:2,children:[e(wo,{src:Pa,alt:"Rebecca",filter:l==="dark"?"brightness(0) invert(1)":"none"}),e(h,{fontSize:"lg",fontWeight:"bold",color:"primary.600",_dark:{color:"primary.300"},children:o("menu")})]}),_e.map(W=>{const oe=W.url,R=typeof oe=="string"&&a.pathname===oe||typeof oe=="string"&&oe!=="/"&&a.pathname.startsWith(oe)||W.subItems&&W.subItems.some(w=>a.pathname===w.url),le=W.icon;return e(L,{children:W.subItems?n($t,{children:[e(mt,{label:t?W.title:"",placement:"right",hasArrow:!0,children:n(U,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:R?"primary.50":"transparent",color:R?"primary.600":"gray.700",_dark:{bg:R?"primary.900":"transparent",color:R?"primary.200":"gray.300"},_hover:{bg:R?"primary.50":"gray.50",_dark:{bg:R?"primary.900":"gray.700"}},transition:"all 0.2s",justifyContent:t?"center":"space-between",onClick:()=>{t?(r&&r(),Q(!0)):Q(!T)},children:[n(U,{spacing:3,children:[e(le,{w:t?5:void 0,h:t?5:void 0}),!t&&e(h,{fontSize:"sm",fontWeight:R?"semibold":"normal",children:W.title})]}),!t&&e($u,{transform:T?"rotate(180deg)":"rotate(0deg)"})]})}),!t&&e(Es,{in:T,animateOpacity:!0,children:e(me,{align:"stretch",pl:6,spacing:1,mt:2,children:W.subItems.map(w=>{const H=a.pathname===w.url,ce=w.icon;return e(ao,{to:w.url,onClick:v,children:n(U,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:H?"primary.50":"transparent",color:H?"primary.600":"gray.700",_dark:{bg:H?"primary.900":"transparent",color:H?"primary.200":"gray.300"},_hover:{bg:H?"primary.50":"gray.50",_dark:{bg:H?"primary.900":"gray.700"}},transition:"all 0.2s",children:[e(ce,{w:t?5:void 0,h:t?5:void 0}),e(h,{fontSize:"sm",fontWeight:H?"semibold":"normal",children:w.title})]})},w.url)})})})]}):W.url?e(ao,{to:W.url,onClick:v,children:e(mt,{label:t?W.title:"",placement:"right",hasArrow:!0,children:n(U,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:R?"primary.50":"transparent",color:R?"primary.600":"gray.700",_dark:{bg:R?"primary.900":"transparent",color:R?"primary.200":"gray.300"},_hover:{bg:R?"primary.50":"gray.50",_dark:{bg:R?"primary.900":"gray.700"}},transition:"all 0.2s",justifyContent:t?"center":"flex-start",children:[e(le,{w:t?5:void 0,h:t?5:void 0}),!t&&e(h,{fontSize:"sm",fontWeight:R?"semibold":"normal",children:W.title})]})})}):null},W.title)})]}),S&&!t&&e(L,{px:t?2:3,py:3,mt:4,w:"full",children:e(Mu,{ad:S})}),u&&c.username&&e(L,{px:t?2:3,py:2,borderTop:"1px",borderColor:"light-border",_dark:{borderColor:"whiteAlpha.200"},mt:4,children:t?e(mt,{label:`${c.username} \xB7 ${y}`,placement:"right",hasArrow:!0,children:e(L,{w:"8",h:"8",borderRadius:"full",bg:"primary.100",_dark:{bg:"primary.800"},display:"flex",alignItems:"center",justifyContent:"center",mx:"auto",flexShrink:0,children:e(h,{fontSize:"sm",fontWeight:"bold",color:"primary.600",_dark:{color:"primary.300"},textAlign:"center",children:c.username.charAt(0).toUpperCase()})})}):n(me,{align:"flex-start",spacing:1,children:[e(h,{fontSize:"xs",fontWeight:"semibold",color:"gray.500",_dark:{color:"gray.500"},children:"username:"}),e(h,{fontSize:"sm",fontWeight:"medium",color:"gray.700",_dark:{color:"gray.300"},noOfLines:1,children:c.username}),e(h,{fontSize:"xs",fontWeight:"semibold",color:"gray.500",_dark:{color:"gray.500"},children:o("admins.roleLabel","Admin role")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:y})]})})]})})},Ju=()=>{const[t,s]=d.exports.useState(null);return jr(),d.exports.useEffect(()=>{fetch("https://api.github.com/repos/rebeccapanel/Rebecca").then(o=>o.json()).then(o=>{o.stargazers_count&&s(o.stargazers_count)}).catch(()=>{})},[]),e(L,{as:"button",onClick:()=>{window.open("https://github.com/rebeccapanel/Rebecca","_blank","noopener,noreferrer")},px:3,py:1.5,borderRadius:"md",borderWidth:"1px",borderColor:"gray.300",bg:"white",_dark:{borderColor:"gray.600",bg:"gray.800"},_hover:{bg:"gray.50",borderColor:"gray.400",transform:"translateY(-1px)",boxShadow:"sm",_dark:{bg:"gray.700",borderColor:"gray.500"}},transition:"all 0.2s",cursor:"pointer","aria-label":"GitHub Stars",children:n(U,{spacing:2,align:"center",children:[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"})}),n(U,{spacing:1,px:1.5,py:.5,borderRadius:"full",bg:"gray.100",_dark:{bg:"gray.700"},children:[e(rd,{style:{width:"14px",height:"14px",color:"#fbbf24"}}),t!==null?e(h,{fontSize:"xs",fontWeight:"bold",color:"gray.700",_dark:{color:"gray.200"},lineHeight:"1",children:t>1e3?`${(t/1e3).toFixed(1)}k`:t}):e(h,{fontSize:"xs",fontWeight:"bold",color:"gray.500",_dark:{color:"gray.400"},lineHeight:"1",children:"..."})]})]})})},qi=nd,Yu="https://cdn.jsdelivr.net/npm/emoji-datasource-apple@15.0.1/img/",Xl={base:Yu,folder:"apple/64",ext:".png",className:"apple-emoji"},pa=t=>{var s,r;return typeof t=="string"&&((r=(s=qi.test)==null?void 0:s.call(qi,t))!=null?r:!1)},Gu=t=>t.some(s=>{var r;return s.type==="characterData"?pa((r=s.target)==null?void 0:r.data):s.type==="childList"?Array.from(s.addedNodes).some(o=>{if(o.nodeType===Node.TEXT_NODE)return pa(o.textContent);if(o.nodeType===Node.ELEMENT_NODE){const i=o;return i.tagName==="IMG"&&i.classList.contains(Xl.className)?!1:pa(i.textContent)}return!1}):!1}),Xu=()=>{const t=$a();d.exports.useEffect(()=>{const s=document.getElementById("root");if(!s)return;const r=()=>{qi.parse(s,Xl)};r();const o=new MutationObserver(i=>{Gu(i)&&requestAnimationFrame(r)});return o.observe(s,{childList:!0,subtree:!0,characterData:!0}),()=>o.disconnect()},[t])},ra={baseStyle:{w:4,h:4}},Qu=se(sd,ra),Zu=se(wl,ra),ju=se(kl,ra),eh=se(bl,ra);function th(){const[t,s]=d.exports.useState(!1),r=Or({base:!0,md:!1}),o=rr(),i=rr(),a=d.exports.useRef(null),{t:l,i18n:c}=qe();Xu();const u=[{code:"en",label:"English",flag:"US"},{code:"fa",label:"\u067E\u0627\u0631\u0633\u06CC",flag:"IR"},{code:"zh-cn",label:"\u4E2D\u6587",flag:"CN"},{code:"ru",label:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",flag:"RU"}],p=m=>{c.changeLanguage(m)};return n(pt,{minH:"100vh",maxH:"100vh",overflow:"hidden",children:[r?null:e(ko,{collapsed:t,onRequestExpand:()=>s(!1)}),n(pt,{flex:"1",direction:"column",minW:"0",overflow:"hidden",ml:r?"0":t?"16":"60",transition:"margin-left 0.3s",children:[n(L,{as:"header",h:"16",minH:"16",borderBottom:"1px",borderColor:"light-border",bg:"surface.light",_dark:{borderColor:"whiteAlpha.200",bg:"surface.dark"},display:"flex",alignItems:"center",px:"6",justifyContent:"space-between",flexShrink:0,children:[e(Be,{size:"sm",variant:"ghost","aria-label":"toggle sidebar",onClick:()=>{r?o.onOpen():s(!t)},icon:e(Zu,{})}),n(U,{spacing:2,children:[e(Ju,{}),n($n,{isOpen:i.isOpen,onOpen:i.onOpen,onClose:i.onClose,placement:"bottom-end",children:[e(Kn,{children:e(Be,{size:"sm",variant:"outline",icon:e(ju,{}),"aria-label":"quick actions",onClick:()=>i.isOpen?i.onClose():i.onOpen()})}),n(qn,{ref:a,w:"full",maxW:{base:"calc(100vw - 2rem)",sm:"56"},mx:{base:4,sm:0},children:[e(us,{}),e(Jn,{children:n(ge,{spacing:2,children:[n(hi,{placement:"left-start",isLazy:!0,children:[e(Is,{as:O,justifyContent:"space-between",rightIcon:e(eh,{}),variant:"ghost",children:l("header.language","Language")}),e(Zi,{containerRef:a,children:e(pi,{minW:{base:"100%",sm:"200px"},maxW:{base:"100%",sm:"240px"},maxH:"60vh",overflowY:"auto",children:u.map(({code:m,label:g,flag:S})=>{const y=c.language===m;return e(gr,{onClick:()=>{p(m),i.onClose()},children:n(U,{justify:"space-between",w:"full",children:[n(U,{spacing:2,children:[e(yl,{countryCode:S,svg:!0,style:{width:"16px",height:"12px"}}),e(h,{children:g})]}),y&&e(vi,{width:16})]})},m)})})})]}),e(Wn,{}),e(Yl,{trigger:"menu",triggerLabel:l("header.theme","Theme"),portalContainer:a}),e(Wn,{}),e(O,{colorScheme:"red",leftIcon:e(Qu,{}),justifyContent:"flex-start",as:id,to:"/login",onClick:i.onClose,children:l("header.logout","Log out")})]})})]})]})]})]}),e(L,{as:"main",flex:"1",p:"6",overflow:"auto",minH:"0",children:e(ad,{})})]}),r&&n(od,{isOpen:o.isOpen,placement:"left",onClose:o.onClose,size:"xs",children:[e(Dt,{}),e(ld,{bg:"surface.light",_dark:{bg:"surface.dark"},children:e(It,{p:0,children:e(ko,{collapsed:!1,inDrawer:!0,onRequestExpand:o.onClose})})})]})]})}const Ql="rebecca-num-users-per-page",Co=10,rh=()=>{const t=localStorage.getItem(Ql)||Co.toString();return parseInt(t)||Co},nh=t=>localStorage.setItem(Ql,t),Zl="-created_at",sh=60*60*1e3,ih=t=>{const s={sort:t.sort||Zl};return Object.keys(t).forEach(r=>{if(r==="sort")return;const o=t[r];if(Array.isArray(o)){if(o.length===0)return;s[r]=o;return}o==null||o===""||(s[r]=o)}),s},ah=t=>JSON.stringify(Object.keys(t).sort().map(s=>[s,t[s]])),oh=(t,s={})=>{var p;const r=ih(t),o=ah(r),{lastUsersFetchAt:i,usersCacheKey:a,users:l}=Lt.getState(),c=Date.now();if(!s.force&&i&&a===o&&c-i<sh)return Promise.resolve(l);Lt.setState({loading:!0});const u={...r};return(p=r.advancedFilters)!=null&&p.length&&(u.filter=r.advancedFilters),r.owner&&(u.admin=r.owner),r.serviceId!==void 0&&(u.service_id=r.serviceId),delete u.advancedFilters,delete u.owner,delete u.serviceId,Ee("/users",{query:u}).then(m=>{var A,f;const g=(A=m.users_limit)!=null?A:null,S=(f=m.active_total)!=null?f:null,y=g!=null&&g>0&&S!==null?S>=g:!1;return Lt.setState({users:m,isUserLimitReached:y,lastUsersFetchAt:Date.now(),usersCacheKey:o}),m}).finally(()=>{Lt.setState({loading:!1})})},yi=()=>Ee("/inbounds").then(t=>{Lt.setState({inbounds:new Map(Object.entries(t))})}).finally(()=>{Lt.setState({loading:!1})}),Lt=Us(cd((t,s)=>({version:null,editingUser:null,deletingUser:null,isCreatingNewUser:!1,QRcodeLinks:null,subscribeUrl:null,users:{users:[],total:0,active_total:0,users_limit:null},loading:!0,isUserLimitReached:!1,isResetingAllUsage:!1,lastUsersFetchAt:null,usersCacheKey:null,isEditingNodes:!1,resetUsageUser:null,revokeSubscriptionUser:null,filters:{limit:rh(),sort:Zl,advancedFilters:[],owner:void 0,serviceId:void 0},inbounds:new Map,isEditingCore:!1,refetchUsers:(r=!1)=>{oh(s().filters,{force:r})},resetAllUsage:()=>Ee("/users/reset",{method:"POST"}).then(()=>{s().onResetAllUsage(!1),s().refetchUsers(!0)}),onResetAllUsage:r=>t({isResetingAllUsage:r}),onCreateUser:r=>t({isCreatingNewUser:r}),onEditingUser:r=>{t({editingUser:r})},onDeletingUser:r=>{t({deletingUser:r})},onFilterChange:r=>{t({filters:{...s().filters,...r}}),s().refetchUsers()},setQRCode:r=>{t({QRcodeLinks:r})},deleteUser:r=>(t({editingUser:null}),Ee(`/user/${r.username}`,{method:"DELETE"}).then(()=>{t({deletingUser:null}),s().refetchUsers(!0),ii.invalidateQueries(Ni)})),createUser:r=>Ee("/user",{method:"POST",body:r}).then(()=>{t({editingUser:null}),s().refetchUsers(!0),ii.invalidateQueries(Ni)}),createUserWithService:r=>Ee("/v2/users",{method:"POST",body:r}).then(()=>{t({editingUser:null}),s().refetchUsers(!0),ii.invalidateQueries(Ni)}),editUser:(r,o)=>Ee(`/v2/users/${r}`,{method:"PUT",body:o}).then(()=>{s().onEditingUser(null),s().refetchUsers(!0)}),fetchUserUsage:(r,o)=>{for(const i in o)o[i]||delete o[i];return Ee(`/user/${r.username}/usage`,{method:"GET",query:o})},onEditingNodes:r=>{t({isEditingNodes:r})},setSubLink:r=>{t({subscribeUrl:r})},resetDataUsage:r=>Ee(`/user/${r.username}/reset`,{method:"POST"}).then(()=>{t({resetUsageUser:null}),s().refetchUsers(!0)}),revokeSubscription:r=>Ee(`/user/${r.username}/revoke_sub`,{method:"POST"}).then(o=>{t({revokeSubscriptionUser:null,editingUser:o}),s().refetchUsers(!0)}),performBulkUserAction:r=>Ee("/users/actions",{method:"POST",body:r}).then(o=>(s().refetchUsers(!0),ii.invalidateQueries(Ni),o)),onEditingCore:r=>t({isEditingCore:r})})));function $e(t,s=2,r=!1){if(!+t){const u=[0,"B"];return r?u:`${u[0]} ${u[1]}`}const o=1024,i=s<0?0:s,a=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],l=Math.floor(Math.log(t)/Math.log(o)),c=parseFloat((t/Math.pow(o,l)).toFixed(i));return r?[c,a[l]]:`${c} ${a[l]}`}const lh=t=>{if(t!==null)return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},ch=[{label:"d",seconds:24*60*60},{label:"h",seconds:60*60},{label:"m",seconds:60},{label:"s",seconds:1}],ma=(t=0)=>{const s=Math.max(0,Math.floor(t));if(s===0)return"0s";const r=[];let o=s;for(const i of ch){const a=Math.floor(o/i.seconds);a>0&&(r.push(`${a}${i.label}`),o-=a*i.seconds)}return r.join(" ")},Ni="statistics-query-key",dh={baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}},uh=se(dd,dh),Qr=t=>{var s;return(s=lh(t))!=null?s:t.toString()},On=t=>(t!=null?t:"").trim().replace(/^v/i,""),jl=[{labelKey:"historyInterval.2m",seconds:120},{labelKey:"historyInterval.10m",seconds:600},{labelKey:"historyInterval.30m",seconds:1800},{labelKey:"historyInterval.1h",seconds:3600},{labelKey:"historyInterval.3h",seconds:10800},{labelKey:"historyInterval.5h",seconds:18e3}],hh=({isOpen:t,onClose:s,payload:r,intervalSeconds:o,onIntervalChange:i,t:a})=>{var f;const{colorMode:l}=jr(),u=Math.floor(Date.now()/1e3)-o,p=d.exports.useMemo(()=>!r||r.type==="network"||r.type==="panel"?[]:r.entries.filter(D=>D.timestamp>=u),[r,u]),m=d.exports.useMemo(()=>!r||r.type!=="network"?[]:r.entries.filter(D=>D.timestamp>=u),[r,u]),g=d.exports.useMemo(()=>!r||r.type!=="panel"?[]:r.cpuEntries.filter(D=>D.timestamp>=u),[r,u]),S=d.exports.useMemo(()=>!r||r.type!=="panel"?[]:r.memoryEntries.filter(D=>D.timestamp>=u),[r,u]),y=d.exports.useMemo(()=>r?r.type==="network"?[{name:a("networkIncoming"),data:m.map(D=>[D.timestamp*1e3,D.incoming])},{name:a("networkOutgoing"),data:m.map(D=>[D.timestamp*1e3,D.outgoing])}]:r.type==="panel"?[{name:a("cpuUsage"),data:g.map(D=>[D.timestamp*1e3,D.value])},{name:a("memoryUsage"),data:S.map(D=>[D.timestamp*1e3,D.value])}]:[{name:r.metricLabel,data:p.map(D=>[D.timestamp*1e3,D.value])}]:[],[p,m,g,S,r,a]),A=d.exports.useMemo(()=>({chart:{type:"line",animations:{enabled:!1},toolbar:{show:!1},zoom:{enabled:!1},background:"transparent"},theme:{mode:l},stroke:{curve:"smooth"},xaxis:{type:"datetime",labels:{datetimeFormatter:{hour:"HH:mm"}}},yaxis:{decimalsInFloat:0},tooltip:{x:{format:"HH:mm:ss"}}}),[l]);return n(Kt,{isOpen:t,onClose:s,size:"xl",scrollBehavior:"inside",children:[e(Dt,{}),n(qt,{children:[e(Tt,{children:a("historyModalTitle",{metric:(f=r==null?void 0:r.title)!=null?f:""})}),e(Jt,{}),e(It,{children:n(ge,{spacing:3,children:[e(pt,{wrap:"wrap",gap:2,children:jl.map(D=>e(O,{size:"sm",variant:o===D.seconds?"solid":"outline",onClick:()=>i(D.seconds),children:a(D.labelKey)},D.seconds))}),e(an,{options:A,series:y,type:"line",height:300})]})}),e(Wt,{children:e(O,{onClick:s,children:a("close")})})]})]})},ph=({values:t,accent:s})=>{const r=Le("gray.600","gray.300"),o=t.length?t:[0],i=Math.max(...o,1);return e(U,{alignItems:"flex-end",spacing:"2px",mt:2,minH:"42px",w:"full",overflow:"hidden",children:o.map((a,l)=>{const c=i>0?a/i*100:0,u=Math.max(4,Math.round(c/100*40));return e(L,{flex:"0 1 4px",minW:"2px",maxW:"4px",h:`${u}px`,bg:s!=null?s:r,borderRadius:"1px",transition:"all 0.2s"},l)})})},ui=({label:t,value:s,history:r,accent:o,onOpen:i,actionLabel:a})=>n(ge,{spacing:1,children:[n(U,{justifyContent:"space-between",alignItems:"center",children:[n(L,{children:[e(h,{fontSize:"xs",color:"gray.500",children:t}),e(h,{fontSize:"lg",fontWeight:"semibold",children:s})]}),i&&e(O,{size:"xs",variant:"ghost",onClick:i,children:a})]}),e(ph,{values:r,accent:o})]}),cr=({label:t,value:s,colorScheme:r="gray"})=>{const o=Le("gray.200","gray.700"),i=Le("white","gray.900"),a=Le(r==="gray"?"gray.800":`${r}.600`,r==="gray"?"gray.100":`${r}.300`);return n(L,{px:3,py:2,borderRadius:"md",borderWidth:"1px",borderColor:o,bg:i,_dark:{bg:"gray.800",borderColor:"gray.700"},children:[e(h,{fontSize:"xs",color:"gray.500",children:t}),e(h,{fontWeight:"semibold",color:a,children:s})]})},mh=({data:t,t:s,onOpenHistory:r})=>{var p,m;const o=t.cpu_history.map(g=>g.value),i=t.memory_history.map(g=>g.value),a=t.network_history.map(g=>g.incoming),l=fr({queryKey:["panel-latest-release"],queryFn:async()=>{const g=await window.fetch("https://api.github.com/repos/rebeccapanel/Rebecca/releases/latest",{headers:{Accept:"application/vnd.github+json"}});if(!g.ok)throw new Error("Failed to load latest panel release");return g.json()},refetchOnWindowFocus:!1,staleTime:5*60*1e3,retry:1}),c=((p=l.data)==null?void 0:p.tag_name)||((m=l.data)==null?void 0:m.name)||"",u=On(c)&&On(t.version)&&On(c)!==On(t.version);return e(Fr,{p:5,borderRadius:"12px",boxShadow:"none",children:n(ge,{spacing:4,children:[n(ge,{direction:{base:"column",md:"row"},spacing:{base:2,md:4},justifyContent:"space-between",align:{base:"flex-start",md:"center"},children:[e(h,{fontSize:"lg",fontWeight:"semibold",children:s("systemOverview")}),n(_s,{spacing:2,justify:{base:"flex-start",md:"flex-end"},children:[e(Fn,{children:n(rt,{colorScheme:"gray",children:["v",t.version]})}),c&&e(Fn,{children:e(rt,{colorScheme:u?"green":"blue",children:u?s("system.updateAvailable",{version:c,defaultValue:"Update available: v{{version}}"}):s("system.latestRelease",{version:c,defaultValue:"Latest release: v{{version}}"})})}),e(Fn,{children:n(rt,{colorScheme:"gray",children:[s("loadAverage"),": "," ",t.load_avg.length?t.load_avg.map(g=>g.toFixed(2)).join(" | "):"-"]})})]})]}),n(He,{columns:{base:1,md:3},gap:4,children:[e(ui,{label:s("cpuUsage"),value:`${t.cpu_usage.toFixed(1)}%`,history:o,actionLabel:s("viewHistory"),onOpen:()=>r({type:"cpu",title:s("cpuUsage"),metricLabel:s("cpuUsage"),entries:t.cpu_history})}),e(ui,{label:s("memoryUsage"),value:`${t.memory.percent.toFixed(1)}%`,history:i,actionLabel:s("viewHistory"),onOpen:()=>r({type:"memory",title:s("memoryUsage"),metricLabel:s("memoryUsage"),entries:t.memory_history})}),e(ui,{label:s("networkHistory"),value:`${$e(t.incoming_bandwidth_speed)}/s`,history:a,actionLabel:s("viewHistory"),onOpen:()=>r({type:"network",title:s("networkHistory"),entries:t.network_history})})]}),n(He,{columns:{base:1,md:2},gap:4,children:[e(cr,{label:s("incomingSpeed"),value:`${$e(t.incoming_bandwidth_speed)}/s`,colorScheme:"green"}),e(cr,{label:s("outgoingSpeed"),value:`${$e(t.outgoing_bandwidth_speed)}/s`,colorScheme:"blue"})]}),n(He,{columns:{base:1,md:3},gap:4,children:[e(cr,{label:s("memoryUsage"),value:`${$e(t.memory.current)} / ${$e(t.memory.total)}`}),e(cr,{label:s("swapUsage"),value:`${$e(t.swap.current)} / ${$e(t.swap.total)}`}),e(cr,{label:s("diskUsage"),value:`${$e(t.disk.current)} / ${$e(t.disk.total)}`})]}),n(ge,{direction:{base:"column",md:"row"},spacing:2,flexWrap:"wrap",alignItems:"flex-start",children:[n(rt,{colorScheme:"green",children:[s("systemUptime"),": ",ma(t.uptime_seconds)]}),n(rt,{colorScheme:"blue",children:[s("panelUptime"),": ",ma(t.panel_uptime_seconds)]}),n(rt,{colorScheme:"orange",children:[s("xrayUptime"),": ",ma(t.xray_uptime_seconds)]})]}),t.last_xray_error&&!t.xray_running&&n(L,{mt:4,p:4,borderRadius:"md",bg:"red.50",borderWidth:"1px",borderColor:"red.200",_dark:{bg:"rgba(239, 68, 68, 0.1)",borderColor:"red.800"},children:[e(U,{spacing:2,mb:2,alignItems:"center",children:n(h,{fontSize:"sm",fontWeight:"semibold",color:"red.600",_dark:{color:"red.400"},children:[s("coreError","Core Error"),":"]})}),e(h,{fontSize:"sm",color:"red.700",fontFamily:"mono",whiteSpace:"pre-wrap",wordBreak:"break-word",_dark:{color:"red.300"},children:t.last_xray_error})]})]})})},gh=({data:t,t:s,onOpenHistory:r})=>{const o=t.panel_cpu_history.map(a=>a.value),i=t.panel_memory_history.map(a=>a.value);return e(Fr,{p:5,borderRadius:"12px",boxShadow:"none",children:n(ge,{spacing:4,children:[n(U,{justifyContent:"space-between",alignItems:"center",children:[e(h,{fontSize:"lg",fontWeight:"semibold",children:s("panelUsage")}),e(cn,{colorScheme:t.xray_running?"green":"red",children:t.xray_running?s("status.running"):s("status.stopped")})]}),n(He,{columns:{base:1,md:2},gap:4,children:[e(ui,{label:s("cpuUsage"),value:`${t.panel_cpu_percent.toFixed(1)}%`,history:o,actionLabel:s("viewHistory"),onOpen:()=>r({type:"panel",title:s("panelUsage"),cpuEntries:t.panel_cpu_history,memoryEntries:t.panel_memory_history})}),e(ui,{label:s("memoryUsage"),value:`${t.panel_memory_percent.toFixed(1)}%`,history:i,actionLabel:s("viewHistory"),onOpen:()=>r({type:"panel",title:s("panelUsage"),cpuEntries:t.panel_cpu_history,memoryEntries:t.panel_memory_history})})]}),n(He,{columns:{base:1,md:3},gap:4,children:[e(cr,{label:s("threads"),value:Qr(t.app_threads),colorScheme:"purple"}),e(cr,{label:s("appMemory"),value:$e(t.app_memory),colorScheme:"blue"})]})]})})},fh=({value:t,t:s})=>{const r=Le("gray.200","gray.700"),o=Le("gray.50","gray.900"),i=Le("primary.100","primary.900"),a=Le("primary.500","primary.200");return e(L,{borderWidth:"1px",borderColor:r,borderRadius:"md",bg:o,p:4,children:n(U,{justifyContent:"space-between",alignItems:"center",children:[n(U,{alignItems:"center",spacing:3,children:[e(L,{p:2,borderRadius:"md",bg:i,children:e(uh,{color:a})}),e(h,{fontSize:"xs",color:"gray.500",children:s("UsersUsage")})]}),e(h,{fontSize:"2xl",fontWeight:"semibold",children:$e(t)})]})})},bh=({data:t,t:s})=>e(Fr,{p:5,borderRadius:"12px",boxShadow:"none",children:n(ge,{spacing:4,children:[e(h,{fontSize:"lg",fontWeight:"semibold",children:s("usersOverview")}),e(cr,{label:s("totalUsersLabel"),value:Qr(t.total_user),colorScheme:"blue"}),e(fh,{value:t.panel_total_bandwidth,t:s}),n(He,{columns:{base:1,sm:2},gap:3,children:[e(cr,{label:s("status.active"),value:Qr(t.users_active),colorScheme:"green"}),e(cr,{label:s("status.disabled"),value:Qr(t.users_disabled),colorScheme:"red"}),e(cr,{label:s("status.expired"),value:Qr(t.users_expired),colorScheme:"orange"}),e(cr,{label:s("status.limited"),value:Qr(t.users_limited),colorScheme:"yellow"}),e(cr,{label:s("status.on_hold"),value:Qr(t.users_on_hold),colorScheme:"purple"})]})]})}),yh=({data:t,t:s})=>t?e(Fr,{p:5,borderRadius:"12px",boxShadow:"none",children:n(ge,{spacing:4,children:[e(h,{fontSize:"lg",fontWeight:"semibold",children:s("yourUsage")}),n(He,{columns:{base:1,md:2},gap:4,children:[e(cr,{label:s("totalUsersLabel"),value:Qr(t.total_users),colorScheme:"blue"}),e(cr,{label:s("consumedData"),value:$e(t.consumed_bytes),colorScheme:"green"}),e(cr,{label:s("builtData"),value:$e(t.built_bytes),colorScheme:"purple"}),e(cr,{label:s("resetData"),value:$e(t.reset_bytes),colorScheme:"orange"})]})]})}):null,Sh=({data:t,t:s})=>t?e(Fr,{p:5,borderRadius:"12px",boxShadow:"none",children:n(ge,{spacing:4,children:[e(h,{fontSize:"lg",fontWeight:"semibold",children:s("adminOverview")}),n(He,{columns:{base:1,md:2},gap:3,children:[e(cr,{label:s("totalAdmins"),value:Qr(t.total_admins),colorScheme:"blue"}),e(cr,{label:s("sudoAdmins"),value:Qr(t.sudo_admins),colorScheme:"purple"}),e(cr,{label:s("fullAccessAdmins"),value:Qr(t.full_access_admins),colorScheme:"green"}),e(cr,{label:s("standardAdmins"),value:Qr(t.standard_admins),colorScheme:"orange"})]}),t.top_admin_username&&n(L,{children:[n(h,{fontSize:"sm",color:"gray.500",children:[s("topAdmin"),":"," ",e(h,{as:"span",fontWeight:"semibold",children:t.top_admin_username})]}),n(h,{fontSize:"sm",color:"gray.500",children:[s("topAdminUsage"),": ",$e(t.top_admin_usage)]})]})]})}):null,xh=t=>{var F,Z;const{version:s}=Lt(),{userData:r}=xr(),{t:o}=qe(),{data:i}=fr({queryKey:"statistics-query-key",queryFn:()=>Ee("/system"),refetchInterval:3e3,onSuccess:({version:ae})=>{s!==ae&&Lt.setState({version:ae})}}),[a,l]=d.exports.useState(null),[c,u]=d.exports.useState(jl[0].seconds),p=fr({queryKey:["panel-latest-release"],queryFn:async()=>{const ae=await window.fetch("https://api.github.com/repos/rebeccapanel/Rebecca/releases/latest",{headers:{Accept:"application/vnd.github+json"}});if(!ae.ok)throw new Error("Failed to load latest panel release");return ae.json()},refetchOnWindowFocus:!1,staleTime:5*60*1e3,retry:1}),m=((F=p.data)==null?void 0:F.tag_name)||((Z=p.data)==null?void 0:Z.name)||"",g=(i==null?void 0:i.version)||s||"";On(m)&&On(g)&&(On(m),On(g));const S=r.role===Ve.Sudo||r.role===Ve.FullAccess,y=ae=>{l(ae)},A=[];i&&A.push(e(bh,{data:i,t:o},"users-overview"));const f=(i==null?void 0:i.personal_usage)&&e(yh,{data:i.personal_usage,t:o},"your-usage");f&&A.push(f);const D=A.length>1?2:1;return n(ge,{spacing:4,width:"full",...t,children:[i&&n($t,{children:[e(mh,{data:i,t:o,onOpenHistory:y}),e(gh,{data:i,t:o,onOpenHistory:y})]}),A.length>0&&e(He,{columns:{base:1,md:D},gap:4,children:A}),S&&i&&e(Sh,{data:i.admin_overview,t:o}),e(hh,{isOpen:Boolean(a),onClose:()=>l(null),payload:a,intervalSeconds:c,onIntervalChange:u,t:o})]})},vh=()=>{const{t}=qe();return e(me,{spacing:6,align:"stretch",children:n(L,{children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",mb:4,children:t("dashboard")}),e(xh,{})]})})},os=({children:t,color:s})=>e(L,{position:"relative",width:"36px",height:"36px",display:"flex",justifyContent:"center",alignItems:"center",_before:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100%)",height:"calc(100%)",bg:`${s}.400`,opacity:".5",borderRadius:"5px",zIndex:"1",_dark:{bg:`${s}.400`}},_after:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100% + 10px)",height:"calc(100% + 10px)",transform:"translate(-5px, -5px)",bg:`${s}.400`,opacity:".4",borderRadius:"8px",zIndex:"1",_dark:{bg:`${s}.400`}},children:e(h,{color:`${s}.500`,_dark:{color:`${s}.900`},position:"relative",zIndex:"2",children:t})}),ki=se(wn,{baseStyle:{w:5,h:5}}),wh=()=>{const[t,s]=d.exports.useState(!1),{deletingUser:r,onDeletingUser:o,deleteUser:i}=Lt(),{t:a}=qe(),l=sr(),c=()=>{o(null)},u=()=>{r&&(s(!0),i(r).then(()=>{l({title:a("deleteUser.deleteSuccess",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).then(c).finally(s.bind(null,!1)))};return n(Kt,{isCentered:!0,isOpen:!!r,onClose:c,size:"sm",children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(qt,{mx:"3",children:[e(Tt,{pt:6,children:e(os,{color:"red",children:e(ki,{})})}),e(Jt,{mt:3}),n(It,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:a("deleteUser.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(ta,{components:{b:e("b",{})},children:a("deleteUser.prompt",{username:r.username})})})]}),n(Wt,{display:"flex",children:[e(O,{size:"sm",onClick:c,mr:3,w:"full",variant:"outline",children:a("cancel")}),e(O,{size:"sm",w:"full",colorScheme:"red",onClick:u,leftIcon:t?e(Et,{size:"xs"}):void 0,children:a("delete")})]})]})]})},kh={search:"",limit:10,offset:0,sort:"username"},un=Us((t,s)=>({admins:[],total:0,loading:!1,filters:kh,isAdminDialogOpen:!1,adminInDialog:null,isAdminDetailsOpen:!1,adminInDetails:null,async fetchAdmins(r){const{filters:o}=s(),i={...o,...r},a={};i.search&&(a.username=i.search),i.offset!==void 0&&(a.offset=i.offset),i.limit!==void 0&&(a.limit=i.limit),i.sort&&(i.sort==="data_usage"?a.sort="users_usage":i.sort==="data_limit"?a.sort="data_limit":a.sort=i.sort),t({loading:!0});try{const l=await Ee("/admins",{query:a}),{admins:c,total:u}=Array.isArray(l)?{admins:l,total:l.length}:{admins:l.admins||[],total:l.total||0};t(p=>{const m=p.adminInDetails?c.find(g=>{var S;return g.username===((S=p.adminInDetails)==null?void 0:S.username)})||p.adminInDetails:null;return{admins:c,total:u,adminInDetails:m}})}catch(l){console.error("Failed to fetch admins:",l),t({admins:[],total:0,adminInDetails:null})}finally{t({loading:!1})}},setFilters(r){t(o=>({filters:{...o.filters,...r}}))},onFilterChange(r){t(o=>({filters:{...o.filters,...r}})),s().fetchAdmins()},async createAdmin(r){await Ee("/admin",{method:"POST",body:r}),await s().fetchAdmins()},async updateAdmin(r,o){await Ee(`/admin/${encodeURIComponent(r)}`,{method:"PUT",body:o}),await s().fetchAdmins()},async deleteAdmin(r){await Ee(`/admin/${encodeURIComponent(r)}`,{method:"DELETE"}),await s().fetchAdmins()},async resetUsage(r){await Ee(`/admin/usage/reset/${encodeURIComponent(r)}`,{method:"POST"}),await s().fetchAdmins()},async disableAdmin(r,o){await Ee(`/admin/${encodeURIComponent(r)}/disable`,{method:"POST",body:{reason:o}}),await s().fetchAdmins()},async enableAdmin(r){await Ee(`/admin/${encodeURIComponent(r)}/enable`,{method:"POST"}),await s().fetchAdmins()},openAdminDialog(r){t({isAdminDialogOpen:!0,adminInDialog:r||null})},closeAdminDialog(){t({isAdminDialogOpen:!1,adminInDialog:null})},openAdminDetails(r){t({isAdminDetailsOpen:!0,adminInDetails:r})},closeAdminDetails(){t({isAdminDetailsOpen:!1,adminInDetails:null})}})),Hn=Us((t,s)=>({services:[],total:0,isLoading:!1,isSaving:!1,serviceDetail:null,async fetchServices(r){t({isLoading:!0});try{const o=await Ee("/v2/services",{query:r});t({services:o.services,total:o.total})}finally{t({isLoading:!1})}},async fetchServiceDetail(r){t({isLoading:!0});try{const o=await Ee(`/v2/services/${r}`);return t({serviceDetail:o}),o}finally{t({isLoading:!1})}},async createService(r){t({isSaving:!0});try{const o=await Ee("/v2/services",{method:"POST",body:r});return t({serviceDetail:o}),await s().fetchServices(),o}finally{t({isSaving:!1})}},async updateService(r,o){t({isSaving:!0});try{const i=await Ee(`/v2/services/${r}`,{method:"PUT",body:o});return t({serviceDetail:i}),await s().fetchServices(),i}finally{t({isSaving:!1})}},async deleteService(r,o){t({isSaving:!0});try{await Ee(`/v2/services/${r}`,{method:"DELETE",body:o}),t({serviceDetail:null}),await s().fetchServices()}finally{t({isSaving:!1})}},async resetServiceUsage(r){t({isSaving:!0});try{const o=await Ee(`/v2/services/${r}/reset-usage`,{method:"POST"});return t({serviceDetail:o}),await s().fetchServices(),o}finally{t({isSaving:!1})}},setServiceDetail(r){t({serviceDetail:r})},async performServiceUserAction(r,o){return Ee(`/v2/services/${r}/users/actions`,{method:"POST",body:o})}})),Ch=["expired","limited"],_h=()=>{var ue,be,Ie;const{t}=qe(),s=sr(),{performBulkUserAction:r}=Lt(),{userData:o}=xr(),{isOpen:i,onOpen:a,onClose:l}=rr(),[c,u]=d.exports.useState(""),[p,m]=d.exports.useState(""),[g,S]=d.exports.useState(""),[y,A]=d.exports.useState(["expired","limited"]),[f,D]=d.exports.useState(!1),[F,Z]=d.exports.useState(!1),[ae,v]=d.exports.useState(!1),[M,T]=d.exports.useState(!1),[Q,_e]=d.exports.useState(!1),[ke,W]=d.exports.useState("my_users"),[oe,R]=d.exports.useState(""),[le,w]=d.exports.useState(""),[H,ce]=d.exports.useState(!1),{admins:j,fetchAdmins:fe}=un(),Ae=Hn(),Pe=o.role===Ve.Sudo||o.role===Ve.FullAccess,Te=Pe,J=Boolean((Ie=(be=(ue=o.permissions)==null?void 0:ue.users)==null?void 0:be.advanced_actions)!=null?Ie:!0);d.exports.useEffect(()=>{i&&Pe&&fe({limit:200,offset:0}),i&&Ae.services.length===0&&Ae.fetchServices({limit:200,offset:0})},[fe,Pe,i,Ae]);const Ce=()=>Pe?ke==="all_users"?null:ke==="my_users"?o.username:ke.startsWith("admin:")?ke.replace(/^admin:/,""):o.username:o.username,$=(N,E)=>{s({title:t("filters.advancedActions.modalTitle","Advanced actions"),description:N,status:E,isClosable:!0})},X=(N,E)=>{var G;return((G=N==null?void 0:N.data)==null?void 0:G.detail)||(N==null?void 0:N.message)||E},_=N=>{$(N!=null?N:t("filters.advancedActions.error.general","Unable to perform action"),"error")},P=()=>oe==="no_service"?{service_id_is_null:!0}:oe?{service_id:Number(oe)}:{},Y=async N=>{var he;const E=Number(c);if(!Number.isFinite(E)||E<=0){$(t("filters.advancedActions.error.invalidDays","Enter a positive number of days"),"warning");return}const G=N==="extend_expire"?D:Z;G(!0);try{const Re=Ce(),tt={action:N,days:Math.floor(E),admin_username:Re,...P()},je=await r(tt);$(t("filters.advancedActions.success.expire",{count:(he=je.count)!=null?he:0}),"success"),u("")}catch(Re){_(X(Re))}finally{G(!1)}},te=async N=>{var he;const E=Number(p);if(!Number.isFinite(E)||E<=0){$(t("filters.advancedActions.error.invalidGigabytes","Enter a positive traffic value"),"warning");return}const G=N==="increase_traffic"?v:T;G(!0);try{const Re=Ce(),tt={action:N,gigabytes:E,admin_username:Re,...P()},je=await r(tt);$(t("filters.advancedActions.success.traffic",{count:(he=je.count)!=null?he:0,value:E}),"success"),m("")}catch(Re){_(X(Re))}finally{G(!1)}},ie=async()=>{var E;const N=Number(g);if(!Number.isFinite(N)||N<=0){$(t("filters.advancedActions.error.invalidDays","Enter a positive number of days"),"warning");return}if(!y.length){$(t("filters.advancedActions.error.noStatuses","Select at least one status"),"warning");return}_e(!0);try{const G=Ce(),he={action:"cleanup_status",days:Math.floor(N),statuses:y,admin_username:G,...P()},Re=await r(he);$(t("filters.advancedActions.success.cleanup",{count:(E=Re.count)!=null?E:0}),"success"),S("")}catch(G){_(X(G))}finally{_e(!1)}},q=async()=>{var E;if(!le){$(t("filters.advancedActions.error.targetServiceRequired","Select a target service first"),"warning");return}const N=le==="no_service"?null:Number(le);ce(!0);try{const G={action:"change_service",admin_username:Ce(),...P(),target_service_id:N},he=await r(G);$(t("filters.advancedActions.success.changeService",{count:(E=he.count)!=null?E:0}),"success")}catch(G){_(X(G))}finally{ce(!1)}},B=N=>{A(E=>E.includes(N)?E.filter(G=>G!==N):[...E,N])};return J?n($t,{children:[e(O,{leftIcon:e(Ps,{className:"w-4 h-4"}),onClick:a,size:"sm",variant:"outline",children:t("filters.advancedActions.button","Advanced actions")}),n(Kt,{isOpen:i,onClose:l,size:"lg",children:[e(Dt,{}),n(qt,{children:[e(Tt,{children:t("filters.advancedActions.modalTitle","Advanced actions")}),e(Jt,{}),e(It,{children:n(me,{spacing:6,align:"stretch",children:[n(Mr,{status:"warning",borderRadius:"md",children:[e(Ur,{}),e(h,{children:t("filters.advancedActions.modalDescription","These tools update every user and cannot be undone. Please double-check the values before confirming.")})]}),Pe&&n(x,{children:[e(I,{fontWeight:"semibold",children:t("filters.advancedActions.scope.label","Scope")}),n(Ze,{value:ke,onChange:N=>{const E=N.target.value;(E==="my_users"||E==="all_users"||E.startsWith("admin:"))&&W(E)},size:"sm",children:[e("option",{value:"my_users",children:t("filters.advancedActions.scope.myUsers","My users")}),e("option",{value:"all_users",children:t("filters.advancedActions.scope.allUsers","All users")}),j.filter(N=>N.username!==o.username).map(N=>e("option",{value:`admin:${N.username}`,children:N.username},N.username))]}),e(nr,{fontSize:"sm",children:t("filters.advancedActions.scope.helper","Select an admin or all users for this action.")})]}),Te&&n($t,{children:[n(x,{children:[e(I,{fontWeight:"semibold",children:t("filters.advancedActions.service.label","Service scope")}),n(Ze,{value:oe,onChange:N=>{R(N.target.value)},size:"sm",children:[e("option",{value:"",children:t("filters.advancedActions.service.all","All services")}),e("option",{value:"no_service",children:t("filters.advancedActions.serviceChange.noService","No service")}),Ae.services.map(N=>e("option",{value:String(N.id),children:N.name},N.id))]}),e(nr,{fontSize:"sm",children:t("filters.advancedActions.service.helper","Apply these actions only to users of the selected service.")})]}),e(L,{borderWidth:"1px",borderRadius:"md",px:4,py:4,children:n(ge,{spacing:3,children:[e(h,{fontWeight:"semibold",children:t("filters.advancedActions.serviceChange.title","Change users' service")}),e(h,{fontSize:"sm",color:"gray.500",children:t("filters.advancedActions.serviceChange.helper","Move the filtered users to another service.")}),n(Ze,{placeholder:t("filters.advancedActions.serviceChange.placeholder","Select target service"),value:le,onChange:N=>w(N.target.value),size:"sm",children:[e("option",{value:"no_service",children:t("filters.advancedActions.serviceChange.noService","No service")}),Ae.services.map(N=>e("option",{value:String(N.id),children:N.name},N.id))]}),e(O,{colorScheme:"primary",size:"sm",alignSelf:"flex-start",isLoading:H,onClick:q,children:t("filters.advancedActions.serviceChange.button","Move to service")})]})})]}),n(ge,{spacing:4,children:[e(L,{borderWidth:"1px",borderRadius:"md",px:4,py:4,children:n(ge,{spacing:2,children:[e(h,{fontWeight:"semibold",children:t("filters.advancedActions.expireSection.title","Expiration dates")}),e(h,{fontSize:"sm",color:"gray.500",children:t("filters.advancedActions.expireSection.description","Add or subtract days from every user's expiration timestamp.")}),n(x,{children:[e(I,{children:t("filters.advancedActions.expireSection.inputLabel","Days")}),e(vn,{value:c,onChange:N=>u(N),min:1,step:1,w:"full",children:e(xn,{})}),e(nr,{children:t("filters.advancedActions.expireSection.helper","The entered value will be added or removed when you click a button.")})]}),n(U,{spacing:2,flexWrap:"wrap",children:[e(O,{colorScheme:"primary",isLoading:f,flex:"1",minW:"150px",onClick:()=>Y("extend_expire"),children:t("filters.advancedActions.expireSection.addButton","Add days to all users")}),e(O,{colorScheme:"gray",variant:"outline",isLoading:F,flex:"1",minW:"150px",onClick:()=>Y("reduce_expire"),children:t("filters.advancedActions.expireSection.removeButton","Subtract days from all users")})]})]})}),e(L,{borderWidth:"1px",borderRadius:"md",px:4,py:4,children:n(ge,{spacing:2,children:[e(h,{fontWeight:"semibold",children:t("filters.advancedActions.trafficSection.title","Usage and traffic")}),e(h,{fontSize:"sm",color:"gray.500",children:t("filters.advancedActions.trafficSection.description","Apply a data limit adjustment to all users.")}),n(x,{children:[e(I,{children:t("filters.advancedActions.trafficSection.inputLabel","Gigabytes")}),e(vn,{value:p,onChange:N=>m(N),min:.01,step:.1,w:"full",children:e(xn,{})})]}),n(U,{spacing:2,flexWrap:"wrap",children:[e(O,{colorScheme:"primary",isLoading:ae,flex:"1",minW:"150px",onClick:()=>te("increase_traffic"),children:t("filters.advancedActions.trafficSection.addButton","Add traffic to all users")}),e(O,{colorScheme:"gray",variant:"outline",isLoading:M,flex:"1",minW:"150px",onClick:()=>te("decrease_traffic"),children:t("filters.advancedActions.trafficSection.removeButton","Subtract traffic from all users")})]})]})}),e(L,{borderWidth:"1px",borderRadius:"md",px:4,py:4,children:n(ge,{spacing:2,children:[e(h,{fontWeight:"semibold",children:t("filters.advancedActions.cleanupSection.title","Cleanup expired or limited")}),e(h,{fontSize:"sm",color:"gray.500",children:t("filters.advancedActions.cleanupSection.description","Remove users that have been expired/limited for the selected number of days.")}),n(x,{children:[e(I,{children:t("filters.advancedActions.cleanupSection.daysLabel","Days since status change")}),e(vn,{value:g,onChange:N=>S(N),min:1,step:1,w:"full",children:e(xn,{})})]}),e(U,{spacing:3,children:Ch.map(N=>e(vr,{isChecked:y.includes(N),onChange:()=>B(N),children:t(`filters.advancedActions.cleanupSection.statuses.${N}`,N.charAt(0).toUpperCase()+N.slice(1))},N))}),e(O,{colorScheme:"primary",isLoading:Q,w:"full",onClick:ie,children:t("filters.advancedActions.cleanupSection.button","Delete selected users")})]})})]})]})}),e(Wt,{children:e(O,{variant:"ghost",onClick:l,children:t("filters.advancedActions.close","Close")})})]})]})]}):null},Ci={baseStyle:{w:4,h:4}},Ah=se(Ka,Ci),Dh=se(ud,Ci),Ih=se(Qi,Ci),Ph=se(dn,Ci),Eh=se(Tn,Ci),_o=[{key:"online",labelKey:"filters.advanced.online",fallback:"Online right now"},{key:"offline",labelKey:"filters.advanced.offline",fallback:"Offline for 24h"},{key:"sub_not_updated",labelKey:"filters.advanced.subNotUpdated",fallback:"Sub link stale for 24h"},{key:"sub_never_updated",labelKey:"filters.advanced.subNeverUpdated",fallback:"Sub link never updated"},{key:"limit",labelKey:"filters.advanced.limit",fallback:"Has data limit"},{key:"unlimited",labelKey:"filters.advanced.unlimited",fallback:"Unlimited users"},{key:"finished",labelKey:"filters.advanced.finished",fallback:"Finished (limited or expired)"},{key:"expired",labelKey:"filters.advanced.statusExpired",fallback:"Expired users"},{key:"limited",labelKey:"filters.advanced.statusLimited",fallback:"Limited users"},{key:"disabled",labelKey:"filters.advanced.statusDisabled",fallback:"Disabled users"},{key:"on_hold",labelKey:"filters.advanced.statusOnHold",fallback:"On-hold users"}],Th=hd((t,s)=>{s==="users"?Lt.getState().onFilterChange({search:t,offset:0}):un.getState().onFilterChange({search:t,offset:0})},300),ec=({for:t="users",...s})=>{var _,P,Y,te,ie,q,B,ue;const{loading:r,filters:o,onFilterChange:i,refetchUsers:a,onCreateUser:l}=Lt(),{loading:c,filters:u,onFilterChange:p,fetchAdmins:m,openAdminDialog:g,admins:S}=un(),{t:y}=qe(),[A,f]=d.exports.useState(""),{userData:D}=xr(),F=D.role===Ve.Sudo||D.role===Ve.FullAccess,Z=!F&&D.status===ln.Disabled,ae=Boolean(((P=(_=D.permissions)==null?void 0:_.admin_management)==null?void 0:P[br.Edit])||D.role===Ve.FullAccess),v=F||Boolean((te=(Y=D.permissions)==null?void 0:Y.users)==null?void 0:te[it.Create]),M=t==="users"?v&&!Z:ae,T=t==="users"?r:c,Q=t==="users",_e=Q?o:u,ke=Q?o:void 0,W=Boolean(ke),oe=(ie=ke==null?void 0:ke.advancedFilters)!=null?ie:[],R=ke==null?void 0:ke.serviceId,le=ke==null?void 0:ke.owner,{services:w,fetchServices:H}=Hn();d.exports.useEffect(()=>{H({limit:500})},[H]),d.exports.useEffect(()=>{F&&m({limit:200,offset:0})},[m,F]),d.exports.useEffect(()=>{var Ie,N;const be=Q?(Ie=o.search)!=null?Ie:"":(N=u.search)!=null?N:"";f(be)},[Q,o.search,u.search]);const ce=be=>{const Ie=_o.find(N=>N.key===be);return Ie?y(Ie.labelKey,Ie.fallback):be},j=be=>{if(!W)return;const Ie=oe.includes(be)?oe.filter(N=>N!==be):[...oe,be];i({advancedFilters:Ie,offset:0})},fe=()=>{!W||oe.length===0||i({advancedFilters:[],offset:0})},Ae=be=>{i({serviceId:be?Number(be):void 0,offset:0})},Pe=be=>{i({owner:be||void 0,offset:0})},Te=be=>{f(be.target.value),Th(be.target.value,t)},J=()=>{f(""),Q?i({...o,offset:0,search:""}):p({search:"",offset:0})},Ce=()=>{t==="users"?a(!0):m()},$=()=>{if(t==="users"){if(Z||!v)return;l(!0)}else ae&&g()},X=(q=Or({base:!0,sm:!1}))!=null?q:!1;return n(gi,{id:"filters",templateColumns:{lg:"repeat(3, 1fr)",md:"repeat(4, 1fr)",base:"repeat(1, 1fr)"},mx:"0",rowGap:4,gap:{lg:4,base:0},py:4,...s,children:[n(on,{colSpan:{base:1,md:2,lg:1},order:{base:2,md:1},children:[n(U,{spacing:2,align:"center",w:"full",children:[n(Dr,{flex:"1",children:[e(qa,{pointerEvents:"none",children:e(Ah,{})}),e(De,{placeholder:t==="users"?y("search"):y("admins.searchPlaceholder","Search admins..."),value:A,borderColor:"light-border",w:"full",onChange:Te}),n(Wr,{children:[T&&e(Et,{size:"xs"}),_e.search&&_e.search.length>0&&e(Be,{onClick:J,"aria-label":"clear",size:"xs",variant:"ghost",children:e(Ih,{})})]})]}),W&&n($n,{placement:"bottom-start",children:[e(Kn,{children:e(O,{leftIcon:e(Dh,{}),size:X?"sm":"md",variant:"outline",borderRadius:"full",minW:X?"auto":"8rem",h:X?"36px":void 0,fontSize:X?"xs":"sm",children:y("filters.advancedButton","Filters")})}),n(qn,{borderColor:"light-border",minW:"250px",children:[e(us,{}),e(Ja,{}),e(Cl,{fontWeight:"semibold",children:y("filters.advancedTitle","Advanced filters")}),n(Jn,{children:[e(ge,{spacing:2,children:_o.map(be=>e(vr,{isChecked:oe.includes(be.key),onChange:()=>j(be.key),children:ce(be.key)},be.key))}),n(ge,{spacing:3,mt:3,children:[n(L,{children:[e(h,{fontSize:"sm",fontWeight:"semibold",mb:1,children:y("filters.advanced.serviceLabel","Service filter")}),n(Ze,{value:R?String(R):"",onChange:be=>Ae(be.target.value),size:"sm",children:[e("option",{value:"",children:y("filters.advanced.serviceAll","All services")}),w.map(be=>e("option",{value:String(be.id),children:be.name},be.id))]})]}),F&&n(L,{children:[e(h,{fontSize:"sm",fontWeight:"semibold",mb:1,children:y("filters.advanced.adminLabel","Admin filter")}),n(Ze,{value:le!=null?le:"",onChange:be=>Pe(be.target.value),size:"sm",children:[e("option",{value:"",children:y("filters.advanced.adminAll","All admins")}),e("option",{value:D.username,children:y("filters.advanced.adminMyUsers","My users")}),S.map(be=>e("option",{value:be.username,children:be.username},be.username))]})]})]}),e(O,{variant:"ghost",size:"sm",mt:3,w:"full",onClick:fe,isDisabled:oe.length===0,children:y("filters.advancedClear","Clear filters")})]})]})]}),e(Be,{"aria-label":"refresh",disabled:T,onClick:Ce,size:X?"sm":"md",variant:X?"ghost":"outline",borderRadius:"full",minW:X?"36px":"40px",h:X?"36px":void 0,children:e(Ph,{className:Ha({"animate-spin":T})})})]}),W&&(oe.length>0||Boolean(R)||Boolean(le))&&n(_s,{mt:2,spacing:2,children:[oe.map(be=>n(rt,{size:"sm",borderRadius:"full",variant:"solid",colorScheme:"primary",children:[e(ci,{children:ce(be)}),e(Vi,{onClick:Ie=>{Ie.preventDefault(),Ie.stopPropagation(),j(be)}})]},be)),R&&n(rt,{size:"sm",borderRadius:"full",variant:"solid",colorScheme:"primary",children:[e(ci,{children:y("filters.advanced.serviceTag","Service: {{name}}",{name:(ue=(B=w.find(be=>be.id===R))==null?void 0:B.name)!=null?ue:R})}),e(Vi,{onClick:be=>{be.preventDefault(),be.stopPropagation(),Ae("")}})]},"service"),le&&n(rt,{size:"sm",borderRadius:"full",variant:"solid",colorScheme:"primary",children:[e(ci,{children:le===D.username?y("filters.advanced.adminTagMine","My users"):le}),e(Vi,{onClick:be=>{be.preventDefault(),be.stopPropagation(),Pe("")}})]},"owner")]})]}),e(on,{colSpan:{base:1,md:2,lg:2},order:{base:1,md:2},children:n(ge,{direction:{base:"row",sm:"row"},spacing:{base:2,sm:3},justifyContent:{base:"flex-start",md:"flex-end"},alignItems:"center",w:"full",flexWrap:"wrap",children:[t==="users"&&e(_h,{}),M&&e(O,{colorScheme:"primary",size:X?"sm":"md",onClick:$,isDisabled:t==="admins"&&!ae,px:X?3:5,leftIcon:X?void 0:e(Eh,{}),w:"auto",h:X?"36px":void 0,minW:X?"auto":"8.5rem",fontSize:X?"sm":"md",fontWeight:"semibold",whiteSpace:"nowrap",children:t==="users"?y("createUser"):y("admins.addAdmin","Add admin")})]})})]})},zh=se(pd,{baseStyle:{w:4,h:4}}),Nh=se(md,{baseStyle:{w:4,h:4}}),Ao=5;function Rh(t,s,r){if(r<Ao)throw new Error(`Must allow at least ${Ao} page items`);if(r%2===0)throw new Error("Must allow odd number of page items");if(t<r)return[...new Array(t).keys()];const o=Math.max(0,Math.min(t-r,s-Math.floor(r/2))),i=new Array(r);for(let a=0;a<r;a+=1)i[a]=a+o;return typeof i[0]=="number"&&i[0]>0&&(i[0]=0,i[1]="prev-more"),i[i.length-1]<t-1&&(i[i.length-1]=t-1,i[i.length-2]="next-more"),i}const tc=({for:t="users"})=>{const{filters:s,onFilterChange:r,users:{total:o}}=Lt(),{filters:i,onFilterChange:a,total:l}=un(),{t:c}=qe(),{filters:u,total:p,onFilterChange:m}=d.exports.useMemo(()=>t==="admins"?{filters:i,total:l,onFilterChange:a}:{filters:s,total:o,onFilterChange:r},[t,i,l,a,s,o,r]),{limit:g,offset:S}=u,y=Number(g||10),A=Number(S||0),f=Math.floor(A/y),D=Math.ceil(p/y),F=Rh(D,f,7),Z=T=>{m({...u,offset:T*y})},ae=T=>{const Q=parseInt(T.target.value,10);m({...u,limit:Q,offset:0}),t==="users"&&nh(T.target.value)},v=d.exports.useMemo(()=>f>0&&D>0,[f,D]),M=d.exports.useMemo(()=>f+1<D&&D>0,[f,D]);return p<=y&&f===0?null:n(U,{justifyContent:"space-between",mt:4,w:"full",display:"flex",columnGap:{lg:4,md:0},rowGap:{md:0,base:4},flexDirection:{md:"row",base:"column"},children:[e(L,{order:{base:2,md:1},children:n(U,{children:[n(Ze,{minW:"60px",value:String(y),onChange:ae,size:"sm",rounded:"md",children:[e("option",{value:"10",children:"10"}),e("option",{value:"20",children:"20"}),e("option",{value:"30",children:"30"})]}),e(h,{whiteSpace:"nowrap",fontSize:"sm",children:c("itemsPerPage")})]})}),n(_l,{size:"sm",isAttached:!0,variant:"outline",order:{base:1,md:2},children:[e(O,{leftIcon:e(zh,{}),onClick:()=>Z(f-1),isDisabled:!v,children:c("previous")}),F.map(T=>typeof T=="string"?e(O,{children:"..."},T):e(O,{variant:T===f?"solid":"outline",onClick:()=>Z(T),children:T+1},T)),e(O,{rightIcon:e(Nh,{}),onClick:()=>Z(f+1),isDisabled:!M,children:c("next")})]})]})},Lh=gd;const Do=se(fd),Mh=se(Ya,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),Uh=se(Al,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),Oh=se(Dl,{baseStyle:{w:5,h:5}}),Wh=()=>{const{QRcodeLinks:t,setQRCode:s,setSubLink:r,subscribeUrl:o}=Lt(),i=t!==null,[a,l]=d.exports.useState(0),{t:c}=qe(),u=()=>{s(null),r(null)},p=String(o).startsWith("/")?window.location.origin+o:String(o);return n(Kt,{isOpen:i,onClose:u,children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(qt,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(Tt,{pt:6,children:e(os,{color:"primary",children:e(Oh,{color:"white"})})}),e(Jt,{mt:3}),t&&n(It,{gap:{base:"20px",lg:"50px"},pr:{lg:"60px"},px:{base:"50px"},display:"flex",justifyContent:"center",flexDirection:{base:"column",lg:"row"},children:[o&&n(me,{children:[e(Do,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:p,bg:"white"}),e(h,{display:"block",textAlign:"center",pb:3,mt:1,children:c("qrcodeDialog.sublink")})]}),n(L,{w:"300px",children:[e(Lh,{centerPadding:"0px",centerMode:!0,slidesToShow:1,slidesToScroll:1,dots:!1,afterChange:l,onInit:()=>l(0),nextArrow:e(Be,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"next",mr:"-4",children:e(Mh,{})}),prevArrow:e(Be,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"prev",ml:"-4",children:e(Uh,{})}),children:t.map((m,g)=>e(U,{children:e(Do,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:m,bg:"white"})},g))}),n(h,{display:"block",textAlign:"center",pb:3,mt:1,children:[a+1," / ",t.length]})]})]})]})]})},Fh=se(dn,{baseStyle:{w:5,h:5}}),Hh=()=>{const[t,s]=d.exports.useState(!1),{resetUsageUser:r,resetDataUsage:o}=Lt(),{t:i}=qe(),a=sr(),l=()=>{Lt.setState({resetUsageUser:null})},c=()=>{r&&(s(!0),o(r).then(()=>{a({title:i("resetUserUsage.success",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{a({title:i("resetUserUsage.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{s(!1)}))};return n(Kt,{isCentered:!0,isOpen:!!r,onClose:l,size:"sm",children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(qt,{mx:"3",children:[e(Tt,{pt:6,children:e(os,{color:"blue",children:e(Fh,{})})}),e(Jt,{mt:3}),n(It,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:i("resetUserUsage.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(ta,{components:{b:e("b",{})},children:i("resetUserUsage.prompt",{username:r.username})})})]}),n(Wt,{display:"flex",children:[e(O,{size:"sm",onClick:l,mr:3,w:"full",variant:"outline",children:i("cancel")}),e(O,{size:"sm",w:"full",colorScheme:"blue",onClick:c,leftIcon:t?e(Et,{size:"xs"}):void 0,children:i("reset")})]})]})]})},Bh=se(dn,{baseStyle:{w:5,h:5}}),Vh=()=>{const[t,s]=d.exports.useState(!1),{revokeSubscriptionUser:r,revokeSubscription:o}=Lt(),{t:i}=qe(),a=sr(),l=()=>{Lt.setState({revokeSubscriptionUser:null})},c=()=>{r&&(s(!0),o(r).then(()=>{a({title:i("revokeUserSub.success",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{a({title:i("revokeUserSub.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{s(!1)}))};return n(Kt,{isCentered:!0,isOpen:!!r,onClose:l,size:"sm",children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(qt,{mx:"3",children:[e(Tt,{pt:6,children:e(os,{color:"blue",children:e(Bh,{})})}),e(Jt,{mt:3}),n(It,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:i("revokeUserSub.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(ta,{components:{b:e("b",{})},children:i("revokeUserSub.prompt",{username:r.username})})})]}),n(Wt,{display:"flex",children:[e(O,{size:"sm",onClick:l,mr:3,w:"full",variant:"outline",children:i("cancel")}),e(O,{size:"sm",w:"full",colorScheme:"blue",onClick:c,leftIcon:t?e(Et,{size:"xs"}):void 0,children:i("revoke")})]})]})]})},_i={baseStyle:{strokeWidth:"2px",w:4,h:4}},Io=se(bd,_i),$h=se(yd,_i),Po=se(Sd,_i),Eo=se(Il,_i),Kh=se(Il,_i),Ta=[{title:"No",value:"no_reset"},{title:"Daily",value:"day"},{title:"Weekly",value:"week"},{title:"Monthly",value:"month"},{title:"Annually",value:"year"}],is={active:{statusColor:"green",bandWidthColor:"primary",icon:Io},connected:{statusColor:"green",bandWidthColor:"primary",icon:Io},disabled:{statusColor:"gray",bandWidthColor:"gray",icon:$h},expired:{statusColor:"orange",bandWidthColor:"orange",icon:Eo},on_hold:{statusColor:"purple",bandWidthColor:"purple",icon:Kh},connecting:{statusColor:"orange",bandWidthColor:"orange",icon:Eo},limited:{statusColor:"red",bandWidthColor:"red",icon:Po},error:{statusColor:"red",bandWidthColor:"red",icon:Po}},qh=async()=>Ee("/settings/telegram"),Jh=async t=>Ee("/settings/telegram",{method:"PUT",body:JSON.stringify(t)}),Qa=async()=>Ee("/settings/panel"),Yh=async t=>Ee("/settings/panel",{method:"PUT",body:JSON.stringify(t)}),na=t=>{let s={status:"",time:""};if(t){Oe(t*1e3).utc().isAfter(Oe().utc())?s.status="expires":s.status="expired";const r=[],o=Oe.duration(Oe(t*1e3).utc().diff(Oe()));o.years()!=0&&r.push(Math.abs(o.years())+" year"+(Math.abs(o.years())!=1?"s":"")),o.months()!=0&&r.push(Math.abs(o.months())+" month"+(Math.abs(o.months())!=1?"s":"")),o.days()!=0&&r.push(Math.abs(o.days())+" day"+(Math.abs(o.days())!=1?"s":"")),r.length===0&&(o.hours()!=0&&r.push(Math.abs(o.hours())+" hour"+(Math.abs(o.hours())!=1?"s":"")),o.minutes()!=0&&r.push(Math.abs(o.minutes())+" min"+(Math.abs(o.minutes())!=1?"s":""))),s.time=r.join(", ")}return s},Gh=({value:t,onChange:s,placeholder:r="Select date",disabled:o=!1,minDate:i,quickSelects:a=[]})=>{const{isOpen:l,onOpen:c,onClose:u}=rr(),[p,m]=d.exports.useState(()=>t?Oe(t):Oe()),[g,S]=d.exports.useState({hour:t?Oe(t).hour():12,minute:t?Oe(t).minute():0}),y=Le("white","gray.900"),A=Le("gray.900","white"),f=Le("gray.200","gray.700"),D=Le("gray.50","gray.800"),F=Le("gray.100","gray.700"),Z=Le("gray.100","gray.700"),ae=Le("gray.500","gray.400"),v=Le("gray.400","gray.500"),M=Le("gray.100","gray.700"),T=Le("gray.200","gray.700"),Q=Le("gray.600","gray.400"),_e=Le("primary.500","primary.400");d.exports.useEffect(()=>{t&&(m(Oe(t)),S({hour:Oe(t).hour(),minute:Oe(t).minute()}))},[t]);const ke=()=>{t||(m(Oe()),S({hour:12,minute:0})),u()},W=p.daysInMonth(),oe=p.startOf("month").day(),R=Oe(),le=t?Oe(t):null,w=J=>{const Ce=p.date(J).hour(g.hour).minute(g.minute).second(0).millisecond(0);i&&Ce.isBefore(Oe(i),"day")||s(Ce.toDate())},H=(J,Ce)=>{if(S({hour:J,minute:Ce}),t){const $=Oe(t).hour(J).minute(Ce);s($.toDate())}},ce=()=>{s(null),m(Oe()),S({hour:12,minute:0}),u()},j=()=>m(p.subtract(1,"month")),fe=()=>m(p.add(1,"month")),Ae=J=>{const $=(t?Oe(t):Oe()).add(J,"day");s($.toDate())},Pe=()=>{const J=[],Ce=i?Oe(i):null;for(let $=0;$<oe;$++)J.push(e(on,{},`empty-${$}`));for(let $=1;$<=W;$++){const X=p.date($),_=X.isSame(R,"day"),P=le==null?void 0:le.isSame(X,"day"),Y=Ce&&X.isBefore(Ce,"day");J.push(e(on,{children:e(O,{size:"xs",variant:"ghost",w:"full",h:"28px",minW:"28px",fontSize:"xs",fontWeight:_?"bold":"normal",bg:P?"primary.500":"transparent",color:P?"white":Y?v:"inherit",border:_?"1px solid":"none",borderColor:_e,_hover:{bg:Y?"transparent":P?"primary.600":M},onClick:()=>!Y&&w($),isDisabled:!!Y,cursor:Y?"not-allowed":"pointer",children:$})},$))}return J},Te=t?Oe(t).format("YYYY/MM/DD HH:mm"):"";return n($n,{isOpen:l,onOpen:c,onClose:ke,placement:"bottom-start",isLazy:!0,children:[e(Kn,{children:e(De,{value:Te,placeholder:r,size:"sm",isReadOnly:!0,cursor:"pointer",isDisabled:o,onClick:c,bg:"transparent",_dark:{bg:"transparent"}})}),e(Zi,{children:e(qn,{w:"auto",maxW:"min(90vw, 420px)",bg:y,borderColor:f,color:A,_focus:{boxShadow:"none"},children:e(Jn,{p:0,children:n(pt,{children:[n(me,{spacing:1,align:"stretch",px:2,py:2,bg:D,minW:"100px",maxW:"110px",borderRight:"1px solid",borderColor:F,flexShrink:0,children:[e(O,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>Ae(1),_hover:{bg:Z},children:"+1 Day"}),e(O,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>Ae(30),_hover:{bg:Z},children:"+1 Month"}),e(O,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>Ae(90),_hover:{bg:Z},children:"+3 Months"}),e(O,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>Ae(180),_hover:{bg:Z},children:"+6 Months"}),e(O,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>Ae(365),_hover:{bg:Z},children:"+1 Year"}),e(O,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>Ae(1095),_hover:{bg:Z},children:"+3 Years"})]}),n(L,{flex:"1",p:2,children:[n(pt,{justify:"space-between",align:"center",mb:2,children:[n(U,{spacing:1,children:[e(Be,{"aria-label":"Previous month",size:"xs",variant:"ghost",icon:e(Al,{width:14,height:14}),onClick:j,_hover:{bg:Z}}),e(Be,{"aria-label":"Next month",size:"xs",variant:"ghost",icon:e(Ya,{width:14,height:14}),onClick:fe,_hover:{bg:Z}})]}),e(h,{fontSize:"xs",fontWeight:"semibold",children:p.format("MMMM YYYY")})]}),e(gi,{templateColumns:"repeat(7, 1fr)",gap:.5,mb:1,children:["Su","Mo","Tu","We","Th","Fr","Sa"].map(J=>e(on,{children:e(h,{fontSize:"2xs",textAlign:"center",color:ae,fontWeight:"semibold",children:J})},J))}),e(gi,{templateColumns:"repeat(7, 1fr)",gap:.5,mb:2,children:Pe()}),n(U,{spacing:2,justify:"center",pt:2,borderTop:"1px solid",borderColor:T,children:[e(h,{fontSize:"2xs",color:Q,children:"Time:"}),e(De,{type:"number",size:"xs",w:"45px",min:0,max:23,value:g.hour,onChange:J=>{const Ce=Math.max(0,Math.min(23,parseInt(J.target.value)||0));H(Ce,g.minute)},textAlign:"center",fontSize:"xs"}),e(h,{fontSize:"xs",children:":"}),e(De,{type:"number",size:"xs",w:"45px",min:0,max:59,value:g.minute,onChange:J=>{const Ce=Math.max(0,Math.min(59,parseInt(J.target.value)||0));H(g.hour,Ce)},textAlign:"center",fontSize:"xs"})]}),n(U,{spacing:2,justify:"flex-end",mt:2,children:[e(O,{size:"xs",variant:"ghost",onClick:ce,children:"Clear"}),e(O,{size:"xs",colorScheme:"primary",onClick:ke,children:"Done"})]})]})]})})})})]})},Ai=d.exports.forwardRef((t,s)=>e(xd,{...t,ref:s}));Ai.displayName="DatePicker";function Xh(t){const s=360/t,r=90,o=47,i=[];for(let a=0;a<t;a++){const l=a*s%360+140,c=Qh(l,r,o);i.push(c)}return i}function Qh(t,s,r){t/=360,s/=100,r/=100;let o,i,a;if(s===0)o=i=a=r;else{const c=(m,g,S)=>(S<0&&(S+=1),S>1&&(S-=1),S<.16666666666666666?m+(g-m)*6*S:S<.5?g:S<.6666666666666666?m+(g-m)*(.6666666666666666-S)*6:m),u=r<.5?r*(1+s):r+s-r*s,p=2*r-u;o=Math.round(c(p,u,t+1/3)*255),i=Math.round(c(p,u,t)*255),a=Math.round(c(p,u,t-1/3)*255)}const l=c=>{const u=c.toString(16);return u.length===1?"0"+u:u};return`#${l(o)}${l(i)}${l(a)}`}const To=({border:t,...s})=>{const{getInputProps:r,getRadioProps:o}=kd(s),i=Or({base:"xs",md:"sm"});return n(L,{as:"label",children:[e("input",{...r()}),e(L,{...o(),minW:"48px",w:"full",h:"full",textAlign:"center",cursor:"pointer",fontSize:i,borderWidth:t?"1px":"0px",borderRadius:"md",_checked:{bg:"primary.500",color:"white",borderColor:"primary.500"},_focus:{boxShadow:"outline"},px:3,py:1,children:s.children})]})},Zh=({onChange:t,defaultValue:s,...r})=>{const{t:o,i18n:i}=qe();jr();const a=Or({base:["7h","1d","3d","1w"],md:["7h","1d","3d","1w","1m","3m"]}),l={h:"hour",d:"day",w:"week",m:"month",y:"year"},c=Or({base:[{title:"hours",options:["1h","3h","6h","12h"]},{title:"days",options:["1d","2d","3d","4d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m"]}],md:[{title:"hours",options:["1h","2h","3h","6h","8h","12h"]},{title:"days",options:["1d","2d","3d","4d","5d","6d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m","8m"]}]}),{getRootProps:u,getRadioProps:p,setValue:m}=vd({name:"filter",defaultValue:s,onChange:R=>{if(R==="custom")return;y(),a.indexOf(R)>=0?(D(o("userDialog.custom")),Z(!1)):(D(o("userDialog.custom")+` (${R})`),Z(!0));const le=Number(R.substring(0,R.length-1)),w=l[R[R.length-1]];t(R,{start:Oe().utc().subtract(le,w).format("YYYY-MM-DDTHH:00:00")})}}),{isOpen:g,onOpen:S,onClose:y}=rr(),A=d.exports.useRef(null);wd({ref:A,handler:y});const[f,D]=d.exports.useState(o("userDialog.custom")),[F,Z]=d.exports.useState(!1),[ae,v]=d.exports.useState(0),M=Or({base:1,md:2}),T=Or({base:"xs",md:"sm"}),[Q,_e]=d.exports.useState(null),[ke,W]=d.exports.useState(null),oe=R=>{const[le,w]=R;ke&&!w?(_e(null),W(null)):(_e(le),W(w),le&&w&&(y(),t("custom",{start:Oe(le).format("YYYY-MM-DDT00:00:00"),end:Oe(w).format("YYYY-MM-DDT23:59:59")})))};return n(me,{...r,children:[ae==0&&n(He,{...u(),gap:0,display:"flex",borderWidth:"1px",borderRadius:"md",minW:{base:"320px",md:"400px"},children:[a.map(R=>e(To,{...p({value:R}),children:R},R)),e(L,{onClick:()=>{_e(null),W(null),S()},cursor:"pointer",borderRadius:"md",w:"full",fontSize:T,px:3,py:1,bg:F?"primary.500":"unset",color:F?"white":"unset",borderColor:F?"primary.500":"unset",children:n(U,{children:[e(h,{children:f}),e(di,{as:oo,boxSize:"18px"})]})})]}),ae==1&&n(U,{onClick:S,cursor:"pointer",fontSize:T,borderRadius:"md",px:3,py:1,minW:{base:"320px",md:"400px"},borderWidth:"1px",children:[e(h,{w:"full",color:Q?"unset":"gray.500",children:Q?Oe(Q).format("YYYY-MM-DD (00:00)"):o("userDialog.startDate")}),e(di,{as:Ya,boxSize:"18px"}),e(h,{w:"full",color:ke?"unset":"gray.500",children:ke?Oe(ke).format("YYYY-MM-DD (23:59)"):o("userDialog.endDate")}),e(di,{as:oo,boxSize:"18px"})]}),e(me,{ref:A,marginTop:"40px !important",borderRadius:"md",borderWidth:"1px",position:"absolute",zIndex:"1",backgroundColor:"white",_dark:{backgroundColor:"gray.700"},display:g?"unset":"none",children:n(hs,{onChange:R=>v(R),children:[n(ps,{children:[e(or,{fontSize:T,children:o("userDialog.relative")}),e(or,{fontSize:T,children:o("userDialog.absolute")})]}),n(ms,{children:[e(lr,{children:c.map(R=>e(me,{alignItems:"start",pl:2,pr:2,children:n(U,{justifyItems:"flex-start",mb:4,children:[e(h,{fontSize:T,minW:"60px",children:o("userDialog."+R.title)}),R.options.map(le=>e(To,{border:!0,...p({value:le}),children:le},le+".custom"))]})},R.title))}),e(lr,{className:"datepicker-panel",children:e(me,{children:e(Ai,{locale:i.language.toLocaleLowerCase(),selected:Q,onChange:oe,startDate:Q,endDate:ke,selectsRange:!0,maxDate:new Date,monthsShown:M,peekNextMonth:!1,inline:!0})})})]})]})})]})};function Xi(t,s,r=[],o=[]){const i=$e(r.reduce((a,l)=>a+=l,0));return{series:r,options:{labels:o,chart:{width:"100%",height:"100%",type:"donut",animations:{enabled:!1}},title:{text:`${s}${i}`,align:"center",style:{fontWeight:"var(--chakra-fontWeights-medium)",color:t==="dark"?"var(--chakra-colors-gray-300)":void 0}},legend:{position:"bottom",labels:{colors:t==="dark"?"#CBD5E0":void 0,useSeriesColors:!1}},stroke:{width:1,colors:void 0},dataLabels:{formatter:(a,{seriesIndex:l,w:c})=>$e(c.config.series[l],1)},tooltip:{custom:({series:a,seriesIndex:l,dataPointIndex:c,w:u})=>{const p=$e(a[l],1),m=Math.max(a.reduce((S,y)=>S+=y),1),g=Math.round(a[l]/m*1e3)/10+"%";return`
            <div style="
                    background-color: ${u.globals.colors[l]};
                    padding-left:12px;
                    padding-right:12px;
                    padding-top:6px;
                    padding-bottom:6px;
                    font-size:0.725rem;
                  "
            >
              ${u.config.labels[l]}: <b>${g}, ${p}</b>
            </div>
          `}},colors:Xh(r.length)}}}const jh=se(Cd,{baseStyle:{w:5,h:5}}),ep=se(Vn,{baseStyle:{w:5,h:5}}),tp=se(vl,{baseStyle:{w:5,h:5}}),rp=se(_d,{baseStyle:{w:{base:16,md:20},h:{base:16,md:20}}});se(vi,{baseStyle:{w:4,h:4}});const np=t=>{var r,o,i,a,l,c;const s=(r=t.next_plan)!=null?r:null;return{...t,data_limit:t.data_limit?Number((t.data_limit/1073741824).toFixed(5)):t.data_limit,ip_limit:t.ip_limit&&t.ip_limit>0?t.ip_limit:null,on_hold_expire_duration:t.on_hold_expire_duration?Number(t.on_hold_expire_duration/(24*60*60)):t.on_hold_expire_duration,service_id:(o=t.service_id)!=null?o:null,credential_key:(i=t.credential_key)!=null?i:null,manual_key_entry:!1,next_plan_enabled:Boolean(s),next_plan_data_limit:s!=null&&s.data_limit?Number((s.data_limit/1073741824).toFixed(5)):null,next_plan_expire:(a=s==null?void 0:s.expire)!=null?a:null,next_plan_add_remaining_traffic:(l=s==null?void 0:s.add_remaining_traffic)!=null?l:!1,next_plan_fire_on_either:(c=s==null?void 0:s.fire_on_either)!=null?c:!0}},ga=()=>({data_limit:null,ip_limit:null,expire:null,credential_key:null,manual_key_entry:!1,username:"",data_limit_reset_strategy:"no_reset",status:"active",on_hold_expire_duration:null,note:"",inbounds:{},proxies:{vless:{id:"",flow:""},vmess:{id:""},trojan:{password:""},shadowsocks:{password:"",method:"chacha20-ietf-poly1305"}},service_id:null,next_plan_enabled:!1,next_plan_data_limit:null,next_plan_expire:null,next_plan_add_remaining_traffic:!1,next_plan_fire_on_either:!0}),sp=/^[0-9a-fA-F]{32}$/,qs={username:xe.string().min(1,{message:"Required"}),note:xe.string().nullable(),service_id:xe.union([xe.string(),xe.number()]).nullable().transform(t=>{if(t===""||t===null||typeof t>"u")return null;const s=Number(t);return Number.isNaN(s)?null:s}),proxies:xe.record(xe.string(),xe.record(xe.string(),xe.any())).transform(t=>{const s=(r,o)=>{r&&r[o]===""&&delete r[o]};return s(t.vmess,"id"),s(t.vless,"id"),s(t.trojan,"password"),s(t.shadowsocks,"password"),s(t.shadowsocks,"method"),t}),data_limit:xe.string().min(0).or(xe.number()).nullable().transform(t=>t?Number((parseFloat(String(t))*1073741824).toFixed(5)):0),expire:xe.number().nullable(),data_limit_reset_strategy:xe.string(),inbounds:xe.record(xe.string(),xe.array(xe.string())).transform(t=>(Object.keys(t).forEach(s=>{var r;Array.isArray(t[s])&&!((r=t[s])!=null&&r.length)&&delete t[s]}),t)),next_plan_enabled:xe.boolean().default(!1),next_plan_data_limit:xe.union([xe.string(),xe.number(),xe.null()]).transform(t=>{if(t===null||t===""||typeof t>"u")return null;const s=Number(t);return Number.isNaN(s)?null:Math.max(0,s)}),next_plan_expire:xe.union([xe.number(),xe.string(),xe.null()]).transform(t=>{if(t===""||t===null||typeof t>"u")return null;const s=Number(t);return Number.isNaN(s)?null:s}),next_plan_add_remaining_traffic:xe.boolean().default(!1),next_plan_fire_on_either:xe.boolean().default(!0),ip_limit:xe.union([xe.number().min(0),xe.null()]).optional().transform(t=>typeof t!="number"?null:Number.isFinite(t)?t:null),manual_key_entry:xe.boolean().default(!1),credential_key:xe.union([xe.string(),xe.null(),xe.undefined()]).transform(t=>{if(!t||typeof t!="string")return null;const s=t.trim();return s===""?null:s}).nullable()},ip=xe.discriminatedUnion("status",[xe.object({status:xe.literal("active"),...qs}),xe.object({status:xe.literal("disabled"),...qs}),xe.object({status:xe.literal("limited"),...qs}),xe.object({status:xe.literal("expired"),...qs}),xe.object({status:xe.literal("on_hold"),on_hold_expire_duration:xe.coerce.number().min(.1,"Required").transform(t=>t*(24*60*60)),...qs})]).superRefine((t,s)=>{if(!t.manual_key_entry)return;const r=t.credential_key;if(!r){s.addIssue({code:xe.ZodIssueCode.custom,path:["credential_key"],message:"Credential key is required when manual entry is enabled."});return}sp.test(r)||s.addIssue({code:xe.ZodIssueCode.custom,path:["credential_key"],message:"Credential key must be a 32-character hexadecimal string."})}),ap=()=>{var Zt,ar,ne,z,k,Se,et,Nt,Ft,Ht,gt,ht,Ut,ur,Hr,Jr,hr,xt;const{editingUser:t,isCreatingNewUser:s,onCreateUser:r,editUser:o,fetchUserUsage:i,onEditingUser:a,createUserWithService:l,onDeletingUser:c,users:u,isUserLimitReached:p}=Lt(),m=!!t,g=s||m,S=(Zt=u.users_limit)!=null?Zt:null,y=(ar=u.active_total)!=null?ar:null,A=p&&!m,[f,D]=d.exports.useState(!1),[F,Z]=d.exports.useState(""),ae=sr(),{t:v}=qe(),{colorMode:M}=jr(),T=en({defaultValues:ga(),resolver:ji(ip)}),Q=er({control:T.control,name:"manual_key_entry"}),_e=T.getValues("expire"),ke=T.getValues("next_plan_expire");function W(K){if(typeof K!="number"||K<=0)return null;const We=Oe.unix(K).utc().local(),Je=Oe(),ft=We.diff(Je,"day",!0);return Number.isFinite(ft)?Math.max(0,Math.round(ft)):null}function oe(K){return Oe().add(K,"day").endOf("day").utc().unix()}const[R,le]=d.exports.useState(()=>W(_e)),[w,H]=d.exports.useState(()=>W(ke)),ce=[{label:v("userDialog.quickSelectOneMonth","+1 month"),amount:1,unit:"month"},{label:v("userDialog.quickSelectThreeMonths","+3 months"),amount:3,unit:"month"},{label:v("userDialog.quickSelectOneYear","+1 year"),amount:1,unit:"year"}],j=Hn(K=>K.services),fe=Hn(K=>K.isLoading),{userData:Ae,getUserIsSuccess:Pe}=xr(),Te=Boolean(Pe&&(Ae.role===Ve.Sudo||Ae.role===Ve.FullAccess));Te||Boolean((z=(ne=Ae.permissions)==null?void 0:ne.users)==null?void 0:z[it.Create]);const J=Te||Boolean((Se=(k=Ae.permissions)==null?void 0:k.users)==null?void 0:Se[it.Delete]),Ce=Te||Boolean((Nt=(et=Ae.permissions)==null?void 0:et.users)==null?void 0:Nt[it.ResetUsage]),$=Te||Boolean((Ht=(Ft=Ae.permissions)==null?void 0:Ft.users)==null?void 0:Ht[it.Revoke]),[X,_]=d.exports.useState(null),P=j.length>0,Y=X&&(gt=j.find(K=>K.id===X))!=null?gt:null,te=Boolean(t==null?void 0:t.service_id),ie=!Te&&j.length===1,q=Te||j.length!==1,B=q&&j.length>0,ue=!B,be=!Te&&j.length===0,{data:Ie}=fr("panel-settings",Qa,{enabled:g,staleTime:5*60*1e3,refetchOnWindowFocus:!1}),N=Boolean(Ie==null?void 0:Ie.use_nobetci),[E,G]=d.exports.useState(!1),he=()=>{G(K=>!K)};d.exports.useEffect(()=>{g&&Hn.getState().fetchServices()},[g]),d.exports.useEffect(()=>{var K,We;m?t!=null&&t.service_id?_(t.service_id):Te?_(null):j.length?_((We=(K=j[0])==null?void 0:K.id)!=null?We:null):_(null):g||_(null)},[m,t,g,Te,j]),d.exports.useEffect(()=>{!m&&g&&P&&!Te&&_(K=>{var We,Je;return(Je=K!=null?K:(We=j[0])==null?void 0:We.id)!=null?Je:null})},[j,m,g,P,Te]),d.exports.useEffect(()=>{!m&&g&&!P&&_(null)},[P,m,g]),d.exports.useEffect(()=>{ie&&j[0]&&_(K=>K!=null?K:j[0].id)},[ie,j]);const[Re,tt]=er({control:T.control,name:["data_limit","status"]}),je=er({control:T.control,name:"next_plan_enabled"}),we=er({control:T.control,name:"expire"}),Fe=er({control:T.control,name:"next_plan_data_limit"}),Ye=er({control:T.control,name:"next_plan_expire"}),ot=er({control:T.control,name:"next_plan_add_remaining_traffic"}),ut=er({control:T.control,name:"next_plan_fire_on_either"});d.exports.useEffect(()=>{const K=W(we);le(We=>We===K?We:K)},[we]),d.exports.useEffect(()=>{const K=W(Ye);H(We=>We===K?We:K)},[Ye]);const yt=K=>{T.setValue("next_plan_enabled",K,{shouldDirty:!0}),K?(T.getValues("next_plan_data_limit")===null&&T.setValue("next_plan_data_limit",0,{shouldDirty:!1}),T.getValues("next_plan_add_remaining_traffic")===void 0&&T.setValue("next_plan_add_remaining_traffic",!1,{shouldDirty:!1}),T.getValues("next_plan_fire_on_either")===void 0&&T.setValue("next_plan_fire_on_either",!0,{shouldDirty:!1})):(T.setValue("next_plan_data_limit",null,{shouldDirty:!0}),T.setValue("next_plan_expire",null,{shouldDirty:!0}),H(null))},re=v("userDialog.total"),[ze,Ne]=d.exports.useState(Xi(M,re)),[wt,ct]=d.exports.useState("1m"),V=K=>{i(t,K).then(We=>{const Je=[],ft=[];for(const Mt in We.usages)ft.push(We.usages[Mt].used_traffic),Je.push(We.usages[Mt].node_name);Ne(Xi(M,re,ft,Je))})};d.exports.useEffect(()=>{if(t){const K=np(t);T.reset(K),le(W(K.expire)),H(W(K.next_plan_expire)),V({start:Oe().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")})}else{const K=ga();T.reset(K),le(W(K.expire)),H(W(K.next_plan_expire))}},[t,m,g]);const lt=K=>{var Yn,_n;if(A)return;D(!0),Z(null);const{service_id:We,next_plan_enabled:Je,next_plan_data_limit:ft,next_plan_expire:Mt,next_plan_add_remaining_traffic:Qt,next_plan_fire_on_either:yr,proxies:Ir,inbounds:hn,status:Br,data_limit:Yr,data_limit_reset_strategy:kn,on_hold_expire_duration:pn,ip_limit:ve,credential_key:Vr,manual_key_entry:$r,...Nn}=K,Cn=Je&&ft&&ft>0?Number((Number(ft)*1073741824).toFixed(5)):0,tn=Je?{data_limit:Cn,expire:Mt!=null?Mt:0,add_remaining_traffic:Qt,fire_on_either:yr}:null,gs=typeof ve=="number"&&Number.isFinite(ve)&&ve>0?Math.floor(ve):0;if(!m){const Bt=Te||X!=null?X:ie&&(_n=(Yn=j[0])==null?void 0:Yn.id)!=null?_n:null;if(!Te&&!Bt){Z(v("userDialog.selectService","Please choose a service")),D(!1);return}const mn={username:K.username,service_id:Bt!=null?Bt:0,note:K.note,status:K.status==="active"||K.status==="disabled"||K.status==="on_hold"?K.status:"active",expire:K.expire,data_limit:K.data_limit,ip_limit:gs,data_limit_reset_strategy:Yr&&Yr>0?kn:"no_reset",on_hold_expire_duration:Br==="on_hold"?pn:null};$r&&Vr&&(mn.credential_key=Vr),tn&&(mn.next_plan=tn),l(mn).then(()=>{ae({title:v("userDialog.userCreated",{username:K.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),_t()}).catch(Gt=>{var gn,An,fn,bn,Rn;(((gn=Gt==null?void 0:Gt.response)==null?void 0:gn.status)===409||((An=Gt==null?void 0:Gt.response)==null?void 0:An.status)===400)&&Z((bn=(fn=Gt==null?void 0:Gt.response)==null?void 0:fn._data)==null?void 0:bn.detail),((Rn=Gt==null?void 0:Gt.response)==null?void 0:Rn.status)===422&&Object.keys(Gt.response._data.detail).forEach(wr=>{Z(Gt==null?void 0:Gt.response._data.detail[wr]),T.setError(wr,{type:"custom",message:Gt.response._data.detail[wr]})})}).finally(()=>{D(!1)});return}const Gr={...Nn,data_limit:Yr,ip_limit:gs,data_limit_reset_strategy:Yr&&Yr>0?kn:"no_reset",status:Br==="active"||Br==="disabled"||Br==="on_hold"?Br:"active",on_hold_expire_duration:Br==="on_hold"?pn:null};$r&&Vr&&(Gr.credential_key=Vr),tn?Gr.next_plan=tn:!Je&&(t==null?void 0:t.next_plan)&&(Gr.next_plan=null),t!=null&&t.service_id||(Ir&&Object.keys(Ir).length>0&&(Gr.proxies=Ir),hn&&Object.keys(hn).length>0&&(Gr.inbounds=hn)),typeof X<"u"&&(X===null?Te&&(Gr.service_id=null):X!==(t==null?void 0:t.service_id)&&(Gr.service_id=X)),o(t.username,Gr).then(()=>{ae({title:v("userDialog.userEdited",{username:K.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),_t()}).catch(Bt=>{var mn,Gt,gn,An,fn;(((mn=Bt==null?void 0:Bt.response)==null?void 0:mn.status)===409||((Gt=Bt==null?void 0:Bt.response)==null?void 0:Gt.status)===400)&&Z((An=(gn=Bt==null?void 0:Bt.response)==null?void 0:gn._data)==null?void 0:An.detail),((fn=Bt==null?void 0:Bt.response)==null?void 0:fn.status)===422&&Object.keys(Bt.response._data.detail).forEach(bn=>{Z(Bt==null?void 0:Bt.response._data.detail[bn]),T.setError(bn,{type:"custom",message:Bt.response._data.detail[bn]})})}).finally(()=>{D(!1)})},_t=()=>{T.reset(ga()),le(null),H(null),r(!1),a(null),Z(null),G(!1),ct("1m"),_(null)},zt=()=>{!Ce||Lt.setState({resetUsageUser:t})},Ge=()=>{!$||Lt.setState({revokeSubscriptionUser:t})},Ue=f||A,St=tt==="on_hold",[Vt,dr]=d.exports.useState(!1),ir=()=>{dr(!0);let K="";const We="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",Je=We.length;let ft=0;for(;ft<6;)K+=We.charAt(Math.floor(Math.random()*Je)),ft+=1;return K};return n(Kt,{isOpen:g,onClose:_t,size:be?"lg":"2xl",children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(Ad,{...T,children:n(qt,{mx:"3",position:"relative",overflow:"hidden",children:[e(Jt,{mt:3,disabled:f}),e(L,{pointerEvents:A?"none":"auto",filter:A?"blur(6px)":"none",transition:"filter 0.2s ease",children:n("form",{onSubmit:T.handleSubmit(lt),children:[e(Tt,{pt:6,children:n(U,{gap:2,children:[e(os,{color:"primary",children:m?e(ep,{color:"white"}):e(jh,{color:"white"})}),e(h,{fontWeight:"semibold",fontSize:"lg",children:v(m?"userDialog.editUserTitle":"createNewUser")})]})}),n(It,{children:[m&&te&&n(Mr,{status:"info",mb:4,borderRadius:"md",children:[e(Ur,{}),v("userDialog.serviceManagedNotice","This user is tied to service {{service}}. Update the service to change shared settings.",{service:(ht=t==null?void 0:t.service_name)!=null?ht:""})]}),n(gi,{templateColumns:{base:"repeat(1, 1fr)",md:B?"repeat(2, 1fr)":"minmax(0, 1fr)"},gap:3,...ue?{maxW:"720px",mx:"auto",w:"full"}:{},children:[e(on,{children:n(me,{justifyContent:"space-between",children:[n(pt,{flexDirection:"column",gridAutoRows:"min-content",w:"full",children:[e(pt,{flexDirection:"row",w:"full",gap:2,children:n(x,{mb:"10px",isInvalid:!!((Ut=T.formState.errors.username)!=null&&Ut.message),children:[e(I,{children:v("username")}),n(U,{align:"flex-end",children:[e(L,{flex:"1",minW:"0",children:n(Dr,{size:"sm",children:[e(De,{type:"text",borderRadius:"6px",placeholder:v("username"),isDisabled:Ue||m,...T.register("username")}),!m&&e(Wr,{width:"auto",pr:1,children:e(Be,{"aria-label":v("userDialog.generateUsername","Generate random username"),size:"sm",variant:"ghost",icon:e(Ps,{width:18}),onClick:()=>{const K=ir();T.setValue("username",K,{shouldDirty:!0}),setTimeout(()=>{dr(!1)},350)},isLoading:Vt,isDisabled:Ue})})]})}),m&&e(U,{px:1,children:e(kt,{name:"status",control:T.control,render:({field:K})=>e(mt,{placement:"top",label:"status: "+v(`status.${K.value}`),textTransform:"capitalize",children:e(L,{children:e(vt,{colorScheme:"primary",isChecked:K.value==="active",onChange:We=>{We.target.checked?K.onChange("active"):K.onChange("disabled")}})})})})})]}),e(Zr,{children:(ur=T.formState.errors.username)==null?void 0:ur.message})]})}),n(ge,{direction:{base:"column",md:"row"},spacing:4,mb:"10px",children:[n(x,{flex:"1",children:[e(I,{children:v("userDialog.dataLimit")}),e(kt,{control:T.control,name:"data_limit",render:({field:K})=>{var We;return e(Sr,{endAdornment:"GB",type:"text",inputMode:"decimal",size:"sm",borderRadius:"6px",onChange:K.onChange,disabled:Ue,error:(We=T.formState.errors.data_limit)==null?void 0:We.message,value:K.value?String(K.value):""})}})]}),N&&n(x,{flex:"1",children:[n(I,{display:"flex",alignItems:"center",gap:2,children:[v("userDialog.ipLimitLabel","IP limit"),e(mt,{hasArrow:!0,placement:"top",label:v("userDialog.ipLimitHint","Maximum number of unique IPs allowed. Leave empty or '-' for unlimited."),children:e(se.span,{display:"inline-flex",color:"gray.400",cursor:"help",children:e(Pl,{width:16,height:16})})})]}),e(kt,{control:T.control,name:"ip_limit",rules:{validate:K=>K==null?!0:typeof K!="number"||Number.isNaN(K)?v("userDialog.ipLimitValidation","Enter a valid non-negative number"):K>=0?!0:v("userDialog.ipLimitValidation","Enter a valid non-negative number")},render:({field:K})=>{var We;return e(Sr,{size:"sm",borderRadius:"6px",placeholder:v("userDialog.ipLimitPlaceholder","Leave empty or '-' for unlimited"),value:typeof K.value=="number"&&K.value>0?String(K.value):"",onChange:Je=>{const ft=Je.target.value;if(!ft.trim()||ft.trim()==="-"){K.onChange(null);return}const Mt=Number(ft);Number.isNaN(Mt)||K.onChange(Mt<0?0:Math.floor(Mt))},disabled:Ue,error:(We=T.formState.errors.ip_limit)==null?void 0:We.message})}})]})]}),e(Es,{in:!!(Re&&Re>0),animateOpacity:!0,style:{width:"100%"},children:n(x,{height:"66px",children:[e(I,{children:v("userDialog.periodicUsageReset")}),e(kt,{control:T.control,name:"data_limit_reset_strategy",render:({field:K})=>e(Ze,{size:"sm",...K,disabled:Ue,bg:Ue?"gray.100":"transparent",_dark:{bg:Ue?"gray.600":"transparent"},sx:{option:{backgroundColor:M==="dark"?"#222C3B":"white"}},children:Ta.map(We=>e("option",{value:We.value,children:v("userDialog.resetStrategy"+We.title)},We.value))})})]})}),n(x,{mb:"10px",isInvalid:!St&&Boolean(T.formState.errors.expire),children:[n(pt,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:{base:2,md:4},flexDirection:{base:"column",md:"row"},children:[e(I,{mb:0,children:St?v("userDialog.onHoldExpireDuration"):v("userDialog.expiryDaysLabel","Expires in (days)")}),!m&&e(kt,{name:"status",control:T.control,render:({field:K})=>{const We=K.value==="on_hold";return n(U,{spacing:2,align:"center",children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:v("userDialog.onHold")}),e(vt,{colorScheme:"primary",isChecked:We,onChange:Je=>{Je.target.checked?K.onChange("on_hold"):(K.onChange("active"),T.setValue("on_hold_expire_duration",null,{shouldDirty:!0}))},isDisabled:Ue})]})}})]}),St?e(kt,{control:T.control,name:"on_hold_expire_duration",render:({field:K})=>{var We;return e(Sr,{endAdornment:"Days",type:"number",size:"sm",borderRadius:"6px",onChange:Je=>{T.setValue("expire",null);const ft=Je.target.value;if(!ft){K.onChange(null);return}const Mt=Number(ft);Number.isNaN(Mt)||Mt<0||K.onChange(Math.round(Mt))},disabled:Ue,error:(We=T.formState.errors.on_hold_expire_duration)==null?void 0:We.message,value:K.value?String(K.value):""})}}):n($t,{children:[e(kt,{name:"expire",control:T.control,render:({field:K})=>{const{status:We,time:Je}=na(K.value),ft=K.value?Oe.unix(K.value).toDate():null,Mt=Qt=>{if(!Qt){K.onChange(null),T.setValue("on_hold_expire_duration",null,{shouldDirty:!1});return}const yr=Oe(Qt).utc().unix();T.setValue("on_hold_expire_duration",null,{shouldDirty:!1}),K.onChange(yr)};return n(L,{mt:"3px",children:[e(Gh,{value:ft,onChange:Mt,placeholder:v("userDialog.selectExpiryDate","Select expiration date"),disabled:Ue,minDate:new Date,quickSelects:ce.map(Qt=>({label:Qt.label,onClick:()=>{const yr=Oe().add(Qt.amount,Qt.unit).endOf("day");Mt(yr.toDate())}}))}),K.value?e(nr,{children:v(We,{time:Je})}):null]})}}),e(Zr,{children:(Hr=T.formState.errors.expire)==null?void 0:Hr.message})]})]}),n(L,{mb:"10px",children:[n(U,{justify:"space-between",align:"center",children:[e(I,{mb:0,children:v("userDialog.nextPlanTitle","Next plan")}),e(vt,{colorScheme:"primary",isChecked:je,onChange:K=>yt(K.target.checked),isDisabled:Ue})]}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:v("userDialog.nextPlanDescription","Configure automatic renewal details for this user.")}),e(Es,{in:je,animateOpacity:!0,style:{width:"100%"},children:n(me,{align:"stretch",spacing:3,mt:3,children:[n(x,{children:[e(I,{fontSize:"sm",children:v("userDialog.nextPlanDataLimit","Next plan data limit")}),e(Sr,{endAdornment:"GB",type:"text",inputMode:"decimal",size:"sm",borderRadius:"6px",disabled:Ue,value:Fe!==null&&typeof Fe<"u"?String(Fe):"",onChange:K=>{const We=K.target.value;if(!We){T.setValue("next_plan_data_limit",null,{shouldDirty:!0});return}const Je=Number(We);Number.isNaN(Je)||T.setValue("next_plan_data_limit",Math.max(0,Je),{shouldDirty:!0})}})]}),n(x,{children:[e(I,{fontSize:"sm",children:v("userDialog.nextPlanExpireDays","Next plan in (days)")}),e(kt,{control:T.control,name:"next_plan_expire",render:({field:K})=>{const We=Je=>{if(!Je){H(null),K.onChange(null);return}const ft=Number(Je);if(Number.isNaN(ft)||ft<0)return;const Mt=Math.min(Math.round(ft),3650);H(Mt);const Qt=oe(Mt);K.onChange(Qt)};return e(Sr,{endAdornment:v("userDialog.days","Days"),type:"number",size:"sm",borderRadius:"6px",value:typeof w=="number"?String(w):"",onChange:Je=>We(Je.target.value),disabled:Ue})}})]}),n(U,{justify:"space-between",children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:v("userDialog.nextPlanAddRemainingTraffic","Carry over remaining traffic")}),e(vt,{size:"sm",colorScheme:"primary",isChecked:Boolean(ot),onChange:K=>T.setValue("next_plan_add_remaining_traffic",K.target.checked,{shouldDirty:!0}),isDisabled:Ue})]}),n(U,{justify:"space-between",children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:v("userDialog.nextPlanFireOnEither","Trigger on data or expiry")}),e(vt,{size:"sm",colorScheme:"primary",isChecked:Boolean(ut),onChange:K=>T.setValue("next_plan_fire_on_either",K.target.checked,{shouldDirty:!0}),isDisabled:Ue})]})]})})]}),n(x,{mb:"10px",isInvalid:!!T.formState.errors.note,children:[e(I,{children:v("userDialog.note")}),e(Rr,{...T.register("note")}),e(Zr,{children:(hr=(Jr=T.formState.errors)==null?void 0:Jr.note)==null?void 0:hr.message})]})]}),F&&n(Mr,{status:"error",display:{base:"none",md:"flex"},children:[e(Ur,{}),F]})]})}),q&&e(on,{mt:B?0:4,children:n(x,{isRequired:!Te,children:[e(I,{children:v("userDialog.selectServiceLabel","Service")}),!fe&&!P&&n(Mr,{status:"warning",borderRadius:"md",mb:4,children:[e(Ur,{}),n(me,{align:"flex-start",spacing:1,children:[e(h,{children:v("userDialog.noServicesAvailable","No services are available yet.")}),e(h,{children:v("userDialog.createServiceToManage","Create a service to manage users.")})]})]}),fe?n(U,{spacing:2,py:4,children:[e(Et,{size:"sm"}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:v("loading")})]}):P?n(me,{align:"stretch",spacing:3,children:[Te&&n(L,{role:"button",tabIndex:Ue?-1:0,"aria-pressed":X===null,onKeyDown:K=>{Ue||(K.key==="Enter"||K.key===" ")&&(K.preventDefault(),_(null))},onClick:()=>{Ue||_(null)},borderWidth:"1px",borderRadius:"md",p:4,borderColor:X===null?"primary.500":"gray.200",bg:X===null?"primary.50":"transparent",cursor:Ue?"not-allowed":"pointer",pointerEvents:Ue?"none":"auto",transition:"border-color 0.2s ease, background-color 0.2s ease",_hover:Ue?{}:{borderColor:X===null?"primary.500":"gray.300"},_dark:{borderColor:X===null?"primary.400":"gray.700",bg:X===null?"primary.900":"transparent"},children:[e(h,{fontWeight:"semibold",children:v("userDialog.noServiceOption","No service")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:v("userDialog.noServiceHelper","Keep this user detached from shared service settings.")})]}),j.map(K=>{const We=X===K.id;return e(L,{role:"button",tabIndex:Ue?-1:0,"aria-pressed":We,onKeyDown:Je=>{Ue||(Je.key==="Enter"||Je.key===" ")&&(Je.preventDefault(),_(K.id))},onClick:()=>{Ue||_(K.id)},borderWidth:"1px",borderRadius:"md",p:4,borderColor:We?"primary.500":"gray.200",bg:We?"primary.50":"transparent",cursor:Ue?"not-allowed":"pointer",pointerEvents:Ue?"none":"auto",transition:"border-color 0.2s ease, background-color 0.2s ease",_hover:Ue?{}:{borderColor:We?"primary.500":"gray.300"},_dark:{borderColor:We?"primary.400":"gray.700",bg:We?"primary.900":"transparent"},children:n(U,{justify:"space-between",align:"flex-start",children:[n(me,{align:"flex-start",spacing:0,children:[e(h,{fontWeight:"semibold",children:K.name}),K.description&&e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:K.description})]}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:v("userDialog.serviceSummary","{{hosts}} hosts, {{users}} users",{hosts:K.host_count,users:K.user_count})})]})},K.id)})]}):null,Y&&e(nr,{mt:2,children:v("userDialog.serviceSummary","{{hosts}} hosts, {{users}} users",{hosts:Y.host_count,users:Y.user_count})})]})}),n(on,{colSpan:{base:1,md:q?2:1},children:[n(x,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e(I,{mb:0,children:v("userDialog.allowManualKeyEntry","Allow custom credential key entry")}),e(kt,{name:"manual_key_entry",control:T.control,render:({field:K})=>e(vt,{size:"sm",colorScheme:"primary",isChecked:K.value,onChange:We=>K.onChange(We.target.checked),isDisabled:Ue})})]}),Q&&n(x,{mt:4,isInvalid:Boolean(T.formState.errors.credential_key),children:[e(I,{children:v("userDialog.credentialKeyLabel","Credential key")}),e(kt,{name:"credential_key",control:T.control,render:({field:K})=>{var We;return e(De,{placeholder:"35e4e39c7d5c4f4b8b71558e4f37ff53",maxLength:32,value:(We=K.value)!=null?We:"",onChange:Je=>K.onChange(Je.target.value),isDisabled:Ue})}}),e(nr,{children:v("userDialog.manualKeyHelper","Enter a 32-character hexadecimal credential key.")}),e(Zr,{children:(xt=T.formState.errors.credential_key)==null?void 0:xt.message})]})]}),m&&E&&e(on,{pt:6,colSpan:{base:1,md:q?2:1},children:n(me,{gap:4,children:[e(Zh,{defaultValue:wt,onChange:(K,We)=>{ct(K),V(We)}}),e(L,{width:{base:"100%",md:"70%"},justifySelf:"center",children:e(an,{options:ze.options,series:ze.series,type:"donut"})})]})})]}),F&&n(Mr,{mt:"3",status:"error",display:{base:"flex",md:"none"},children:[e(Ur,{}),F]})]}),e(Wt,{mt:"3",children:n(U,{justifyContent:"space-between",w:"full",gap:3,flexDirection:{base:"column",sm:"row"},children:[e(U,{justifyContent:"flex-start",w:{base:"full",sm:"unset"},children:m&&n($t,{children:[J&&e(mt,{label:v("delete"),placement:"top",children:e(Be,{"aria-label":"Delete",size:"sm",onClick:()=>{c(t),_t()},children:e(ki,{})})}),e(mt,{label:v("userDialog.usage"),placement:"top",children:e(Be,{"aria-label":"usage",size:"sm",onClick:he,children:e(tp,{})})}),Ce&&e(O,{onClick:zt,size:"sm",children:v("userDialog.resetUsage")}),$&&e(O,{onClick:Ge,size:"sm",children:v("userDialog.revokeSubscription")})]})}),e(U,{w:"full",maxW:{md:"50%",base:"full"},justify:"end",children:e(O,{type:"submit",size:"sm",px:"8",colorScheme:"primary",leftIcon:f?e(Et,{size:"xs"}):void 0,disabled:Ue,children:v(m?"userDialog.editUser":"createUser")})})]})})]})}),A&&n(pt,{position:"absolute",inset:0,align:"center",justify:"center",direction:"column",gap:4,bg:"blackAlpha.600",color:"white",textAlign:"center",p:6,pointerEvents:"none",children:[e(os,{color:"primary",children:e(rp,{})}),e(h,{fontSize:"xl",fontWeight:"semibold",children:v("userDialog.limitReachedTitle")}),e(h,{fontSize:"md",maxW:"sm",children:S&&S>0?v("userDialog.limitReachedBody",{limit:S,active:y!=null?y:S}):v("userDialog.limitReachedContent")})]})]})})]})},op=t=>d.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","data-name":"Layer 1",width:782.04441,height:701.88002,viewBox:"0 0 782.04441 701.88002",xmlnsXlink:"http://www.w3.org/1999/xlink",...t},d.exports.createElement("path",{d:"M609.48783,100.59015l-25.44631,6.56209L270.53735,187.9987,245.091,194.56079A48.17927,48.17927,0,0,0,210.508,253.17865L320.849,681.05606a48.17924,48.17924,0,0,0,58.61776,34.58317l.06572-.01695,364.26536-93.93675.06572-.01695a48.17923,48.17923,0,0,0,34.58309-58.6178l-110.341-427.87741A48.17928,48.17928,0,0,0,609.48783,100.59015Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M612.94784,114.00532l-30.13945,7.77236L278.68955,200.20385l-30.139,7.77223a34.30949,34.30949,0,0,0-24.6275,41.74308l110.341,427.87741a34.30946,34.30946,0,0,0,41.7431,24.62736l.06572-.01695,364.26536-93.93674.06619-.01707a34.30935,34.30935,0,0,0,24.627-41.7429l-110.341-427.87741A34.30938,34.30938,0,0,0,612.94784,114.00532Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("path",{d:"M590.19,252.56327,405.917,300.08359a8.01411,8.01411,0,0,1-4.00241-15.52046l184.273-47.52033A8.01412,8.01412,0,0,1,590.19,252.56327Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M628.955,270.49906,412.671,326.27437a8.01411,8.01411,0,1,1-4.00241-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M620.45825,369.93676l-184.273,47.52032a8.01411,8.01411,0,1,1-4.00242-15.52046l184.273-47.52032a8.01411,8.01411,0,1,1,4.00241,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M659.22329,387.87255l-216.284,55.77531a8.01411,8.01411,0,1,1-4.00242-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M650.72653,487.31025l-184.273,47.52033a8.01412,8.01412,0,0,1-4.00242-15.52047l184.273-47.52032a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M689.49156,505.246l-216.284,55.77532a8.01412,8.01412,0,1,1-4.00241-15.52047l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M374.45884,348.80871l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76146L289.5963,304.81607a3.847,3.847,0,0,1,2.76145-4.68061l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76145l14.96947,58.04817A3.847,3.847,0,0,1,374.45884,348.80871Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M404.72712,466.1822l-65.21247,16.817a3.847,3.847,0,0,1-4.68062-2.76146l-14.96946-58.04816A3.847,3.847,0,0,1,322.626,417.509l65.21246-16.817a3.847,3.847,0,0,1,4.68062,2.76145l14.96946,58.04817A3.847,3.847,0,0,1,404.72712,466.1822Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M434.99539,583.55569l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76145l-14.96946-58.04817a3.847,3.847,0,0,1,2.76145-4.68062l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76146l14.96947,58.04816A3.847,3.847,0,0,1,434.99539,583.55569Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M863.63647,209.0517H487.31811a48.17928,48.17928,0,0,0-48.125,48.12512V699.05261a48.17924,48.17924,0,0,0,48.125,48.12507H863.63647a48.17924,48.17924,0,0,0,48.125-48.12507V257.17682A48.17928,48.17928,0,0,0,863.63647,209.0517Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M863.637,222.90589H487.31811a34.30948,34.30948,0,0,0-34.271,34.27093V699.05261a34.30947,34.30947,0,0,0,34.271,34.27088H863.637a34.30936,34.30936,0,0,0,34.27051-34.27088V257.17682A34.30937,34.30937,0,0,0,863.637,222.90589Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("circle",{cx:694.19401,cy:614.02963,r:87.85039,fill:"#3182CE"}),d.exports.createElement("path",{d:"M945.18722,701.63087H914.63056V671.07421a11.45875,11.45875,0,0,0-22.9175,0v30.55666H861.1564a11.45875,11.45875,0,0,0,0,22.9175h30.55666V755.105a11.45875,11.45875,0,1,0,22.9175,0V724.54837h30.55666a11.45875,11.45875,0,0,0,0-22.9175Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("path",{d:"M807.00068,465.71551H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01412,8.01412,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M840.05889,492.76314H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01411,8.01411,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M807.00068,586.929H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M840.05889,613.97661H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01412,8.01412,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M574.07028,505.04162H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V441.25158a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,505.04162Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M574.07028,626.25509H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V562.46505a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,626.25509Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M807.21185,330.781H666.91017a8.01411,8.01411,0,0,1,0-16.02823H807.21185a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),d.exports.createElement("path",{d:"M840.27007,357.82862H666.91017a8.01411,8.01411,0,1,1,0-16.02822h173.3599a8.01411,8.01411,0,0,1,0,16.02822Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),d.exports.createElement("path",{d:"M635.85911,390.6071H506.51316a3.847,3.847,0,0,1-3.84277-3.84277V285.81706a3.847,3.847,0,0,1,3.84277-3.84277H635.85911a3.847,3.847,0,0,1,3.84277,3.84277V386.76433A3.847,3.847,0,0,1,635.85911,390.6071Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"})),lp=t=>{if(!t)return null;const s=new Date(`${t}Z`);return Math.floor(s.getTime()/1e3)},zo=({lastOnline:t})=>{const s=Math.floor(Date.now()/1e3),r=lp(t);return!t||r===null?e(L,{border:"1px solid",borderColor:"gray.400",_dark:{borderColor:"gray.600"},className:"circle"}):s-r<=60?e(L,{bg:"green.300",_dark:{bg:"green.500"},className:"circle pulse green"}):e(L,{bg:"gray.400",_dark:{bg:"gray.600"},className:"circle"})},cp=t=>{if(!t)return null;const s=new Date(t+"Z");return Math.floor(s.getTime()/1e3)},No=({lastOnline:t})=>{const s=Math.floor(Date.now()/1e3),r=cp(t),o=r?s-r:null,i=r?na(r):{status:"",time:"Not Connected Yet"};return e(h,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:o&&o<=60?"Online":o?`${i.time} ago`:i.time})},fa=({expiryDate:t,status:s,compact:r=!1,showDetail:o=!0,extraText:i})=>{const{t:a}=qe(),l=na(t),c=is[s].icon;return n($t,{children:[n(cn,{colorScheme:is[s].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:r?1:2,alignItems:"center",children:[e(c,{w:r?3:4}),o&&n(h,{textTransform:"capitalize",fontSize:r?".7rem":".875rem",lineHeight:r?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",children:[s&&a(`status.${s}`),i&&`: ${i}`]})]}),o&&t&&e(h,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:a(l.status,{time:l.time})})]})},dp=se(op),Ws={baseStyle:{w:{base:4,md:5},h:{base:4,md:5}}},up=se(El,Ws),hp=se(ea,Ws),Ro=se(vi,Ws),pp=se(Tl,Ws),mp=se(Dl,Ws),gp=se(Vn,Ws),fp=se(ea,{baseStyle:{width:"15px",height:"15px"}}),bp=se(Dd,{baseStyle:{width:{base:16,md:20},height:{base:16,md:20}}}),yp=t=>{for(var s=0;s<Ta.length;s++){const r=Ta[s];if(r.value==t)return r.title}return"No"},Sp=t=>{const{used:s,total:r,dataLimitResetStrategy:o,totalUsedTraffic:i}=t,a=r===0||r===null;return e(U,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:n(h,{children:[$e(s)," /"," ",a?e(h,{as:"span",fontFamily:"system-ui",children:"\u221E"}):$e(r)]})})},Lo=t=>{const{used:s,total:r,dataLimitResetStrategy:o,totalUsedTraffic:i,...a}=t,l=r===0||r===null,c=!l&&s/r*100>=100;return n($t,{children:[e(Ml,{orientation:"horizontal",value:l?100:Math.min(s/r*100,100),colorScheme:c?"red":"primary",...a,children:e(Ul,{h:"6px",borderRadius:"full",children:e(Ol,{borderRadius:"full"})})}),n(U,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:[n(h,{children:[$e(s)," /"," ",l?e(h,{as:"span",fontFamily:"system-ui",children:"\u221E"}):$e(r)+(o&&o!=="no_reset"?" "+Dn("userDialog.resetStrategy"+yp(o)):"")]}),n(h,{children:[Dn("usersTable.total"),": ",$e(i)]})]})]})},Js=({sort:t,column:s})=>t.includes(s)?e(fp,{transform:t.startsWith("-")?void 0:"rotate(180deg)"}):null,xp=t=>{var M,T,Q,_e,ke,W,oe,R,le;const{filters:s,users:{users:r,total:o},onEditingUser:i,onFilterChange:a,loading:l}=Lt(),{t:c}=qe(),[u,p]=d.exports.useState(void 0),m=Or({base:!1,md:!0}),{userData:g}=xr(),S=g.role===Ve.Sudo||g.role===Ve.FullAccess,y=Boolean(!S&&g.status===ln.Disabled),A=S||Boolean((T=(M=g.permissions)==null?void 0:M.users)==null?void 0:T[it.Create]);S||Boolean((_e=(Q=g.permissions)==null?void 0:Q.users)==null?void 0:_e[it.Delete]),S||Boolean((W=(ke=g.permissions)==null?void 0:ke.users)==null?void 0:W[it.ResetUsage]),S||Boolean((R=(oe=g.permissions)==null?void 0:oe.users)==null?void 0:R[it.Revoke]);const f=g.disabled_reason,D=r.length!==o,F=s.limit||10,Z=w=>{let H=s.sort;H.includes(w)?H.startsWith("-")?H="-created_at":H="-"+w:H=w,a({sort:H})},ae=w=>{a({status:w.target.value.length>0?w.target.value:void 0})},v=w=>{p(w===u?void 0:w)};return n(L,{position:"relative",children:[n(L,{id:"users-table",overflowX:{base:"unset",md:"unset"},filter:y?"blur(4px)":void 0,pointerEvents:y?"none":void 0,"aria-hidden":y?!0:void 0,children:[e(zl,{allowMultiple:!0,display:{base:"block",md:"none"},index:u,children:n(as,{orientation:"vertical",zIndex:"docked",...t,children:[e(yn,{zIndex:"docked",position:"relative",children:n(Ot,{children:[e(Ke,{minW:"120px",pl:4,pr:4,cursor:"pointer",onClick:Z.bind(null,"username"),children:n(U,{children:[e("span",{children:c("users")}),e(Js,{sort:s.sort,column:"username"})]})}),e(Ke,{minW:"50px",pl:0,pr:0,w:"140px",cursor:"pointer",children:n(U,{spacing:0,position:"relative",children:[n(h,{position:"absolute",_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,w:"100%",children:[c("usersTable.status"),s.status?": "+s.status:""]}),n(Ze,{value:(le=s.status)!=null?le:"",fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",p:0,border:0,h:"auto",w:"auto",icon:e($t,{}),_focusVisible:{border:"0 !important"},onChange:ae,children:[e("option",{value:""}),e("option",{value:"active",children:"active"}),e("option",{value:"on_hold",children:"on_hold"}),e("option",{value:"disabled",children:"disabled"}),e("option",{value:"limited",children:"limited"}),e("option",{value:"expired",children:"expired"})]})]})}),e(Ke,{minW:"100px",cursor:"pointer",pr:0,onClick:Z.bind(null,"used_traffic"),children:n(U,{children:[e("span",{children:c("usersTable.dataUsage")}),e(Js,{sort:s.sort,column:"used_traffic"})]})}),e(Ke,{minW:"32px",w:"32px",p:0,cursor:"pointer"})]})}),n(sn,{children:[!m&&(l?Array.from({length:F}).map((w,H)=>n(d.exports.Fragment,{children:[n(Ot,{children:[e(Me,{borderBottom:0,minW:"100px",pl:4,pr:4,children:e(Ti,{noOfLines:1,width:"40%"})}),e(Me,{borderBottom:0,minW:"50px",pl:0,pr:0,children:e(bs,{height:"16px",width:"64px"})}),e(Me,{borderBottom:0,minW:"100px",pr:0,children:e(bs,{height:"16px",width:"120px"})}),e(Me,{p:0,borderBottom:0,w:"32px",minW:"32px",children:e(bs,{height:"16px",width:"16px"})})]}),e(Ot,{className:"collapsible",children:e(Me,{p:0,colSpan:4,children:e(L,{px:6,py:3,children:e(Ti,{noOfLines:3})})})})]},"skeleton-"+H)):r==null?void 0:r.map((w,H)=>{var ce;return n(d.exports.Fragment,{children:[n(Ot,{onClick:v.bind(null,H),cursor:"pointer",children:[e(Me,{borderBottom:0,minW:"100px",pl:4,pr:4,maxW:"calc(100vw - 50px - 32px - 100px - 48px)",children:n("div",{className:"flex-status",children:[e(zo,{lastOnline:w.online_at}),e(h,{isTruncated:!0,children:w.username})]})}),e(Me,{borderBottom:0,minW:"50px",pl:0,pr:0,children:e(fa,{compact:!0,showDetail:!1,expiryDate:w.expire,status:w.status})}),e(Me,{borderBottom:0,minW:"100px",pr:0,children:e(Sp,{totalUsedTraffic:w.lifetime_used_traffic,dataLimitResetStrategy:w.data_limit_reset_strategy,used:w.used_traffic,total:w.data_limit,colorScheme:is[w.status].bandWidthColor})}),e(Me,{p:0,borderBottom:0,w:"32px",minW:"32px",children:e(hp,{color:"gray.600",_dark:{color:"gray.400"},transition:"transform .2s ease-out",transform:u===H?"rotate(180deg)":"0deg"})})]}),e(Ot,{className:"collapsible",onClick:v.bind(null,H),children:e(Me,{p:0,colSpan:4,children:n(Nl,{border:0,children:[e(Rl,{display:"none"}),e(Ll,{border:0,cursor:"pointer",px:6,py:3,children:n(me,{justifyContent:"space-between",spacing:"4",children:[n(me,{alignItems:"flex-start",w:"full",spacing:-1,children:[e(h,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:c("usersTable.dataUsage")}),e(L,{width:"full",minW:"230px",children:e(Lo,{totalUsedTraffic:w.lifetime_used_traffic,dataLimitResetStrategy:w.data_limit_reset_strategy,used:w.used_traffic,total:w.data_limit,colorScheme:is[w.status].bandWidthColor})})]}),n(me,{alignItems:"flex-start",w:"full",spacing:1,children:[e(h,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:c("usersTable.service","Service")}),e(h,{fontSize:"sm",color:w.service_name?"gray.700":"gray.500",_dark:{color:w.service_name?"gray.200":"gray.500"},children:(ce=w.service_name)!=null?ce:c("usersTable.defaultService","Default")})]}),n(U,{w:"full",justifyContent:"space-between",children:[n(L,{width:"full",children:[e(fa,{compact:!0,expiryDate:w.expire,status:w.status}),e(No,{lastOnline:w.online_at})]}),n(U,{children:[e(Mo,{user:w}),A&&e(mt,{label:c("userDialog.editUser"),placement:"top",children:e(Be,{p:"0 !important","aria-label":"Edit user",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:j=>{j.stopPropagation(),i(w)},children:e(gp,{})})})]})]})]})})]})})})]},w.username)})),!l&&!m&&r.length===0&&e(Ot,{children:e(Me,{colSpan:4,border:0,children:e(Uo,{isFiltered:D,isCreateDisabled:y})})})]})]})}),n(as,{orientation:"vertical",display:{base:"none",md:"table"},...t,children:[e(yn,{position:"relative",zIndex:"docked",children:n(Ot,{children:[e(Ke,{minW:"140px",cursor:"pointer",onClick:Z.bind(null,"username"),children:n(U,{children:[e("span",{children:c("username")}),e(Js,{sort:s.sort,column:"username"})]})}),e(Ke,{width:"400px",minW:"150px",cursor:"pointer",children:n(U,{position:"relative",gap:"5px",children:[n(h,{_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,children:[c("usersTable.status"),s.status?": "+s.status:""]}),e(h,{children:"/"}),e(Js,{sort:s.sort,column:"expire"}),e(U,{onClick:Z.bind(null,"expire"),children:e(h,{children:"Sort by expire"})}),n(Ze,{fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",position:"absolute",p:0,left:"-40px",border:0,h:"auto",w:"auto",icon:e($t,{}),_focusVisible:{border:"0 !important"},value:s.sort,onChange:ae,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(Ke,{minW:"150px",children:e("span",{children:c("usersTable.service","Service")})}),e(Ke,{width:"350px",minW:"230px",cursor:"pointer",onClick:Z.bind(null,"used_traffic"),children:n(U,{children:[e("span",{children:c("usersTable.dataUsage")}),e(Js,{sort:s.sort,column:"used_traffic"})]})}),e(Ke,{width:"200px",minW:"180px"})]})}),n(sn,{children:[m&&(l?Array.from({length:F}).map((w,H)=>n(Ot,{children:[e(Me,{minW:"140px",children:e(Ti,{noOfLines:1,width:"40%"})}),e(Me,{width:"400px",minW:"150px",children:e(bs,{height:"16px",width:"120px"})}),e(Me,{minW:"150px",children:e(Ti,{noOfLines:1,width:"60%"})}),e(Me,{width:"350px",minW:"230px",children:e(bs,{height:"16px",width:"200px"})}),e(Me,{width:"200px",minW:"180px",children:e(bs,{height:"16px",width:"64px"})})]},"skeleton-desktop-"+H)):r==null?void 0:r.map((w,H)=>{var ce;return n(Ot,{className:Ha("interactive",{"last-row":H===r.length-1}),onClick:()=>{A&&i(w)},cursor:A?"pointer":"default",children:[e(Me,{minW:"140px",children:n("div",{className:"flex-status",children:[e(zo,{lastOnline:w.online_at}),w.username,e(No,{lastOnline:w.online_at})]})}),e(Me,{width:"400px",minW:"150px",children:e(fa,{expiryDate:w.expire,status:w.status})}),e(Me,{minW:"150px",children:e(h,{fontSize:"sm",color:w.service_name?"gray.700":"gray.500",_dark:{color:w.service_name?"gray.200":"gray.500"},isTruncated:!0,children:(ce=w.service_name)!=null?ce:c("usersTable.defaultService","Default")})}),e(Me,{width:"350px",minW:"230px",children:e(Lo,{totalUsedTraffic:w.lifetime_used_traffic,dataLimitResetStrategy:w.data_limit_reset_strategy,used:w.used_traffic,total:w.data_limit,colorScheme:is[w.status].bandWidthColor})}),e(Me,{width:"200px",minW:"180px",children:e(Mo,{user:w})})]},w.username)})),!l&&r.length==0&&e(Ot,{children:e(Me,{colSpan:5,children:e(Uo,{isFiltered:D,isCreateDisabled:y||!A})})})]})]})]}),y&&n(pt,{position:"absolute",inset:0,align:"center",justify:"center",direction:"column",textAlign:"center",px:6,py:8,bg:"rgba(255, 255, 255, 0.85)",_dark:{bg:"rgba(15, 23, 42, 0.9)"},zIndex:"overlay",children:[e(bp,{color:"red.400",mb:6}),e(h,{fontSize:"xl",fontWeight:"bold",mb:3,children:c("usersTable.adminDisabledTitle","Your account is disabled")}),e(h,{maxW:"480px",color:"gray.600",_dark:{color:"gray.200"},children:f||c("usersTable.adminDisabledDescription","Please contact the sudo admin to regain access.")})]})]})},Mo=({user:t})=>{const{setQRCode:s,setSubLink:r}=Lt(),o=t.links.join(`\r
`),a=(u=>u?u.startsWith("/")?window.location.origin+u:u:"")(t.subscription_url),[l,c]=d.exports.useState([-1,!1]);return d.exports.useEffect(()=>{l[1]&&setTimeout(()=>{c([-1,!1])},1e3)},[l]),n(U,{justifyContent:"flex-end",onClick:u=>{u.preventDefault(),u.stopPropagation()},children:[e(lo,{text:a,onCopy:()=>{c([0,!0])},children:e("div",{children:e(mt,{label:l[0]==0&&l[1]?Dn("usersTable.copied"):Dn("usersTable.copyLink"),placement:"top",children:e(Be,{p:"0 !important","aria-label":"copy subscription link",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:l[0]==0&&l[1]?e(Ro,{}):e(pp,{})})})})}),e(lo,{text:o,onCopy:()=>{c([1,!0])},children:e("div",{children:e(mt,{label:l[0]==1&&l[1]?Dn("usersTable.copied"):Dn("usersTable.copyConfigs"),placement:"top",children:e(Be,{p:"0 !important","aria-label":"copy configs",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:l[0]==1&&l[1]?e(Ro,{}):e(up,{})})})})}),e(mt,{label:"QR Code",placement:"top",children:e(Be,{p:"0 !important","aria-label":"qr code",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:()=>{s(t.links),r(a)},children:e(mp,{})})})]})},Uo=({isFiltered:t,isCreateDisabled:s})=>{const{onCreateUser:r}=Lt(),o=()=>{s||r(!0)};return n(L,{padding:"5",py:"8",display:"flex",alignItems:"center",flexDirection:"column",gap:4,w:"full",children:[e(dp,{maxHeight:"200px",maxWidth:"200px",_dark:{'path[fill="#fff"]':{fill:"gray.800"},'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.700"},'circle[fill="#3182CE"]':{fill:"primary.300"}},_light:{'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.300"},'circle[fill="#3182CE"]':{fill:"primary.500"}}}),e(h,{fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:t?Dn("usersTable.noUserMatched"):Dn("usersTable.noUser")}),!t&&!s&&e(O,{size:"sm",colorScheme:"primary",onClick:o,children:Dn("createUser")})]})},vp=()=>{const{t}=qe();return d.exports.useEffect(()=>{Lt.getState().refetchUsers(),yi()},[]),n(me,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("users")}),e(ec,{}),e(xp,{}),e(tc,{}),e(ap,{}),e(wh,{}),e(Wh,{}),e(Hh,{}),e(Vh,{})]})},jt=(t,s,r)=>{if(t.response&&t.response._data){if(typeof t.response._data.detail=="string")return s({title:t.response._data.detail,status:"error",isClosable:!0,position:"top",duration:3e3});if(typeof t.response._data.detail=="object"&&r){Object.keys(t.response._data.detail).forEach(o=>r.setError(o,{message:t.response._data.detail[o]}));return}}return s({title:"Something went wrong!",status:"error",isClosable:!0,position:"top",duration:3e3})},tr=(t,s)=>s({title:t,status:"success",isClosable:!0,position:"top",duration:3e3}),wp=[{key:it.Create,label:"admins.permissions.createUser"},{key:it.Delete,label:"admins.permissions.deleteUser"},{key:it.ResetUsage,label:"admins.permissions.resetUsage"},{key:it.Revoke,label:"admins.permissions.revoke"},{key:it.CreateOnHold,label:"admins.permissions.createOnHold"},{key:it.AllowUnlimitedData,label:"admins.permissions.unlimitedData"},{key:it.AllowUnlimitedExpire,label:"admins.permissions.unlimitedExpire"},{key:it.AllowNextPlan,label:"admins.permissions.nextPlan"},{key:it.AdvancedActions,label:"admins.permissions.advancedActions"}],kp=[{key:br.View,label:"admins.permissions.viewAdmins"},{key:br.Edit,label:"admins.permissions.editAdmins"},{key:br.ManageSudo,label:"admins.permissions.manageSudo"}],Cp=[{key:Ct.Usage,label:"admins.sections.usage"},{key:Ct.Admins,label:"admins.sections.admins"},{key:Ct.Services,label:"admins.sections.services"},{key:Ct.Hosts,label:"admins.sections.hosts"},{key:Ct.Nodes,label:"admins.sections.nodes"},{key:Ct.Integrations,label:"admins.sections.integrations"},{key:Ct.Xray,label:"admins.sections.xray"}],rc=({value:t,onChange:s,maxDataLimitValue:r,onMaxDataLimitChange:o,maxDataLimitError:i,showReset:a=!1,onReset:l,hideExtendedSections:c=!1})=>{const{t:u}=qe(),p=(g,S,y)=>{const A={...t[g],[S]:y},f={...t,[g]:A};s(f)},m=g=>{o==null||o(g.target.value)};return n(ge,{spacing:6,children:[n(U,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"semibold",children:u("admins.permissions.userCapabilities","User capabilities")}),a&&l&&e(O,{size:"xs",variant:"ghost",onClick:l,children:u("admins.permissions.resetToDefaults","Reset to defaults")})]}),e(He,{columns:{base:1,md:2},spacing:3,children:wp.map(({key:g,label:S})=>n(U,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(h,{fontSize:"sm",children:u(S)}),e(vt,{isChecked:Boolean(t.users[g]),onChange:y=>p("users",g,y.target.checked)})]},g))}),n(x,{isInvalid:Boolean(i),children:[e(I,{children:u("admins.permissions.maxDataPerUser","Max per user data (GB)")}),e(mt,{label:u("admins.permissions.enableUnlimitedFirst","Enable unlimited data first to set this value."),isDisabled:Boolean(t.users.allow_unlimited_data),hasArrow:!0,openDelay:200,placement:"top",gutter:6,shouldWrapChildren:!0,children:e(De,{type:"number",min:"0",step:"1",placeholder:u("admins.permissions.maxDataHint","Leave empty for unlimited"),value:r,onChange:m,isDisabled:!t.users.allow_unlimited_data})}),i?e(Zr,{children:i}):e(nr,{children:t.users.allow_unlimited_data?u("admins.permissions.maxDataDescription","Applies when this admin creates or edits users."):u("admins.permissions.limitDisabledHint","Unlimited data must be allowed before setting a cap.")})]}),!c&&n(ge,{spacing:3,children:[e(h,{fontWeight:"semibold",children:u("admins.permissions.manageAdminsTitle","Admin management")}),e(He,{columns:{base:1,md:2},spacing:3,children:kp.map(({key:g,label:S})=>n(U,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(h,{fontSize:"sm",children:u(S)}),e(vt,{isChecked:Boolean(t.admin_management[g]),onChange:y=>p("admin_management",g,y.target.checked)})]},g))})]}),!c&&n(ge,{spacing:3,children:[e(h,{fontWeight:"semibold",children:u("admins.permissions.sectionAccess","Section access")}),e(He,{columns:{base:1,md:2},spacing:3,children:Cp.map(({key:g,label:S})=>n(U,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(h,{fontSize:"sm",children:u(S)}),e(vt,{isChecked:Boolean(t.sections[g]),onChange:y=>p("sections",g,y.target.checked)})]},g))})]})]})},nc=({isOpen:t,onClose:s,admin:r})=>{var y,A;const{t:o}=qe(),i=sr(),a=un(f=>f.updateAdmin),[l,c]=d.exports.useState((y=r==null?void 0:r.permissions)!=null?y:zi),[u,p]=d.exports.useState(""),[m,g]=d.exports.useState(!1);d.exports.useEffect(()=>{var f;r?(c((f=r.permissions)!=null?f:zi),p(r.permissions.users.max_data_limit_per_user?String(Math.floor(r.permissions.users.max_data_limit_per_user/(1024*1024*1024))):"")):(c(zi),p(""))},[r,t]);const S=async()=>{if(!!r){g(!0);try{await a(r.username,{permissions:l}),tr(o("admins.permissions.updateSuccess","Permissions updated"),i),s()}catch(f){jt(f,i)}finally{g(!1)}}};return n(Kt,{isOpen:t,onClose:s,size:"lg",children:[e(Dt,{}),n(qt,{children:[e(Tt,{children:o("admins.permissions.modalTitle",{defaultValue:"Edit permissions for {{username}}",username:(A=r==null?void 0:r.username)!=null?A:""})}),e(Jt,{}),e(It,{children:e(rc,{value:l,onChange:c,showReset:!0,onReset:()=>c(zi),maxDataLimitValue:u,onMaxDataLimitChange:f=>{p(f);const D=Number(f);c(F=>({...F,users:{...F.users,max_data_limit_per_user:!f||Number.isNaN(D)?null:Math.max(0,D)*1024*1024*1024}}))},hideExtendedSections:(r==null?void 0:r.role)===Ve.Standard})}),n(Wt,{children:[e(O,{variant:"ghost",mr:3,onClick:s,children:o("cancel")}),e(O,{colorScheme:"primary",onClick:S,isLoading:m,isDisabled:!r,children:o("save","Save")})]})]})]})},ai=1024*1024*1024,_p={[Ve.Standard]:{users:{create:!0,delete:!0,reset_usage:!0,revoke:!0,create_on_hold:!0,allow_unlimited_data:!0,allow_unlimited_expire:!0,allow_next_plan:!0,advanced_actions:!0,max_data_limit_per_user:null},admin_management:{can_view:!1,can_edit:!1,can_manage_sudo:!1},sections:{usage:!1,admins:!1,services:!1,hosts:!1,nodes:!1,integrations:!1,xray:!1}},[Ve.Reseller]:{users:{create:!0,delete:!0,reset_usage:!0,revoke:!0,create_on_hold:!0,allow_unlimited_data:!0,allow_unlimited_expire:!0,allow_next_plan:!0,advanced_actions:!0,max_data_limit_per_user:null},admin_management:{can_view:!1,can_edit:!1,can_manage_sudo:!1},sections:{usage:!1,admins:!1,services:!1,hosts:!1,nodes:!1,integrations:!1,xray:!1}},[Ve.Sudo]:{users:{create:!0,delete:!0,reset_usage:!0,revoke:!0,create_on_hold:!0,allow_unlimited_data:!0,allow_unlimited_expire:!0,allow_next_plan:!0,advanced_actions:!0,max_data_limit_per_user:null},admin_management:{can_view:!0,can_edit:!0,can_manage_sudo:!1},sections:{usage:!0,admins:!0,services:!0,hosts:!0,nodes:!0,integrations:!0,xray:!0}},[Ve.FullAccess]:{users:{create:!0,delete:!0,reset_usage:!0,revoke:!0,create_on_hold:!0,allow_unlimited_data:!0,allow_unlimited_expire:!0,allow_next_plan:!0,advanced_actions:!0,max_data_limit_per_user:null},admin_management:{can_view:!0,can_edit:!0,can_manage_sudo:!0},sections:{usage:!0,admins:!0,services:!0,hosts:!0,nodes:!0,integrations:!0,xray:!0}}},es=t=>JSON.parse(JSON.stringify(_p[t])),Ap=t=>t&&t>0?String(Math.floor(t/ai)):"",Dp=xe.object({users:xe.object({create:xe.boolean(),delete:xe.boolean(),reset_usage:xe.boolean(),revoke:xe.boolean(),create_on_hold:xe.boolean(),allow_unlimited_data:xe.boolean(),allow_unlimited_expire:xe.boolean(),allow_next_plan:xe.boolean(),advanced_actions:xe.boolean(),max_data_limit_per_user:xe.number().nullable()}),admin_management:xe.object({can_view:xe.boolean(),can_edit:xe.boolean(),can_manage_sudo:xe.boolean()}),sections:xe.object({usage:xe.boolean(),admins:xe.boolean(),services:xe.boolean(),hosts:xe.boolean(),nodes:xe.boolean(),integrations:xe.boolean(),xray:xe.boolean()})}),Ip=()=>{var $,X,_,P,Y,te,ie,q;const{t}=qe(),{userData:s}=xr(),r=s.role===Ve.FullAccess,o=sr(),{admins:i,adminInDialog:a,isAdminDialogOpen:l,closeAdminDialog:c,createAdmin:u,updateAdmin:p}=un(),m=d.exports.useMemo(()=>{var B;return a?(B=i.find(ue=>ue.username===a.username))!=null?B:a:null},[a,i]),g=d.exports.useMemo(()=>m?"edit":"create",[m]),S=d.exports.useMemo(()=>({[ln.Active]:t("admins.statusActive","Active"),[ln.Disabled]:t("admins.statusDisabled","Disabled"),[ln.Deleted]:t("admins.statusDeleted","Deleted")}),[t]),y=m?($=S[m.status])!=null?$:m.status:t("admins.statusNew","New admin"),A=d.exports.useMemo(()=>xe.object({username:g==="create"?xe.string().trim().min(3,{message:t("admins.validation.usernameMin")}):xe.string().optional(),password:xe.string().trim().optional().transform(ue=>ue===""?void 0:ue).refine(ue=>!ue||ue.length>=6,t("admins.validation.passwordMin")),telegram_id:xe.string().trim().optional().transform(ue=>ue===""?void 0:ue).refine(ue=>ue===void 0||/^\d+$/.test(ue),t("admins.validation.telegramNumeric")),role:xe.nativeEnum(Ve).optional(),data_limit:xe.string().trim().optional().transform(ue=>ue===""?void 0:ue).refine(ue=>ue===void 0||/^\d+$/.test(ue),t("admins.validation.dataLimitNumeric","Data limit must be a number")),users_limit:xe.string().trim().optional().transform(ue=>ue===""?void 0:ue).refine(ue=>ue===void 0||/^\d+$/.test(ue),t("admins.validation.usersLimitNumeric","Users limit must be a number")),maxDataLimitPerUserGb:xe.string().trim().optional().transform(ue=>ue===""?void 0:ue),permissions:Dp}).superRefine((ue,be)=>{g==="create"&&!ue.password&&be.addIssue({code:xe.ZodIssueCode.custom,path:["password"],message:t("admins.validation.passwordRequired")})}),[g,t]),f=en({resolver:ji(A),defaultValues:{username:"",password:"",telegram_id:"",role:Ve.Standard,permissions:es(Ve.Standard),maxDataLimitPerUserGb:"",data_limit:"",users_limit:""}}),{register:D,handleSubmit:F,reset:Z,formState:ae,setValue:v,watch:M,setError:T}=f,[Q,_e]=d.exports.useState(!1),[ke,W]=d.exports.useState(!1),oe=d.exports.useCallback(B=>{var Ie;const ue="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789",be=ue.length;if(typeof window<"u"&&((Ie=window.crypto)==null?void 0:Ie.getRandomValues)){const N=new Uint32Array(B);return window.crypto.getRandomValues(N),Array.from(N,E=>ue[E%be]).join("")}return Array.from({length:B},()=>{const N=Math.floor(Math.random()*be);return ue[N]}).join("")},[]),R=d.exports.useCallback(()=>{if(g==="edit")return;const B=oe(8);v("username",B,{shouldDirty:!0,shouldValidate:!0})},[oe,g,v]),le=d.exports.useCallback(()=>{const B=oe(12);v("password",B,{shouldDirty:!0,shouldValidate:!0})},[oe,v]),{errors:w,isSubmitting:H}=ae,ce=M("role");Ve.Standard;const j=M("permissions"),fe=(X=M("maxDataLimitPerUserGb"))!=null?X:"",Ae=d.exports.useCallback(()=>{const B=ce!=null?ce:Ve.Standard;v("permissions",es(B),{shouldDirty:!0}),v("maxDataLimitPerUserGb","",{shouldDirty:!0})},[v,ce]),Pe=d.exports.useCallback(B=>{v("permissions",B,{shouldDirty:!0})},[v]),Te=d.exports.useCallback(B=>{v("maxDataLimitPerUserGb",B,{shouldDirty:!0})},[v]);d.exports.useEffect(()=>{D("maxDataLimitPerUserGb"),D("permissions")},[D]),d.exports.useEffect(()=>{var B,ue,be;if(l){const Ie=(B=m==null?void 0:m.role)!=null?B:Ve.Standard,N=m&&(ue=JSON.parse(JSON.stringify(m.permissions)))!=null?ue:es(Ie);Z({username:(be=m==null?void 0:m.username)!=null?be:"",password:"",telegram_id:(m==null?void 0:m.telegram_id)!==void 0&&(m==null?void 0:m.telegram_id)!==null?String(m.telegram_id):"",role:Ie,permissions:N,maxDataLimitPerUserGb:Ap(N.users.max_data_limit_per_user),data_limit:(m==null?void 0:m.data_limit)!==void 0&&(m==null?void 0:m.data_limit)!==null?String(Math.floor(m.data_limit/ai)):"",users_limit:(m==null?void 0:m.users_limit)!==void 0&&(m==null?void 0:m.users_limit)!==null?String(m.users_limit):""})}},[m,l,Z]),d.exports.useEffect(()=>{l||W(!1)},[l]);const J=F(async B=>{var Ie,N,E,G,he;const ue=(Ie=B.role)!=null?Ie:Ve.Standard;let be;if(g==="create"){const Re=JSON.parse(JSON.stringify((N=B.permissions)!=null?N:es(ue))),tt=(E=B.maxDataLimitPerUserGb)==null?void 0:E.trim();if(tt){const je=Number(tt);if(Number.isNaN(je)||je<0){T("maxDataLimitPerUserGb",{type:"manual",message:t("admins.validation.invalidMaxDataLimit","Enter a positive number or leave empty.")});return}Re.users.max_data_limit_per_user=je===0?null:Math.round(je*ai)}else Re.users.max_data_limit_per_user=null;be=Re}if(g==="edit"&&m){const Re=(G=m.active_users)!=null?G:0;if(B.users_limit){const tt=Number(B.users_limit);if(!Number.isNaN(tt)&&tt>0&&tt<Re){T("users_limit",{type:"manual",message:t("admins.validation.usersLimitTooLow",{active:Re})});return}}}try{if(g==="create"){const Re={username:B.username.trim(),password:(he=B.password)!=null?he:"",role:ue,permissions:be!=null?be:es(ue),telegram_id:B.telegram_id?Number(B.telegram_id):void 0,data_limit:B.data_limit?Number(B.data_limit)*ai:void 0,users_limit:B.users_limit?Number(B.users_limit):void 0};await u(Re),tr(t("admins.createSuccess","Admin created"),o)}else if(m){const Re={role:ue,telegram_id:B.telegram_id?Number(B.telegram_id):void 0,data_limit:B.data_limit?Number(B.data_limit)*ai:void 0,users_limit:B.users_limit?Number(B.users_limit):void 0};B.password&&(Re.password=B.password),await p(m.username,Re),tr(t("admins.updateSuccess","Admin updated"),o)}c()}catch(Re){jt(Re,o,f)}}),Ce=n(me,{spacing:4,align:"stretch",children:[g==="edit"&&(m==null?void 0:m.id)!==void 0&&n(x,{children:[e(I,{children:t("admins.idLabel","Admin ID")}),e(De,{value:String(m.id),isReadOnly:!0})]}),g==="edit"&&n(x,{children:[e(I,{children:t("admins.status","Status")}),e(De,{value:y,isReadOnly:!0})]}),n(x,{isInvalid:!!w.username,children:[e(I,{children:t("username")}),n(Dr,{children:[e(De,{placeholder:t("admins.usernamePlaceholder","Admin username"),...D("username"),isDisabled:g==="edit"}),g==="create"&&e(Wr,{children:e(Be,{"aria-label":t("admins.generateUsername","Random"),size:"sm",variant:"ghost",icon:e(Ps,{width:20}),onClick:R})})]}),e(Zr,{children:(_=w.username)==null?void 0:_.message})]}),n(x,{isInvalid:!!w.password,children:[e(I,{children:t("password")}),n(U,{spacing:2,children:[n(Dr,{children:[e(De,{placeholder:t("admins.passwordPlaceholder","Password"),type:Q?"text":"password",...D("password")}),e(Wr,{children:e(Be,{"aria-label":Q?t("admins.hidePassword","Hide"):t("admins.showPassword","Show"),size:"sm",variant:"ghost",icon:Q?e(Va,{width:16}):e(mi,{width:16}),onClick:()=>_e(!Q)})})]}),e(Be,{"aria-label":t("admins.generatePassword","Random"),size:"md",variant:"outline",icon:e(Ps,{width:20}),onClick:le})]}),e(Zr,{children:(P=w.password)==null?void 0:P.message}),g==="edit"&&e(h,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.passwordOptionalHint","Leave empty to keep current password.")})]}),n(x,{children:[e(I,{children:t("admins.roleLabel","Admin role")}),e(fi,{value:ce!=null?ce:Ve.Standard,onChange:B=>v("role",B,{shouldDirty:!0}),children:n(me,{align:"flex-start",spacing:2,children:[n(Lr,{value:Ve.Standard,children:[e(h,{fontWeight:"medium",children:t("admins.roles.standard","Standard")}),e(nr,{m:0,children:t("admins.roles.standardDescription","Can manage own users; only user-related permissions are available.")})]}),n(Lr,{value:Ve.Reseller,children:[e(h,{fontWeight:"medium",children:t("admins.roles.reseller","Reseller")}),e(nr,{m:0,children:t("admins.roles.resellerDescription","Can create and manage their own admins.")})]}),n(Lr,{value:Ve.Sudo,children:[e(h,{fontWeight:"medium",children:t("admins.roles.sudo","Sudo")}),e(nr,{m:0,children:t("admins.roles.sudoDescription","Extended access to settings and other admins.")})]}),r&&n(Lr,{value:Ve.FullAccess,children:[e(h,{fontWeight:"medium",children:t("admins.roles.fullAccess","Full access")}),e(nr,{m:0,children:t("admins.roles.fullAccessDescription","Complete control, including other sudo admins.")})]})]})})]}),g==="edit"&&e(O,{alignSelf:"flex-start",onClick:()=>W(!0),variant:"outline",children:t("admins.editPermissionsButton","Edit permissions")}),n(x,{isInvalid:!!w.telegram_id,children:[e(I,{children:t("admins.telegramId","Telegram ID")}),e(De,{placeholder:t("admins.telegramPlaceholder","Optional numeric Telegram ID"),inputMode:"numeric",...D("telegram_id")}),e(Zr,{children:(Y=w.telegram_id)==null?void 0:Y.message})]}),n(He,{columns:{base:1,md:2},spacing:3,children:[n(x,{isInvalid:!!w.data_limit,children:[e(I,{children:t("admins.dataLimit","Data Limit (GB)")}),e(De,{placeholder:t("admins.dataLimitPlaceholder","e.g., 100 for 100GB (empty = unlimited)"),inputMode:"numeric",...D("data_limit")}),e(Zr,{children:(te=w.data_limit)==null?void 0:te.message}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.dataLimitHint","Leave empty for unlimited data")})]}),n(x,{isInvalid:!!w.users_limit,children:[e(I,{children:t("admins.usersLimit","Users Limit")}),e(De,{placeholder:t("admins.usersLimitPlaceholder","e.g., 100 (empty = unlimited)"),inputMode:"numeric",...D("users_limit")}),e(Zr,{children:(ie=w.users_limit)==null?void 0:ie.message}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.usersLimitHint","Leave empty for unlimited users")})]})]})]});return n($t,{children:[n(Kt,{isOpen:l,onClose:c,size:"lg",children:[e(Dt,{}),n(qt,{children:[e(Tt,{children:g==="create"?t("admins.addAdminTitle","Add admin"):t("admins.editAdminTitle","Edit admin")}),e(Jt,{}),e(It,{children:g==="create"?n(hs,{colorScheme:"primary",isFitted:!0,variant:"enclosed",children:[n(ps,{children:[e(or,{children:t("admins.detailsTabLabel","Details")}),e(or,{children:t("admins.permissionsTabLabel","Permissions")})]}),n(ms,{children:[e(lr,{px:0,children:Ce}),e(lr,{px:0,children:e(rc,{value:j!=null?j:es(ce!=null?ce:Ve.Standard),onChange:Pe,showReset:!0,onReset:Ae,maxDataLimitValue:fe,onMaxDataLimitChange:Te,maxDataLimitError:(q=w.maxDataLimitPerUserGb)==null?void 0:q.message,hideExtendedSections:ce===Ve.Standard})})]})]}):Ce}),e(Wt,{children:n(U,{spacing:3,children:[e(O,{variant:"ghost",onClick:c,children:t("cancel")}),e(O,{colorScheme:"primary",onClick:J,isLoading:H,children:g==="create"?t("admins.addAdmin","Create"):t("save","Save")})]})})]})]}),e(nc,{isOpen:ke,onClose:()=>W(!1),admin:m})]})},Pp="admin_data_limit_exhausted",sc={baseStyle:{strokeWidth:"2px",w:3,h:3}},Ep=se(Id,sc),Tp=se(Pd,sc),zp=({status:t})=>{const{t:s}=qe(),r=t===ln.Active,o=r?Ep:Tp,i=Le({bg:r?"green.100":"red.100",color:r?"green.800":"red.800"},{bg:r?"green.900":"red.900",color:r?"green.200":"red.200"});return n(L,{display:"inline-flex",alignItems:"center",columnGap:1,px:2,py:.5,borderRadius:"md",bg:i.bg,color:i.color,fontSize:"xs",fontWeight:"medium",lineHeight:"1",w:"fit-content",children:[e(o,{w:3,h:3}),e(h,{textTransform:"capitalize",children:r?s("status.active","Active"):s("admins.disabledLabel","Disabled")})]})},Np=t=>{const{used:s,total:r,lifetimeUsage:o,...i}=t,a=r===0||r===null,l=!a&&s/r*100>=100;return n(ge,{spacing:2,width:"100%",children:[e(Ml,{orientation:"horizontal",value:a?100:Math.min(s/r*100,100),colorScheme:l?"red":"primary",...i,children:e(Ul,{h:"6px",borderRadius:"full",children:e(Ol,{borderRadius:"full"})})}),n(U,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},flexWrap:"wrap",children:[n(h,{children:[$e(s,2)," /"," ",a?e(h,{as:"span",fontFamily:"system-ui",children:"\u221E"}):$e(r,2)]}),o!=null&&n(h,{color:"blue.500",_dark:{color:"blue.300"},children:["lifetime: ",$e(o,2)]})]})]})},Rp=()=>{var Ne,wt,ct;const{t}=qe(),s=sr(),{userData:r}=xr(),o=Le("gray.50","whiteAlpha.100"),i=Le("primary.50","primary.900"),a=Le("white","gray.900"),l=Le("gray.100","whiteAlpha.200"),c=Le("gray.50","whiteAlpha.100"),u=Le("gray.100","whiteAlpha.200"),p=Le("gray.600","gray.300"),m=Le("surface.light","surface.dark"),g=Le("light-border","gray.700"),{admins:S,loading:y,total:A,filters:f,onFilterChange:D,fetchAdmins:F,deleteAdmin:Z,resetUsage:ae,disableAdmin:v,enableAdmin:M,openAdminDialog:T,openAdminDetails:Q,adminInDetails:_e}=un(),ke=d.exports.useRef(null),W=d.exports.useRef(null),{isOpen:oe,onOpen:R,onClose:le}=rr(),{isOpen:w,onOpen:H,onClose:ce}=rr(),{isOpen:j,onOpen:fe,onClose:Ae}=rr(),[Pe,Te]=d.exports.useState(null),[J,Ce]=d.exports.useState(null),[$,X]=d.exports.useState(""),[_,P]=d.exports.useState(null),[Y,te]=d.exports.useState(null),ie=d.exports.useMemo(()=>S.length?S.reduce((V,lt)=>{var _t;return Math.max(V,String((_t=lt.id)!=null?_t:"").length)},0):0,[S]),q=ie?`calc(${ie}ch + 5px)`:void 0,B="120px",ue=r.username,be=r.role===Ve.FullAccess,Ie=(Ne=r.permissions)==null?void 0:Ne.admin_management,N=Boolean((Ie==null?void 0:Ie[br.Edit])||be),E=Boolean((Ie==null?void 0:Ie[br.ManageSudo])||be),G=V=>V.username===ue?!0:V.role===Ve.FullAccess||!N?!1:V.role===Ve.Sudo?E:!0,he=V=>{if(V==="data_usage"||V==="data_limit"){const lt=f.sort===V?`-${V}`:V;D({sort:lt,offset:0})}else{const lt=f.sort===V?`-${V}`:f.sort===`-${V}`?void 0:V;D({sort:lt,offset:0})}},Re=V=>{Te(V),R()},tt=async()=>{if(!!Pe)try{await Z(Pe.username),tr(t("admins.deleteSuccess","Admin removed"),s),le(),Te(null)}catch(V){jt(V,s)}},je=async V=>{P({type:"reset",username:V.username});try{await ae(V.username),tr(t("admins.resetUsageSuccess","Usage reset"),s),F()}catch(lt){jt(lt,s)}finally{P(null)}},we=V=>{Ce(V),X(""),H()},Fe=()=>{ce(),Ce(null),X("")},Ye=V=>{te(V),fe()},ot=()=>{te(null),Ae()},ut=async()=>{if(!J)return;const V=$.trim();if(!(V.length<3)){P({type:"disableAdmin",username:J.username});try{await v(J.username,V),tr(t("admins.disableAdminSuccess","Admin disabled"),s),Fe(),F()}catch(lt){jt(lt,s)}finally{P(null)}}},yt=async V=>{P({type:"enableAdmin",username:V.username});try{await M(V.username),tr(t("admins.enableAdminSuccess","Admin re-enabled"),s),F()}catch(lt){jt(lt,s)}finally{P(null)}},re=({column:V})=>{var zt,Ge,Ue,St,Vt;let lt=!1,_t=!1;return V==="data"?(lt=((zt=f.sort)==null?void 0:zt.includes("data_usage"))||((Ge=f.sort)==null?void 0:Ge.includes("data_limit")),_t=lt&&((Ue=f.sort)==null?void 0:Ue.startsWith("-"))):(lt=(St=f.sort)==null?void 0:St.includes(V),_t=lt&&((Vt=f.sort)==null?void 0:Vt.startsWith("-"))),e(ea,{style:{width:"1rem",height:"1rem",opacity:lt?1:0,transform:lt&&!_t?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"}})},ze=d.exports.useMemo(()=>[{key:"id",label:"ID"},{key:"username",label:t("username")},{key:"status",label:t("status")},{key:"users_count",label:t("users")},{key:"data",label:t("dataUsage")+" / "+t("dataLimit")},{key:"actions",label:""}],[t]);return y&&!S.length?e(L,{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",children:e(Et,{})}):A?n($t,{children:[e(L,{borderWidth:"1px",borderRadius:"md",overflowX:"auto",bg:a,borderColor:l,children:n(as,{variant:"simple",size:"sm",minW:{base:"100%",md:"800px"},children:[e(yn,{bg:c,color:p,children:e(Ot,{children:ze.map(V=>e(Ke,{onClick:()=>V.key==="username"||V.key==="users_count"||V.key==="data"||V.key==="id"?he(V.key):void 0,borderRight:V.key==="id"?"1px solid":void 0,borderColor:V.key==="id"?u:"transparent",cursor:V.key==="username"||V.key==="users_count"||V.key==="data"||V.key==="id"?"pointer":"default",textAlign:V.key==="actions"?"right":"left",display:{base:V.key==="id"?"none":"table-cell",md:"table-cell"},px:V.key==="id"?1:void 0,width:V.key==="id"?q:void 0,minW:V.key==="id"?q:void 0,maxW:V.key==="id"?B:void 0,whiteSpace:V.key==="id"?"nowrap":void 0,children:n(U,{justify:V.key==="actions"?"flex-end":"flex-start",children:[e(h,{children:V.label}),V.key==="data"?n(hi,{children:[e(Is,{as:Be,size:"xs",variant:"ghost",icon:e(re,{column:"data"})}),n(pi,{children:[e(gr,{onClick:()=>he("data_usage"),children:t("admins.sortByUsage")}),e(gr,{onClick:()=>he("data_limit"),children:t("admins.sortByLimit")})]})]}):V.key==="username"||V.key==="users_count"||V.key==="id"?e(re,{column:V.key}):null]})},V.key))})}),e(sn,{children:S.map(V=>{var ar,ne,z,k;const lt=(_e==null?void 0:_e.username)===V.username,_t=V.users_limit&&V.users_limit>0?String(V.users_limit):"\u221E",zt=`${(ar=V.active_users)!=null?ar:0}/${_t}`,Ge=G(V),Ue=Ge&&V.username!==ue,St=Ue&&V.status!==ln.Disabled,Vt=V.disabled_reason===Pp,dr=V.disabled_reason?Vt?t("admins.disabledReason.dataLimitExceeded","Your data limit has been reached"):V.disabled_reason:null,ir=Ue&&V.status===ln.Disabled&&!Vt,Zt=Ue;return n(Ot,{onClick:()=>Q(V),cursor:"pointer",bg:lt?i:void 0,_hover:{bg:o},transition:"background-color 0.15s ease-in-out",children:[e(Me,{display:{base:"none",md:"table-cell"},px:1,pr:1,borderRight:"1px solid",borderColor:"gray.200",_dark:{borderColor:"gray.700"},width:q,minW:q,maxW:B,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:e(h,{fontWeight:"medium",color:"gray.700",_dark:{color:"gray.300"},fontSize:"sm",children:V.id})}),e(Me,{px:2,children:e(mt,{label:V.role===Ve.FullAccess?t("admins.roles.fullAccess","Full access"):V.role===Ve.Sudo?t("admins.roles.sudo","Sudo"):t("admins.roles.standard","Standard"),placement:"top",children:e(h,{fontWeight:"medium",px:2,py:1,borderRadius:"md",bg:V.role===Ve.FullAccess?"yellow.100":V.role===Ve.Sudo?"purple.100":"gray.100",color:V.role===Ve.FullAccess?"yellow.800":V.role===Ve.Sudo?"purple.800":"gray.800",_dark:{bg:V.role===Ve.FullAccess?"yellow.900":V.role===Ve.Sudo?"purple.900":"gray.700",color:V.role===Ve.FullAccess?"yellow.200":V.role===Ve.Sudo?"purple.200":"gray.200"},display:"inline-block",children:V.username})})}),e(Me,{children:n(ge,{spacing:1,align:"flex-start",maxW:"full",children:[e(zp,{status:V.status}),V.status===ln.Disabled&&dr&&e(h,{fontSize:"xs",color:"red.400",mt:1,children:dr})]})}),e(Me,{children:n(ge,{spacing:0,children:[e(h,{fontSize:"xs",fontWeight:"semibold",children:zt}),V.online_users!==null&&V.online_users!==void 0&&n(U,{spacing:1,mt:1,children:[n(h,{fontSize:"xs",color:"green.600",_dark:{color:"green.400"},children:[t("admins.details.onlineLabel","Online"),":"]}),e(h,{fontSize:"xs",fontWeight:"semibold",color:"green.600",_dark:{color:"green.400"},children:V.online_users})]})]})}),e(Me,{children:e(Np,{used:(ne=V.users_usage)!=null?ne:0,total:(z=V.data_limit)!=null?z:null,lifetimeUsage:(k=V.lifetime_usage)!=null?k:null})}),e(Me,{textAlign:"right",children:n(hi,{children:[e(Is,{as:Be,icon:e(kl,{width:20}),variant:"ghost",isDisabled:!Ge&&!Ue,onClick:Se=>Se.stopPropagation()}),n(pi,{onClick:Se=>Se.stopPropagation(),children:[Ge&&n($t,{children:[e(gr,{icon:e(Vn,{width:20}),onClick:Se=>{Se.stopPropagation(),T(V)},children:t("edit")}),e(gr,{icon:e(Wl,{width:20}),onClick:Se=>{Se.stopPropagation(),Ye(V)},children:t("admins.editPermissionsButton","Edit permissions")}),e(gr,{icon:e(dn,{width:20}),onClick:Se=>{Se.stopPropagation(),je(V)},isDisabled:(_==null?void 0:_.username)===V.username&&(_==null?void 0:_.type)==="reset",children:t("admins.resetUsage")})]}),(St||ir||Zt)&&Ge&&e(Yi,{}),St&&e(gr,{icon:e(Ed,{width:20}),onClick:Se=>{Se.stopPropagation(),we(V)},isDisabled:(_==null?void 0:_.username)===V.username&&(_==null?void 0:_.type)==="disableAdmin",children:t("admins.disableAdmin","Disable admin")}),ir&&e(gr,{icon:e(Td,{width:20}),onClick:Se=>{Se.stopPropagation(),yt(V)},isDisabled:(_==null?void 0:_.username)===V.username&&(_==null?void 0:_.type)==="enableAdmin",children:t("admins.enableAdmin","Enable admin")}),Zt&&(St||ir)&&e(Yi,{}),Zt&&e(gr,{color:"red.500",icon:e(wn,{width:20}),onClick:Se=>{Se.stopPropagation(),Re(V)},children:t("delete")})]})]})})]},V.username)})})]})}),e(Ts,{isOpen:oe,leastDestructiveRef:ke,onClose:le,children:e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)",children:n(zs,{bg:m,borderWidth:"1px",borderColor:g,children:[e(Tt,{fontSize:"lg",fontWeight:"bold",children:t("admins.confirmDeleteTitle","Delete admin")}),e(It,{children:t("admins.confirmDeleteMessage","Are you sure you want to delete {{username}}?",{username:(wt=Pe==null?void 0:Pe.username)!=null?wt:""})}),n(Wt,{children:[e(O,{ref:ke,onClick:le,variant:"ghost",colorScheme:"primary",children:t("cancel")}),e(O,{colorScheme:"red",onClick:tt,ml:3,children:t("delete")})]})]})})}),e(Ts,{isOpen:w,leastDestructiveRef:W,onClose:Fe,children:e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)",children:n(zs,{bg:m,borderWidth:"1px",borderColor:g,children:[e(Tt,{fontSize:"lg",fontWeight:"bold",children:t("admins.disableAdminTitle","Disable admin")}),n(It,{children:[e(h,{mb:3,children:t("admins.disableAdminMessage","All users owned by {{username}} will be disabled. Provide a reason for this action.",{username:(ct=J==null?void 0:J.username)!=null?ct:""})}),e(Rr,{value:$,onChange:V=>X(V.target.value),placeholder:t("admins.disableAdminReasonPlaceholder","Reason for disabling")})]}),n(Wt,{children:[e(O,{ref:W,onClick:Fe,variant:"ghost",colorScheme:"primary",children:t("cancel")}),e(O,{colorScheme:"red",onClick:ut,ml:3,isDisabled:$.trim().length<3,isLoading:(_==null?void 0:_.type)==="disableAdmin"&&(_==null?void 0:_.username)===(J==null?void 0:J.username),children:t("admins.disableAdminConfirm","Disable admin")})]})]})})}),e(nc,{isOpen:j,onClose:ot,admin:Y})]}):e(L,{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",children:e(h,{children:t("admins.noAdmins")})})},Lp=(t,s)=>!t||t<=0?s!=null?s:"\u221E":`${t}`,ba=(t,s)=>!t||t<=0?s!=null?s:"\u221E":$e(t,2),Mp=()=>{var M,T,Q,_e,ke,W,oe,R,le,w,H,ce,j,fe,Ae,Pe;const{t}=qe(),{isAdminDetailsOpen:s,adminInDetails:r,closeAdminDetails:o}=un(Te=>({isAdminDetailsOpen:Te.isAdminDetailsOpen,adminInDetails:Te.adminInDetails,closeAdminDetails:Te.closeAdminDetails})),i=Le("gray.50","whiteAlpha.50"),a=(M=r==null?void 0:r.active_users)!=null?M:0,l=(T=r==null?void 0:r.users_limit)!=null?T:null,c=t("admins.details.unlimited","Unlimited"),u=l&&l>0?String(l):c;(Q=r==null?void 0:r.users_count)!=null;const p=(_e=r==null?void 0:r.limited_users)!=null?_e:0,m=(ke=r==null?void 0:r.expired_users)!=null?ke:0,g=(W=r==null?void 0:r.online_users)!=null?W:0,S=(oe=r==null?void 0:r.on_hold_users)!=null?oe:0,y=(R=r==null?void 0:r.disabled_users)!=null?R:0,A=(le=r==null?void 0:r.users_usage)!=null?le:0,f=(w=r==null?void 0:r.data_limit)!=null?w:null,D=f&&f>0?Math.max(f-A,0):null,F=(H=r==null?void 0:r.lifetime_usage)!=null?H:null,Z=(ce=r==null?void 0:r.data_limit_allocated)!=null?ce:0,ae=(j=r==null?void 0:r.reset_bytes)!=null?j:0,v=(fe=r==null?void 0:r.unlimited_users_usage)!=null?fe:0;return n(Kt,{isCentered:!0,isOpen:s,onClose:o,scrollBehavior:"inside",size:"xl",children:[e(Dt,{}),n(qt,{children:[e(Tt,{bg:i,children:n(ge,{spacing:1,children:[n(U,{spacing:2,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:(Ae=r==null?void 0:r.username)!=null?Ae:t("admins.details.title","Admin details")}),r&&e(cn,{fontSize:"xs",px:2,py:.5,borderRadius:"full",colorScheme:r.role===Ve.FullAccess?"orange":r.role===Ve.Sudo?"purple":"gray",children:r.role===Ve.FullAccess?t("admins.roles.fullAccess","Full access"):r.role===Ve.Sudo?t("admins.roles.sudo","Sudo"):t("admins.roles.standard","Standard")})]}),r&&e(h,{fontSize:"sm",color:"gray.500",children:t("admins.details.summary",{active:a,limit:u})})]})}),e(Jt,{}),e(It,{children:r?n(ge,{spacing:8,children:[n(L,{children:[e(h,{fontWeight:"semibold",mb:3,children:t("admins.details.usersSection","Users")}),n(He,{columns:{base:2,md:3},spacing:4,children:[e(kr,{label:t("admins.details.activeLabel","Active"),value:String(a),valueColor:"blue.600"}),e(kr,{label:t("admins.details.onlineLabel","Online"),value:String(g),valueColor:"green.600"}),e(kr,{label:t("admins.details.limitedLabel","Limited"),value:String(p),valueColor:"orange.600"}),e(kr,{label:t("status.expired","Expired"),value:String(m),valueColor:"red.600"}),e(kr,{label:t("status.on_hold","On hold"),value:String(S),valueColor:"yellow.600"}),e(kr,{label:t("status.disabled","Disabled"),value:String(y),valueColor:"gray.600"})]}),n(He,{columns:{base:2,md:2},spacing:4,mt:3,children:[e(kr,{label:t("admins.details.totalUsers","Total users"),value:String((Pe=r.users_count)!=null?Pe:0),valueColor:"blue.600"}),e(kr,{label:t("admins.details.usersLimit","Users limit"),value:Lp(l,c)})]})]}),n(L,{children:[e(h,{fontWeight:"semibold",mb:3,children:t("admins.details.dataSection","Data usage")}),n(He,{columns:{base:2,md:4},spacing:4,children:[e(kr,{label:t("admins.details.used","Used"),value:$e(A,2)}),e(kr,{label:t("admins.details.limit","Limit"),value:ba(f,c)}),e(kr,{label:t("admins.details.remaining","Remaining"),value:ba(D,c)}),e(kr,{label:t("admins.details.lifetime","Lifetime usage"),value:ba(F,void 0)})]})]}),n(L,{children:[e(h,{fontWeight:"semibold",mb:3,children:t("admins.details.allocationSection","Data allocation")}),n(He,{columns:{base:2,md:3},spacing:4,children:[e(kr,{label:t("admins.details.dataAllocated","Allocated data"),value:$e(Z,2)}),e(kr,{label:t("admins.details.resetVolume","Reset volume"),value:$e(ae,2)}),e(kr,{label:t("admins.details.unlimitedUsage","Unlimited users usage"),value:$e(v,2)})]})]})]}):e(L,{py:8,children:e(h,{color:"gray.500",children:t("admins.details.empty","Select an admin to view details.")})})}),e(Wt,{children:e(O,{variant:"outline",mr:3,onClick:o,children:t("close","Close")})})]})]})},kr=({label:t,value:s,valueColor:r})=>n(L,{borderWidth:"1px",borderRadius:"md",px:3,py:2,minH:"64px",display:"flex",flexDirection:"column",justifyContent:"center",children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t}),e(h,{fontWeight:"semibold",color:r||void 0,children:s})]}),Up=()=>{var a;const{t}=qe(),s=un(l=>l.fetchAdmins),{userData:r,getUserIsSuccess:o}=xr(),i=o&&Boolean((a=r.permissions)==null?void 0:a.sections.admins);return d.exports.useEffect(()=>{i&&s()},[s,i]),i?n(me,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("admins.manageTab","Admins")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.pageDescription","View and manage admin accounts. Use this page to create, edit and review admin permissions and recent usage.")}),e(ec,{for:"admins"}),e(Rp,{}),e(tc,{for:"admins"}),e(Ip,{}),e(Mp,{})]}):n(me,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("admins.manageTab","Admins")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.pageDescription","View and manage admin accounts. Use this page to create, edit and review admin permissions and recent usage.")}),e(h,{children:t("admins.noPermission","You don't have permission to manage admins.")})]})},ic=Us(t=>({isLoading:!1,isPostLoading:!1,hosts:{},fetchHosts:()=>{t({isLoading:!0}),Ee("/hosts").then(s=>t({hosts:s})).finally(()=>t({isLoading:!1}))},setHosts:s=>(t({isPostLoading:!0}),Ee("/hosts",{method:"PUT",body:s}).finally(()=>{t({isPostLoading:!1})}))})),Op=[{title:"Inbound's default",value:"inbound_default"},{title:"TLS",value:"tls"},{title:"None",value:"none"}],Wp=[{title:"",value:""},{title:"h3",value:"h3"},{title:"h2",value:"h2"},{title:"http/1.1",value:"http/1.1"},{title:"h3,h2,http/1.1",value:"h3,h2,http/1.1"},{title:"h3,h2",value:"h3,h2"},{title:"h2,http/1.1",value:"h2,http/1.1"}],Fp=[{title:"",value:""},...["chrome","firefox","safari","ios","android","edge","360","qq","random","randomized"].map(t=>({title:t,value:t}))],Hp=se(Vn,{baseStyle:{w:4,h:4}}),ac=se(Tn,{baseStyle:{w:4,h:4}}),oc=se(wl,{baseStyle:{w:4,h:4}}),Bp=se(wi,{baseStyle:{w:4,h:4,color:"gray.400",cursor:"pointer"}}),Vp=[{token:"{SERVER_IP}",labelKey:"hostsDialog.currentServer"},{token:"{SERVER_IPV6}",labelKey:"hostsDialog.currentServerv6"},{token:"{USERNAME}",labelKey:"hostsDialog.username"},{token:"{DATA_USAGE}",labelKey:"hostsDialog.dataUsage"},{token:"{DATA_LEFT}",labelKey:"hostsDialog.remainingData"},{token:"{DATA_LIMIT}",labelKey:"hostsDialog.dataLimit"},{token:"{DAYS_LEFT}",labelKey:"hostsDialog.remainingDays"},{token:"{EXPIRE_DATE}",labelKey:"hostsDialog.expireDate"},{token:"{JALALI_EXPIRE_DATE}",labelKey:"hostsDialog.jalaliExpireDate"},{token:"{TIME_LEFT}",labelKey:"hostsDialog.remainingTime"},{token:"{STATUS_TEXT}",labelKey:"hostsDialog.statusText"},{token:"{STATUS_EMOJI}",labelKey:"hostsDialog.statusEmoji"},{token:"{PROTOCOL}",labelKey:"hostsDialog.proxyProtocol"},{token:"{TRANSPORT}",labelKey:"hostsDialog.proxyMethod"}],Ds=()=>{const{t}=qe();return n($n,{isLazy:!0,placement:"right",children:[e(Kn,{children:e(L,{mt:"-1",children:e(Bp,{})})}),e(Zi,{children:n(qn,{maxW:"xs",fontSize:"xs",children:[e(us,{}),e(Ja,{}),e(Jn,{children:n(L,{pr:5,lineHeight:"1.4",children:[e(h,{mb:2,children:t("hostsDialog.desc")}),Vp.map(({token:s,labelKey:r})=>n(h,{mt:1,children:[e(cn,{mr:2,children:s}),t(r)]},s))]})})]})})]})},lc=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,Xr=t=>typeof t=="number"&&!Number.isNaN(t)?t:Number.MAX_SAFE_INTEGER,Sn=t=>(t!=null?t:"").trim(),Ys=(t,s=!1)=>typeof t=="boolean"?t:s,$p=(t,s)=>{var r,o,i,a,l,c,u,p;return{id:(r=t.id)!=null?r:null,remark:(o=t.remark)!=null?o:"",address:(i=t.address)!=null?i:"",sort:(a=t.sort)!=null?a:s,port:(l=t.port)!=null?l:null,path:Sn(t.path),sni:Sn(t.sni),host:Sn(t.host),mux_enable:Ys(t.mux_enable),allowinsecure:Ys(t.allowinsecure),is_disabled:Ys(t.is_disabled,!1),fragment_setting:Sn(t.fragment_setting),noise_setting:Sn(t.noise_setting),random_user_agent:Ys(t.random_user_agent),security:(c=t.security)!=null?c:"inbound_default",alpn:(u=t.alpn)!=null?u:"",fingerprint:(p=t.fingerprint)!=null?p:"",use_sni_as_host:Ys(t.use_sni_as_host)}},za=t=>{var s,r;return{id:(s=t.id)!=null?s:null,remark:t.remark,address:t.address,sort:t.sort,port:(r=t.port)!=null?r:null,path:t.path,sni:t.sni,host:t.host,mux_enable:t.mux_enable,allowinsecure:t.allowinsecure,is_disabled:t.is_disabled,fragment_setting:t.fragment_setting,noise_setting:t.noise_setting,random_user_agent:t.random_user_agent,security:t.security,alpn:t.alpn,fingerprint:t.fingerprint,use_sni_as_host:t.use_sni_as_host}},Oo=t=>{var s,r;return{...t,id:(s=t.id)!=null?s:null,port:(r=t.port)!=null?r:null,path:Sn(t.path),sni:Sn(t.sni),host:Sn(t.host),fragment_setting:Sn(t.fragment_setting),noise_setting:Sn(t.noise_setting)}},cc=t=>{const s=Oo(t.data),r=Oo(t.original);return t.inboundTag!==t.initialInboundTag?!0:JSON.stringify(s)!==JSON.stringify(r)},Kp=t=>{var s;return{id:(s=t.id)!=null?s:null,remark:t.remark.trim(),address:t.address.trim(),sort:t.sort,port:t.port,path:t.path.trim()?t.path.trim():null,sni:t.sni.trim()?t.sni.trim():null,host:t.host.trim()?t.host.trim():null,mux_enable:t.mux_enable,allowinsecure:t.allowinsecure,is_disabled:t.is_disabled,fragment_setting:t.fragment_setting.trim()?t.fragment_setting.trim():null,noise_setting:t.noise_setting.trim()?t.noise_setting.trim():null,random_user_agent:t.random_user_agent,security:t.security||"inbound_default",alpn:t.alpn||"",fingerprint:t.fingerprint||"",use_sni_as_host:t.use_sni_as_host}},oi=t=>[...t].sort((s,r)=>{const o=Xr(s.data.sort)-Xr(r.data.sort);return o!==0?o:s.data.remark.localeCompare(r.data.remark)}),qp=t=>{const s=[];return Object.entries(t).forEach(([r,o])=>{o.forEach((i,a)=>{const l=$p(i,a),c=l.id!=null?`host-${l.id}`:lc();s.push({uid:c,inboundTag:r,initialInboundTag:r,data:za(l),original:za(l)})})}),oi(s)},dc=t=>{const s=new Map;t.forEach(o=>{var a;const i=(a=s.get(o.inboundTag))!=null?a:[];i.push(o.data),s.set(o.inboundTag,i)});const r={};return s.forEach((o,i)=>{r[i]=o.map(a=>Kp(a)).sort((a,l)=>Xr(a.sort)-Xr(l.sort))}),r},ya=(t,s)=>{const r=dc(t),o=Array.from(new Set(s)),i={};return o.forEach(a=>{var l;i[a]=(l=r[a])!=null?l:[]}),i},Jp=({host:t,inboundOptions:s,orderIndex:r,onToggleActive:o,onEdit:i,onDelete:a,saving:l,deleting:c})=>{const{t:u}=qe(),p=s.find(y=>y.value===t.inboundTag),m=!t.data.is_disabled,g=cc(t),S=t.data.remark||u("hostsPage.untitledHost");return e(Fr,{borderWidth:"1px",borderColor:g?"primary.400":"gray.200",_dark:{borderColor:g?"primary.300":"gray.700",bg:g?"gray.800":"gray.900"},cursor:"pointer",onClick:()=>i(t.uid),transition:"border-color 0.2s ease",_hover:{borderColor:"primary.400"},children:n(Pn,{as:ge,spacing:4,children:[n(U,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[n(me,{align:"flex-start",spacing:1,flex:"1",children:[e(mt,{label:t.data.remark,isDisabled:!t.data.remark,children:e(h,{fontWeight:"semibold",noOfLines:1,maxW:"full",children:S})}),n(U,{spacing:2,flexWrap:"wrap",children:[e(rt,{colorScheme:"gray",size:"sm",children:u("hostsPage.orderIndex",{value:r+1})}),p&&e(rt,{colorScheme:"purple",size:"sm",children:`${p.value} (${p.protocol.toUpperCase()} - ${p.network})`}),typeof t.data.port=="number"&&e(rt,{colorScheme:"blue",size:"sm",children:u("hostsPage.portTag",{value:t.data.port})}),g&&e(rt,{colorScheme:"orange",size:"sm",children:u("hostsPage.unsaved")})]})]}),n(U,{spacing:2,onClick:y=>y.stopPropagation(),onPointerDown:y=>y.stopPropagation(),children:[e(vt,{size:"sm",colorScheme:"primary",isChecked:m,onChange:y=>{y.stopPropagation(),o(t.uid,y.target.checked)},onClick:y=>y.stopPropagation(),onPointerDown:y=>y.stopPropagation(),"aria-label":u("hostsPage.toggleActive")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:u(m?"hostsPage.enabled":"hostsPage.disabled")})]})]}),n(me,{align:"stretch",spacing:2,color:"gray.600",_dark:{color:"gray.300"},children:[e(h,{fontSize:"sm",children:t.data.address||u("hostsPage.noAddress")}),t.data.path&&n(h,{fontSize:"sm",noOfLines:1,children:[u("hostsDialog.path"),": ",t.data.path]}),t.data.sni&&n(h,{fontSize:"sm",noOfLines:1,children:[u("hostsDialog.sni"),": ",t.data.sni]})]}),n(U,{justify:"space-between",children:[e(O,{size:"sm",variant:"outline",leftIcon:e(Hp,{}),onClick:y=>{y.stopPropagation(),i(t.uid)},isLoading:l,children:u("hostsPage.edit")}),e(Be,{"aria-label":u("hostsPage.delete"),size:"sm",colorScheme:"red",variant:"ghost",onClick:y=>{y.stopPropagation(),a(t.uid)},icon:e(ki,{}),isLoading:c})]})]})})},Yp=({host:t,index:s})=>{const{t:r}=qe(),o=zd(),i=t.data.remark||r("hostsPage.untitledHost"),a=d.exports.useCallback(l=>{l.pointerType==="mouse"&&l.button!==0||(l.preventDefault(),o.start(l))},[o]);return e(Fl.Item,{value:t,id:t.uid,dragListener:!1,dragControls:o,drag:!0,dragMomentum:!1,whileDrag:{zIndex:10,scale:1.01},dragTransition:{bounceStiffness:600,bounceDamping:40},style:{listStyle:"none",touchAction:"none"},children:n(U,{borderWidth:"1px",borderRadius:"md",borderColor:"gray.200",_dark:{borderColor:"gray.600",bg:"gray.800"},px:4,py:3,spacing:4,align:"center",children:[e(mt,{label:r("hostsPage.dragHandle"),hasArrow:!0,children:e(Be,{"aria-label":r("hostsPage.dragHandle"),size:"sm",variant:"ghost",icon:e(oc,{}),cursor:"grab",onPointerDown:a,style:{touchAction:"none"}})}),e(rt,{colorScheme:"gray",size:"sm",children:r("hostsPage.orderIndex",{value:s+1})}),n(me,{align:"flex-start",spacing:0,flex:"1",children:[e(mt,{label:t.data.remark,isDisabled:!t.data.remark,children:e(h,{fontWeight:"medium",noOfLines:1,maxW:"full",children:i})}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},noOfLines:1,children:t.data.address||t.inboundTag})]})]})})},Gp=({host:t,inboundOptions:s,isOpen:r,onClose:o,onChange:i,onChangeInbound:a,onSave:l,onReset:c,onDelete:u,saving:p,deleting:m})=>{var A;const{t:g}=qe();if(!t)return null;const S=s.find(f=>f.value===t.inboundTag),y=cc(t);return n(Kt,{isOpen:r,onClose:o,size:"4xl",scrollBehavior:"inside",isCentered:!0,returnFocusOnClose:!1,children:[e(Dt,{}),n(qt,{children:[e(Jt,{}),e(Tt,{pb:1,children:n(me,{align:"stretch",spacing:1,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:t.data.remark||g("hostsPage.untitledHost")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t.data.address||g("hostsPage.noAddress")}),S&&e(rt,{colorScheme:"purple",size:"sm",alignSelf:"flex-start",children:`${S.value} (${S.protocol.toUpperCase()} - ${S.network})`})]})}),e(It,{children:n(me,{align:"stretch",spacing:5,children:[n(Fr,{variant:"outline",children:[e(As,{pb:2,children:e(h,{fontWeight:"semibold",children:g("hostsPage.section.general")})}),e(Pn,{pt:0,children:n(me,{align:"stretch",spacing:4,children:[n(x,{children:[e(I,{children:g("hostsDialog.remark")}),n(Dr,{children:[e(De,{value:t.data.remark,onChange:f=>i(t.uid,"remark",f.target.value)}),e(Wr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Ds,{})})]})]}),n(He,{columns:{base:1,md:2},spacing:4,children:[n(x,{children:[e(I,{children:g("hostsPage.inboundLabel")}),e(Ze,{value:t.inboundTag,onChange:f=>a(t.uid,f.target.value),children:s.map(f=>e("option",{value:f.value,children:f.label},f.value))})]}),n(x,{children:[e(I,{children:g("hostsDialog.sort")}),e(vn,{value:t.data.sort,allowMouseWheel:!0,onChange:(f,D)=>i(t.uid,"sort",Number.isNaN(D)?t.data.sort:D),children:e(xn,{})})]})]}),n(He,{columns:{base:1,md:2},spacing:4,children:[n(x,{children:[e(I,{children:g("hostsDialog.address")}),n(Dr,{children:[e(De,{value:t.data.address,onChange:f=>i(t.uid,"address",f.target.value)}),e(Wr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Ds,{})})]})]}),n(x,{children:[e(I,{children:g("hostsDialog.port")}),e(vn,{value:(A=t.data.port)!=null?A:"",allowMouseWheel:!0,onChange:(f,D)=>i(t.uid,"port",Number.isNaN(D)?null:D),children:e(xn,{})})]})]}),n(x,{children:[e(I,{children:g("hostsDialog.path")}),e(De,{value:t.data.path,onChange:f=>i(t.uid,"path",f.target.value),placeholder:"/"})]})]})})]}),n(Fr,{variant:"outline",children:[e(As,{pb:2,children:e(h,{fontWeight:"semibold",children:g("hostsPage.section.security")})}),e(Pn,{pt:0,children:n(me,{align:"stretch",spacing:4,children:[n(He,{columns:{base:1,md:2},spacing:4,children:[n(x,{children:[e(I,{children:g("hostsDialog.sni")}),e(De,{value:t.data.sni,onChange:f=>i(t.uid,"sni",f.target.value)})]}),n(x,{children:[e(I,{children:g("hostsDialog.host")}),n(Dr,{children:[e(De,{value:t.data.host,onChange:f=>i(t.uid,"host",f.target.value)}),e(Wr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Ds,{})})]})]})]}),n(He,{columns:{base:1,md:3},spacing:4,children:[n(x,{children:[e(I,{children:g("hostsDialog.security")}),e(Ze,{value:t.data.security,onChange:f=>i(t.uid,"security",f.target.value),children:Op.map(f=>e("option",{value:f.value,children:f.title},f.value))})]}),n(x,{children:[e(I,{children:g("hostsDialog.alpn")}),e(Ze,{value:t.data.alpn,onChange:f=>i(t.uid,"alpn",f.target.value),children:Wp.map(f=>e("option",{value:f.value,children:f.title},f.value))})]}),n(x,{children:[e(I,{children:g("hostsDialog.fingerprint")}),e(Ze,{value:t.data.fingerprint,onChange:f=>i(t.uid,"fingerprint",f.target.value),children:Fp.map(f=>e("option",{value:f.value,children:f.title},f.value))})]})]})]})})]}),n(Fr,{variant:"outline",children:[e(As,{pb:2,children:e(h,{fontWeight:"semibold",children:g("hostsPage.section.advanced")})}),e(Pn,{pt:0,children:n(me,{align:"stretch",spacing:4,children:[n(He,{columns:{base:1,md:2},spacing:4,children:[n(x,{children:[e(I,{children:g("hostsDialog.fragment")}),e(De,{value:t.data.fragment_setting,onChange:f=>i(t.uid,"fragment_setting",f.target.value)})]}),n(x,{children:[e(I,{children:g("hostsDialog.noise")}),e(De,{value:t.data.noise_setting,onChange:f=>i(t.uid,"noise_setting",f.target.value)})]})]}),n(ge,{direction:{base:"column",md:"row"},spacing:4,children:[e(vr,{isChecked:t.data.allowinsecure,onChange:f=>i(t.uid,"allowinsecure",f.target.checked),children:g("hostsDialog.allowinsecure")}),e(vr,{isChecked:t.data.mux_enable,onChange:f=>i(t.uid,"mux_enable",f.target.checked),children:g("hostsDialog.muxEnable")}),e(vr,{isChecked:t.data.random_user_agent,onChange:f=>i(t.uid,"random_user_agent",f.target.checked),children:g("hostsDialog.randomUserAgent")}),e(vr,{isChecked:t.data.use_sni_as_host,onChange:f=>i(t.uid,"use_sni_as_host",f.target.checked),children:g("hostsDialog.useSniAsHost")})]})]})})]})]})}),n(Wt,{justifyContent:"space-between",children:[e(O,{size:"sm",variant:"ghost",colorScheme:"red",leftIcon:e(ki,{}),onClick:()=>u(t.uid),isLoading:m,children:g("hostsPage.delete")}),n(U,{spacing:3,children:[e(O,{size:"sm",variant:"outline",onClick:()=>c(t.uid),isDisabled:!y||p,children:g("hostsPage.reset")}),e(O,{size:"sm",colorScheme:"primary",onClick:()=>l(t.uid),isDisabled:!y,isLoading:p,children:g("hostsPage.save")})]})]})]})]})},Xp=({isOpen:t,onClose:s,inboundOptions:r,onSubmit:o,isSubmitting:i,defaultSort:a})=>{var g,S,y,A;const{t:l}=qe(),c=d.exports.useRef(null),[u,p]=d.exports.useState({inboundTag:(S=(g=r[0])==null?void 0:g.value)!=null?S:"",remark:"",address:"",sort:a!=null?a:0,port:null,path:"",sni:"",host:""});d.exports.useEffect(()=>{var f,D;t&&(p({inboundTag:(D=(f=r[0])==null?void 0:f.value)!=null?D:"",remark:"",address:"",sort:a!=null?a:0,port:null,path:"",sni:"",host:""}),setTimeout(()=>{var F;return(F=c.current)==null?void 0:F.focus()},150))},[a,r,t]);const m=()=>{!u.inboundTag||!u.remark.trim()||!u.address.trim()||o(u)};return n(Kt,{isOpen:t,onClose:s,size:"lg",initialFocusRef:c,returnFocusOnClose:!1,children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(6px)"}),n(qt,{children:[e(Tt,{children:n(U,{spacing:3,children:[e(ac,{}),e(h,{fontWeight:"semibold",children:l("hostsPage.create.title")})]})}),e(Jt,{mt:2}),n(It,{as:me,align:"stretch",spacing:4,pt:2,children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:l("hostsPage.create.description")}),n(x,{children:[e(I,{children:l("hostsPage.inboundLabel")}),e(Ze,{value:u.inboundTag,onChange:f=>p(D=>({...D,inboundTag:f.target.value})),children:r.map(f=>e("option",{value:f.value,children:f.label},f.value))})]}),n(x,{isRequired:!0,children:[e(I,{children:l("hostsDialog.remark")}),n(Dr,{children:[e(De,{ref:c,value:u.remark,onChange:f=>p(D=>({...D,remark:f.target.value}))}),e(Wr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Ds,{})})]})]}),n(He,{columns:{base:1,md:2},spacing:3,children:[n(x,{isRequired:!0,children:[e(I,{children:l("hostsDialog.address")}),n(Dr,{children:[e(De,{value:u.address,onChange:f=>p(D=>({...D,address:f.target.value}))}),e(Wr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Ds,{})})]})]}),n(x,{children:[e(I,{children:l("hostsDialog.port")}),e(vn,{value:(y=u.port)!=null?y:"",onChange:(f,D)=>p(F=>({...F,port:Number.isNaN(D)?null:D})),children:e(xn,{})})]})]}),n(He,{columns:{base:1,md:2},spacing:3,children:[n(x,{children:[e(I,{children:l("hostsDialog.path")}),e(De,{value:u.path,onChange:f=>p(D=>({...D,path:f.target.value}))})]}),n(x,{children:[e(I,{children:l("hostsDialog.sni")}),e(De,{value:u.sni,onChange:f=>p(D=>({...D,sni:f.target.value}))})]})]}),n(x,{children:[e(I,{children:l("hostsDialog.host")}),n(Dr,{children:[e(De,{value:u.host,onChange:f=>p(D=>({...D,host:f.target.value}))}),e(Wr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Ds,{})})]})]}),n(x,{children:[e(I,{children:l("hostsDialog.sort")}),e(vn,{value:Number.isFinite(u.sort)?u.sort:"",onChange:(f,D)=>p(F=>({...F,sort:Number.isNaN(D)?F.sort:D})),children:e(xn,{})})]}),e(L,{borderRadius:"md",bg:"gray.50",color:"gray.600",fontSize:"sm",px:4,py:3,_dark:{bg:"gray.800",color:"gray.300"},children:l("hostsPage.create.sortHint",{value:(A=u.sort)!=null?A:a})})]}),n(Wt,{gap:2,children:[e(O,{variant:"ghost",onClick:s,children:l("hostsPage.cancel")}),e(O,{colorScheme:"primary",onClick:m,isLoading:i,children:l("hostsPage.create.submit")})]})]})]})},Qp=()=>{var yt;const{t}=qe(),s=sr(),{hosts:r,fetchHosts:o,isLoading:i,isPostLoading:a,setHosts:l}=ic(),{inbounds:c}=Lt(),[u,p]=d.exports.useState([]),m=d.exports.useRef([]),g=d.exports.useCallback(re=>{typeof re=="function"?p(ze=>{const Ne=re(ze);return m.current=Ne,Ne}):(m.current=re,p(re))},[]),[S,y]=d.exports.useState(null),[A,f]=d.exports.useState(!1),[D,F]=d.exports.useState(""),[Z,ae]=d.exports.useState(!1),[v,M]=d.exports.useState(null),[T,Q]=d.exports.useState(null),[_e,ke]=d.exports.useState(null),W=d.exports.useRef(null),[oe,R]=d.exports.useState(!1),le=d.exports.useRef(!1),[w,H]=d.exports.useState(!1),[ce,j]=d.exports.useState(!1),[fe,Ae]=d.exports.useState(null);d.exports.useEffect(()=>{o()},[o]),d.exports.useEffect(()=>{c.size||yi()},[c]),d.exports.useEffect(()=>{const re=qp(r);g(re)},[r,g]),d.exports.useEffect(()=>{S&&!m.current.some(re=>re.uid===S)&&y(null)},[u,S]);const Pe=d.exports.useCallback(re=>{le.current=re,R(re)},[]);d.exports.useEffect(()=>{ce||(Ae(null),Pe(!1))},[A,ce,Pe]),d.exports.useEffect(()=>{if(!ce||!fe)return;const re=new Set(m.current.map(Ne=>Ne.uid));fe.every(Ne=>re.has(Ne.uid))||(Ae(null),Pe(!1))},[u,ce,Pe,fe]);const Te=d.exports.useMemo(()=>{const re=[];return c.forEach(ze=>{ze.forEach(Ne=>{re.push({label:`${Ne.tag} (${Ne.protocol.toUpperCase()} - ${Ne.network})`,value:Ne.tag,protocol:Ne.protocol,network:Ne.network})})}),re.sort((ze,Ne)=>ze.label.localeCompare(Ne.label))},[c]),J=d.exports.useMemo(()=>m.current.filter(re=>!re.data.is_disabled).sort((re,ze)=>Xr(re.data.sort)-Xr(ze.data.sort)),[u]),Ce=d.exports.useMemo(()=>[...m.current].sort((re,ze)=>Xr(re.data.sort)-Xr(ze.data.sort)),[u]),$=d.exports.useMemo(()=>A?Ce:J,[J,Ce,A]),X=D.trim().toLowerCase(),_=d.exports.useMemo(()=>X?$.filter(re=>[re.data.remark,re.data.address,re.data.host,re.data.path,re.data.sni,re.inboundTag,re.data.port!=null?String(re.data.port):""].some(Ne=>Ne&&Ne.toLowerCase().includes(X))):$,[$,X]);d.exports.useEffect(()=>{ce&&Ae(re=>re!=null?re:[...J])},[J,ce]);const P=ce?fe!=null?fe:J:_,Y=m.current.length>0,te=i&&!Y,ie=i&&Y,q=X.length>0,B=!ce&&!te&&q&&$.length>0&&_.length===0,ue=d.exports.useMemo(()=>{const re=new Map;return P.forEach((ze,Ne)=>re.set(ze.uid,Ne)),re},[P]),be=S&&(yt=m.current.find(re=>re.uid===S))!=null?yt:null,Ie=(re,ze,Ne)=>{g(wt=>oi(wt.map(ct=>ct.uid===re?{...ct,data:{...ct.data,[ze]:Ne}}:ct)))},N=(re,ze)=>{g(Ne=>oi(Ne.map(wt=>wt.uid===re?{...wt,inboundTag:ze}:wt)))},E=d.exports.useCallback(async()=>{if(!ce||w)return!1;const re=J,ze=fe!=null?fe:re;if(!(ze.length!==re.length||ze.some((Ge,Ue)=>{var St;return Ge.uid!==((St=re[Ue])==null?void 0:St.uid)}))||!fe||ze.length===0)return j(!1),Ae(null),Pe(!1),!0;const wt=ze.map(Ge=>Ge.uid),ct=new Map;wt.forEach((Ge,Ue)=>ct.set(Ge,Ue));const V=m.current,lt=m.current.filter(Ge=>ct.has(Ge.uid)).sort((Ge,Ue)=>{var St,Vt;return((St=ct.get(Ge.uid))!=null?St:Number.MAX_SAFE_INTEGER)-((Vt=ct.get(Ue.uid))!=null?Vt:Number.MAX_SAFE_INTEGER)}),_t=m.current.filter(Ge=>!ct.has(Ge.uid)).sort((Ge,Ue)=>Xr(Ge.data.sort)-Xr(Ue.data.sort)),zt=[...lt,..._t].map((Ge,Ue)=>({...Ge,data:{...Ge.data,sort:Ue},original:{...Ge.original,sort:Ue}}));g(zt),Ae(zt.filter(Ge=>!Ge.data.is_disabled)),H(!0);try{const Ge=dc(zt);return await l(Ge),await o(),Pe(!1),j(!1),Ae(null),s({title:t("hostsPage.reorderSaved"),status:"success",isClosable:!0,position:"top"}),!0}catch{g(V);const Ue=V.filter(St=>!St.data.is_disabled).sort((St,Vt)=>Xr(St.data.sort)-Xr(Vt.data.sort));return Ae(Ue),Pe(!0),s({title:t("hostsPage.reorderFailed"),status:"error",isClosable:!0,position:"top"}),!1}finally{H(!1)}},[g,J,o,ce,w,l,Pe,t,s,fe]),G=d.exports.useCallback(re=>{if(!ce||!re.length)return;const ze=fe!=null?fe:J;!(re.length!==ze.length||re.some((wt,ct)=>{var V;return wt.uid!==((V=ze[ct])==null?void 0:V.uid)}))||(Ae(re),le.current||Pe(!0))},[J,ce,Pe,fe]),he=d.exports.useCallback(()=>{Ae([...J]),Pe(!1),j(!0)},[J,Pe]),Re=d.exports.useCallback(()=>{j(!1),Ae(null),Pe(!1)},[Pe]),tt=d.exports.useCallback(()=>{E()},[E]),je=async re=>{const ze=m.current.find(Ne=>Ne.uid===re);if(!!ze){M(re);try{const Ne=ya(m.current,[ze.inboundTag,ze.initialInboundTag]);await l(Ne),await o(),s({title:t("hostsPage.saved"),status:"success",isClosable:!0,position:"top"}),y(null)}catch{s({title:t("hostsPage.error.save"),status:"error",isClosable:!0,position:"top"})}finally{M(null)}}},we=re=>{g(ze=>oi(ze.map(Ne=>Ne.uid===re?{...Ne,inboundTag:Ne.initialInboundTag,data:za(Ne.original)}:Ne)))},Fe=(re,ze)=>{Ie(re,"is_disabled",!ze),ze||f(!0)},Ye=re=>{ke(re)},ot=async()=>{if(!_e)return;const re=m.current.find(ze=>ze.uid===_e);if(!!re){Q(_e);try{const ze=m.current.filter(wt=>wt.uid!==_e);g(ze);const Ne=ya(ze,[re.inboundTag,re.initialInboundTag]);await l(Ne),await o(),s({title:t("hostsPage.deleted"),status:"success",isClosable:!0,position:"top"}),S===_e&&y(null)}catch{s({title:t("hostsPage.error.delete"),status:"error",isClosable:!0,position:"top"})}finally{Q(null),ke(null)}}},ut=async re=>{const ze=m.current.length?Math.max(...m.current.map(Ne=>Ne.data.sort))+1:0;M("create");try{const Ne={uid:lc(),inboundTag:re.inboundTag,initialInboundTag:re.inboundTag,data:{id:null,remark:re.remark,address:re.address,sort:Number.isFinite(re.sort)?re.sort:ze,port:re.port,path:re.path,sni:re.sni,host:re.host,mux_enable:!1,allowinsecure:!1,is_disabled:!1,fragment_setting:"",noise_setting:"",random_user_agent:!1,security:"inbound_default",alpn:"",fingerprint:"",use_sni_as_host:!1},original:{id:null,remark:re.remark,address:re.address,sort:Number.isFinite(re.sort)?re.sort:ze,port:re.port,path:re.path,sni:re.sni,host:re.host,mux_enable:!1,allowinsecure:!1,is_disabled:!1,fragment_setting:"",noise_setting:"",random_user_agent:!1,security:"inbound_default",alpn:"",fingerprint:"",use_sni_as_host:!1}},wt=oi([...m.current,Ne]);g(wt);const ct=ya(wt,[re.inboundTag]);await l(ct),await o(),s({title:t("hostsPage.created"),status:"success",isClosable:!0,position:"top"}),ae(!1)}catch{s({title:t("hostsPage.error.create"),status:"error",isClosable:!0,position:"top"})}finally{M(null)}};return n(me,{align:"stretch",spacing:4,children:[ce?n(me,{align:"stretch",spacing:2,children:[n(U,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[e(h,{fontWeight:"semibold",children:t("hostsPage.sortingTitle")}),n(U,{spacing:2,children:[e(O,{variant:"ghost",onClick:Re,isDisabled:w,children:t("hostsPage.cancel")}),e(O,{colorScheme:"primary",onClick:tt,isLoading:w,isDisabled:!oe&&!w,children:t("hostsPage.saveOrder")})]})]}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:t("hostsPage.sortingInstructions")}),w?n(U,{spacing:2,fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:[e(Et,{size:"xs"}),e(h,{children:t("hostsPage.orderSaving")})]}):oe?e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:t("hostsPage.orderDirty")}):null]}):n(ge,{direction:{base:"column",md:"row"},spacing:3,align:{base:"stretch",md:"center"},justify:"space-between",children:[n(U,{spacing:3,flexWrap:"wrap",children:[e(O,{colorScheme:"primary",size:"sm",onClick:()=>ae(!0),leftIcon:e(ac,{}),isDisabled:!Te.length,children:t("hostsPage.addHost")}),e(vt,{isChecked:A,onChange:re=>f(re.target.checked),children:t("hostsPage.showDisabled")})]}),n(ge,{direction:{base:"column",sm:"row"},spacing:2,align:{base:"stretch",sm:"center"},justify:"flex-end",w:"full",children:[e(De,{value:D,onChange:re=>F(re.target.value),placeholder:t("hostsPage.searchPlaceholder",{defaultValue:"Search hosts..."}),size:"sm",w:"100%"}),n(U,{spacing:2,justify:"flex-end",children:[ie&&e(Et,{size:"sm"}),e(O,{size:"sm",variant:"outline",leftIcon:e(oc,{}),onClick:he,isDisabled:te||!J.length,children:t("hostsPage.enterSort")})]})]})]}),te?e(U,{justify:"center",py:10,children:e(Et,{})}):P.length===0?e(L,{border:"1px dashed",borderRadius:"md",px:6,py:10,textAlign:"center",borderColor:"gray.300",_dark:{borderColor:"gray.600"},children:e(h,{children:t(B?"hostsPage.searchEmpty":"hostsPage.emptyState")})}):ce?e(Fl.Group,{axis:"y",values:P,onReorder:G,layoutScroll:!0,style:{display:"flex",flexDirection:"column",gap:"0.75rem",listStyle:"none",padding:0,margin:0},children:P.map((re,ze)=>e(Yp,{host:re,index:ze},re.uid))}):e(He,{columns:{base:1,md:2,xl:3},spacing:4,children:P.map((re,ze)=>{var Ne;return e(Jp,{host:re,inboundOptions:Te,orderIndex:(Ne=ue.get(re.uid))!=null?Ne:ze,onToggleActive:Fe,onEdit:y,onDelete:Ye,saving:v===re.uid&&a,deleting:T===re.uid&&a},re.uid)})}),e(Xp,{isOpen:Z,onClose:()=>ae(!1),inboundOptions:Te,onSubmit:ut,isSubmitting:v==="create"&&a,defaultSort:m.current.length?Math.max(...m.current.map(re=>re.data.sort))+1:0}),e(Gp,{host:be,inboundOptions:Te,isOpen:Boolean(be),onClose:()=>y(null),onChange:Ie,onChangeInbound:N,onSave:je,onReset:we,onDelete:Ye,saving:!!be&&v===be.uid&&a,deleting:!!be&&T===be.uid&&a}),e(Ts,{isOpen:Boolean(_e),leastDestructiveRef:W,onClose:()=>ke(null),children:e(Dt,{children:n(zs,{children:[e(Tt,{fontSize:"lg",fontWeight:"bold",children:t("hostsPage.deleteTitle")}),e(It,{children:t("hostsPage.deleteConfirmation")}),n(Wt,{children:[e(O,{ref:W,onClick:()=>ke(null),children:t("hostsPage.cancel")}),e(O,{colorScheme:"red",onClick:ot,ml:3,isLoading:Boolean(T),children:t("hostsPage.delete")})]})]})})})]})},Zp=t=>t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,""),Wo=t=>{if(typeof t!="string"||t.length===0)return"";try{if(typeof atob=="function")return atob(Zp(t))}catch{}return""},jp=t=>{if(typeof t!="string"||t.length===0)return"";const s=globalThis.Wireguard;if(s!=null&&s.generateKeypair)try{const r=s.generateKeypair(t);if(r&&typeof r.publicKey=="string")return r.publicKey}catch{}return""};class qr{static isEmpty(s){return s==null?!0:typeof s=="string"?s.trim().length===0:Array.isArray(s)?s.length===0:typeof s=="object"?Object.keys(s).length===0:!1}static isArrEmpty(s){return!Array.isArray(s)||s.length===0}}const ye=Object.freeze({Freedom:"freedom",Blackhole:"blackhole",DNS:"dns",VMess:"vmess",VLESS:"vless",Trojan:"trojan",Shadowsocks:"shadowsocks",Socks:"socks",HTTP:"http",Wireguard:"wireguard"}),uc=Object.freeze({AES_256_GCM:"aes-256-gcm",AES_128_GCM:"aes-128-gcm",CHACHA20_POLY1305:"chacha20-poly1305",CHACHA20_IETF_POLY1305:"chacha20-ietf-poly1305",XCHACHA20_POLY1305:"xchacha20-poly1305",XCHACHA20_IETF_POLY1305:"xchacha20-ietf-poly1305",BLAKE3_AES_128_GCM:"2022-blake3-aes-128-gcm",BLAKE3_AES_256_GCM:"2022-blake3-aes-256-gcm",BLAKE3_CHACHA20_POLY1305:"2022-blake3-chacha20-poly1305"});Object.freeze({VISION:"xtls-rprx-vision",VISION_UDP443:"xtls-rprx-vision-udp443"});const em=Object.freeze({UTLS_CHROME:"chrome",UTLS_FIREFOX:"firefox",UTLS_SAFARI:"safari",UTLS_IOS:"ios",UTLS_android:"android",UTLS_EDGE:"edge",UTLS_360:"360",UTLS_QQ:"qq",UTLS_RANDOM:"random",UTLS_RANDOMIZED:"randomized",UTLS_RONDOMIZEDNOALPN:"randomizednoalpn",UTLS_UNSAFE:"unsafe"}),tm=Object.freeze({H3:"h3",H2:"h2",HTTP1:"http/1.1"});Object.freeze(["AsIs","UseIP","UseIPv4","UseIPv6","UseIPv6v4","UseIPv4v6","ForceIP","ForceIPv6v4","ForceIPv6","ForceIPv4v6","ForceIPv4"]);const rm=Object.freeze(["ForceIP","ForceIPv4","ForceIPv4v6","ForceIPv6","ForceIPv6v4"]);Object.freeze({AES_128_GCM:"aes-128-gcm",CHACHA20_POLY1305:"chacha20-poly1305",AUTO:"auto",NONE:"none",ZERO:"zero"});Object.freeze({AUTO:"auto",PACKET_UP:"packet-up",STREAM_UP:"stream-up",STREAM_ONE:"stream-one"});const Sa=Object.freeze({NONE:"none",SrvPortOnly:"srvportonly",SrvAddressOnly:"srvaddressonly",SrvPortAndAddress:"srvportandaddress",TxtPortOnly:"txtportonly",TxtAddressOnly:"txtaddressonly",TxtPortAndAddress:"txtportandaddress"});class Rt{static toJsonArray(s){return s.map(r=>r.toJson())}static fromJson(s){return new Rt}toJson(){return{}}toString(s=!0){const r=this.toJson();return s?JSON.stringify(r,null,2):JSON.stringify(r)}}class En extends Rt{constructor(r="none",o="",i=""){super();ee(this,"type");ee(this,"host");ee(this,"path");this.type=r,this.host=o,this.path=i}static fromJson(r={}){var i,a,l,c,u,p,m,g,S,y;const o=r==null?void 0:r.header;if(!o)return new En;if(o.type==="http"&&o.request){const A=((a=(i=o.request)==null?void 0:i.headers)==null?void 0:a.Host)&&Array.isArray(o.request.headers.Host)?o.request.headers.Host.join(","):(u=(c=(l=o.request)==null?void 0:l.headers)==null?void 0:c.Host)!=null?u:"",f=((p=o.request)==null?void 0:p.path)&&Array.isArray(o.request.path)?o.request.path.join(","):(g=(m=o.request)==null?void 0:m.path)!=null?g:"";return new En((S=o.type)!=null?S:"http",A,f)}return new En((y=o.type)!=null?y:"none","","")}toJson(){return{header:{type:this.type,request:this.type==="http"?{headers:{Host:qr.isEmpty(this.host)?[]:this.host.split(",")},path:qr.isEmpty(this.path)?["/"]:this.path.split(",")}:void 0}}}}class Ns extends Rt{constructor(r=1350,o=50,i=5,a=20,l=!1,c=2,u=2,p="none",m=""){super();ee(this,"mtu");ee(this,"tti");ee(this,"upCap");ee(this,"downCap");ee(this,"congestion");ee(this,"readBuffer");ee(this,"writeBuffer");ee(this,"type");ee(this,"seed");this.mtu=r!=null?r:1350,this.tti=o!=null?o:50,this.upCap=i!=null?i:5,this.downCap=a!=null?a:20,this.congestion=Boolean(l),this.readBuffer=c!=null?c:2,this.writeBuffer=u!=null?u:2,this.type=p!=null?p:"none",this.seed=m!=null?m:""}static fromJson(r={}){var o,i,a;return new Ns(r==null?void 0:r.mtu,r==null?void 0:r.tti,r==null?void 0:r.uplinkCapacity,r==null?void 0:r.downlinkCapacity,r==null?void 0:r.congestion,r==null?void 0:r.readBufferSize,r==null?void 0:r.writeBufferSize,(i=(o=r==null?void 0:r.header)==null?void 0:o.type)!=null?i:"none",(a=r==null?void 0:r.seed)!=null?a:"")}toJson(){return{mtu:this.mtu,tti:this.tti,uplinkCapacity:this.upCap,downlinkCapacity:this.downCap,congestion:this.congestion,readBufferSize:this.readBuffer,writeBufferSize:this.writeBuffer,header:{type:this.type},seed:this.seed}}}class ls extends Rt{constructor(r="/",o="",i=0){super();ee(this,"path");ee(this,"host");ee(this,"heartbeatPeriod");this.path=r!=null?r:"/",this.host=o!=null?o:"",this.heartbeatPeriod=i!=null?i:0}static fromJson(r={}){var o,i,a;return new ls((o=r==null?void 0:r.path)!=null?o:"/",(i=r==null?void 0:r.host)!=null?i:"",(a=r==null?void 0:r.heartbeatPeriod)!=null?a:0)}toJson(){return{path:this.path,host:this.host,heartbeatPeriod:this.heartbeatPeriod}}}class cs extends Rt{constructor(r="",o="",i=!1){super();ee(this,"serviceName");ee(this,"authority");ee(this,"multiMode");this.serviceName=r!=null?r:"",this.authority=o!=null?o:"",this.multiMode=Boolean(i)}static fromJson(r={}){var o,i;return new cs((o=r==null?void 0:r.serviceName)!=null?o:"",(i=r==null?void 0:r.authority)!=null?i:"",Boolean(r==null?void 0:r.multiMode))}toJson(){return{serviceName:this.serviceName,authority:this.authority,multiMode:this.multiMode}}}class Rs extends Rt{constructor(r="/",o=""){super();ee(this,"path");ee(this,"host");this.path=r!=null?r:"/",this.host=o!=null?o:""}static fromJson(r={}){var o,i;return new Rs((o=r==null?void 0:r.path)!=null?o:"/",(i=r==null?void 0:r.host)!=null?i:"")}toJson(){return{path:this.path,host:this.host}}}class Ls extends Rt{constructor(r="/",o="",i="",a=!1,l="30",c={maxConcurrency:"16-32",maxConnections:0,cMaxReuseTimes:0,hMaxRequestTimes:"600-900",hMaxReusableSecs:"1800-3000",hKeepAlivePeriod:0}){var u,p,m,g,S,y;super();ee(this,"path");ee(this,"host");ee(this,"mode");ee(this,"noGRPCHeader");ee(this,"scMinPostsIntervalMs");ee(this,"xmux");this.path=r!=null?r:"/",this.host=o!=null?o:"",this.mode=i!=null?i:"",this.noGRPCHeader=Boolean(a),this.scMinPostsIntervalMs=l!=null?l:"30",this.xmux={maxConcurrency:(u=c==null?void 0:c.maxConcurrency)!=null?u:"16-32",maxConnections:(p=c==null?void 0:c.maxConnections)!=null?p:0,cMaxReuseTimes:(m=c==null?void 0:c.cMaxReuseTimes)!=null?m:0,hMaxRequestTimes:(g=c==null?void 0:c.hMaxRequestTimes)!=null?g:"600-900",hMaxReusableSecs:(S=c==null?void 0:c.hMaxReusableSecs)!=null?S:"1800-3000",hKeepAlivePeriod:(y=c==null?void 0:c.hKeepAlivePeriod)!=null?y:0}}static fromJson(r={}){var o,i,a,l;return new Ls((o=r==null?void 0:r.path)!=null?o:"/",(i=r==null?void 0:r.host)!=null?i:"",(a=r==null?void 0:r.mode)!=null?a:"",Boolean(r==null?void 0:r.noGRPCHeader),(l=r==null?void 0:r.scMinPostsIntervalMs)!=null?l:"30",r==null?void 0:r.xmux)}toJson(){return{path:this.path,host:this.host,mode:this.mode,noGRPCHeader:this.noGRPCHeader,scMinPostsIntervalMs:this.scMinPostsIntervalMs,xmux:{maxConcurrency:this.xmux.maxConcurrency,maxConnections:this.xmux.maxConnections,cMaxReuseTimes:this.xmux.cMaxReuseTimes,hMaxRequestTimes:this.xmux.hMaxRequestTimes,hMaxReusableSecs:this.xmux.hMaxReusableSecs,hKeepAlivePeriod:this.xmux.hKeepAlivePeriod}}}}class ds extends Rt{constructor(r="",o=[],i="",a=!1,l=""){super();ee(this,"serverName");ee(this,"alpn");ee(this,"fingerprint");ee(this,"allowInsecure");ee(this,"echConfigList");this.serverName=r!=null?r:"",this.alpn=o!=null?o:[],this.fingerprint=i!=null?i:"",this.allowInsecure=Boolean(a),this.echConfigList=l!=null?l:""}static fromJson(r={}){var o,i,a;return new ds((o=r==null?void 0:r.serverName)!=null?o:"",Array.isArray(r==null?void 0:r.alpn)?r.alpn:[],(i=r==null?void 0:r.fingerprint)!=null?i:"",Boolean(r==null?void 0:r.allowInsecure),(a=r==null?void 0:r.echConfigList)!=null?a:"")}toJson(){var r;return{serverName:this.serverName||void 0,alpn:(r=this.alpn)!=null&&r.length?this.alpn:void 0,fingerprint:this.fingerprint||void 0,allowInsecure:this.allowInsecure,echConfigList:this.echConfigList||void 0}}}class Ms extends Rt{constructor(r="",o="",i="",a="",l="",c=""){super();ee(this,"publicKey");ee(this,"fingerprint");ee(this,"serverName");ee(this,"shortId");ee(this,"spiderX");ee(this,"mldsa65Verify");this.publicKey=r!=null?r:"",this.fingerprint=o!=null?o:"",this.serverName=i!=null?i:"",this.shortId=a!=null?a:"",this.spiderX=l!=null?l:"",this.mldsa65Verify=c!=null?c:""}static fromJson(r={}){var o,i,a,l,c,u;return new Ms((o=r==null?void 0:r.publicKey)!=null?o:"",(i=r==null?void 0:r.fingerprint)!=null?i:"",(a=r==null?void 0:r.serverName)!=null?a:"",(l=r==null?void 0:r.shortId)!=null?l:"",(c=r==null?void 0:r.spiderX)!=null?c:"",(u=r==null?void 0:r.mldsa65Verify)!=null?u:"")}toJson(){return{publicKey:this.publicKey||void 0,fingerprint:this.fingerprint||void 0,serverName:this.serverName||void 0,shortId:this.shortId||void 0,spiderX:this.spiderX||void 0,mldsa65Verify:this.mldsa65Verify||void 0}}}class Si extends Rt{constructor(r="",o=!1,i=0,a=!1,l=!1,c=Sa.NONE){super();ee(this,"dialerProxy");ee(this,"tcpFastOpen");ee(this,"tcpKeepAliveInterval");ee(this,"tcpMptcp");ee(this,"penetrate");ee(this,"addressPortStrategy");this.dialerProxy=r!=null?r:"",this.tcpFastOpen=Boolean(o),this.tcpKeepAliveInterval=i!=null?i:0,this.tcpMptcp=Boolean(a),this.penetrate=Boolean(l),this.addressPortStrategy=c!=null?c:Sa.NONE}static fromJson(r={}){var o,i,a;return!r||Object.keys(r).length===0?new Si:new Si((o=r==null?void 0:r.dialerProxy)!=null?o:"",Boolean(r==null?void 0:r.tcpFastOpen),(i=r==null?void 0:r.tcpKeepAliveInterval)!=null?i:0,Boolean(r==null?void 0:r.tcpMptcp),Boolean(r==null?void 0:r.penetrate),(a=r==null?void 0:r.addressPortStrategy)!=null?a:Sa.NONE)}toJson(){return{dialerProxy:this.dialerProxy||void 0,tcpFastOpen:this.tcpFastOpen,tcpKeepAliveInterval:this.tcpKeepAliveInterval||void 0,tcpMptcp:this.tcpMptcp,penetrate:this.penetrate,addressPortStrategy:this.addressPortStrategy}}}class Un extends Rt{constructor(r="tcp",o="none",i=new ds,a=new Ms,l=new En,c=new Ns,u=new ls,p=new cs,m=new Rs,g=new Ls,S){super();ee(this,"network");ee(this,"security");ee(this,"tls");ee(this,"reality");ee(this,"tcp");ee(this,"kcp");ee(this,"ws");ee(this,"grpc");ee(this,"httpupgrade");ee(this,"xhttp");ee(this,"sockopt");this.network=r!=null?r:"tcp",this.security=o!=null?o:"none",this.tls=i,this.reality=a,this.tcp=l,this.kcp=c,this.ws=u,this.grpc=p,this.httpupgrade=m,this.xhttp=g,this.sockopt=S}get isTls(){return this.security==="tls"}get isReality(){return this.security==="reality"}get sockoptSwitch(){return this.sockopt!==void 0}set sockoptSwitch(r){this.sockopt=r?new Si:void 0}static fromJson(r={}){var o,i;return new Un((o=r==null?void 0:r.network)!=null?o:"tcp",(i=r==null?void 0:r.security)!=null?i:"none",ds.fromJson(r==null?void 0:r.tlsSettings),Ms.fromJson(r==null?void 0:r.realitySettings),En.fromJson(r==null?void 0:r.tcpSettings),Ns.fromJson(r==null?void 0:r.kcpSettings),ls.fromJson(r==null?void 0:r.wsSettings),cs.fromJson(r==null?void 0:r.grpcSettings),Rs.fromJson(r==null?void 0:r.httpupgradeSettings),Ls.fromJson(r==null?void 0:r.xhttpSettings),Si.fromJson(r==null?void 0:r.sockopt))}toJson(){const r=this.network;return{network:r,security:this.security,tlsSettings:this.security==="tls"?this.tls.toJson():void 0,realitySettings:this.security==="reality"?this.reality.toJson():void 0,tcpSettings:r==="tcp"?this.tcp.toJson():void 0,kcpSettings:r==="kcp"?this.kcp.toJson():void 0,wsSettings:r==="ws"?this.ws.toJson():void 0,grpcSettings:r==="grpc"?this.grpc.toJson():void 0,httpupgradeSettings:r==="httpupgrade"?this.httpupgrade.toJson():void 0,xhttpSettings:r==="xhttp"?this.xhttp.toJson():void 0,sockopt:this.sockopt?this.sockopt.toJson():void 0}}}class xi extends Rt{constructor(r=!1,o=8,i=16,a="reject"){super();ee(this,"enabled");ee(this,"concurrency");ee(this,"xudpConcurrency");ee(this,"xudpProxyUDP443");this.enabled=Boolean(r),this.concurrency=o!=null?o:8,this.xudpConcurrency=i!=null?i:16,this.xudpProxyUDP443=a!=null?a:"reject"}static fromJson(r={}){return!r||Object.keys(r).length===0?new xi:new xi(r==null?void 0:r.enabled,r==null?void 0:r.concurrency,r==null?void 0:r.xudpConcurrency,r==null?void 0:r.xudpProxyUDP443)}toJson(){return{enabled:this.enabled,concurrency:this.concurrency,xudpConcurrency:this.xudpConcurrency,xudpProxyUDP443:this.xudpProxyUDP443}}}var In,nn;const st=class extends Rt{constructor(r="",o=ye.VLESS,i=st.Settings.getSettings(ye.VLESS),a=new Un,l,c=new xi){super();ee(this,"tag");ee(this,"_protocol");ee(this,"settings");ee(this,"stream");ee(this,"sendThrough");ee(this,"mux");this.tag=r!=null?r:"",this._protocol=o!=null?o:ye.VLESS,this.settings=i!=null?i:st.Settings.getSettings(this._protocol),this.stream=a,this.sendThrough=l,this.mux=c}get protocol(){return this._protocol}set protocol(r){this._protocol=r,this.settings=st.Settings.getSettings(r),this.stream=new Un}canEnableTls(){return[ye.VMess,ye.VLESS,ye.Trojan,ye.Shadowsocks].includes(this.protocol)?["tcp","ws","http","grpc","httpupgrade","xhttp"].includes(this.stream.network):!1}canEnableTlsFlow(){return this.stream.security!=="none"&&this.stream.network==="tcp"?this.protocol===ye.VLESS:!1}canEnableReality(){return[ye.VLESS,ye.Trojan].includes(this.protocol)?["tcp","http","grpc","xhttp"].includes(this.stream.network):!1}canEnableStream(){return[ye.VMess,ye.VLESS,ye.Trojan,ye.Shadowsocks].includes(this.protocol)}canEnableMux(){if(this.settings&&typeof this.settings=="object"&&"flow"in this.settings){const r=this.settings.flow;if(r&&r.length>0)return this.mux&&(this.mux.enabled=!1),!1}return this.stream.network==="xhttp"?(this.mux&&(this.mux.enabled=!1),!1):[ye.VMess,ye.VLESS,ye.Trojan,ye.Shadowsocks,ye.HTTP,ye.Socks].includes(this.protocol)}hasVnext(){return[ye.VMess,ye.VLESS].includes(this.protocol)}hasServers(){return[ye.Trojan,ye.Shadowsocks,ye.Socks,ye.HTTP].includes(this.protocol)}hasAddressPort(){return[ye.DNS,ye.VMess,ye.VLESS,ye.Trojan,ye.Shadowsocks,ye.Socks,ye.HTTP].includes(this.protocol)}hasUsername(){return[ye.Socks,ye.HTTP].includes(this.protocol)}static fromJson(r={}){var o,i,a,l;return new st((o=r==null?void 0:r.tag)!=null?o:"",(i=r==null?void 0:r.protocol)!=null?i:ye.VLESS,st.Settings.fromProtocol((a=r==null?void 0:r.protocol)!=null?a:ye.VLESS,r==null?void 0:r.settings),Un.fromJson(r==null?void 0:r.streamSettings),(l=r==null?void 0:r.sendThrough)!=null?l:"",xi.fromJson(r==null?void 0:r.mux))}toJson(){var o,i;let r;return this.canEnableStream()?r=this.stream.toJson():(o=this.stream)!=null&&o.sockopt&&(r={sockopt:this.stream.sockopt.toJson()}),{tag:this.tag||void 0,protocol:this.protocol,settings:this.settings instanceof Rt?this.settings.toJson():this.settings,streamSettings:r,sendThrough:this.sendThrough||void 0,mux:(i=this.mux)!=null&&i.enabled?this.mux.toJson():void 0}}static fromLink(r){if(!r||typeof r!="string")return null;const o=r.split("://");if(o.length!==2)return null;const i=o[0].toLowerCase();try{switch(i){case ye.VMess:return st.fromVmessLink(JSON.parse(Wo(o[1])));case ye.VLESS:case ye.Trojan:case"ss":return st.fromParamLink(r);default:return null}}catch{return null}}static fromVmessLink(r={}){var l,c,u,p,m,g,S,y,A,f,D,F,Z,ae,v,M,T,Q,_e,ke,W,oe,R;if(!r)return null;const o=new Un((l=r==null?void 0:r.net)!=null?l:"tcp",(c=r==null?void 0:r.tls)!=null?c:"none"),i=r==null?void 0:r.net;i==="tcp"?o.tcp=new En((u=r==null?void 0:r.type)!=null?u:"none",(p=r==null?void 0:r.host)!=null?p:"",(m=r==null?void 0:r.path)!=null?m:""):i==="kcp"?(o.kcp=new Ns,o.kcp.type=(g=r==null?void 0:r.type)!=null?g:"none",o.kcp.seed=(S=r==null?void 0:r.path)!=null?S:""):i==="ws"?o.ws=new ls((y=r==null?void 0:r.path)!=null?y:"/",(A=r==null?void 0:r.host)!=null?A:""):i==="grpc"?o.grpc=new cs((f=r==null?void 0:r.path)!=null?f:"",(D=r==null?void 0:r.authority)!=null?D:"",(r==null?void 0:r.type)==="multi"):i==="httpupgrade"?o.httpupgrade=new Rs((F=r==null?void 0:r.path)!=null?F:"/",(Z=r==null?void 0:r.host)!=null?Z:""):i==="xhttp"&&(o.xhttp=new Ls((ae=r==null?void 0:r.path)!=null?ae:"/",(v=r==null?void 0:r.host)!=null?v:"",(M=r==null?void 0:r.mode)!=null?M:"")),(r==null?void 0:r.tls)==="tls"&&(o.security="tls",o.tls=new ds((T=r==null?void 0:r.sni)!=null?T:"",r!=null&&r.alpn?String(r.alpn).split(","):[],(Q=r==null?void 0:r.fp)!=null?Q:"",Boolean(r==null?void 0:r.allowInsecure)));const a=Number((_e=r==null?void 0:r.port)!=null?_e:0);return Number.isNaN(a)?null:new st((ke=r==null?void 0:r.ps)!=null?ke:"",ye.VMess,new st.VmessSettings((W=r==null?void 0:r.add)!=null?W:"",a,(oe=r==null?void 0:r.id)!=null?oe:"",(R=r==null?void 0:r.scy)!=null?R:""),o)}static fromParamLink(r){var M,T,Q,_e,ke,W,oe,R,le,w,H,ce,j,fe,Ae,Pe,Te,J,Ce,$,X;let o;try{o=new URL(r)}catch{return null}const i=(M=o.searchParams.get("type"))!=null?M:"tcp",a=(T=o.searchParams.get("security"))!=null?T:"none",l=new Un(i,a),c=(Q=o.searchParams.get("headerType"))!=null?Q:void 0,u=(_e=o.searchParams.get("host"))!=null?_e:void 0,p=(ke=o.searchParams.get("path"))!=null?ke:void 0,m=(W=o.searchParams.get("mode"))!=null?W:void 0;if(i==="tcp"||i==="none"?l.tcp=new En(c!=null?c:"none",u!=null?u:"",p!=null?p:""):i==="kcp"?(l.kcp=new Ns,l.kcp.type=c!=null?c:"none",l.kcp.seed=p!=null?p:""):i==="ws"?l.ws=new ls(p!=null?p:"/",u!=null?u:""):i==="grpc"?l.grpc=new cs((oe=o.searchParams.get("serviceName"))!=null?oe:"",(R=o.searchParams.get("authority"))!=null?R:"",o.searchParams.get("mode")==="multi"):i==="httpupgrade"?l.httpupgrade=new Rs(p!=null?p:"/",u!=null?u:""):i==="xhttp"&&(l.xhttp=new Ls(p!=null?p:"/",u!=null?u:"",m!=null?m:"")),a==="tls"){const _=(le=o.searchParams.get("fp"))!=null?le:"none",P=o.searchParams.get("alpn"),Y=o.searchParams.get("allowInsecure"),te=(w=o.searchParams.get("sni"))!=null?w:"",ie=(H=o.searchParams.get("ech"))!=null?H:"";l.tls=new ds(te,P?P.split(","):[],_,Y==="1",ie)}if(a==="reality"){const _=(ce=o.searchParams.get("pbk"))!=null?ce:"",P=(j=o.searchParams.get("fp"))!=null?j:"",Y=(fe=o.searchParams.get("sni"))!=null?fe:"",te=(Ae=o.searchParams.get("sid"))!=null?Ae:"",ie=(Pe=o.searchParams.get("spx"))!=null?Pe:"",q=(Te=o.searchParams.get("pqv"))!=null?Te:"";l.reality=new Ms(_,P,Y,te,ie,q)}const g=/([^@]+):\/\/([^@]+)@(.+):(\d+)(.*)$/,S=r.match(g);if(!S)return null;let[,y,A,f,D]=S,F=Number(D);Number.isNaN(F)&&(F=0),y==="ss"&&(y=ye.Shadowsocks,A=Wo(A));let Z=null;switch(y){case ye.VLESS:{const _=(J=o.searchParams.get("encryption"))!=null?J:"none";Z=new st.VLESSSettings(f,F,A,(Ce=o.searchParams.get("flow"))!=null?Ce:"",_);break}case ye.Trojan:Z=new st.TrojanSettings(f,F,A);break;case ye.Shadowsocks:{const _=A.split(":"),P=($=_.shift())!=null?$:"";Z=new st.ShadowsocksSettings(f,F,_.join(":"),P,!0);break}default:return null}const ae=decodeURIComponent((X=o.hash)!=null?X:""),v=ae.length>1?ae.substring(1):`out-${y}-${F}`;return new st(v,y,Z,l)}};let mr=st;ee(mr,"Settings",class extends Rt{constructor(i){super();ee(this,"protocol");this.protocol=i}static getSettings(i){switch(i){case ye.Freedom:return new st.FreedomSettings;case ye.Blackhole:return new st.BlackholeSettings;case ye.DNS:return new st.DNSSettings;case ye.VMess:return new st.VmessSettings;case ye.VLESS:return new st.VLESSSettings;case ye.Trojan:return new st.TrojanSettings;case ye.Shadowsocks:return new st.ShadowsocksSettings;case ye.Socks:return new st.SocksSettings;case ye.HTTP:return new st.HttpSettings;case ye.Wireguard:return new st.WireguardSettings;default:return null}}static fromProtocol(i,a){switch(i){case ye.Freedom:return st.FreedomSettings.fromJson(a);case ye.Blackhole:return st.BlackholeSettings.fromJson(a);case ye.DNS:return st.DNSSettings.fromJson(a);case ye.VMess:return st.VmessSettings.fromJson(a);case ye.VLESS:return st.VLESSSettings.fromJson(a);case ye.Trojan:return st.TrojanSettings.fromJson(a);case ye.Shadowsocks:return st.ShadowsocksSettings.fromJson(a);case ye.Socks:return st.SocksSettings.fromJson(a);case ye.HTTP:return st.HttpSettings.fromJson(a);case ye.Wireguard:return st.WireguardSettings.fromJson(a);default:return null}}toJson(){return{}}}),ee(mr,"FreedomSettings",(In=class extends Rt{constructor(i="",a="",l={},c=[]){super();ee(this,"domainStrategy");ee(this,"redirect");ee(this,"fragment");ee(this,"noises");this.domainStrategy=i!=null?i:"",this.redirect=a!=null?a:"",this.fragment=l!=null?l:{},this.noises=c!=null?c:[]}addNoise(){this.noises.push(new st.FreedomSettings.Noise)}delNoise(i){this.noises.splice(i,1)}static fromJson(i={}){var a,l;return new In((a=i==null?void 0:i.domainStrategy)!=null?a:"",(l=i==null?void 0:i.redirect)!=null?l:"",i!=null&&i.fragment?In.Fragment.fromJson(i.fragment):{},Array.isArray(i==null?void 0:i.noises)?i.noises.map(c=>In.Noise.fromJson(c)):[])}toJson(){return{domainStrategy:qr.isEmpty(this.domainStrategy)?void 0:this.domainStrategy,redirect:qr.isEmpty(this.redirect)?void 0:this.redirect,fragment:Object.keys(this.fragment).length===0?void 0:this.fragment,noises:this.noises.length===0?void 0:Rt.toJsonArray(this.noises)}}},ee(In,"Fragment",class hc extends Rt{constructor(l="1-3",c="",u="",p=""){super();ee(this,"packets");ee(this,"length");ee(this,"interval");ee(this,"maxSplit");this.packets=l!=null?l:"1-3",this.length=c!=null?c:"",this.interval=u!=null?u:"",this.maxSplit=p!=null?p:""}static fromJson(l={}){var c,u,p,m;return new hc((c=l==null?void 0:l.packets)!=null?c:"1-3",(u=l==null?void 0:l.length)!=null?u:"",(p=l==null?void 0:l.interval)!=null?p:"",(m=l==null?void 0:l.maxSplit)!=null?m:"")}}),ee(In,"Noise",class pc extends Rt{constructor(l="rand",c="10-20",u="10-16",p="ip"){super();ee(this,"type");ee(this,"packet");ee(this,"delay");ee(this,"applyTo");this.type=l!=null?l:"rand",this.packet=c!=null?c:"10-20",this.delay=u!=null?u:"10-16",this.applyTo=p!=null?p:"ip"}static fromJson(l={}){var c,u,p,m;return new pc((c=l==null?void 0:l.type)!=null?c:"rand",(u=l==null?void 0:l.packet)!=null?u:"10-20",(p=l==null?void 0:l.delay)!=null?p:"10-16",(m=l==null?void 0:l.applyTo)!=null?m:"ip")}toJson(){return{type:this.type,packet:this.packet,delay:this.delay,applyTo:this.applyTo}}}),In)),ee(mr,"BlackholeSettings",class mc extends Rt{constructor(i){super();ee(this,"type");this.type=i}static fromJson(i={}){var a;return new mc((a=i==null?void 0:i.response)==null?void 0:a.type)}toJson(){return{response:qr.isEmpty(this.type)?void 0:{type:this.type}}}}),ee(mr,"DNSSettings",class gc extends Rt{constructor(i="udp",a="",l=53,c="reject",u=[]){super();ee(this,"network");ee(this,"address");ee(this,"port");ee(this,"nonIPQuery");ee(this,"blockTypes");this.network=i!=null?i:"udp",this.address=a!=null?a:"",this.port=l!=null?l:53,this.nonIPQuery=c!=null?c:"reject",this.blockTypes=u!=null?u:[]}static fromJson(i={}){var a,l,c,u;return new gc((a=i==null?void 0:i.network)!=null?a:"udp",(l=i==null?void 0:i.address)!=null?l:"",(c=i==null?void 0:i.port)!=null?c:53,(u=i==null?void 0:i.nonIPQuery)!=null?u:"reject",Array.isArray(i==null?void 0:i.blockTypes)?i.blockTypes:[])}}),ee(mr,"VmessSettings",class extends Rt{constructor(i="",a=0,l="",c=""){super();ee(this,"address");ee(this,"port");ee(this,"id");ee(this,"security");this.address=i!=null?i:"",this.port=a!=null?a:0,this.id=l!=null?l:"",this.security=c!=null?c:""}static fromJson(i={}){var c,u,p,m;if(qr.isArrEmpty(i==null?void 0:i.vnext))return new st.VmessSettings;const a=i.vnext[0],l=Array.isArray(a==null?void 0:a.users)&&a.users[0]?a.users[0]:{};return new st.VmessSettings((c=a==null?void 0:a.address)!=null?c:"",(u=a==null?void 0:a.port)!=null?u:0,(p=l==null?void 0:l.id)!=null?p:"",(m=l==null?void 0:l.security)!=null?m:"")}toJson(){return{vnext:[{address:this.address,port:this.port,users:[{id:this.id,security:this.security}]}]}}}),ee(mr,"VLESSSettings",class extends Rt{constructor(i="",a=0,l="",c="",u=""){super();ee(this,"address");ee(this,"port");ee(this,"id");ee(this,"flow");ee(this,"encryption");this.address=i!=null?i:"",this.port=a!=null?a:0,this.id=l!=null?l:"",this.flow=c!=null?c:"",this.encryption=u!=null?u:""}static fromJson(i={}){var c,u,p,m,g;if(qr.isArrEmpty(i==null?void 0:i.vnext))return new st.VLESSSettings;const a=i.vnext[0],l=Array.isArray(a==null?void 0:a.users)&&a.users[0]?a.users[0]:{};return new st.VLESSSettings((c=a==null?void 0:a.address)!=null?c:"",(u=a==null?void 0:a.port)!=null?u:0,(p=l==null?void 0:l.id)!=null?p:"",(m=l==null?void 0:l.flow)!=null?m:"",(g=l==null?void 0:l.encryption)!=null?g:"")}toJson(){return{vnext:[{address:this.address,port:this.port,users:[{id:this.id,flow:this.flow,encryption:this.encryption}]}]}}}),ee(mr,"TrojanSettings",class extends Rt{constructor(i="",a=0,l=""){super();ee(this,"address");ee(this,"port");ee(this,"password");this.address=i!=null?i:"",this.port=a!=null?a:0,this.password=l!=null?l:""}static fromJson(i={}){var l,c,u;if(qr.isArrEmpty(i==null?void 0:i.servers))return new st.TrojanSettings;const a=i.servers[0];return new st.TrojanSettings((l=a==null?void 0:a.address)!=null?l:"",(c=a==null?void 0:a.port)!=null?c:0,(u=a==null?void 0:a.password)!=null?u:"")}toJson(){return{servers:[{address:this.address,port:this.port,password:this.password}]}}}),ee(mr,"ShadowsocksSettings",class extends Rt{constructor(i="",a=0,l="",c="",u,p){super();ee(this,"address");ee(this,"port");ee(this,"password");ee(this,"method");ee(this,"uot");ee(this,"UoTVersion");this.address=i!=null?i:"",this.port=a!=null?a:0,this.password=l!=null?l:"",this.method=c!=null?c:"",this.uot=u,this.UoTVersion=p}static fromJson(i={}){var c,u,p,m;let a=i==null?void 0:i.servers;qr.isArrEmpty(a)&&(a=[{}]);const l=a[0];return new st.ShadowsocksSettings((c=l==null?void 0:l.address)!=null?c:"",(u=l==null?void 0:l.port)!=null?u:0,(p=l==null?void 0:l.password)!=null?p:"",(m=l==null?void 0:l.method)!=null?m:"",l==null?void 0:l.uot,l==null?void 0:l.UoTVersion)}toJson(){return{servers:[{address:this.address,port:this.port,password:this.password,method:this.method,uot:this.uot,UoTVersion:this.UoTVersion}]}}}),ee(mr,"SocksSettings",class extends Rt{constructor(i="",a=0,l="",c=""){super();ee(this,"address");ee(this,"port");ee(this,"user");ee(this,"pass");this.address=i!=null?i:"",this.port=a!=null?a:0,this.user=l!=null?l:"",this.pass=c!=null?c:""}static fromJson(i={}){var u,p,m,g;let a=i==null?void 0:i.servers;qr.isArrEmpty(a)&&(a=[{users:[{}]}]);const l=a[0],c=Array.isArray(l==null?void 0:l.users)&&l.users[0]?l.users[0]:{};return new st.SocksSettings((u=l==null?void 0:l.address)!=null?u:"",(p=l==null?void 0:l.port)!=null?p:0,(m=c==null?void 0:c.user)!=null?m:"",(g=c==null?void 0:c.pass)!=null?g:"")}toJson(){return{servers:[{address:this.address,port:this.port,users:qr.isEmpty(this.user)?[]:[{user:this.user,pass:this.pass}]}]}}}),ee(mr,"HttpSettings",class extends Rt{constructor(i="",a=0,l="",c=""){super();ee(this,"address");ee(this,"port");ee(this,"user");ee(this,"pass");this.address=i!=null?i:"",this.port=a!=null?a:0,this.user=l!=null?l:"",this.pass=c!=null?c:""}static fromJson(i={}){var u,p,m,g;let a=i==null?void 0:i.servers;qr.isArrEmpty(a)&&(a=[{users:[{}]}]);const l=a[0],c=Array.isArray(l==null?void 0:l.users)&&l.users[0]?l.users[0]:{};return new st.HttpSettings((u=l==null?void 0:l.address)!=null?u:"",(p=l==null?void 0:l.port)!=null?p:0,(m=c==null?void 0:c.user)!=null?m:"",(g=c==null?void 0:c.pass)!=null?g:"")}toJson(){return{servers:[{address:this.address,port:this.port,users:qr.isEmpty(this.user)?[]:[{user:this.user,pass:this.pass}]}]}}}),ee(mr,"WireguardSettings",(nn=class extends Rt{constructor(i=1420,a="",l=[""],c=2,u="",p="",m=[new nn.Peer],g=!1){super();ee(this,"mtu");ee(this,"secretKey");ee(this,"pubKey");ee(this,"address");ee(this,"workers");ee(this,"domainStrategy");ee(this,"reserved");ee(this,"peers");ee(this,"noKernelTun");this.mtu=i!=null?i:1420,this.secretKey=a!=null?a:"",this.pubKey=this.secretKey.length>0?jp(this.secretKey):"",this.address=Array.isArray(l)?l.join(","):l!=null?l:"",this.workers=c!=null?c:2,this.domainStrategy=u!=null?u:"",this.reserved=Array.isArray(p)?p.join(","):p!=null?p:"",this.peers=m!=null?m:[new nn.Peer],this.noKernelTun=Boolean(g)}addPeer(){this.peers.push(new nn.Peer)}delPeer(i){this.peers.splice(i,1)}static fromJson(i={}){var a,l,c,u,p,m,g;return new nn((a=i==null?void 0:i.mtu)!=null?a:1420,(l=i==null?void 0:i.secretKey)!=null?l:"",(c=i==null?void 0:i.address)!=null?c:[""],(u=i==null?void 0:i.workers)!=null?u:2,(p=i==null?void 0:i.domainStrategy)!=null?p:"",(m=i==null?void 0:i.reserved)!=null?m:"",Array.isArray(i==null?void 0:i.peers)?i.peers.map(S=>nn.Peer.fromJson(S)):[new nn.Peer],(g=i==null?void 0:i.noKernelTun)!=null?g:!1)}toJson(){return{mtu:this.mtu||void 0,secretKey:this.secretKey,address:this.address?this.address.split(","):[],workers:this.workers||void 0,domainStrategy:rm.includes(this.domainStrategy)?this.domainStrategy:void 0,reserved:this.reserved?this.reserved.split(",").map(i=>Number(i)).filter(i=>!Number.isNaN(i)):void 0,peers:Rt.toJsonArray(this.peers),noKernelTun:this.noKernelTun}}},ee(nn,"Peer",class extends Rt{constructor(l="",c="",u=["0.0.0.0/0","::/0"],p="",m=0){super();ee(this,"publicKey");ee(this,"psk");ee(this,"allowedIPs");ee(this,"endpoint");ee(this,"keepAlive");this.publicKey=l!=null?l:"",this.psk=c!=null?c:"",this.allowedIPs=u!=null?u:["0.0.0.0/0","::/0"],this.endpoint=p!=null?p:"",this.keepAlive=m!=null?m:0}static fromJson(l={}){var c,u,p,m;return new st.WireguardSettings.Peer((c=l==null?void 0:l.publicKey)!=null?c:"",(u=l==null?void 0:l.preSharedKey)!=null?u:"",Array.isArray(l==null?void 0:l.allowedIPs)?l.allowedIPs:["0.0.0.0/0","::/0"],(p=l==null?void 0:l.endpoint)!=null?p:"",(m=l==null?void 0:l.keepAlive)!=null?m:0)}toJson(){var l;return{publicKey:this.publicKey,preSharedKey:this.psk.length>0?this.psk:void 0,allowedIPs:(l=this.allowedIPs)!=null&&l.length?this.allowedIPs:void 0,endpoint:this.endpoint,keepAlive:this.keepAlive||void 0}}}),nn));class ss{static sizeFormat(s){if(s<=0||Number.isNaN(s))return"0 B";const r=["B","KB","MB","GB","TB","PB"];let o=0,i=s;for(;i>=1024&&o<r.length-1;)i/=1024,o++;return`${i.toFixed(2)} ${r[o]}`}}const nm=[{value:"http",label:"HTTP"},{value:"tls",label:"TLS"},{value:"quic",label:"QUIC"},{value:"fakedns",label:"FakeDNS"}];Object.values(tm);const sm=Object.values(em),Za=["vmess","vless","trojan","shadowsocks","http","socks"],im=["tcp","ws","grpc","kcp","quic","httpupgrade","splithttp","xhttp"],am=["none","tls","reality"],xa=t=>t.split(/[\n,]/).map(s=>s.trim()).filter(Boolean),va=t=>t&&t.length?t.join(`
`):"",Ss=t=>typeof t=="number"&&Number.isFinite(t)?String(t):typeof t=="string"?t:"",fc=()=>({acceptProxyProtocol:!1,tcpFastOpen:!1,mark:"",tproxy:"off",tcpMptcp:!1,penetrate:!1,domainStrategy:"",tcpMaxSeg:"",dialerProxy:"",tcpKeepAliveInterval:"",tcpKeepAliveIdle:"",tcpUserTimeout:"",tcpcongestion:"",V6Only:!1,tcpWindowClamp:"",interfaceName:""}),om=t=>{if(!t)return 0;const s=Number(t);return!Number.isNaN(s)&&s>0?s:t.trim()},Nr=t=>(Object.keys(t).forEach(s=>{const r=t[s];(r==null||typeof r=="string"&&r.trim()===""||Array.isArray(r)&&r.length===0)&&delete t[s]}),t),Fo=()=>({user:"",pass:""}),Na=()=>({name:"",value:""}),Ho=t=>{var s,r;return{user:(s=t==null?void 0:t.user)!=null?s:"",pass:(r=t==null?void 0:t.pass)!=null?r:""}},Bo=t=>{var s,r;return Nr({user:(s=t.user)==null?void 0:s.trim(),pass:(r=t.pass)==null?void 0:r.trim()})},rs=t=>{if(t===""||t===null||typeof t>"u")return;const s=Number(t);return Number.isFinite(s)?s:void 0},lm=t=>{if(!t.sockoptEnabled)return;const s=t.sockopt,r={acceptProxyProtocol:s.acceptProxyProtocol,tcpFastOpen:s.tcpFastOpen,mark:rs(s.mark),tproxy:s.tproxy||void 0,tcpMptcp:s.tcpMptcp,penetrate:s.penetrate,domainStrategy:s.domainStrategy||void 0,tcpMaxSeg:rs(s.tcpMaxSeg),dialerProxy:s.dialerProxy||void 0,tcpKeepAliveInterval:rs(s.tcpKeepAliveInterval),tcpKeepAliveIdle:rs(s.tcpKeepAliveIdle),tcpUserTimeout:rs(s.tcpUserTimeout),tcpcongestion:s.tcpcongestion||void 0,V6Only:s.V6Only,tcpWindowClamp:rs(s.tcpWindowClamp),interface:s.interfaceName||void 0};return Nr(r)},Ra=(t="vless")=>({tag:"",listen:"",port:"",protocol:t,disableInsecureEncryption:!0,vlessDecryption:"none",vlessEncryption:"",fallbacks:[],shadowsocksNetwork:"tcp,udp",sniffingEnabled:!0,sniffingDestinations:["http","tls"],sniffingRouteOnly:!1,sniffingMetadataOnly:!1,streamNetwork:"tcp",streamSecurity:"tls",tlsServerName:"",tlsAlpn:[],tlsAllowInsecure:!1,tlsFingerprint:"",tlsRawSettings:{},realityPrivateKey:"",realityServerNames:"",realityShortIds:"",realityDest:"",realitySpiderX:"",realityXver:"0",wsPath:"/",wsHost:"",tcpHeaderType:"none",tcpHttpHosts:"",tcpHttpPath:"/",grpcServiceName:"",grpcAuthority:"",grpcMultiMode:!1,kcpHeaderType:"none",kcpSeed:"",quicSecurity:"",quicKey:"",quicHeaderType:"none",httpupgradePath:"/",httpupgradeHost:"",splithttpPath:"/",splithttpHost:"",xhttpHost:"",xhttpPath:"/",xhttpHeaders:[Na()],xhttpMode:"auto",xhttpScMaxBufferedPosts:"30",xhttpScMaxEachPostBytes:"1000000",xhttpScStreamUpServerSecs:"20-80",xhttpPaddingBytes:"100-1000",xhttpNoSSEHeader:!1,vlessSelectedAuth:"",sockoptEnabled:!1,sockopt:fc(),httpAccounts:[Fo()],httpAllowTransparent:!1,socksAuth:"noauth",socksAccounts:[Fo()],socksUdpEnabled:!1,socksUdpIp:""}),cm=t=>{var s,r,o,i,a,l,c;return{dest:(r=(s=t==null?void 0:t.dest)==null?void 0:s.toString())!=null?r:"",path:(o=t==null?void 0:t.path)!=null?o:"",type:(i=t==null?void 0:t.type)!=null?i:"",alpn:Array.isArray(t==null?void 0:t.alpn)?t.alpn.join(","):(a=t==null?void 0:t.alpn)!=null?a:"",xver:(c=(l=t==null?void 0:t.xver)==null?void 0:l.toString())!=null?c:""}},Vo=t=>{var r,o,i;const s={dest:(r=t.dest)==null?void 0:r.trim(),path:(o=t.path)==null?void 0:o.trim(),type:(i=t.type)==null?void 0:i.trim(),xver:t.xver?Number(t.xver):void 0};return t.alpn&&(s.alpn=t.alpn.split(",").map(a=>a.trim()).filter(Boolean)),Nr(s)},dm=t=>{var p,m,g,S,y,A,f,D,F,Z,ae,v,M,T,Q,_e,ke,W,oe,R,le,w,H,ce,j,fe,Ae,Pe,Te,J,Ce,$,X,_,P,Y,te,ie,q,B,ue,be,Ie,N,E,G,he,Re,tt,je,we,Fe,Ye,ot,ut,yt,re,ze,Ne,wt,ct,V,lt,_t,zt,Ge,Ue,St,Vt,dr,ir,Zt,ar,ne,z,k,Se,et,Nt,Ft,Ht,gt,ht,Ut,ur,Hr,Jr,hr;const s=Za.includes(t.protocol)?t.protocol:"vless",r=Ra(s),o=(p=t.settings)!=null?p:{},i=(m=t.sniffing)!=null?m:{},a=(g=t.streamSettings)!=null?g:{},l=(S=a.tlsSettings)!=null?S:{},c=a.tlsSettings!==void 0&&a.tlsSettings!==null?JSON.parse(JSON.stringify(a.tlsSettings)):{},u=(y=a.realitySettings)!=null?y:{};return{...r,tag:(A=t.tag)!=null?A:"",listen:(f=t.listen)!=null?f:"",port:(F=(D=t.port)==null?void 0:D.toString())!=null?F:"",disableInsecureEncryption:Boolean((Z=o.disableInsecureEncryption)!=null?Z:r.disableInsecureEncryption),vlessDecryption:(ae=o.decryption)!=null?ae:r.vlessDecryption,vlessEncryption:(v=o.encryption)!=null?v:r.vlessEncryption,fallbacks:Array.isArray(o.fallbacks)?o.fallbacks.map(xt=>cm(xt)):r.fallbacks,shadowsocksNetwork:(M=o.network)!=null?M:r.shadowsocksNetwork,sniffingEnabled:Boolean((T=i.enabled)!=null?T:r.sniffingEnabled),sniffingDestinations:Array.isArray(i.destOverride)&&i.destOverride.length?i.destOverride:r.sniffingDestinations,sniffingRouteOnly:Boolean((Q=i.routeOnly)!=null?Q:r.sniffingRouteOnly),sniffingMetadataOnly:Boolean((_e=i.metadataOnly)!=null?_e:r.sniffingMetadataOnly),streamNetwork:(ke=a.network)!=null?ke:r.streamNetwork,streamSecurity:(W=a.security)!=null?W:r.streamSecurity,tlsServerName:(oe=l.serverName)!=null?oe:r.tlsServerName,tlsAlpn:Array.isArray(l.alpn)?l.alpn:r.tlsAlpn,tlsAllowInsecure:Boolean((R=l.allowInsecure)!=null?R:r.tlsAllowInsecure),tlsFingerprint:(le=l.fingerprint)!=null?le:r.tlsFingerprint,tlsRawSettings:c,realityPrivateKey:(w=u.privateKey)!=null?w:r.realityPrivateKey,realityServerNames:va(u.serverNames),realityShortIds:va(u.shortIds),realityDest:(H=u.dest)!=null?H:r.realityDest,realitySpiderX:(ce=u.spiderX)!=null?ce:r.realitySpiderX,realityXver:(fe=(j=u.xver)==null?void 0:j.toString())!=null?fe:r.realityXver,wsPath:(Pe=(Ae=a==null?void 0:a.wsSettings)==null?void 0:Ae.path)!=null?Pe:r.wsPath,wsHost:(Ce=(J=(Te=a==null?void 0:a.wsSettings)==null?void 0:Te.headers)==null?void 0:J.Host)!=null?Ce:r.wsHost,tcpHeaderType:(_=(X=($=a==null?void 0:a.tcpSettings)==null?void 0:$.header)==null?void 0:X.type)!=null?_:r.tcpHeaderType,tcpHttpHosts:va((ie=(te=(Y=(P=a==null?void 0:a.tcpSettings)==null?void 0:P.header)==null?void 0:Y.request)==null?void 0:te.headers)==null?void 0:ie.Host),tcpHttpPath:Array.isArray((ue=(B=(q=a==null?void 0:a.tcpSettings)==null?void 0:q.header)==null?void 0:B.request)==null?void 0:ue.path)?a.tcpSettings.header.request.path[0]:r.tcpHttpPath,grpcServiceName:(Ie=(be=a==null?void 0:a.grpcSettings)==null?void 0:be.serviceName)!=null?Ie:r.grpcServiceName,grpcAuthority:(E=(N=a==null?void 0:a.grpcSettings)==null?void 0:N.authority)!=null?E:r.grpcAuthority,grpcMultiMode:Boolean((he=(G=a==null?void 0:a.grpcSettings)==null?void 0:G.multiMode)!=null?he:r.grpcMultiMode),kcpHeaderType:(je=(tt=(Re=a==null?void 0:a.kcpSettings)==null?void 0:Re.header)==null?void 0:tt.type)!=null?je:r.kcpHeaderType,kcpSeed:(Fe=(we=a==null?void 0:a.kcpSettings)==null?void 0:we.seed)!=null?Fe:r.kcpSeed,quicSecurity:(ot=(Ye=a==null?void 0:a.quicSettings)==null?void 0:Ye.security)!=null?ot:r.quicSecurity,quicKey:(yt=(ut=a==null?void 0:a.quicSettings)==null?void 0:ut.key)!=null?yt:r.quicKey,quicHeaderType:(Ne=(ze=(re=a==null?void 0:a.quicSettings)==null?void 0:re.header)==null?void 0:ze.type)!=null?Ne:r.quicHeaderType,httpupgradePath:(ct=(wt=a==null?void 0:a.httpupgradeSettings)==null?void 0:wt.path)!=null?ct:r.httpupgradePath,httpupgradeHost:(lt=(V=a==null?void 0:a.httpupgradeSettings)==null?void 0:V.host)!=null?lt:r.httpupgradeHost,splithttpPath:(zt=(_t=a==null?void 0:a.splithttpSettings)==null?void 0:_t.path)!=null?zt:r.splithttpPath,splithttpHost:(Ue=(Ge=a==null?void 0:a.splithttpSettings)==null?void 0:Ge.host)!=null?Ue:r.splithttpHost,xhttpHost:(Vt=(St=a==null?void 0:a.xhttpSettings)==null?void 0:St.host)!=null?Vt:r.xhttpHost,xhttpPath:(ir=(dr=a==null?void 0:a.xhttpSettings)==null?void 0:dr.path)!=null?ir:r.xhttpPath,xhttpHeaders:(Zt=a==null?void 0:a.xhttpSettings)!=null&&Zt.headers?mm(a.xhttpSettings.headers):r.xhttpHeaders,xhttpMode:(ne=(ar=a==null?void 0:a.xhttpSettings)==null?void 0:ar.mode)!=null?ne:r.xhttpMode,xhttpScMaxBufferedPosts:(Se=(k=(z=a==null?void 0:a.xhttpSettings)==null?void 0:z.scMaxBufferedPosts)==null?void 0:k.toString())!=null?Se:r.xhttpScMaxBufferedPosts,xhttpScMaxEachPostBytes:(Ft=(Nt=(et=a==null?void 0:a.xhttpSettings)==null?void 0:et.scMaxEachPostBytes)==null?void 0:Nt.toString())!=null?Ft:r.xhttpScMaxEachPostBytes,xhttpScStreamUpServerSecs:(ht=(gt=(Ht=a==null?void 0:a.xhttpSettings)==null?void 0:Ht.scStreamUpServerSecs)==null?void 0:gt.toString())!=null?ht:r.xhttpScStreamUpServerSecs,xhttpPaddingBytes:(ur=(Ut=a==null?void 0:a.xhttpSettings)==null?void 0:Ut.xPaddingBytes)!=null?ur:r.xhttpPaddingBytes,xhttpNoSSEHeader:Boolean((Jr=(Hr=a==null?void 0:a.xhttpSettings)==null?void 0:Hr.noSSEHeader)!=null?Jr:r.xhttpNoSSEHeader),vlessSelectedAuth:(hr=o.selectedAuth)!=null?hr:r.vlessSelectedAuth,sockoptEnabled:Boolean(a==null?void 0:a.sockopt),sockopt:(()=>{var We,Je,ft,Mt,Qt,yr;const xt=fc(),K=(We=a==null?void 0:a.sockopt)!=null?We:{};return xt.acceptProxyProtocol=Boolean(K.acceptProxyProtocol),xt.tcpFastOpen=Boolean(K.tcpFastOpen),xt.mark=Ss(K.mark),xt.tproxy=(Je=K.tproxy)!=null?Je:xt.tproxy,xt.tcpMptcp=Boolean(K.tcpMptcp),xt.penetrate=Boolean(K.penetrate),xt.domainStrategy=(ft=K.domainStrategy)!=null?ft:xt.domainStrategy,xt.tcpMaxSeg=Ss(K.tcpMaxSeg),xt.dialerProxy=(Mt=K.dialerProxy)!=null?Mt:xt.dialerProxy,xt.tcpKeepAliveInterval=Ss(K.tcpKeepAliveInterval),xt.tcpKeepAliveIdle=Ss(K.tcpKeepAliveIdle),xt.tcpUserTimeout=Ss(K.tcpUserTimeout),xt.tcpcongestion=(Qt=K.tcpcongestion)!=null?Qt:xt.tcpcongestion,xt.V6Only=Boolean(K.V6Only),xt.tcpWindowClamp=Ss(K.tcpWindowClamp),xt.interfaceName=(yr=K.interface)!=null?yr:xt.interfaceName,xt})(),httpAccounts:s==="http"&&Array.isArray(o.accounts)?o.accounts.map(xt=>Ho(xt)):r.httpAccounts,httpAllowTransparent:s==="http"&&typeof o.allowTransparent=="boolean"?o.allowTransparent:r.httpAllowTransparent,socksAuth:s==="socks"&&o.auth==="password"?"password":r.socksAuth,socksAccounts:s==="socks"&&Array.isArray(o.accounts)?o.accounts.map(xt=>Ho(xt)):r.socksAccounts,socksUdpEnabled:s==="socks"&&typeof o.udp=="boolean"?o.udp:r.socksUdpEnabled,socksUdpIp:s==="socks"&&o.ip!==void 0&&o.ip!==null?String(o.ip):r.socksUdpIp}},um=t=>{var o,i,a,l;const s={network:t.streamNetwork,security:t.streamSecurity};if(t.streamNetwork==="ws"&&(s.wsSettings=Nr({path:t.wsPath||void 0,headers:t.wsHost?{Host:t.wsHost}:void 0})),t.streamNetwork==="tcp"&&(t.tcpHeaderType==="http"?s.tcpSettings={header:{type:"http",request:{path:t.tcpHttpPath?[t.tcpHttpPath]:[],headers:t.tcpHttpHosts?{Host:xa(t.tcpHttpHosts)}:{}}}}:s.tcpSettings={header:{type:"none"}}),t.streamNetwork==="grpc"&&(s.grpcSettings=Nr({serviceName:t.grpcServiceName,authority:t.grpcAuthority,multiMode:t.grpcMultiMode})),t.streamNetwork==="kcp"&&(s.kcpSettings=Nr({header:{type:t.kcpHeaderType},seed:t.kcpSeed})),t.streamNetwork==="quic"&&(s.quicSettings=Nr({security:t.quicSecurity,key:t.quicKey,header:{type:t.quicHeaderType}})),t.streamNetwork==="httpupgrade"&&(s.httpupgradeSettings=Nr({path:t.httpupgradePath,host:t.httpupgradeHost})),t.streamNetwork==="splithttp"&&(s.splithttpSettings=Nr({path:t.splithttpPath,host:t.splithttpHost})),t.streamNetwork==="xhttp"&&(s.xhttpSettings=Nr({path:t.xhttpPath,host:t.xhttpHost,headers:gm(t.xhttpHeaders),mode:t.xhttpMode,scMaxBufferedPosts:rs(t.xhttpScMaxBufferedPosts),scMaxEachPostBytes:((o=t.xhttpScMaxEachPostBytes)==null?void 0:o.trim())||void 0,scStreamUpServerSecs:((i=t.xhttpScStreamUpServerSecs)==null?void 0:i.trim())||void 0,xPaddingBytes:((a=t.xhttpPaddingBytes)==null?void 0:a.trim())||void 0,noSSEHeader:t.xhttpNoSSEHeader||void 0})),t.streamSecurity==="tls"){const c=t.tlsRawSettings&&typeof t.tlsRawSettings=="object"?{...t.tlsRawSettings}:{};c.serverName=t.tlsServerName||void 0,c.alpn=(l=t.tlsAlpn)!=null&&l.length?t.tlsAlpn:void 0,c.allowInsecure=t.tlsAllowInsecure,c.fingerprint=t.tlsFingerprint||void 0,s.tlsSettings=Nr(c)}t.streamSecurity==="reality"&&(s.realitySettings=Nr({privateKey:t.realityPrivateKey||void 0,serverNames:xa(t.realityServerNames),shortIds:xa(t.realityShortIds),dest:t.realityDest||void 0,spiderX:t.realitySpiderX||void 0,xver:t.realityXver?Number(t.realityXver):void 0}));const r=lm(t);return r&&(s.sockopt=r),Nr(s)},hm=t=>{const s={};switch(["vmess","vless","trojan","shadowsocks"].includes(t.protocol)&&(s.clients=[]),t.protocol){case"vmess":s.disableInsecureEncryption=t.disableInsecureEncryption;break;case"vless":s.decryption=t.vlessDecryption||"none",t.vlessEncryption&&(s.encryption=t.vlessEncryption),t.vlessSelectedAuth&&(s.selectedAuth=t.vlessSelectedAuth),t.fallbacks.length&&(s.fallbacks=t.fallbacks.map(Vo).filter(r=>Object.keys(r).length));break;case"trojan":t.fallbacks.length&&(s.fallbacks=t.fallbacks.map(Vo).filter(r=>Object.keys(r).length));break;case"shadowsocks":s.network=t.shadowsocksNetwork||"tcp,udp";break;case"http":{const r=t.httpAccounts.map(Bo).filter(o=>Object.keys(o).length);r.length&&(s.accounts=r),t.httpAllowTransparent&&(s.allowTransparent=!0);break}case"socks":{if(s.auth=t.socksAuth,t.socksAuth==="password"){const r=t.socksAccounts.map(Bo).filter(o=>Object.keys(o).length);r.length&&(s.accounts=r)}s.udp=t.socksUdpEnabled,t.socksUdpEnabled&&t.socksUdpIp.trim()&&(s.ip=t.socksUdpIp.trim());break}}return s},pm=t=>{const r=t.protocol!=="http"&&t.protocol!=="socks"?um(t):void 0,o={tag:t.tag.trim(),listen:t.listen.trim()||void 0,port:om(t.port),protocol:t.protocol,settings:hm(t)};return r&&(o.streamSettings=r),t.sniffingEnabled?o.sniffing=Nr({enabled:!0,destOverride:t.sniffingDestinations,routeOnly:t.sniffingRouteOnly,metadataOnly:t.sniffingMetadataOnly}):o.sniffing={enabled:!1},o},mm=t=>{if(!t)return[Na()];const s=[];return Object.entries(t).forEach(([r,o])=>{var i;Array.isArray(o)?o.forEach(a=>{var l;return s.push({name:r,value:(l=a==null?void 0:a.toString())!=null?l:""})}):s.push({name:r,value:(i=o==null?void 0:o.toString())!=null?i:""})}),s.length?s:[Na()]},gm=t=>{const s={};return t.forEach(({name:r,value:o})=>{const i=r==null?void 0:r.trim(),a=o==null?void 0:o.trim();!i||!a||(s[i]=a)}),Object.keys(s).length?s:void 0};class La{static gf(s){const r=new Float64Array(16);if(s)for(let o=0;o<s.length;++o)r[o]=s[o];return r}static pack(s,r){let o;const i=this.gf(),a=this.gf();for(let l=0;l<16;++l)a[l]=r[l];this.carry(a),this.carry(a),this.carry(a);for(let l=0;l<2;++l){i[0]=a[0]-65517;for(let c=1;c<15;++c)i[c]=a[c]-65535-(i[c-1]>>16&1),i[c-1]&=65535;i[15]=a[15]-32767-(i[14]>>16&1),o=i[15]>>16&1,i[14]&=65535,this.cswap(a,i,1-o)}for(let l=0;l<16;++l)s[2*l]=a[l]&255,s[2*l+1]=a[l]>>8}static carry(s){for(let r=0;r<16;++r)s[(r+1)%16]+=(r<15?1:38)*Math.floor(s[r]/65536),s[r]&=65535}static cswap(s,r,o){const i=~(o-1);for(let a=0;a<16;++a){const l=i&(s[a]^r[a]);s[a]^=l,r[a]^=l}}static add(s,r,o){for(let i=0;i<16;++i)s[i]=r[i]+o[i]|0}static subtract(s,r,o){for(let i=0;i<16;++i)s[i]=r[i]-o[i]|0}static multmod(s,r,o){const i=new Float64Array(31);for(let a=0;a<16;++a)for(let l=0;l<16;++l)i[a+l]+=r[a]*o[l];for(let a=0;a<15;++a)i[a]+=38*i[a+16];for(let a=0;a<16;++a)s[a]=i[a];this.carry(s),this.carry(s)}static invert(s,r){const o=this.gf();for(let i=0;i<16;++i)o[i]=r[i];for(let i=253;i>=0;--i)this.multmod(o,o,o),i!==2&&i!==4&&this.multmod(o,o,r);for(let i=0;i<16;++i)s[i]=o[i]}static clamp(s){s[31]=s[31]&127|64,s[0]&=248}static generatePublicKey(s){let r;const o=new Uint8Array(32),i=this.gf([1]),a=this.gf([9]),l=this.gf(),c=this.gf([1]),u=this.gf(),p=this.gf(),m=this.gf([56129,1]),g=this.gf([9]);for(let S=0;S<32;++S)o[S]=s[S];this.clamp(o);for(let S=254;S>=0;--S)r=o[S>>>3]>>>(S&7)&1,this.cswap(i,a,r),this.cswap(l,c,r),this.add(u,i,l),this.subtract(i,i,l),this.add(l,a,c),this.subtract(a,a,c),this.multmod(c,u,u),this.multmod(p,i,i),this.multmod(i,l,i),this.multmod(l,a,u),this.add(u,i,l),this.subtract(i,i,l),this.multmod(a,i,i),this.subtract(l,c,p),this.multmod(i,l,m),this.add(i,i,c),this.multmod(l,l,i),this.multmod(i,c,p),this.multmod(c,a,g),this.multmod(a,u,u),this.cswap(i,a,r),this.cswap(l,c,r);return this.invert(l,l),this.multmod(i,i,l),this.pack(o,i),o}static generatePresharedKey(){const s=new Uint8Array(32),r=globalThis==null?void 0:globalThis.crypto;if(!(r!=null&&r.getRandomValues))throw new Error("Crypto.getRandomValues is not available in this environment.");return r.getRandomValues(s),s}static generatePrivateKey(){const s=this.generatePresharedKey();return this.clamp(s),s}static encodeBase64(s,r){const o=Uint8Array.from([r[0]>>2&63,(r[0]<<4|r[1]>>4)&63,(r[1]<<2|r[2]>>6)&63,r[2]&63]);for(let i=0;i<4;++i)s[i]=o[i]+65+(25-o[i]>>8&6)-(51-o[i]>>8&75)-(61-o[i]>>8&15)+(62-o[i]>>8&3)}static keyToBase64(s){let r;const o=new Uint8Array(44);for(r=0;r<32/3;++r)this.encodeBase64(o.subarray(r*4),s.subarray(r*3));return this.encodeBase64(o.subarray(r*4),Uint8Array.from([s[r*3+0],s[r*3+1],0])),o[43]=61,Array.from(o).map(i=>String.fromCharCode(i)).join("")}static keyFromBase64(s){const r=globalThis.atob(s),o=new Uint8Array(r.length);for(let i=0;i<r.length;i++)o[i]=r.charCodeAt(i);return o}static generateKeypair(s=""){const r=s.length>0?this.keyFromBase64(s):this.generatePrivateKey(),o=this.generatePublicKey(r);return{publicKey:this.keyToBase64(o),privateKey:s.length>0?s:this.keyToBase64(r)}}}const Ma=t=>La.generateKeypair(t!=null?t:""),fm=()=>{const t=globalThis;t.Wireguard||(t.Wireguard={generateKeypair:La.generateKeypair.bind(La)})},bm=async()=>Ee("/xray/vlessenc"),ym=async()=>Ee("/xray/reality-keypair"),Sm=async()=>Ee("/xray/reality-shortid"),at=d.exports.forwardRef((t,s)=>e(De,{size:"sm",ref:s,...t}));at.displayName="InboundFormInput";const ns=d.exports.forwardRef((t,s)=>e(Ze,{size:"sm",ref:s,...t}));ns.displayName="InboundFormSelect";const li=d.exports.forwardRef((t,s)=>e(Rr,{size:"sm",resize:"vertical",ref:s,...t}));li.displayName="InboundFormTextarea";const $o=t=>(t!=null?t:"").replace(/\s+/g,"").replace(/=+$/,""),xm=t=>{const s=(t!=null?t:"").replace(/\s+/g,"").replace(/-/g,"+").replace(/_/g,"/");if(!s)return"";const r=s.length%4;return r===0?s:`${s}${"=".repeat(4-r)}`},vm=["AsIs","UseIP","UseIPv6v4","UseIPv6","UseIPv4v6","UseIPv4","ForceIP","ForceIPv6v4","ForceIPv6","ForceIPv4v6","ForceIPv4"],wm=["bbr","cubic","reno"],km=["off","redirect","tproxy"],Cm=["auto","packet-up","stream-up","stream-one"],_m=({isOpen:t,mode:s,initialValue:r,isSubmitting:o,existingInbounds:i,onClose:a,onSubmit:l})=>{var ir,Zt,ar,ne;const{t:c}=qe(),u=sr(),[p,m]=d.exports.useState([]),[g,S]=d.exports.useState(!1),y=en({defaultValues:Ra()}),{control:A,register:f,handleSubmit:D,reset:F,watch:Z}=y,[ae,v]=d.exports.useState(!1),[M,T]=d.exports.useState(null),[Q,_e]=d.exports.useState(null),[ke,W]=d.exports.useState(null),[oe,R]=d.exports.useState(!1),{fields:le,append:w,remove:H}=ks({control:A,name:"fallbacks"}),{fields:ce,append:j,remove:fe}=ks({control:A,name:"httpAccounts"}),{fields:Ae,append:Pe,remove:Te}=ks({control:A,name:"socksAccounts"}),{fields:J,append:Ce,remove:$}=ks({control:A,name:"xhttpHeaders"}),X=er({control:A,name:"protocol"})||Z("protocol"),_=er({control:A,name:"streamNetwork"})||Z("streamNetwork"),P=er({control:A,name:"streamSecurity"})||Z("streamSecurity"),Y=(ir=er({control:A,name:"sniffingEnabled"}))!=null?ir:Z("sniffingEnabled"),te=er({control:A,name:"realityPrivateKey"})||Z("realityPrivateKey"),ie=er({control:A,name:"tcpHeaderType"})||Z("tcpHeaderType"),q=(Zt=er({control:A,name:"sockoptEnabled"}))!=null?Zt:!1,B=er({control:A,name:"vlessSelectedAuth"})||"",ue=er({control:A,name:"socksAuth"})||Z("socksAuth")||"noauth",be=(ne=(ar=er({control:A,name:"socksUdpEnabled"}))!=null?ar:Z("socksUdpEnabled"))!=null?ne:!1,Ie=er({control:A,name:"xhttpMode"})||Z("xhttpMode")||"auto",N=er({control:A,name:"tag"})||Z("tag")||"",E=er({control:A,name:"port"})||Z("port")||"",G=X!=="http"&&X!=="socks",he=Le("yellow.50","yellow.900"),Re=Le("yellow.400","yellow.500"),tt=Boolean(Q||ke),je=d.exports.useMemo(()=>["X25519, not Post-Quantum","ML-KEM-768, Post-Quantum"],[]),we=d.exports.useMemo(()=>{const z=[...je,...p.map(Se=>Se.label)].filter(Boolean);return Array.from(new Set(z)).map(Se=>({label:Se,value:Se}))},[je,p]);d.exports.useEffect(()=>{if(t)if(r){const z=dm(r);F(z),v(!0),R(!1)}else F(Ra()),v(!1),T(null),R(!1)},[r,F,t]);const Fe=d.exports.useMemo(()=>new Set([21,22,23,25,53,67,68,110,111,123,137,143,161,162,993]),[]),Ye=d.exports.useCallback((z,k,Se)=>{const et=Se==null?void 0:Se.toString().trim(),Nt=[z||"inbound",k||"net"];return et&&Nt.push(et),Nt.join("+")},[]),ot=d.exports.useCallback(()=>{let z=0;for(let k=0;k<10;k+=1){const Se=Math.floor(Math.random()*9e3)+1e3;if(!Fe.has(Se)){z=Se;break}}return z||(z=4443),y.setValue("port",z.toString(),{shouldDirty:!0}),z.toString()},[Fe,y]);d.exports.useEffect(()=>{if(s!=="create"||r||!t||oe)return;const k=y.getValues("port")||ot(),Se=Ye(X,_,k);y.setValue("port",k,{shouldDirty:!0}),y.setValue("tag",Se,{shouldDirty:!0}),_e(null),W(null),R(!0)},[s,r,t,oe,X,_,Ye,ot,y]),d.exports.useEffect(()=>{if(s==="create"&&!ae){const z=Ye(X,_,E);y.setValue("tag",z,{shouldDirty:!0})}},[s,ae,Ye,X,_,E,y]),d.exports.useEffect(()=>{if(!E){T(null);return}const z=Number(E);Number.isFinite(z)&&Fe.has(z)?T(c("inbounds.portWarningBlocked","This port is commonly blocked by servers/firewalls. Better to avoid it.")):T(null)},[Fe,E,c]),d.exports.useEffect(()=>{const z=(N||"").trim();if(s==="edit"){_e(null),W(null);return}z&&i.some(k=>(k.tag||"").trim().toLowerCase()===z.toLowerCase())?_e(c("inbounds.error.tagExists","Inbound tag already exists")):_e(null),E&&i.some(k=>{var Se;return((Se=k.port)==null?void 0:Se.toString())===E})?W(c("inbounds.error.portExists","Inbound port already exists")):W(null)},[i,s,E,N,c]);const ut=d.exports.useCallback((z,k)=>n(x,{children:[e(I,{children:k}),e(kt,{control:A,name:`sockopt.${z}`,render:({field:Se})=>{const et=typeof Se.value=="number"||typeof Se.value=="string"?Se.value:void 0;return e(vn,{min:0,value:et!=null?et:"",onChange:Nt=>Se.onChange(Nt),children:e(xn,{})})}})]}),[A]),yt=d.exports.useCallback((z,k)=>n(x,{display:"flex",alignItems:"center",children:[e(I,{mb:0,children:k}),e(kt,{control:A,name:`sockopt.${z}`,render:({field:Se})=>e(vt,{isChecked:typeof Se.value=="boolean"?Se.value:Boolean(Se.value),onChange:et=>Se.onChange(et.target.checked)})})]}),[A]),re=d.exports.useCallback((z,k,Se)=>n(x,{children:[e(I,{children:k}),e(at,{...f(`sockopt.${z}`),placeholder:Se})]}),[f]),ze=X==="vless"||X==="trojan",Ne=Le("gray.200","gray.700"),wt=async z=>{await l(z)},ct=d.exports.useCallback(async()=>{try{const{privateKey:z,publicKey:k}=await ym();y.setValue("realityPrivateKey",$o(z),{shouldDirty:!0}),u({status:"success",title:c("inbounds.reality.generateKeys","Generate key pair"),description:"Key pair generated successfully using Xray",duration:2e3,isClosable:!0})}catch(z){u({status:"error",title:c("inbounds.reality.generateError","Unable to generate key pair"),description:z instanceof Error?z.message:void 0})}},[y,u,c]),V=d.exports.useCallback(async()=>{try{const{shortId:z}=await Sm(),Se=(y.getValues("realityShortIds")||"").split(/[\s,]+/).map(et=>et.trim()).filter(Boolean);Se.push(z),y.setValue("realityShortIds",Se.join(`
`),{shouldDirty:!0}),u({status:"success",title:c("inbounds.reality.generateShortId","Generate short ID"),description:"Short ID generated successfully",duration:2e3,isClosable:!0})}catch(z){u({status:"error",title:c("inbounds.reality.shortIdError","Unable to generate short ID"),description:z instanceof Error?z.message:void 0})}},[y,u,c]),lt=d.exports.useMemo(()=>{const z=xm(te);if(!z)return"";try{const{publicKey:k}=Ma(z);return $o(k)}catch{return""}},[te]),_t=()=>w({dest:"",path:"",type:"",alpn:"",xver:""}),zt=d.exports.useCallback(async()=>{var z;S(!0);try{const k=await bm(),Se=(z=k==null?void 0:k.auths)!=null?z:[];return m(Se),Se}catch(k){return console.error(k),u({status:"error",title:c("inbounds.vless.getKeysError","Unable to fetch VLESS keys")}),[]}finally{S(!1)}},[u,c]),Ge=d.exports.useCallback(async()=>p.length?p:zt(),[zt,p]),Ue=d.exports.useCallback((z,k)=>{var et,Nt;const Se=k.find(Ft=>Ft.label===z);if(!Se){u({status:"warning",title:c("inbounds.vless.authNotFound","Authentication block not available")});return}y.setValue("vlessDecryption",(et=Se.decryption)!=null?et:"",{shouldDirty:!0}),y.setValue("vlessEncryption",(Nt=Se.encryption)!=null?Nt:"",{shouldDirty:!0})},[y,c,u]),St=d.exports.useCallback(async z=>{if(!z){y.setValue("vlessDecryption","",{shouldDirty:!0}),y.setValue("vlessEncryption","",{shouldDirty:!0});return}const k=await Ge();k.length&&Ue(z,k)},[Ue,Ge,y]),Vt=d.exports.useCallback(async()=>{const z=y.getValues("vlessSelectedAuth");if(!z){u({status:"info",title:c("inbounds.vless.selectAuthFirst","Select an authentication option first")});return}const k=await zt();k.length&&Ue(z,k)},[Ue,zt,y,c,u]),dr=d.exports.useCallback(()=>{y.setValue("vlessSelectedAuth","",{shouldDirty:!0}),y.setValue("vlessDecryption","",{shouldDirty:!0}),y.setValue("vlessEncryption","",{shouldDirty:!0})},[y]);return d.exports.useEffect(()=>{t&&X==="vless"&&Ge()},[X,Ge,t]),n(Kt,{isOpen:t,onClose:a,size:"5xl",scrollBehavior:"inside",isCentered:!0,children:[e(Dt,{}),n(qt,{maxW:{base:"95vw",md:"4xl"},children:[e(Tt,{children:s==="create"?c("inbounds.add","Add inbound"):c("inbounds.edit","Edit inbound")}),e(Jt,{}),e(It,{children:n(me,{align:"stretch",spacing:6,children:[n(ge,{spacing:4,borderWidth:"1px",borderColor:Ne,borderRadius:"lg",p:4,children:[n(He,{columns:{base:1,md:2},spacing:4,children:[n(x,{isRequired:!0,isInvalid:!!Q,children:[e(I,{children:c("inbounds.tag","Tag")}),e(at,{...f("tag",{required:!0,onChange:()=>v(!0)}),isDisabled:s==="edit"}),Q&&e(h,{fontSize:"xs",color:"red.500",mt:1,children:Q})]}),n(x,{children:[e(I,{children:c("inbounds.listen","Listen address")}),e(at,{placeholder:"::",...f("listen")})]})]}),n(He,{columns:{base:1,md:2},spacing:4,children:[n(x,{isRequired:!0,isInvalid:!!ke,children:[e(I,{children:c("inbounds.port","Port")}),e(at,{placeholder:"443",...f("port",{required:!0}),value:E,onChange:z=>{f("port").onChange(z),y.setValue("port",z.target.value,{shouldDirty:!0})},bg:M?he:void 0,_dark:{bg:M?he:void 0,color:"white"},borderColor:M?Re:void 0}),n(U,{justify:"space-between",mt:1,children:["\u0627\u0631",e(O,{size:"xs",variant:"ghost",leftIcon:e(Ps,{width:16,height:16}),onClick:()=>ot(),children:c("inbounds.randomPort","Random")})]}),M&&e(h,{fontSize:"xs",color:"yellow.600",mt:1,children:M}),ke&&e(h,{fontSize:"xs",color:"red.500",mt:1,children:ke})]}),n(x,{isRequired:!0,children:[e(I,{children:c("inbounds.protocol","Protocol")}),e(ns,{...f("protocol",{required:!0}),isDisabled:s==="edit",children:Za.map(z=>e("option",{value:z,children:z.toUpperCase()},z))})]})]}),X==="vmess"&&n(x,{display:"flex",alignItems:"center",children:[e(I,{mb:0,children:c("inbounds.vmess.disableInsecure","Disable insecure encryption")}),e(vt,{...f("disableInsecureEncryption")})]}),X==="shadowsocks"&&n(x,{children:[e(I,{children:c("inbounds.shadowsocks.network","Allowed networks")}),e(at,{...f("shadowsocksNetwork")})]}),X==="vless"&&n(ge,{spacing:3,children:[e(kt,{control:A,name:"vlessSelectedAuth",render:({field:z})=>n(x,{children:[e(I,{children:c("inbounds.vless.authentication","Authentication")}),n(Ze,{placeholder:c("inbounds.vless.authPlaceholder","Select authentication"),value:z.value||"",onChange:async k=>{const Se=k.target.value;z.onChange(Se),await St(Se)},children:[e("option",{value:"",children:c("common.none","None")}),we.map(k=>e("option",{value:k.value,children:k.label},k.value))]})]})}),n(He,{columns:{base:1,md:2},spacing:4,children:[n(x,{children:[e(I,{children:c("inbounds.vless.decryption","Decryption")}),e(at,{...f("vlessDecryption")})]}),n(x,{children:[e(I,{children:c("inbounds.vless.encryption","Encryption")}),e(at,{...f("vlessEncryption")})]})]}),n(U,{spacing:3,children:[e(O,{size:"sm",onClick:Vt,isLoading:g,isDisabled:!B,children:c("inbounds.vless.getKeys","Get new keys")}),e(O,{size:"sm",variant:"ghost",onClick:dr,children:c("inbounds.vless.clearKeys","Clear")})]})]}),X==="http"&&n(ge,{spacing:3,children:[n(pt,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:c("inbounds.http.accounts","HTTP accounts")}),e(O,{size:"xs",onClick:()=>j({user:"",pass:""}),children:c("inbounds.accounts.add","Add account")})]}),n(ge,{spacing:3,children:[ce.map((z,k)=>n(L,{borderWidth:"1px",borderRadius:"md",borderColor:Ne,p:3,children:[n(pt,{justify:"space-between",align:"center",mb:3,children:[n(h,{fontWeight:"semibold",children:[c("inbounds.accounts.label","Account")," #",k+1]}),e(O,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>fe(k),children:c("hostsPage.delete","Delete")})]}),n(He,{columns:{base:1,md:2},spacing:3,children:[n(x,{children:[e(I,{children:c("username","Username")}),e(at,{...f(`httpAccounts.${k}.user`)})]}),n(x,{children:[e(I,{children:c("password","Password")}),e(at,{...f(`httpAccounts.${k}.pass`)})]})]})]},z.id)),!ce.length&&e(h,{fontSize:"sm",color:"gray.500",children:c("inbounds.http.noAccountsHint","Add at least one username/password pair.")})]}),n(x,{display:"flex",alignItems:"center",children:[e(I,{mb:0,children:c("inbounds.http.allowTransparent","Allow transparent proxy")}),e(vt,{...f("httpAllowTransparent")})]})]}),X==="socks"&&n(ge,{spacing:3,children:[n(x,{display:"flex",alignItems:"center",children:[e(I,{mb:0,children:c("inbounds.socks.udp","Enable UDP")}),e(vt,{...f("socksUdpEnabled")})]}),be&&n(x,{children:[e(I,{children:c("inbounds.socks.udpIp","UDP bind IP")}),e(at,{...f("socksUdpIp"),placeholder:"127.0.0.1"})]}),n(x,{display:"flex",alignItems:"center",children:[e(I,{mb:0,children:c("inbounds.socks.auth","Require authentication")}),e(kt,{control:A,name:"socksAuth",render:({field:z})=>e(vt,{isChecked:z.value==="password",onChange:k=>z.onChange(k.target.checked?"password":"noauth")})})]}),ue==="password"&&n(ge,{spacing:3,children:[n(pt,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:c("inbounds.socks.accounts","SOCKS accounts")}),e(O,{size:"xs",onClick:()=>Pe({user:"",pass:""}),children:c("inbounds.accounts.add","Add account")})]}),Ae.map((z,k)=>n(L,{borderWidth:"1px",borderRadius:"md",borderColor:Ne,p:3,children:[n(pt,{justify:"space-between",align:"center",mb:3,children:[n(h,{fontWeight:"semibold",children:[c("inbounds.accounts.label","Account")," #",k+1]}),e(O,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>Te(k),children:c("hostsPage.delete","Delete")})]}),n(He,{columns:{base:1,md:2},spacing:3,children:[n(x,{children:[e(I,{children:c("username","Username")}),e(at,{...f(`socksAccounts.${k}.user`)})]}),n(x,{children:[e(I,{children:c("password","Password")}),e(at,{...f(`socksAccounts.${k}.pass`)})]})]})]},z.id)),!Ae.length&&e(h,{fontSize:"sm",color:"gray.500",children:c("inbounds.socks.noAccountsHint","Add at least one account for password mode.")})]})]})]}),G&&n(ge,{spacing:4,borderWidth:"1px",borderColor:Ne,borderRadius:"lg",p:4,children:[n(He,{columns:{base:1,md:2},spacing:4,children:[n(x,{children:[e(I,{children:c("inbounds.network","Network")}),e(ns,{...f("streamNetwork"),children:im.map(z=>e("option",{value:z,children:z},z))})]}),n(x,{children:[e(I,{children:c("inbounds.security","Security")}),e(ns,{...f("streamSecurity"),children:am.map(z=>e("option",{value:z,children:z},z))})]})]}),_==="ws"&&n(He,{columns:{base:1,md:2},spacing:4,children:[n(x,{children:[e(I,{children:c("inbounds.ws.path","WebSocket path")}),e(at,{...f("wsPath"),placeholder:"/ws"})]}),n(x,{children:[e(I,{children:c("inbounds.ws.host","WebSocket host header")}),e(at,{...f("wsHost")})]})]}),_==="tcp"&&n(ge,{spacing:3,children:[n(x,{children:[e(I,{children:c("inbounds.tcp.headerType","TCP header type")}),n(ns,{...f("tcpHeaderType"),children:[e("option",{value:"none",children:"none"}),e("option",{value:"http",children:"http"})]})]}),ie==="http"&&n(He,{columns:{base:1,md:2},spacing:3,children:[n(x,{children:[e(I,{children:c("inbounds.tcp.host","HTTP host list")}),e(li,{...f("tcpHttpHosts"),placeholder:"example.com"})]}),n(x,{children:[e(I,{children:c("inbounds.tcp.path","HTTP path")}),e(at,{...f("tcpHttpPath")})]})]})]}),_==="grpc"&&n(He,{columns:{base:1,md:2},spacing:3,children:[n(x,{children:[e(I,{children:c("inbounds.grpc.serviceName","Service name")}),e(at,{...f("grpcServiceName")})]}),n(x,{children:[e(I,{children:c("inbounds.grpc.authority","Authority")}),e(at,{...f("grpcAuthority")})]}),n(x,{display:"flex",alignItems:"center",children:[e(I,{mb:0,children:c("inbounds.grpc.multiMode","Multi mode")}),e(vt,{...f("grpcMultiMode")})]})]}),_==="kcp"&&n(He,{columns:{base:1,md:2},spacing:3,children:[n(x,{children:[e(I,{children:c("inbounds.kcp.headerType","mKCP header")}),e(at,{...f("kcpHeaderType")})]}),n(x,{children:[e(I,{children:c("inbounds.kcp.seed","mKCP seed")}),e(at,{...f("kcpSeed")})]})]}),_==="quic"&&n(He,{columns:{base:1,md:3},spacing:3,children:[n(x,{children:[e(I,{children:c("inbounds.quic.security","QUIC security")}),e(at,{...f("quicSecurity")})]}),n(x,{children:[e(I,{children:c("inbounds.quic.key","QUIC key")}),e(at,{...f("quicKey")})]}),n(x,{children:[e(I,{children:c("inbounds.quic.headerType","QUIC header type")}),e(at,{...f("quicHeaderType")})]})]}),_==="httpupgrade"&&n(He,{columns:{base:1,md:2},spacing:3,children:[n(x,{children:[e(I,{children:c("inbounds.httpUpgrade.path","Path")}),e(at,{...f("httpupgradePath")})]}),n(x,{children:[e(I,{children:c("inbounds.httpUpgrade.host","Host")}),e(at,{...f("httpupgradeHost")})]})]}),_==="splithttp"&&n(He,{columns:{base:1,md:2},spacing:3,children:[n(x,{children:[e(I,{children:c("inbounds.splitHttp.path","Path")}),e(at,{...f("splithttpPath")})]}),n(x,{children:[e(I,{children:c("inbounds.splitHttp.host","Host")}),e(at,{...f("splithttpHost")})]})]}),_==="xhttp"&&n(ge,{spacing:3,children:[n(He,{columns:{base:1,md:2},spacing:3,children:[n(x,{children:[e(I,{children:c("inbounds.xhttp.host","Host")}),e(at,{...f("xhttpHost"),placeholder:"example.com"})]}),n(x,{children:[e(I,{children:c("inbounds.xhttp.path","Path")}),e(at,{...f("xhttpPath"),placeholder:"/"})]})]}),n(ge,{spacing:2,children:[n(pt,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:c("inbounds.xhttp.headers","Custom headers")}),e(O,{size:"xs",onClick:()=>Ce({name:"",value:""}),children:c("inbounds.accounts.add","Add")})]}),J.map((z,k)=>n(U,{spacing:2,align:"flex-start",children:[e(x,{children:e(at,{...f(`xhttpHeaders.${k}.name`),placeholder:c("inbounds.xhttp.headerName","Header name")})}),e(x,{children:e(at,{...f(`xhttpHeaders.${k}.value`),placeholder:c("inbounds.xhttp.headerValue","Header value")})}),e(O,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>$(k),children:c("hostsPage.delete","Delete")})]},z.id))]}),n(He,{columns:{base:1,md:2},spacing:3,children:[n(x,{children:[e(I,{children:c("inbounds.xhttp.mode","Mode")}),e(ns,{...f("xhttpMode"),children:Cm.map(z=>e("option",{value:z,children:z},z))})]}),n(x,{children:[e(I,{children:c("inbounds.xhttp.paddingBytes","Padding bytes")}),e(at,{...f("xhttpPaddingBytes"),placeholder:"100-1000"})]})]}),Ie==="packet-up"&&n(He,{columns:{base:1,md:2},spacing:3,children:[n(x,{children:[e(I,{children:c("inbounds.xhttp.maxBuffered","Max buffered upload")}),e(at,{...f("xhttpScMaxBufferedPosts"),placeholder:"30"})]}),n(x,{children:[e(I,{children:c("inbounds.xhttp.maxUploadBytes","Max upload size (bytes)")}),e(at,{...f("xhttpScMaxEachPostBytes"),placeholder:"1000000"})]})]}),Ie==="stream-up"&&n(x,{children:[e(I,{children:c("inbounds.xhttp.streamUp","Stream-up server seconds")}),e(at,{...f("xhttpScStreamUpServerSecs"),placeholder:"20-80"})]}),n(x,{display:"flex",alignItems:"center",children:[e(I,{mb:0,children:c("inbounds.xhttp.noSSE","Disable SSE header")}),e(vt,{...f("xhttpNoSSEHeader")})]})]}),n(x,{display:"flex",alignItems:"center",children:[e(I,{mb:0,children:c("inbounds.sockopt.enable","Enable sockopt")}),e(kt,{control:A,name:"sockoptEnabled",render:({field:z})=>e(vt,{isChecked:Boolean(z.value),onChange:k=>z.onChange(k.target.checked)})})]}),e(Es,{in:Boolean(q),animateOpacity:!0,children:n(ge,{spacing:4,borderWidth:"1px",borderColor:Ne,borderRadius:"md",p:4,mt:2,children:[n(He,{columns:{base:1,md:2},spacing:3,children:[ut("mark",c("inbounds.sockopt.routeMark","Route mark")),ut("tcpKeepAliveInterval",c("inbounds.sockopt.tcpKeepAliveInterval","TCP keep alive interval")),ut("tcpKeepAliveIdle",c("inbounds.sockopt.tcpKeepAliveIdle","TCP keep alive idle")),ut("tcpMaxSeg",c("inbounds.sockopt.tcpMaxSeg","TCP max segment")),ut("tcpUserTimeout",c("inbounds.sockopt.tcpUserTimeout","TCP user timeout")),ut("tcpWindowClamp",c("inbounds.sockopt.tcpWindowClamp","TCP window clamp"))]}),n(He,{columns:{base:1,md:2},spacing:3,children:[re("dialerProxy",c("inbounds.sockopt.dialerProxy","Dialer proxy"),"proxy"),re("interfaceName",c("inbounds.sockopt.interfaceName","Interface name"))]}),n(He,{columns:{base:1,md:2},spacing:3,children:[n(x,{children:[e(I,{children:c("inbounds.sockopt.domainStrategy","Domain strategy")}),e(kt,{control:A,name:"sockopt.domainStrategy",render:({field:z})=>n(Ze,{...z,children:[e("option",{value:"",children:c("common.none","None")}),vm.map(k=>e("option",{value:k,children:k},k))]})})]}),n(x,{children:[e(I,{children:c("inbounds.sockopt.tcpCongestion","TCP congestion")}),e(kt,{control:A,name:"sockopt.tcpcongestion",render:({field:z})=>n(Ze,{...z,children:[e("option",{value:"",children:c("common.none","None")}),wm.map(k=>e("option",{value:k,children:k},k))]})})]}),n(x,{children:[e(I,{children:c("inbounds.sockopt.tproxy","TProxy")}),e(kt,{control:A,name:"sockopt.tproxy",render:({field:z})=>e(Ze,{...z,children:km.map(k=>e("option",{value:k,children:k},k))})})]})]}),n(He,{columns:{base:1,md:2},spacing:3,children:[yt("acceptProxyProtocol",c("inbounds.sockopt.acceptProxyProtocol","Accept proxy protocol")),yt("tcpFastOpen",c("inbounds.sockopt.tcpFastOpen","TCP fast open")),yt("tcpMptcp",c("inbounds.sockopt.tcpMptcp","Multipath TCP")),yt("penetrate",c("inbounds.sockopt.penetrate","Penetrate")),yt("V6Only",c("inbounds.sockopt.v6Only","IPv6 only"))]})]})})]}),P==="tls"&&n(ge,{spacing:4,borderWidth:"1px",borderColor:Ne,borderRadius:"lg",p:4,children:[n(x,{children:[e(I,{children:c("inbounds.tls.serverName","Server name (SNI)")}),e(at,{...f("tlsServerName"),placeholder:"example.com"})]}),n(x,{children:[e(I,{children:c("inbounds.tls.fingerprint","uTLS fingerprint")}),n(ns,{...f("tlsFingerprint"),children:[e("option",{value:"",children:c("common.none","None")}),sm.map(z=>e("option",{value:z,children:z},z))]})]}),n(x,{display:"flex",alignItems:"center",children:[e(I,{mb:0,children:c("inbounds.tls.allowInsecure","Allow insecure")}),e(vt,{...f("tlsAllowInsecure")})]})]}),P==="reality"&&n(ge,{spacing:4,borderWidth:"1px",borderColor:Ne,borderRadius:"lg",p:4,children:[n(x,{isRequired:!0,children:[e(I,{children:c("inbounds.reality.privateKey","Reality private key")}),e(li,{rows:3,...f("realityPrivateKey",{required:!0})}),e(O,{size:"xs",mt:2,variant:"outline",onClick:ct,alignSelf:"flex-start",children:c("inbounds.reality.generateKeys","Generate key pair")})]}),n(x,{children:[e(I,{children:c("inbounds.reality.publicKey","Reality public key")}),e(at,{value:lt,isReadOnly:!0,placeholder:c("inbounds.reality.publicKeyPlaceholder","Derived automatically")})]}),n(He,{columns:{base:1,md:2},spacing:4,children:[n(x,{children:[e(I,{children:c("inbounds.reality.serverNames","Server names")}),e(li,{rows:2,...f("realityServerNames"),placeholder:"domain.com"}),e(L,{fontSize:"sm",color:"gray.500",children:c("inbounds.serverNamesHint","Separate entries with commas or new lines.")})]}),n(x,{children:[e(I,{children:c("inbounds.reality.dest","Destination (host:port)")}),e(at,{...f("realityDest"),placeholder:"example.com:443"})]})]}),n(x,{children:[e(I,{children:c("inbounds.reality.shortIds","Short IDs")}),e(li,{rows:2,...f("realityShortIds")}),e(O,{size:"xs",mt:2,variant:"outline",onClick:V,alignSelf:"flex-start",children:c("inbounds.reality.generateShortId","Generate short ID")}),e(L,{fontSize:"sm",color:"gray.500",children:c("inbounds.shortIdsHint","Separate entries with commas or new lines.")})]}),n(He,{columns:{base:1,md:2},spacing:4,children:[n(x,{children:[e(I,{children:c("inbounds.reality.spiderX","SpiderX")}),e(at,{...f("realitySpiderX")})]}),n(x,{children:[e(I,{children:c("inbounds.reality.xver","Xver")}),e(at,{...f("realityXver")})]})]})]}),ze&&n(ge,{spacing:3,borderWidth:"1px",borderColor:Ne,borderRadius:"lg",p:4,children:[n(pt,{align:"center",justify:"space-between",children:[e(L,{fontWeight:"medium",children:c("inbounds.fallbacks","Fallbacks")}),e(O,{size:"xs",onClick:_t,children:c("inbounds.fallbacks.add","Add fallback")})]}),le.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("inbounds.fallbacks.empty","No fallbacks configured yet.")}):le.map((z,k)=>n(L,{borderWidth:"1px",borderRadius:"md",borderColor:Ne,p:3,children:[n(pt,{justify:"space-between",align:"center",mb:3,children:[n(h,{fontWeight:"semibold",children:[c("inbounds.fallbacks.type","Fallback")," #",k+1]}),e(O,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>H(k),children:c("hostsPage.delete","Delete")})]}),n(He,{columns:{base:1,md:2},spacing:3,children:[n(x,{children:[e(I,{children:c("inbounds.fallbacks.dest","Destination (host:port)")}),e(at,{placeholder:"example.com:443",...f(`fallbacks.${k}.dest`)})]}),n(x,{children:[e(I,{children:c("inbounds.fallbacks.path","Path")}),e(at,{...f(`fallbacks.${k}.path`),placeholder:"/"})]}),n(x,{children:[e(I,{children:c("inbounds.fallbacks.type","Type")}),e(at,{...f(`fallbacks.${k}.type`),placeholder:"none"})]}),n(x,{children:[e(I,{children:c("inbounds.fallbacks.alpn","ALPN")}),e(at,{...f(`fallbacks.${k}.alpn`),placeholder:"h2,http/1.1"})]}),n(x,{children:[e(I,{children:"Xver"}),e(at,{...f(`fallbacks.${k}.xver`),placeholder:"0"})]})]})]},z.id))]}),n(ge,{spacing:4,borderWidth:"1px",borderColor:Ne,borderRadius:"lg",p:4,children:[n(pt,{align:"center",justify:"space-between",children:[n(U,{spacing:2,children:[e(L,{fontWeight:"medium",children:c("inbounds.sniffing","Sniffing")}),e(mt,{label:c("inbounds.sniffingHint","It is recommended to keep the default."),children:e(Pl,{width:16,height:16})})]}),e(vt,{...f("sniffingEnabled")})]}),Y&&n(ge,{spacing:3,children:[n(x,{children:[e(I,{children:c("inbounds.sniffingDestinations","Protocols to sniff")}),e(kt,{control:A,name:"sniffingDestinations",render:({field:z})=>{var k;return e($i,{value:(k=z.value)!=null?k:[],onChange:z.onChange,children:e(U,{spacing:4,children:nm.map(Se=>e(vr,{value:Se.value,children:Se.label},Se.value))})})}})]}),n(x,{display:"flex",alignItems:"center",children:[e(I,{mb:0,children:c("inbounds.sniffingRouteOnly","Route only")}),e(vt,{...f("sniffingRouteOnly")})]}),n(x,{display:"flex",alignItems:"center",children:[e(I,{mb:0,children:c("inbounds.sniffingMetadataOnly","Metadata only")}),e(vt,{...f("sniffingMetadataOnly")})]})]})]})]})}),n(Wt,{children:[e(O,{variant:"ghost",mr:3,onClick:a,children:c("hostsPage.cancel","Cancel")}),e(O,{colorScheme:"primary",isLoading:o,isDisabled:tt,onClick:D(wt),children:s==="create"?c("common.create","Create"):c("common.save","Save")})]})]})]})},Am=()=>{const{t}=qe(),s=sr(),[r,o]=d.exports.useState([]),[i,a]=d.exports.useState(!0),[l,c]=d.exports.useState(!1),[u,p]=d.exports.useState(null),[m,g]=d.exports.useState({protocol:"all",search:""}),[S,y]=d.exports.useState(null),{isOpen:A,onOpen:f,onClose:D}=rr(),[F,Z]=d.exports.useState("create"),ae=Or({base:!1,md:!0}),v=d.exports.useCallback(()=>{a(!0),p(null),Ee("/inbounds/full").then(W=>{o(W||[])}).catch(()=>{p(t("inbounds.error.load","Unable to load inbounds"))}).finally(()=>a(!1))},[t]);d.exports.useEffect(()=>{v()},[v]);const M=d.exports.useMemo(()=>{const W=m.search.trim().toLowerCase();return r.filter(oe=>{var R;return m.protocol!=="all"&&oe.protocol!==m.protocol?!1:W?oe.tag.toLowerCase().includes(W)||((R=oe.port)==null?void 0:R.toString().includes(W)):!0})},[r,m]),T=()=>{Z("create"),y(null),f()},Q=W=>{Z("edit"),y(W),f()},_e=async W=>{var oe;c(!0);try{const R=(W.tag||"").trim().toLowerCase(),le=r.some(j=>(j.tag||"").trim().toLowerCase()===R&&(F==="create"||j.tag!==(S==null?void 0:S.tag))),w=r.some(j=>{var fe;return((fe=j.port)==null?void 0:fe.toString())===W.port&&(F==="create"||j.tag!==(S==null?void 0:S.tag))});if(le)throw new Error(t("inbounds.error.tagExists","Inbound tag already exists"));if(w)throw new Error(t("inbounds.error.portExists","Inbound port already exists"));const H=pm(W),ce=F==="create"?"/inbounds":`/inbounds/${encodeURIComponent(H.tag)}`;await Ee(ce,{method:F==="create"?"POST":"PUT",body:H}),s({status:"success",title:F==="create"?t("inbounds.success.created","Inbound created"):t("inbounds.success.updated","Inbound updated")}),yi(),await v(),D()}catch(R){s({status:"error",title:t("inbounds.error.submit","Unable to save inbound"),description:((oe=R==null?void 0:R.data)==null?void 0:oe.detail)||(R==null?void 0:R.message)})}finally{c(!1)}},ke=async W=>{var R;const oe=t("inbounds.confirmDelete",{defaultValue:"Delete inbound {{tag}}?",tag:W.tag});if(!!window.confirm(oe)){c(!0);try{await Ee(`/inbounds/${encodeURIComponent(W.tag)}`,{method:"DELETE"}),s({status:"success",title:t("inbounds.success.deleted","Inbound deleted")}),yi(),await v()}catch(le){s({status:"error",title:t("inbounds.error.submit","Unable to save inbound"),description:((R=le==null?void 0:le.data)==null?void 0:R.detail)||(le==null?void 0:le.message)})}finally{c(!1)}}};return n(ge,{spacing:4,children:[n(pt,{justify:"space-between",flexWrap:"wrap",gap:4,children:[e(De,{maxW:"300px",placeholder:t("inbounds.searchPlaceholder","Search by tag or port"),value:m.search,onChange:W=>g(oe=>({...oe,search:W.target.value}))}),n(U,{spacing:3,children:[n(Ze,{width:"180px",value:m.protocol,onChange:W=>g(oe=>({...oe,protocol:W.target.value})),children:[e("option",{value:"all",children:t("inbounds.filterProtocol","All protocols")}),Za.map(W=>e("option",{value:W,children:W.toUpperCase()},W))]}),e(O,{leftIcon:e(Tn,{width:18,height:18}),onClick:T,colorScheme:"primary",children:t("inbounds.add","Add inbound")})]})]}),u&&n(Mr,{status:"error",children:[e(Ur,{}),u]}),i?e(pt,{justify:"center",py:10,children:e(Et,{})}):M.length===0?e(L,{border:"1px dashed",borderRadius:"md",p:8,textAlign:"center",color:"gray.500",children:t("inbounds.emptyState","No inbounds configured yet.")}):ae?e(L,{borderWidth:"1px",borderRadius:"lg",overflow:"hidden",children:n(as,{variant:"simple",size:"sm",children:[e(yn,{bg:"gray.50",_dark:{bg:"gray.900"},children:n(Ot,{children:[e(Ke,{children:t("inbounds.tag","Tag")}),e(Ke,{children:t("inbounds.protocol","Protocol")}),e(Ke,{children:t("inbounds.portLabel","Port")}),e(Ke,{children:t("inbounds.network","Network")}),e(Ke,{children:t("inbounds.security","Security")}),e(Ke,{children:t("inbounds.sniffing","Sniffing")}),e(Ke,{width:"120px",children:t("actions","Actions")})]})}),e(sn,{children:M.map(W=>{var R;const oe=W.streamSettings||{};return n(Ot,{children:[n(Me,{children:[e(h,{fontWeight:"semibold",children:W.tag}),W.listen&&e(h,{fontSize:"sm",color:"gray.500",children:W.listen})]}),e(Me,{children:e(rt,{colorScheme:"purple",children:W.protocol})}),e(Me,{children:W.port}),e(Me,{children:oe.network||"\u2014"}),e(Me,{children:oe.security&&oe.security!=="none"?e(rt,{colorScheme:"blue",children:oe.security}):"\u2014"}),e(Me,{children:(R=W.sniffing)!=null&&R.enabled?e(rt,{size:"sm",colorScheme:"green",children:t("inbounds.sniffingEnabled","Sniffing enabled")}):e(rt,{size:"sm",colorScheme:"gray",children:t("inbounds.sniffingDisabled","Sniffing disabled")})}),e(Me,{children:n(U,{spacing:2,children:[e(Be,{"aria-label":t("common.edit","Edit"),icon:e(Vn,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>Q(W)}),e(Be,{"aria-label":t("common.delete","Delete"),icon:e(wn,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>ke(W),isLoading:l})]})})]},W.tag)})})]})}):e(ge,{spacing:3,children:M.map(W=>{var R;const oe=W.streamSettings||{};return n(L,{borderWidth:"1px",borderRadius:"lg",p:4,children:[n(pt,{justify:"space-between",align:"center",mb:2,children:[n(L,{children:[e(h,{fontWeight:"semibold",children:W.tag}),n(h,{fontSize:"sm",color:"gray.500",children:[t("inbounds.portLabel","Port"),": ",W.port]})]}),n(U,{spacing:2,children:[e(Be,{"aria-label":t("common.edit","Edit"),icon:e(Vn,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>Q(W)}),e(Be,{"aria-label":t("common.delete","Delete"),icon:e(wn,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>ke(W),isLoading:l})]})]}),n(ge,{spacing:2,children:[n(U,{spacing:2,wrap:"wrap",children:[e(rt,{colorScheme:"purple",children:W.protocol}),oe.network&&e(rt,{children:oe.network}),oe.security&&oe.security!=="none"&&e(rt,{colorScheme:"blue",children:oe.security})]}),n(U,{spacing:2,wrap:"wrap",children:[(R=W.sniffing)!=null&&R.enabled?e(rt,{size:"sm",colorScheme:"green",children:t("inbounds.sniffingEnabled","Sniffing enabled")}):e(rt,{size:"sm",colorScheme:"gray",children:t("inbounds.sniffingDisabled","Sniffing disabled")}),W.listen&&e(rt,{size:"sm",colorScheme:"gray",children:W.listen})]})]})]},W.tag)})}),e(_m,{isOpen:A,mode:F,initialValue:S,isSubmitting:l,existingInbounds:r,onClose:D,onSubmit:_e})]})},Dm=()=>{var i;const{t}=qe(),{userData:s,getUserIsSuccess:r}=xr();return r&&Boolean((i=s.permissions)==null?void 0:i.sections.hosts)?n(me,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.hostSettings","Inbounds & Hosts")}),n(hs,{colorScheme:"primary",isLazy:!0,children:[n(ps,{children:[e(or,{children:n(U,{spacing:2,children:[e(di,{as:Tl,w:4,h:4}),e("span",{children:t("hostsPage.tabInbounds","Inbounds")})]})}),e(or,{children:n(U,{spacing:2,children:[e(di,{as:xl,w:4,h:4}),e("span",{children:t("hostsPage.tabHosts","Hosts")})]})})]}),n(ms,{children:[e(lr,{px:0,children:n(me,{spacing:4,align:"stretch",children:[e(h,{color:"gray.500",fontSize:"sm",children:t("hostsPage.tabInboundsDescription","Manage and customize Xray inbounds, transport layers, security, and sniffing options.")}),e(Am,{})]})}),e(lr,{px:0,children:n(me,{spacing:4,align:"stretch",children:[e(h,{color:"gray.500",fontSize:"sm",children:t("hostsPage.tabHostsDescription","Assign hosts to inbounds, adjust ordering, and fine-tune SNI, paths, and transport overrides.")}),e(Qp,{})]})})]})]})]}):n(me,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.hostSettings","Inbounds & Hosts")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("hostsPage.noPermission","You do not have permission to manage host or inbound settings.")})]})},Im=xe.object({name:xe.string().min(1),address:xe.string().min(1).refine(t=>{const s=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,r=/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:(?:[0-9a-f]{1,4}:){3}(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:(?:[0-9a-f]{1,4}:){2}(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:(?:[0-9a-f]{1,4}:)(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?::[0-9a-f]{1,4}){1,7}|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/,o=/^(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/;return s.test(t)||r.test(t)||o.test(t)},"Invalid IP address or domain"),port:xe.number().min(1).or(xe.string().transform(t=>parseFloat(t))),api_port:xe.number().min(1).or(xe.string().transform(t=>parseFloat(t))),xray_version:xe.string().nullable().optional(),node_service_version:xe.string().nullable().optional(),id:xe.number().nullable().optional(),status:xe.enum(["connected","connecting","error","disabled","limited"]).nullable().optional(),message:xe.string().nullable().optional(),add_as_new_host:xe.boolean().optional(),usage_coefficient:xe.number().or(xe.string().transform(t=>parseFloat(t))),data_limit:xe.number().nullable().optional(),uplink:xe.number().nullable().optional(),downlink:xe.number().nullable().optional(),use_nobetci:xe.boolean().optional(),nobetci_port:xe.number().nullable().optional()}),Ri=()=>({name:"",address:"",port:62050,api_port:62051,xray_version:"",node_service_version:"",usage_coefficient:1,data_limit:null,uplink:0,downlink:0,use_nobetci:!1,nobetci_port:null}),zr="fetch-nodes-query-key",ja=t=>{var r;const{isEditingNodes:s}=Lt();return fr({queryKey:zr,queryFn:Di.getState().fetchNodes,refetchInterval:s?3e3:void 0,refetchOnWindowFocus:!1,enabled:(r=t==null?void 0:t.enabled)!=null?r:!0})},Di=Us((t,s)=>({nodes:[],addNode(r){return Ee("/node",{method:"POST",body:r})},fetchNodes(){return Ee("/nodes")},fetchNodesUsage(r){return Ee("/nodes/usage",{query:r})},updateNode(r){return Ee(`/node/${r.id}`,{method:"PUT",body:r})},setDeletingNode(r){t({deletingNode:r})},reconnectNode(r){return Ee(`/node/${r.id}/reconnect`,{method:"POST"})},restartNodeService(r){return Ee(`/node/${r.id}/service/restart`,{method:"POST"})},updateNodeService(r){return Ee(`/node/${r.id}/service/update`,{method:"POST"})},resetNodeUsage(r){return Ee(`/node/${r.id}/usage/reset`,{method:"POST"})},updateMasterNode(r){return Ee("/node/master",{method:"PUT",body:r})},resetMasterUsage(){return Ee("/node/master/usage/reset",{method:"POST"})},deleteNode:()=>{var r;return Ee(`/node/${(r=s().deletingNode)==null?void 0:r.id}`,{method:"DELETE"})}})),Ko=({expiryDate:t,status:s,compact:r=!1,showDetail:o=!0,extraText:i})=>{const{t:a}=qe(),l=na(t),c=is[s].icon;return n($t,{children:[n(cn,{colorScheme:is[s].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:r?1:2,alignItems:"center",flexWrap:"wrap",children:[e(c,{w:r?3:4}),o&&n(h,{textTransform:"capitalize",fontSize:r?".7rem":".875rem",lineHeight:r?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",whiteSpace:"normal",textAlign:"left",maxW:{base:"100%",md:"fit-content"},children:[s&&a(`nodeModal.status.${s}`),i&&`: ${i}`]})]}),o&&t&&e(h,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:a(l.status,{time:l.time})})]})},Pm=se(mi,{baseStyle:{w:4,h:4}}),Em=se(Va,{baseStyle:{w:4,h:4}}),Tm=se(Nd,{baseStyle:{w:4,h:4}}),zm=se(Sl,{baseStyle:{w:4,h:4}}),qo=1024*1024*1024,Nm=51031,ts=t=>{if(t&&typeof t=="object"&&"message"in t){const s=t.message;return typeof s=="string"?s:void 0}},Jo=({isOpen:t,onClose:s,node:r,mutate:o,isLoading:i,isAddMode:a=!1})=>{var le,w,H,ce,j,fe,Ae,Pe,Te,J,Ce,$,X,_,P,Y,te;const{t:l}=qe(),c=sr(),[u,p]=d.exports.useState(a),{fetchNodesUsage:m}=Di(),[g,S]=d.exports.useState(null),{data:y,isLoading:A}=fr({queryKey:"node-settings",queryFn:()=>Ee("/node/settings")}),{data:f}=fr({queryKey:"panel-settings",queryFn:Qa,staleTime:5*60*1e3}),D=(le=f==null?void 0:f.use_nobetci)!=null?le:!0,F=ie=>{if(ie==null)return null;const q=ie/qo;return Number.isFinite(q)?Math.round(q*100)/100:null},Z=ie=>ie==null?null:Math.round(ie*qo),ae=a?{...Ri(),add_as_new_host:!1}:{...Ri(),...r,add_as_new_host:!1},v=en({resolver:ji(Im),defaultValues:{...ae,data_limit:F((w=ae.data_limit)!=null?w:null)}}),M=(H=y==null?void 0:y.certificate)!=null?H:"",{onCopy:T,hasCopied:Q}=Hl(M),_e=v.watch("use_nobetci");d.exports.useEffect(()=>{if(!D||!_e){v.getValues("nobetci_port")!==null&&v.setValue("nobetci_port",null);return}const ie=v.getValues("nobetci_port");(ie==null||ie==="")&&v.setValue("nobetci_port",Nm)},[_e,v,D]),d.exports.useEffect(()=>{f&&!f.use_nobetci&&(v.getValues("use_nobetci")&&v.setValue("use_nobetci",!1),v.getValues("nobetci_port")!==null&&v.setValue("nobetci_port",null))},[f,v]),d.exports.useEffect(()=>{var ie;if(t){const q=a?{...Ri(),add_as_new_host:!1}:{...Ri(),...r,add_as_new_host:!1};v.reset({...q,data_limit:F((ie=q.data_limit)!=null?ie:null)}),p(a&&!!M)}},[t,a,r,v,M]),d.exports.useEffect(()=>{!a&&r&&t?m({start:Oe().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")}).then(ie=>{const q=ie.usages[r.id];q&&S({uplink:q.uplink,downlink:q.downlink})}):S(null)},[r,a,t,m]);const ke=v.handleSubmit(ie=>{var B;const q={...ie,data_limit:Z((B=ie.data_limit)!=null?B:null)};o(q)}),W=()=>{!M||(T(),c({title:l("copied"),status:"success",isClosable:!0,position:"top",duration:2e3}))},oe=()=>{if(!M)return;const ie=new Blob([M],{type:"text/plain"}),q=URL.createObjectURL(ie),B=document.createElement("a");B.href=q,B.download="ssl_client_cert.pem",B.click(),URL.revokeObjectURL(q)},R=()=>{p(!1),S(null),s()};return n(Kt,{isOpen:t,onClose:R,size:"lg",children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(qt,{mx:"3",as:"form",onSubmit:ke,children:[e(Tt,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:l(a?"nodes.addNewRebeccaNode":"nodes.editNode")})}),e(Jt,{mt:3}),e(It,{children:n(ge,{spacing:6,children:[!a&&g&&n(ge,{spacing:2,children:[e(h,{fontWeight:"medium",children:l("nodes.usage")}),n(U,{children:[n(rt,{colorScheme:"green",children:[l("nodes.uplink"),": ",ss.sizeFormat(g.uplink)]}),n(rt,{colorScheme:"blue",children:[l("nodes.downlink"),": ",ss.sizeFormat(g.downlink)]})]})]}),a&&n(ge,{spacing:3,children:[n(U,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:l("nodes.certificate")}),n(U,{spacing:2,children:[e(O,{size:"xs",variant:"outline",leftIcon:e(Tm,{}),onClick:W,isDisabled:!M,children:l(Q?"copied":"copy")}),e(O,{size:"xs",variant:"outline",leftIcon:e(zm,{}),onClick:oe,isDisabled:!M,children:l("nodes.download-certificate")}),e(mt,{placement:"top",label:l(u?"nodes.hide-certificate":"nodes.show-certificate"),children:e(Be,{"aria-label":l(u?"nodes.hide-certificate":"nodes.show-certificate"),onClick:()=>p(ie=>!ie),size:"xs",variant:"ghost",children:u?e(Em,{}):e(Pm,{})})})]})]}),e(Es,{in:u&&!!M,animateOpacity:!0,children:e(L,{borderWidth:"1px",borderRadius:"md",p:3,fontFamily:"mono",fontSize:"xs",maxH:"220px",overflow:"auto",bg:"gray.50",_dark:{bg:"whiteAlpha.100"},children:M||(A?l("loading"):"")})}),!M&&!A&&e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:l("nodes.certificateUnavailable","Certificate not available.")})]}),n(ge,{spacing:4,children:[n(He,{columns:{base:1,md:2},spacing:4,children:[e(x,{children:e(Sr,{label:l("nodes.nodeName"),size:"sm",placeholder:"Rebecca-S2",...v.register("name"),error:ts((j=(ce=v.formState)==null?void 0:ce.errors)==null?void 0:j.name)})}),e(x,{children:e(Sr,{label:l("nodes.nodeAddress"),size:"sm",placeholder:"192.168.1.1 or 2001:db8::1",...v.register("address"),error:ts((Ae=(fe=v.formState)==null?void 0:fe.errors)==null?void 0:Ae.address)})})]}),n(He,{columns:{base:1,md:2},spacing:4,children:[e(x,{children:e(Sr,{label:l("nodes.nodePort"),size:"sm",placeholder:"62050",...v.register("port"),error:ts((Te=(Pe=v.formState)==null?void 0:Pe.errors)==null?void 0:Te.port)})}),e(x,{children:e(Sr,{label:l("nodes.nodeAPIPort"),size:"sm",placeholder:"62051",...v.register("api_port"),error:ts((Ce=(J=v.formState)==null?void 0:J.errors)==null?void 0:Ce.api_port)})})]}),e(x,{children:e(Sr,{label:l("nodes.usageCoefficient"),size:"sm",placeholder:"1",...v.register("usage_coefficient"),error:ts((X=($=v.formState)==null?void 0:$.errors)==null?void 0:X.usage_coefficient)})}),n(x,{children:[e(Sr,{label:l("nodes.dataLimitField","Data Limit (GB)"),size:"sm",type:"number",step:.01,min:0,placeholder:l("nodes.dataLimitPlaceholder","e.g., 500 (empty = unlimited)"),...v.register("data_limit",{setValueAs:ie=>{if(ie===""||ie===null||ie===void 0)return null;const q=Number(ie);return Number.isFinite(q)?q:Number.NaN},validate:ie=>ie==null?!0:Number.isNaN(ie)?l("nodes.dataLimitValidation","Data limit must be a valid number"):ie>=0||l("nodes.dataLimitPositive","Data limit must be zero or greater")}),error:ts((P=(_=v.formState)==null?void 0:_.errors)==null?void 0:P.data_limit)}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:l("nodes.dataLimitHint","Leave empty for unlimited data.")})]}),D&&n($t,{children:[n(x,{display:"flex",alignItems:"center",children:[e(I,{mb:0,children:l("nodes.useNobetci","Enable Nobetci integration")}),e(kt,{control:v.control,name:"use_nobetci",render:({field:ie})=>e(vt,{isChecked:Boolean(ie.value),onChange:q=>ie.onChange(q.target.checked)})})]}),e(Es,{in:Boolean(_e),animateOpacity:!0,children:n(x,{mt:_e?2:0,children:[e(Sr,{label:l("nodes.nobetciPort","Nobetci port"),size:"sm",placeholder:"443",...v.register("nobetci_port",{setValueAs:ie=>{if(ie===""||ie===null||ie===void 0)return null;const q=Number(ie);return Number.isFinite(q)?q:Number.NaN},validate:ie=>_e?ie==null?l("nodes.nobetciPortRequired","Port is required when Nobetci is enabled"):Number.isNaN(ie)?l("nodes.nobetciPortInvalid","Enter a valid port number"):ie>=1&&ie<=65535?!0:l("nodes.nobetciPortRange","Port must be between 1 and 65535"):!0}),error:ts((te=(Y=v.formState)==null?void 0:Y.errors)==null?void 0:te.nobetci_port)}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:l("nodes.nobetciHint","Provide the Nobetci listener port. Leave blank to disable.")})]})})]})]}),a&&e(L,{children:e(vr,{...v.register("add_as_new_host"),children:l("nodes.addHostForEveryInbound")})})]})}),n(Wt,{gap:3,children:[e(O,{variant:"outline",onClick:R,children:l("cancel")}),e(O,{type:"submit",colorScheme:"primary",isLoading:i,children:l(a?"nodes.addNode":"nodes.editNode")})]})]})]})},Rm=({deleteCallback:t})=>{const{deleteNode:s,deletingNode:r,setDeletingNode:o}=Di(),{t:i}=qe(),a=sr(),l=Ga(),c=()=>{o(null)},{isLoading:u,mutate:p}=Ar(s,{onSuccess:()=>{tr(i("deleteNode.deleteSuccess",{name:r&&r.name}),a),o(null),l.invalidateQueries(zr),t&&t()},onError:m=>{jt(m,a)},onSettled:()=>{o(null)}});return n(Kt,{isCentered:!0,isOpen:!!r,onClose:c,size:"sm",children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(qt,{mx:"3",children:[e(Tt,{pt:6,children:e(os,{color:"red",children:e(ki,{})})}),e(Jt,{mt:3}),n(It,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:i("deleteNode.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(ta,{components:{b:e("b",{})},children:i("deleteNode.prompt",{name:r.name})})})]}),n(Wt,{display:"flex",children:[e(O,{size:"sm",onClick:c,mr:3,w:"full",variant:"outline",children:i("cancel")}),e(O,{size:"sm",w:"full",colorScheme:"red",onClick:()=>p(),leftIcon:u?e(Et,{size:"xs"}):void 0,children:i("delete")})]})]})]})},Lm=10,Mm=({isOpen:t,title:s,description:r,currentVersion:o,allowPersist:i=!1,isSubmitting:a,onSubmit:l,onClose:c})=>{const{t:u}=qe(),[p,m]=d.exports.useState(""),[g,S]=d.exports.useState(!1),[y,A]=d.exports.useState(null),f=fr(["core-xray-releases"],()=>Ee("/core/xray/releases",{query:{limit:Lm}}),{enabled:t,staleTime:5*60*1e3});d.exports.useEffect(()=>{t&&(m(o||""),S(!1),A(null))},[t,o]);const D=d.exports.useMemo(()=>{var M,T;return(T=(M=f.data)==null?void 0:M.tags)!=null?T:[]},[f.data]),F=M=>{m(M.target.value)},Z=M=>{m(M.target.value)},ae=async()=>{if(!p){A(u("validation.required"));return}try{A(null),await l({version:p,persist:i?g:void 0})}catch(M){M instanceof Error?A(M.message):A(u("core.generalErrorMessage"))}},v=f.isLoading;return n(Kt,{isOpen:t,onClose:c,isCentered:!0,size:"lg",children:[e(Dt,{}),n(qt,{children:[e(Tt,{children:s}),e(Jt,{}),e(It,{children:n(ge,{spacing:4,children:[r&&e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:r}),n(x,{children:[e(I,{children:u("nodes.coreVersionDialog.latestReleases")}),e(Ze,{placeholder:u(v?"nodes.coreVersionDialog.loadingReleases":"nodes.coreVersionDialog.selectVersionPlaceholder"),value:p&&D.includes(p)?p:"",onChange:F,isDisabled:v||D.length===0,size:"sm",children:D.map(M=>e("option",{value:M,children:M},M))}),v&&n(ge,{direction:"row",align:"center",spacing:2,mt:2,children:[e(Et,{size:"sm"}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:u("nodes.coreVersionDialog.fetchingFromGithub")})]}),f.isError&&e(h,{fontSize:"xs",color:"red.500",mt:1,children:u("nodes.coreVersionDialog.failedToLoadReleases")})]}),n(x,{isRequired:!0,children:[e(I,{children:u("nodes.coreVersionDialog.customVersionLabel")}),e(De,{value:p,placeholder:u("nodes.coreVersionDialog.customVersionPlaceholder"),onChange:Z,size:"sm"}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:u("nodes.coreVersionDialog.customVersionHelper")})]}),i&&e(vr,{isChecked:g,onChange:M=>S(M.target.checked),children:u("nodes.coreVersionDialog.persistExecutable")}),y&&n(Mr,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(Ur,{}),e(Bn,{children:y})]})]})}),n(Wt,{children:[e(O,{variant:"ghost",mr:3,onClick:c,children:u("cancel")}),e(O,{colorScheme:"primary",onClick:ae,isLoading:a,children:u("nodes.coreVersionDialog.confirmUpdate")})]})]})]})},Yo="https://raw.githubusercontent.com/ppouria/geo-templates/main/index.json",Um=se(Bl,{baseStyle:{w:3.5,h:3.5}}),Om=se(Tn,{baseStyle:{w:3.5,h:3.5}}),Wm=se(dn,{baseStyle:{w:4,h:4}}),Fm=({isOpen:t,title:s,isSubmitting:r,showMasterOptions:o=!1,defaultTemplateIndexUrl:i,onSubmit:a,onClose:l})=>{const{t:c}=qe(),[u,p]=d.exports.useState("template"),[m,g]=d.exports.useState(Yo),[S,y]=d.exports.useState(""),[A,f]=d.exports.useState([{name:"geoip.dat",url:""},{name:"geosite.dat",url:""}]),[D,F]=d.exports.useState(!0),[Z,ae]=d.exports.useState(!1),[v,M]=d.exports.useState(null);d.exports.useEffect(()=>{t&&(p("template"),g(i||Yo),y(""),f([{name:"geoip.dat",url:""},{name:"geosite.dat",url:""}]),F(!0),ae(!1),M(null))},[t,i]);const T=fr(["geo-templates",m],()=>Ee("/core/geo/templates",{query:m?{index_url:m}:void 0}),{enabled:t&&u==="template"&&Boolean(m),staleTime:10*60*1e3}),Q=d.exports.useMemo(()=>{var w,H;return(H=(w=T.data)==null?void 0:w.templates)!=null?H:[]},[T.data]);d.exports.useEffect(()=>{Q.length>0&&y(w=>w||Q[0].name)},[Q]);const _e=Le("gray.50","whiteAlpha.50"),ke=()=>{f(w=>[...w,{name:"",url:""}])},W=(w,H,ce)=>{f(j=>j.map((fe,Ae)=>Ae===w?{...fe,[H]:ce}:fe))},oe=w=>{f(H=>H.filter((ce,j)=>j!==w))},R=async()=>{const w=u==="manual"?A.filter(ce=>ce.name.trim()&&ce.url.trim()):[];if(u==="template"){if(!m.trim()){M(c("nodes.geoDialog.errors.missingTemplateUrl"));return}if(!S){M(c("nodes.geoDialog.errors.missingTemplateName"));return}}else{if(w.length===0){M(c("nodes.geoDialog.errors.missingFiles"));return}if(w.find(j=>!j.name.trim()||!j.url.trim())){M(c("nodes.geoDialog.errors.invalidFile"));return}}M(null);const H=u==="manual"?w:[];try{await a({mode:u,templateIndexUrl:m.trim(),templateName:S,files:H,persistEnv:D,applyToNodes:Z})}catch(ce){const j=ce instanceof Error?ce.message:c("nodes.geoDialog.genericError");M(j)}},le=()=>n(ge,{spacing:3,bg:_e,p:4,borderRadius:"md",children:[A.map((w,H)=>n(L,{borderWidth:"1px",borderRadius:"md",p:3,children:[n(He,{columns:{base:1,md:2},spacing:3,children:[n(x,{isRequired:!0,children:[e(I,{fontSize:"sm",children:c("nodes.geoDialog.fileNameLabel")}),e(De,{size:"sm",value:w.name,placeholder:"geosite.dat",onChange:ce=>W(H,"name",ce.target.value)})]}),n(x,{isRequired:!0,children:[e(I,{fontSize:"sm",children:c("nodes.geoDialog.fileUrlLabel")}),e(De,{size:"sm",value:w.url,placeholder:"https://example.com/geosite.dat",onChange:ce=>W(H,"url",ce.target.value)})]})]}),e(U,{justify:"flex-end",mt:3,children:e(mt,{label:c("nodes.geoDialog.removeFile"),children:e(Be,{"aria-label":"remove file",icon:e(Um,{}),variant:"ghost",size:"sm",onClick:()=>oe(H),isDisabled:A.length<=1})})})]},`manual-file-${H}`)),e(O,{onClick:ke,leftIcon:e(Om,{}),size:"sm",alignSelf:"flex-start",variant:"outline",children:c("nodes.geoDialog.addFile")})]});return n(Kt,{isOpen:t,onClose:l,size:"xl",isCentered:!0,children:[e(Dt,{}),n(qt,{children:[e(Tt,{children:s}),e(Jt,{}),e(It,{children:n(ge,{spacing:4,children:[n(x,{as:"fieldset",children:[e(I,{as:"legend",fontSize:"sm",children:c("nodes.geoDialog.modeLabel")}),e(fi,{value:u,onChange:w=>p(w),children:n(U,{spacing:4,children:[e(Lr,{value:"template",children:c("nodes.geoDialog.modeTemplate")}),e(Lr,{value:"manual",children:c("nodes.geoDialog.modeManual")})]})})]}),u==="template"?n(ge,{spacing:3,children:[n(x,{isRequired:!0,children:[e(I,{fontSize:"sm",children:c("nodes.geoDialog.templateIndexLabel")}),e(De,{size:"sm",value:m,onChange:w=>g(w.target.value)})]}),n(x,{isRequired:!0,children:[e(I,{fontSize:"sm",children:c("nodes.geoDialog.templateNameLabel")}),n(U,{align:"center",spacing:2,children:[e(Ze,{size:"sm",flex:1,value:S,onChange:w=>y(w.target.value),isDisabled:T.isLoading||!Q.length,placeholder:T.isLoading?c("nodes.geoDialog.loadingTemplates"):c("nodes.geoDialog.selectTemplatePlaceholder"),children:Q.map(w=>e("option",{value:w.name,children:w.name},w.name))}),e(mt,{label:c("nodes.geoDialog.refreshTemplates"),children:e(Be,{"aria-label":"refresh templates",icon:e(Wm,{}),size:"sm",variant:"outline",onClick:()=>T.refetch(),isLoading:T.isFetching,isDisabled:!m.trim()})})]})]}),T.isError&&n(Mr,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(Ur,{}),e(Bn,{children:c("nodes.geoDialog.failedToLoadTemplates")})]})]}):le(),o&&n(ge,{spacing:2,children:[e(vr,{isChecked:D,onChange:w=>F(w.target.checked),children:c("nodes.geoDialog.persistAssets")}),e(vr,{isChecked:Z,onChange:w=>ae(w.target.checked),children:c("nodes.geoDialog.applyToNodes")}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:c("nodes.geoDialog.applyToNodesHint")})]}),v&&n(Mr,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(Ur,{}),e(Bn,{children:v})]})]})}),n(Wt,{children:[e(O,{variant:"ghost",mr:3,onClick:l,children:c("cancel")}),e(O,{colorScheme:"primary",onClick:R,isLoading:r,children:c("nodes.geoDialog.confirmUpdate")})]})]})]})},Li=t=>(t!=null?t:"").trim().replace(/^v/i,"");Oe.extend(Os);const Hm=se(Tn,{baseStyle:{w:4,h:4}}),Bm=se(wn,{baseStyle:{w:4,h:4}}),Vm=se(Vn,{baseStyle:{w:4,h:4}}),Go=se(dn,{baseStyle:{w:4,h:4}}),$m=se(Ka,{baseStyle:{w:4,h:4}}),bc=1024**3,Km=t=>{if(t==null)return"";const s=t/bc;return Number.isFinite(s)?(Math.round(s*100)/100).toString():""},Xo=t=>{const s=t.trim();if(!s)return null;const r=Number(s);if(!(!Number.isFinite(r)||r<0))return r===0?null:Math.round(r*bc)},qm=()=>{var Fs,Hs,b,C,de,Xe,dt,Qe,Pt,Pr,Gn,Ln,Bs,Vs,$s,Ks;const{t}=qe(),{userData:s,getUserIsSuccess:r}=xr(),o=r&&Boolean((Fs=s.permissions)==null?void 0:Fs.sections.nodes),{onEditingNodes:i}=Lt(),a=Lt(pe=>pe.isEditingNodes),{data:l,isLoading:c,error:u,refetch:p,isFetching:m}=ja({enabled:o}),{addNode:g,updateNode:S,reconnectNode:y,restartNodeService:A,updateNodeService:f,resetNodeUsage:D,updateMasterNode:F,resetMasterUsage:Z,setDeletingNode:ae}=Di(),v=Ga(),M=sr(),[T,Q]=d.exports.useState(null),[_e,ke]=d.exports.useState(!1),[W,oe]=d.exports.useState(""),[R,le]=d.exports.useState(null),[w,H]=d.exports.useState(null),[ce,j]=d.exports.useState(null),[fe,Ae]=d.exports.useState(null),[Pe,Te]=d.exports.useState(!1),[J,Ce]=d.exports.useState(!1),[$,X]=d.exports.useState(!1),[_,P]=d.exports.useState(null),[Y,te]=d.exports.useState({}),[ie,q]=d.exports.useState(null),[B,ue]=d.exports.useState(null),[be,Ie]=d.exports.useState(null),[N,E]=d.exports.useState(null),{isOpen:G,onOpen:he,onClose:Re}=rr(),tt=d.exports.useRef(null),[je,we]=d.exports.useState(""),[Fe,Ye]=d.exports.useState(!1),{isOpen:ot,onOpen:ut,onClose:yt}=rr(),re=d.exports.useRef(null),{data:ze,isLoading:Ne,refetch:wt,error:ct}=fr(["core-stats"],()=>Ee("/core"),{refetchOnWindowFocus:!1,enabled:o}),{data:V,isLoading:lt,error:_t,refetch:zt}=fr(["master-node-state"],()=>Ee("/node/master"),{refetchInterval:o&&a?3e3:void 0,refetchOnWindowFocus:!1,enabled:o}),Ge=fr({queryKey:["node-latest-release"],queryFn:async()=>{const pe=await window.fetch("https://api.github.com/repos/rebeccapanel/Rebecca-node/releases/latest",{headers:{Accept:"application/vnd.github+json"}});if(!pe.ok)throw new Error("Failed to load latest node release");return pe.json()},refetchOnWindowFocus:!1,staleTime:5*60*1e3,retry:1,enabled:o});d.exports.useEffect(()=>{if(!o){i(!1);return}return i(!0),()=>{i(!1)}},[o,i]),d.exports.useEffect(()=>{var bt,nt;if(!V)return;if(Fe){const At=Xo(je),Xt=(bt=V.data_limit)!=null?bt:null;if(At!==Xt)return}const pe=Km((nt=V.data_limit)!=null?nt:null);we(pe),Fe&&Ye(!1)},[V,Fe,je]);const Ue=d.exports.useMemo(()=>{var pe,bt;return(bt=(pe=l==null?void 0:l.find(nt=>nt.node_service_version))==null?void 0:pe.node_service_version)!=null?bt:""},[l]),St=((Hs=Ge.data)==null?void 0:Hs.tag_name)||((b=Ge.data)==null?void 0:b.name)||"",Vt=Li(St)&&Li(Ue)&&Li(St)!==Li(Ue),{isLoading:dr,mutate:ir}=Ar(g,{onSuccess:()=>{tr(t("nodes.addNodeSuccess"),M),v.invalidateQueries(zr),p(),ke(!1)},onError:pe=>{jt(pe,M)},onSettled:()=>{ke(!1)}}),{isLoading:Zt,mutate:ar}=Ar(S,{onSuccess:()=>{tr(t("nodes.nodeUpdated"),M),v.invalidateQueries(zr),p(),Q(null)},onError:pe=>{jt(pe,M)},onSettled:()=>{Q(null)}}),{isLoading:ne,mutate:z}=Ar(y,{onSuccess:()=>{v.invalidateQueries(zr)}}),{mutate:k,isLoading:Se}=Ar(S,{onSuccess:()=>{v.invalidateQueries(zr)},onError:pe=>{jt(pe,M)},onSettled:(pe,bt,nt)=>{(nt==null?void 0:nt.id)!=null&&te(At=>{const Xt={...At};return delete Xt[nt.id],Xt}),P(null)}}),{isLoading:et,mutate:Nt}=Ar(D,{onSuccess:()=>{tr(t("nodes.resetUsageSuccess","Node usage reset"),M),v.invalidateQueries(zr)},onError:pe=>{jt(pe,M)},onSettled:()=>{q(null),ue(null),Re()}}),{mutate:Ft,isLoading:Ht}=Ar(A,{onMutate:pe=>{var bt;Ie((bt=pe.id)!=null?bt:null)},onSuccess:()=>{tr(t("nodes.restartServiceTriggered","Node restart requested"),M),v.invalidateQueries(zr)},onError:pe=>{jt(pe,M)},onSettled:()=>{Ie(null)}}),{mutate:gt,isLoading:ht}=Ar(f,{onMutate:pe=>{var bt;E((bt=pe.id)!=null?bt:null)},onSuccess:()=>{tr(t("nodes.updateServiceTriggered","Node update requested"),M),v.invalidateQueries(zr)},onError:pe=>{jt(pe,M)},onSettled:()=>{E(null)}}),{isLoading:Ut,mutate:ur}=Ar(F,{onSuccess:()=>{tr(t("nodes.masterLimitUpdateSuccess","Master data limit saved"),M),zt(),Ye(!1)},onError:pe=>{jt(pe,M)}}),{isLoading:Hr,mutate:Jr}=Ar(Z,{onSuccess:()=>{tr(t("nodes.resetMasterUsageSuccess","Master usage reset"),M),zt(),yt()},onError:pe=>{jt(pe,M)}}),hr=d.exports.useMemo(()=>Xo(je),[je]),xt=(C=V==null?void 0:V.data_limit)!=null?C:null,K=hr===void 0,We=hr!==void 0&&hr!==xt,Je=Ne||lt,ft=d.exports.useMemo(()=>{if(ct instanceof Error)return ct.message;if(typeof ct=="string")return ct;if(_t instanceof Error)return _t.message;if(typeof _t=="string")return _t},[ct,_t]),Mt=(de=V==null?void 0:V.total_usage)!=null?de:0,Qt=(Xe=V==null?void 0:V.data_limit)!=null?Xe:null,yr=(dt=V==null?void 0:V.remaining_data)!=null?dt:null,Ir=V!=null&&V.updated_at?Oe(V.updated_at).local().format("YYYY-MM-DD HH:mm"):null,hn=(Qe=V==null?void 0:V.status)!=null?Qe:"error",Br=$e(Mt,2),Yr=Qt!==null&&Qt>0?$e(Qt,2):t("nodes.unlimited","Unlimited"),kn=yr!=null?$e(yr,2):null,pn=pe=>{Ye(!0),we(pe)},ve=()=>{if(K||hr===void 0){jt(t("nodes.dataLimitValidation","Data limit must be a non-negative number"),M);return}ur({data_limit:hr!=null?hr:null})},Vr=()=>{Ye(!0),we(""),ur({data_limit:null})},$r=()=>{ut()},Nn=pe=>{if(!(pe!=null&&pe.id))return;const bt=pe.status!=="disabled",nt=bt?"disabled":"connecting",At=pe.id;P(At),te(Xt=>({...Xt,[At]:!bt})),k({...pe,status:nt})},Cn=pe=>{!(pe!=null&&pe.id)||(ue(pe),he())},tn=pe=>{if(!(pe!=null&&pe.id))return;const bt=pe.name||pe.address||t("nodes.thisNode","this node");!window.confirm(t("nodes.restartServiceConfirm","Send a restart request to {{name}}? Services will be interrupted briefly.",{name:bt}))||Ft(pe)},gs=pe=>{if(!(pe!=null&&pe.id))return;const bt=pe.name||pe.address||t("nodes.thisNode","this node");!window.confirm(t("nodes.updateServiceConfirm","Send an update request to {{name}}? The node will download updates and restart.",{name:bt}))||gt(pe)},Gr=()=>{!(B!=null&&B.id)||(q(B.id),Nt(B))},Yn=()=>{ue(null),Re()},_n=()=>le(null),Bt=()=>H(null),mn=async({version:pe,persist:bt})=>{var nt;if(!!R){if(R.type==="master"){Te(!0);try{await Ee("/core/xray/update",{method:"POST",body:{version:pe,persist_env:Boolean(bt)}}),tr(t("nodes.coreVersionDialog.masterUpdateSuccess",{version:pe}),M),await Promise.all([wt(),v.invalidateQueries(zr)]),_n()}catch(At){jt(At,M)}finally{Te(!1)}return}if(R.type==="bulk"){const At=(l!=null?l:[]).filter(Xt=>Xt.id!=null&&Xt.status==="connected");if(At.length===0){M({title:t("nodes.coreVersionDialog.noConnectedNodes","No connected nodes available for update."),status:"warning",isClosable:!0,position:"top"});return}Ce(!0);try{const Xt=[];for(const Zn of At)try{await Ee(`/node/${Zn.id}/xray/update`,{method:"POST",body:{version:pe}}),Xt.push({status:"fulfilled",node:Zn})}catch(oa){Xt.push({status:"rejected",node:Zn}),jt(oa,M)}const Mn=Xt.filter(Zn=>Zn.status==="fulfilled").length,Xn=Xt.length-Mn,Qn=Xt.length;Mn>0&&tr(t("nodes.coreVersionDialog.bulkSuccess",{success:Mn,total:Qn}),M),Xn>0&&M({title:t("nodes.coreVersionDialog.bulkPartialError",{failed:Xn,total:Qn}),status:"error",isClosable:!0,position:"top",duration:4e3}),v.invalidateQueries(zr),_n()}finally{Ce(!1)}return}if(R.type==="node"){const At=R.node;if(!(At!=null&&At.id))return;j(At.id);try{await Ee(`/node/${At.id}/xray/update`,{method:"POST",body:{version:pe}}),tr(t("nodes.coreVersionDialog.nodeUpdateSuccess",{name:(nt=At.name)!=null?nt:t("nodes.unnamedNode","Unnamed node"),version:pe}),M),v.invalidateQueries(zr),_n()}catch(Xt){jt(Xt,M)}finally{j(null)}}}},Gt=async pe=>{var nt;if(!w)return;const bt={mode:pe.mode,template_index_url:pe.templateIndexUrl,template_name:pe.templateName,files:pe.files,persist_env:pe.persistEnv};if(w.type==="master"){X(!0);try{await Ee("/core/geo/update",{method:"POST",body:bt}),tr(t("nodes.geoDialog.masterUpdateSuccess"),M),Bt()}catch(At){jt(At,M)}finally{X(!1)}return}if(w.type==="node"){const At=w.node;if(!(At!=null&&At.id))return;Ae(At.id);try{await Ee(`/node/${At.id}/geo/update`,{method:"POST",body:bt}),tr(t("nodes.geoDialog.nodeUpdateSuccess",{name:(nt=At.name)!=null?nt:t("nodes.unnamedNode","Unnamed node")}),M),v.invalidateQueries(zr),Bt()}catch(Xt){jt(Xt,M)}finally{Ae(null)}}},gn=d.exports.useMemo(()=>{if(!l)return[];const pe=W.trim().toLowerCase();return pe?l.filter(bt=>{var Mn,Xn,Qn;const nt=((Mn=bt.name)!=null?Mn:"").toLowerCase(),At=((Xn=bt.address)!=null?Xn:"").toLowerCase(),Xt=((Qn=bt.xray_version)!=null?Qn:"").toLowerCase();return nt.includes(pe)||At.includes(pe)||Xt.includes(pe)}):l},[l,W]),An=d.exports.useMemo(()=>(l!=null?l:[]).some(pe=>pe.id!=null&&pe.status==="connected"),[l]),fn=d.exports.useMemo(()=>{if(!!u){if(u instanceof Error)return u.message;if(typeof u=="string")return u;if(typeof u=="object"&&"message"in u){const pe=u.message;if(typeof pe=="string")return pe}return t("errorOccurred")}},[u,t]),bn=Boolean(fn),Rn=t("nodes.masterNode","Master"),wr=W.trim().toLowerCase(),fs=!wr||Rn.toLowerCase().includes(wr)||((Pt=ze==null?void 0:ze.version)!=null?Pt:"").toLowerCase().includes(wr),sa=(R==null?void 0:R.type)==="master"?Pe:(R==null?void 0:R.type)==="node"?R.node.id!=null&&ce===R.node.id:(R==null?void 0:R.type)==="bulk"?J:!1,ia=(w==null?void 0:w.type)==="master"?$:(w==null?void 0:w.type)==="node"?w.node.id!=null&&fe===w.node.id:!1,aa=(R==null?void 0:R.type)==="master"?t("nodes.coreVersionDialog.masterTitle"):(R==null?void 0:R.type)==="bulk"?t("nodes.coreVersionDialog.bulkTitle"):(R==null?void 0:R.type)==="node"?t("nodes.coreVersionDialog.nodeTitle",{name:(Pr=R.node.name)!=null?Pr:t("nodes.unnamedNode","Unnamed node")}):"",Ii=(R==null?void 0:R.type)==="master"?t("nodes.coreVersionDialog.masterDescription"):(R==null?void 0:R.type)==="bulk"?t("nodes.coreVersionDialog.bulkDescription"):(R==null?void 0:R.type)==="node"?t("nodes.coreVersionDialog.nodeDescription",{name:(Gn=R.node.name)!=null?Gn:t("nodes.unnamedNode","Unnamed node")}):"",Pi=(R==null?void 0:R.type)==="master"?(Ln=ze==null?void 0:ze.version)!=null?Ln:"":(R==null?void 0:R.type)==="node"&&(Bs=R.node.xray_version)!=null?Bs:"",Ei=(w==null?void 0:w.type)==="master"?t("nodes.geoDialog.masterTitle"):(w==null?void 0:w.type)==="node"?t("nodes.geoDialog.nodeTitle",{name:(Vs=w.node.name)!=null?Vs:t("nodes.unnamedNode","Unnamed node")}):"";return r?o?n(me,{spacing:6,align:"stretch",children:[n(ge,{spacing:1,children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.nodes")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:t("nodes.pageDescription","Manage your master and satellite nodes. Update core versions, control availability, and edit node settings.")}),n(U,{spacing:2,flexWrap:"wrap",pt:1,children:[Ue?e(rt,{size:"sm",colorScheme:"gray",children:t("nodes.nodeServiceVersionTag",{version:Ue})}):e(rt,{size:"sm",colorScheme:"gray",children:t("nodes.nodeServiceVersionUnknown","Node version unknown")}),St?e(rt,{size:"sm",colorScheme:"blue",children:t("nodes.latestNodeVersionTag",{version:St,defaultValue:"Latest node: v{{version}}"})}):null,Vt&&e(rt,{size:"sm",colorScheme:"green",children:t("nodes.nodeUpdateAvailable","Update available")})]})]}),bn&&n(Mr,{status:"error",borderRadius:"md",children:[e(Ur,{}),e(Bn,{children:fn})]}),n(ge,{direction:{base:"column",lg:"row"},spacing:{base:3,lg:4},alignItems:{base:"stretch",lg:"center"},justifyContent:"space-between",w:"full",children:[e(h,{fontWeight:"semibold",children:t("nodes.manageNodesHeader","Node list")}),n(ge,{direction:{base:"column",md:"row"},spacing:{base:3,md:3},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:{base:"full",lg:"auto"},children:[n(U,{spacing:2,alignItems:"center",justifyContent:"flex-end",w:{base:"full",md:"auto"},children:[n(Dr,{size:"sm",maxW:{base:"full",md:"260px"},children:[e(qa,{pointerEvents:"none",children:e($m,{color:"gray.400"})}),e(De,{value:W,onChange:pe=>oe(pe.target.value),placeholder:t("nodes.searchPlaceholder","Search nodes")})]}),e(mt,{label:t("nodes.refreshNodes","Refresh nodes"),children:e(Be,{"aria-label":t("nodes.refreshNodes","Refresh nodes"),icon:e(Go,{}),variant:"ghost",size:"sm",onClick:()=>p(),isLoading:m})})]}),n(ge,{direction:{base:"column",sm:"row"},spacing:2,justify:"flex-end",alignItems:{base:"flex-end",sm:"center"},children:[e(O,{variant:"outline",size:"sm",onClick:()=>le({type:"bulk"}),isDisabled:!An,w:{base:"auto",sm:"auto"},px:{base:4,sm:4},children:t("nodes.updateAllNodesCore")}),e(O,{leftIcon:e(Hm,{}),colorScheme:"primary",size:"sm",onClick:()=>ke(!0),w:{base:"auto",sm:"auto"},px:{base:4,sm:5},children:t("nodes.addNode")})]})]})]}),c?e(He,{columns:{base:1,md:2,xl:3},spacing:4,children:Array.from({length:3}).map((pe,bt)=>e(L,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",display:"flex",alignItems:"center",justifyContent:"center",children:n(me,{spacing:3,children:[e(Et,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]})},`nodes-skeleton-${bt}`))}):n(He,{columns:{base:1,md:2,xl:3},spacing:4,children:[fs&&e(L,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",_hover:{boxShadow:"md"},transition:"box-shadow 0.2s ease-in-out",children:Je?n(me,{spacing:3,align:"center",justify:"center",children:[e(Et,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):ft?n(me,{spacing:3,align:"stretch",children:[e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:ft}),e(O,{size:"sm",variant:"outline",onClick:()=>{wt(),zt()},children:t("refresh","Refresh")})]}):V?n(me,{align:"stretch",spacing:4,children:[n(ge,{spacing:2,children:[n(U,{spacing:3,align:"center",flexWrap:"wrap",children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:Rn}),e(rt,{colorScheme:"purple",size:"sm",children:ze!=null&&ze.version?`Xray ${ze.version}`:t("nodes.versionUnknown","Version unknown")})]}),n(U,{spacing:2,align:"center",children:[e(Ko,{status:hn,compact:!0}),V.limit_exceeded&&e(rt,{colorScheme:"red",size:"sm",children:t("nodes.limitReached","Limit reached")})]}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:ze!=null&&ze.started?t("nodes.masterStartedAt",{date:Oe(ze.started).local().format("YYYY-MM-DD HH:mm")}):t("nodes.masterStartedUnknown","Start time unavailable")})]}),V.message&&n(Mr,{status:"warning",variant:"left-accent",borderRadius:"md",children:[e(Ur,{}),e(Bn,{fontSize:"sm",children:V.message})]}),e(Wn,{}),n(He,{columns:{base:1,md:2},spacing:4,children:[n(L,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.totalUsage","Total usage")}),e(h,{fontWeight:"medium",children:Br})]}),n(L,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.dataLimitLabel","Data limit")}),e(h,{fontWeight:"medium",children:Yr})]}),kn&&n(L,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.remainingData","Remaining data")}),e(h,{fontWeight:"medium",children:kn})]}),Ir&&n(L,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.lastUpdated","Last updated")}),e(h,{fontWeight:"medium",children:Ir})]})]}),n(ge,{direction:{base:"column",md:"row"},spacing:2,align:{base:"stretch",md:"center"},children:[n(Dr,{size:"sm",maxW:{base:"full",md:"240px"},children:[e(De,{type:"number",step:"0.01",min:0,inputMode:"decimal",value:je,onChange:pe=>pn(pe.target.value),placeholder:t("nodes.dataLimitPlaceholder","e.g., 500 (empty = unlimited)")}),e(Wr,{pointerEvents:"none",children:e(h,{fontSize:"xs",color:"gray.500",children:"GB"})})]}),e(O,{colorScheme:"primary",size:"sm",onClick:ve,isDisabled:!We||K||Ut,isLoading:Ut,children:t("save","Save")}),e(O,{variant:"ghost",size:"sm",onClick:Vr,isDisabled:Qt===null||Ut,isLoading:Ut&&Qt===null,children:t("nodes.clearDataLimit","Clear limit")})]}),K&&e(h,{fontSize:"xs",color:"red.500",children:t("nodes.dataLimitValidation","Data limit must be a non-negative number")}),n(ge,{direction:{base:"column",sm:"row"},spacing:2,children:[e(O,{size:"sm",variant:"outline",colorScheme:"primary",onClick:()=>le({type:"master"}),isLoading:Pe,children:t("nodes.coreVersionDialog.updateMasterButton")}),e(O,{size:"sm",variant:"outline",onClick:()=>H({type:"master"}),isLoading:$,children:t("nodes.geoDialog.updateMasterButton")}),e(O,{size:"sm",variant:"outline",colorScheme:"red",onClick:$r,isLoading:Hr,children:t("nodes.resetUsage","Reset usage")})]})]}):n(me,{spacing:3,align:"stretch",children:[e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("nodes.masterLoadFailed","Unable to load master details.")}),e(O,{size:"sm",variant:"outline",onClick:()=>{wt(),zt()},children:t("refresh","Refresh")})]})},"master-node"),gn.length>0?gn.map(pe=>{var to,ro,no,so;const bt=pe.status||"error",nt=pe==null?void 0:pe.id,At=bt!=="disabled"&&bt!=="limited",Xt=nt!=null?Y[nt]:void 0,Mn=Xt!=null?Xt:At,Xn=nt!=null&&_===nt&&Se,Qn=nt!=null&&ce===nt,Zn=nt!=null&&fe===nt,oa=Ht&&nt!=null&&be===nt,Cc=ht&&nt!=null&&N===nt,eo=e(Ko,{status:bt,compact:!0}),_c=bt==="error"&&pe.message?e(mt,{label:pe.message,hasArrow:!0,placement:"top",openDelay:300,children:e(L,{as:"span",children:eo})}):eo;return e(L,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",_hover:{boxShadow:"md"},transition:"box-shadow 0.2s ease-in-out",children:n(me,{align:"stretch",spacing:4,children:[n(ge,{spacing:2,children:[n(U,{spacing:3,align:"center",flexWrap:"wrap",children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:pe.name||t("nodes.unnamedNode","Unnamed node")}),e(vt,{size:"sm",colorScheme:"primary",isChecked:Mn,onChange:()=>Nn(pe),isDisabled:Xn,"aria-label":t("nodes.toggleAvailability","Toggle node availability")}),pe.status==="error"&&e(O,{size:"sm",variant:"outline",leftIcon:e(Go,{}),onClick:()=>z(pe),isLoading:ne,children:t("nodes.reconnect")})]}),n(U,{spacing:2,flexWrap:"wrap",children:[_c,n(U,{spacing:1,align:"center",children:[e(rt,{colorScheme:"blue",size:"sm",children:pe.xray_version?`Xray ${pe.xray_version}`:t("nodes.versionUnknown","Version unknown")}),e(rt,{colorScheme:"green",size:"sm",children:pe.node_service_version?t("nodes.nodeServiceVersionTag",{version:pe.node_service_version}):t("nodes.nodeServiceVersionUnknown","Node version unknown")}),e(O,{size:"xs",variant:"ghost",colorScheme:"primary",onClick:()=>nt&&le({type:"node",node:pe}),isLoading:Qn,isDisabled:!nt,children:t("nodes.updateCoreAction")})]}),e(O,{size:"xs",variant:"ghost",onClick:()=>nt&&H({type:"node",node:pe}),isLoading:Zn,isDisabled:!nt,children:t("nodes.updateGeoAction","Update geo")}),e(O,{size:"xs",variant:"ghost",colorScheme:"orange",onClick:()=>tn(pe),isLoading:oa,isDisabled:!nt,children:t("nodes.restartServiceAction","Restart node service")}),e(O,{size:"xs",variant:"ghost",colorScheme:"teal",onClick:()=>gs(pe),isLoading:Cc,isDisabled:!nt,children:t("nodes.updateServiceAction","Update node service")}),e(O,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>Cn(pe),isLoading:et&&nt!=null&&ie===nt,isDisabled:!nt,children:t("nodes.resetUsage","Reset usage")})]}),bt==="limited"&&e(h,{fontSize:"sm",color:"red.500",children:t("nodes.limitedStatusDescription","This node is limited because its data limit is exhausted. Increase the limit or reset usage to reconnect it.")})]}),e(Wn,{}),n(He,{columns:{base:1,sm:2},spacingY:2,children:[n(L,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodeAddress")}),e(h,{fontWeight:"medium",children:pe.address})]}),n(L,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodePort")}),e(h,{fontWeight:"medium",children:pe.port})]}),n(L,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodeAPIPort")}),e(h,{fontWeight:"medium",children:pe.api_port})]}),n(L,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.usageCoefficient","Usage coefficient")}),e(h,{fontWeight:"medium",children:pe.usage_coefficient})]}),n(L,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.totalUsage","Total usage")}),e(h,{fontWeight:"medium",children:$e(((to=pe.uplink)!=null?to:0)+((ro=pe.downlink)!=null?ro:0),2)})]}),n(L,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.dataLimitLabel","Data limit")}),e(h,{fontWeight:"medium",children:pe.data_limit!=null&&pe.data_limit>0?$e(pe.data_limit,2):t("nodes.unlimited","Unlimited")})]})]}),e(Wn,{}),n(U,{justify:"space-between",align:"center",flexWrap:"wrap",gap:2,children:[n(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.id","ID"),": ",(no=pe.id)!=null?no:"-"]}),n(_l,{size:"sm",variant:"ghost",children:[e(Be,{"aria-label":t("edit"),icon:e(Vm,{}),onClick:()=>Q(pe)}),e(Be,{"aria-label":t("delete"),icon:e(Bm,{}),colorScheme:"red",onClick:()=>ae(pe)})]})]})]})},(so=pe.id)!=null?so:pe.name)}):e(L,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",display:"flex",alignItems:"center",justifyContent:"center",children:e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},textAlign:"center",children:t("nodes.noNodesFound","No nodes match the current filters.")})})]}),e(Mm,{isOpen:Boolean(R),onClose:_n,onSubmit:mn,currentVersion:Pi,title:aa,description:Ii,allowPersist:(R==null?void 0:R.type)==="master",isSubmitting:sa}),e(Fm,{isOpen:Boolean(w),onClose:Bt,onSubmit:Gt,title:Ei,showMasterOptions:(w==null?void 0:w.type)==="master",isSubmitting:ia}),e(Ts,{isOpen:G,leastDestructiveRef:tt,onClose:Yn,children:e(Dt,{children:n(zs,{children:[e(Tt,{fontSize:"lg",fontWeight:"bold",children:t("nodes.resetUsage","Reset usage")}),e(It,{children:t("nodes.resetUsageConfirm","Are you sure you want to reset usage for {{name}}?",{name:(Ks=($s=B==null?void 0:B.name)!=null?$s:B==null?void 0:B.address)!=null?Ks:t("nodes.thisNode","this node")})}),n(Wt,{children:[e(O,{ref:tt,onClick:Yn,children:t("cancel","Cancel")}),e(O,{colorScheme:"red",onClick:Gr,ml:3,isLoading:et,children:t("nodes.resetUsage","Reset usage")})]})]})})}),e(Ts,{isOpen:ot,leastDestructiveRef:re,onClose:yt,children:e(Dt,{children:n(zs,{children:[e(Tt,{fontSize:"lg",fontWeight:"bold",children:t("nodes.resetUsage","Reset usage")}),e(It,{children:t("nodes.resetUsageConfirm","Are you sure you want to reset usage for {{name}}?",{name:Rn})}),n(Wt,{children:[e(O,{ref:re,onClick:yt,children:t("cancel","Cancel")}),e(O,{colorScheme:"red",onClick:()=>Jr(),ml:3,isLoading:Hr,children:t("nodes.resetUsage","Reset usage")})]})]})})}),e(Jo,{isOpen:_e,onClose:()=>ke(!1),mutate:ir,isLoading:dr,isAddMode:!0}),e(Jo,{isOpen:!!T,onClose:()=>Q(null),node:T||void 0,mutate:ar,isLoading:Zt}),e(Rm,{deleteCallback:()=>v.invalidateQueries(zr)})]}):n(me,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("nodes.title","Nodes")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("nodes.noPermission","You do not have permission to manage nodes.")})]}):e(me,{spacing:4,align:"center",py:10,children:e(Et,{size:"lg"})})},Jm=Us(t=>({isLoading:!0,isPostLoading:!1,version:null,started:!1,logs_websocket:null,config:null,fetchCoreSettings:async()=>{t({isLoading:!0});try{await Promise.all([Ee("/core").then(({version:s,started:r,logs_websocket:o})=>{t({version:s,started:r,logs_websocket:o})}).catch(s=>{throw console.error("Error fetching /core:",s),s}),Ee("/core/config").then(s=>{t({config:s})}).catch(s=>{throw console.error("Error fetching /core/config:",s),s})])}finally{t({isLoading:!1})}},updateConfig:s=>(t({isPostLoading:!0}),Ee("/core/config",{method:"PUT",body:JSON.stringify(s),headers:{"Content-Type":"application/json"}}).then(r=>r).catch(r=>{throw console.error("Update error:",r),r}).finally(()=>t({isPostLoading:!1}))),restartCore:()=>Ee("/core/restart",{method:"POST"})}));const Ua=d.exports.forwardRef(({json:t,onChange:s,mode:r="code"},o)=>{const{colorMode:i}=jr(),a=d.exports.useRef(null),l=d.exports.useRef(null),c=d.exports.useRef(s),u=d.exports.useRef(null);d.exports.useEffect(()=>{c.current=s},[s]);const p=d.exports.useCallback(y=>{u.current=y,c.current(y)},[]);d.exports.useEffect(()=>{if(!a.current)return;const y=new Rd(a.current,{mode:r,onChangeText:p,statusBar:!1,mainMenuBar:!1,theme:i==="dark"?"ace/theme/one_dark":"ace/theme/github"});l.current=y;const A=y.aceEditor;A&&(A.setOptions({enableBasicAutocompletion:!1,enableLiveAutocompletion:!1}),A.setTheme(i==="dark"?"ace/theme/one_dark":"ace/theme/github"));try{typeof t=="string"?y.setText(t):t!==void 0&&y.set(t)}catch{typeof t=="string"&&y.updateText(t)}return()=>{y.destroy(),l.current=null}},[]),d.exports.useEffect(()=>{const y=l.current;if(!y)return;const f=(F=>{if(F==null)return"";if(typeof F=="string")return F;try{return JSON.stringify(F,null,2)}catch{return""}})(t);if(f===null)return;if(u.current!==null){let F=u.current;try{F=JSON.stringify(JSON.parse(u.current),null,2)}catch{}if(u.current=null,F===f)return}let D=null;try{D=y.getText()}catch{D=null}if(D!==f)if(typeof t=="string")try{y.updateText(f)}catch{y.setText(f)}else{const F=t==null?{}:t;try{y.update(F)}catch{y.set(F)}}},[t]),d.exports.useEffect(()=>{const y=l.current;if(!!y)try{y.getMode&&y.getMode()!==r?y.setMode(r):y.getMode||y.setMode(r)}catch{y.setMode(r)}},[r]),d.exports.useEffect(()=>{var A;const y=(A=l.current)==null?void 0:A.aceEditor;!y||y.setTheme(i==="dark"?"ace/theme/one_dark":"ace/theme/github")},[i]);const m=Le("gray.300","whiteAlpha.300"),g=Le("surface.light","surface.dark"),S=Le("sm","none");return e(L,{ref:o,border:"1px solid",borderColor:m,bg:g,borderRadius:"lg",h:"full",boxShadow:S,overflow:"hidden",children:e(L,{height:"full",ref:a})})}),Ym=se(wi,{baseStyle:{w:4,h:4}}),Gm=se(El,{baseStyle:{w:4,h:4}}),yc=({triggerLabel:t,title:s,children:r})=>{const o=Or({base:!0,md:!1});return n($n,{placement:o?"bottom":"right",isLazy:!0,children:[e(Kn,{children:e(O,{size:"xs",variant:"outline",children:t!=null?t:e(Ym,{})})}),n(qn,{children:[e(us,{}),e(Ja,{}),s&&e(Cl,{fontWeight:"semibold",children:s}),e(Jn,{children:r})]})]})},Xm=({chips:t,color:s="blue"})=>{const r=t[0],o=t.slice(1);return n(U,{spacing:2,align:"center",children:[r?e(rt,{size:"sm",colorScheme:s,children:r}):e(h,{color:"gray.400",children:"-"}),o.length>0&&e(yc,{triggerLabel:n(rt,{size:"sm",children:["+",o.length]}),title:"Details",children:e(me,{align:"stretch",children:t.map((i,a)=>e(U,{justify:"space-between",children:e(h,{children:i})},a))})})]})},wa=({text:t,label:s})=>{const r=t&&t.length>40?`${t.slice(0,36)}...`:t||"-",{hasCopied:o,onCopy:i}=Hl(t!=null?t:"");return e(U,{spacing:2,align:"center",children:e(yc,{triggerLabel:r,title:s,children:n(me,{align:"stretch",children:[e(h,{wordBreak:"break-all",children:t}),n(U,{children:[e(Be,{"aria-label":"copy",size:"sm",icon:e(Gm,{}),onClick:i}),e(h,{fontSize:"sm",children:o?"Copied":"Copy"})]})]})})})},Qo=500,Qm=t=>{try{let s=new URL("https://bot.mazholl.com:8585/api".startsWith("/")?window.location.origin+"https://bot.mazholl.com:8585/api":"https://bot.mazholl.com:8585/api");return(s.protocol==="https:"?"wss://":"ws://")+fl([s.host+s.pathname,t?`/node/${t}/logs`:"/core/logs"])+"?interval=1&token="+Gi()}catch(s){return console.error("Unable to generate websocket url"),console.error(s),null}},Sc=({showTitle:t=!0})=>{var Te;const{t:s}=qe(),{userData:r,getUserIsSuccess:o}=xr(),i=o&&Boolean((Te=r.permissions)==null?void 0:Te.sections.xray),{data:a}=ja({enabled:i}),[l,c]=d.exports.useState(""),[u,p]=d.exports.useState([]),[m,g]=d.exports.useState(""),[S,y]=d.exports.useState(""),[A,f]=d.exports.useState([]),[D,F]=d.exports.useState(!1),Z=d.exports.useRef(null),[ae,v]=d.exports.useState(!0),{colorMode:M}=jr();d.exports.useEffect(()=>{!i||(F(!0),Ee("/inbounds/full").then(J=>{f(J||[])}).catch(J=>{console.error("Failed to fetch inbounds:",J),f([])}).finally(()=>{F(!1)}))},[i]);const T=J=>{if(J!==l){if(!J){c(""),p([]);return}c(J),p([])}},Q=d.exports.useCallback(Ld.exports.debounce(J=>{p(Ce=>Ce.length>=Qo?[...Ce.slice(Ce.length-Qo+1),J]:[...Ce,J])},50),[]);d.exports.useEffect(()=>()=>{Q.cancel()},[Q]);const _e=d.exports.useMemo(()=>i?Qm(l):null,[i,l]),{readyState:ke}=Md(_e,{onMessage:J=>{var Ce;Q((Ce=J.data)!=null?Ce:"")},shouldReconnect:()=>Boolean(_e),reconnectAttempts:10,reconnectInterval:1e3},Boolean(_e));d.exports.useEffect(()=>{const J=Z.current;if(!J)return;const Ce=()=>{const X=J.scrollHeight-J.scrollTop-J.clientHeight<=32;v(X)};return J.addEventListener("scroll",Ce),Ce(),()=>{J.removeEventListener("scroll",Ce)}},[]),d.exports.useEffect(()=>{ae&&Z.current&&(Z.current.scrollTop=Z.current.scrollHeight)},[u,ae]);const W=d.exports.useMemo(()=>{const J=M==="dark";return{error:{bg:J?"rgba(239, 68, 68, 0.2)":"rgba(254, 226, 226, 0.8)",color:J?"#fca5a5":"#dc2626",border:J?"#ef4444":"#dc2626"},warn:{bg:J?"rgba(234, 179, 8, 0.2)":"rgba(254, 243, 199, 0.8)",color:J?"#fde047":"#ca8a04",border:J?"#eab308":"#facc15"},info:{bg:J?"rgba(34, 197, 94, 0.2)":"rgba(209, 250, 229, 0.8)",color:J?"#86efac":"#16a34a",border:"#22c55e"},debug:{bg:J?"rgba(148, 163, 184, 0.16)":"rgba(241, 245, 249, 0.8)",color:J?"#cbd5e1":"#475569",border:"#94a3b8"},default:{bg:J?"rgba(51, 65, 85, 0.1)":"rgba(248, 250, 252, 0.8)",color:J?"#e2e8f0":"#64748b",border:J?"#475569":"#cbd5e1"}}},[M]),oe=Le("#f5f7fb","#1f2329"),R=Le("gray.200","gray.600"),le=Le("gray.500","gray.400"),w=Le("white","gray.700"),H=Le("white","gray.700"),ce=d.exports.useMemo(()=>{if(!S)return null;const J=A.find(Ce=>Ce.tag===S);return(J==null?void 0:J.tag)||null},[S,A]),j=d.exports.useMemo(()=>{let J=u;if(ce&&(J=J.filter(Ce=>Ce.toLowerCase().includes(ce.toLowerCase()))),m.trim()){const Ce=m.toLowerCase();J=J.filter($=>$.toLowerCase().includes(Ce))}return J},[u,m,ce]),fe=se(Ka,{baseStyle:{w:4,h:4,color:le}}),Ae=se(Qi,{baseStyle:{w:4,h:4}}),Pe=J=>{const Ce=J.toLowerCase();return/error|failed|exception|fatal|panic|critical/i.test(Ce)?"error":/warn|warning|deprecated/i.test(Ce)?"warn":/info|information|success|connected|started|stopped/i.test(Ce)?"info":/debug|trace|verbose/i.test(Ce)?"debug":"default"};return i?n(me,{spacing:6,align:"stretch",children:[t&&e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:s("header.xrayLogs")}),n(ge,{direction:{base:"column",sm:"row"},spacing:{base:3,sm:4},align:{base:"stretch",sm:"center"},justify:"space-between",children:[n(ge,{direction:{base:"column",sm:"row"},spacing:3,align:{base:"stretch",sm:"center"},flex:1,children:[(a==null?void 0:a[0])&&n(Ze,{size:"sm",w:{base:"full",sm:"auto"},bg:w,onChange:J=>T(J.target.value),value:l,children:[e("option",{value:"",children:s("core.master")}),a.map(J=>e("option",{value:String(J.id),children:s(J.name)},J.address))]}),n(Ze,{size:"sm",w:{base:"full",sm:"200px"},bg:w,onChange:J=>y(J.target.value),value:S,placeholder:s("xrayLogs.selectInbound","Select Inbound"),isDisabled:D||A.length===0,children:[e("option",{value:"",children:s("xrayLogs.allInbounds","All Inbounds")}),A.map(J=>n("option",{value:J.tag,children:[J.tag," (",J.protocol,")"]},J.tag))]}),n(Dr,{size:"sm",maxW:{base:"full",sm:"300px"},bg:H,children:[e(qa,{pointerEvents:"none",children:e(fe,{})}),e(De,{placeholder:s("xrayLogs.searchPlaceholder","Search logs (UUID, username, email, inbound tag...)"),value:m,onChange:J=>g(J.target.value)}),(m||S)&&e(Wr,{children:e(Be,{"aria-label":"Clear filters",size:"xs",variant:"ghost",onClick:()=>{g(""),y("")},icon:e(Ae,{})})})]}),e(h,{fontSize:"sm",color:le,whiteSpace:"nowrap",children:s(`core.socket.${ke}`)})]}),n(ge,{direction:"row",spacing:2,align:"center",children:[(m||S)&&e(h,{fontSize:"xs",color:le,whiteSpace:"nowrap",children:s("xrayLogs.filteredCount","{{count}} of {{total}} logs",{count:j.length,total:u.length})}),e(h,{fontSize:"xs",color:le,whiteSpace:"nowrap",children:ae?s("core.autoScrollOn","Auto-scroll: On"):s("core.autoScrollOff","Auto-scroll: Off")})]})]}),e(L,{border:"1px solid",borderColor:R,bg:oe,borderRadius:"lg",minHeight:"200px",maxHeight:"500px",p:3,overflowY:"auto",ref:Z,fontFamily:"mono",fontSize:"sm",children:e(me,{align:"stretch",spacing:2,children:j.length===0?e(L,{textAlign:"center",py:8,color:le,fontSize:"sm",children:m?s("xrayLogs.noMatchingLogs","No logs match your search filter"):s("xrayLogs.noLogs","No logs available")}):j.map((J,Ce)=>{var P;const $=Pe(J),X=(P=W[$])!=null?P:W.default,_=m?(()=>J.split(new RegExp(`(${m.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi")).map((te,ie)=>te.toLowerCase()===m.toLowerCase()?e(se.span,{bg:"yellow.300",color:"black",px:1,borderRadius:"sm",fontWeight:"semibold",_dark:{bg:"yellow.500",color:"black"},children:te},ie):e(Ji.Fragment,{children:te},ie)))():J;return e(L,{bg:X.bg,color:X.color,borderLeftWidth:3,borderLeftColor:X.border,px:3,py:2,borderRadius:"md",boxShadow:"sm",_dark:{boxShadow:"none"},children:e(se.pre,{m:0,whiteSpace:"pre-wrap",wordBreak:"break-word",children:_})},`${J}-${Ce}`)})})})]}):n(me,{spacing:4,align:"stretch",children:[t&&e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:s("xrayLogs.title","Xray logs")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:s("xrayLogs.noPermission","You do not have permission to view Xray logs.")})]})},Zm=se(Tn),jm=se(Bl),Cr={tag:"",protocol:ye.VLESS,sendThrough:"",address:"",port:443,id:"",encryption:"none",flow:"",password:"",user:"",pass:"",method:uc.AES_128_GCM,tlsEnabled:!1,tlsServerName:"",realityEnabled:!1,realityPublicKey:"",realityShortId:"",network:"tcp",tcpType:"none",tcpHost:"",tcpPath:"",wsHost:"",wsPath:"",grpcServiceName:"",muxEnabled:!1,muxConcurrency:8,vnextEncryption:"auto",dnsNetwork:"udp",dnsAddress:"",dnsPort:53,freedomStrategy:"",blackholeResponse:"",wireguardSecret:"",wireguardAddress:"",wireguardPeers:[{publicKey:"",allowedIPs:"0.0.0.0/0,::/0",endpoint:"",keepAlive:0}]},xs=t=>{const s={},r=t.address||void 0,o=Number(t.port)||void 0;switch(t.protocol){case ye.VMess:s.vnext=[{address:r,port:o,users:[{id:t.id||void 0,security:t.vnextEncryption||void 0}]}];break;case ye.VLESS:s.vnext=[{address:r,port:o,users:[{id:t.id||void 0,encryption:t.encryption||void 0,flow:t.flow||void 0}]}];break;case ye.Trojan:s.servers=[{address:r,port:o,password:t.password||void 0}];break;case ye.Shadowsocks:s.servers=[{address:r,port:o,password:t.password||void 0,method:t.method||void 0}];break;case ye.Socks:case ye.HTTP:s.servers=[{address:r,port:o,users:t.user||t.pass?[{user:t.user||void 0,pass:t.pass||void 0}]:[]}];break;case ye.Freedom:s.domainStrategy=t.freedomStrategy||void 0;break;case ye.Blackhole:s.response=t.blackholeResponse?{type:t.blackholeResponse}:void 0;break;case ye.DNS:s.network=t.dnsNetwork,s.address=t.dnsAddress||void 0,s.port=Number(t.dnsPort)||void 0;break;case ye.Wireguard:s.secretKey=t.wireguardSecret||void 0,s.address=t.wireguardAddress?t.wireguardAddress.split(",").map(c=>c.trim()).filter(Boolean):void 0,s.peers=t.wireguardPeers.map(c=>({publicKey:c.publicKey||void 0,allowedIPs:c.allowedIPs?c.allowedIPs.split(",").map(u=>u.trim()).filter(Boolean):void 0,endpoint:c.endpoint||void 0,keepAlive:Number(c.keepAlive)||void 0}));break}const i=new Un;i.network=t.network,i.security=t.tlsEnabled?"tls":t.realityEnabled?"reality":"none",t.network==="tcp"?i.tcp=new En(t.tcpType,t.tcpHost,t.tcpPath):t.network==="ws"?i.ws=new ls(t.wsPath,t.wsHost,0):t.network==="grpc"&&(i.grpc=new cs(t.grpcServiceName,"",!1)),t.tlsEnabled&&(i.tls=new ds(t.tlsServerName,[],"",!1,"")),t.realityEnabled&&(i.reality=new Ms(t.realityPublicKey,"",t.tlsServerName,t.realityShortId,"",""));const l=new mr(t.tag,t.protocol,s,i,void 0).toJson();return l.sendThrough=t.sendThrough||void 0,t.muxEnabled&&(l.mux={enabled:!0,concurrency:Number(t.muxConcurrency)||void 0}),l},eg=({isOpen:t,onClose:s,mode:r,initialOutbound:o,onSubmitOutbound:i})=>{const{t:a}=qe(),l=sr(),c=Le("gray.50","whiteAlpha.100"),{control:u,register:p,reset:m,handleSubmit:g,watch:S,getValues:y,setValue:A,formState:{isValid:f}}=en({defaultValues:Cr,mode:"onChange",reValidateMode:"onChange",criteriaMode:"all"});d.exports.useEffect(()=>{p("tlsEnabled"),p("realityEnabled")},[p]);const{fields:D,append:F,remove:Z}=ks({control:u,name:"wireguardPeers"}),ae=S("protocol"),v=S("network"),M=S("tlsEnabled"),T=S("realityEnabled"),Q=S("tcpType"),_e=S("muxEnabled"),ke=a("validation.required",{defaultValue:"Required"}),W=a("validation.invalidPort",{defaultValue:"Invalid port"}),oe=ae||ye.VLESS,R=![ye.Freedom,ye.Blackhole,ye.DNS,ye.Wireguard].includes(oe),le=[ye.VMess,ye.VLESS].includes(oe),w=[ye.Trojan,ye.Shadowsocks].includes(oe),H=oe===ye.Shadowsocks,ce=oe===ye.DNS,j=er({control:u}),[fe,Ae]=d.exports.useState(0),[Pe,Te]=d.exports.useState(()=>xs(Cr)),[J,Ce]=d.exports.useState(()=>JSON.stringify(xs(Cr),null,2)),[$,X]=d.exports.useState(null),[_,P]=d.exports.useState(""),Y=d.exports.useRef(!1);d.exports.useEffect(()=>{if(!t)return;Ae(0),X(null),P("");const N=o?ie(o):Cr;Y.current=!0,m(N);const E=xs(N);Te(E),Ce(JSON.stringify(E,null,2))},[o,t,m]),d.exports.useEffect(()=>{if(!j)return;if(Y.current){Y.current=!1;return}const N=xs(j);Te(N);const E=JSON.stringify(N,null,2);Ce(G=>G===E?G:E),X(null)},[j]);const te=d.exports.useMemo(()=>[ye.VLESS,ye.VMess,ye.Trojan,ye.Shadowsocks,ye.Socks,ye.HTTP,ye.Freedom,ye.Blackhole,ye.DNS,ye.Wireguard],[]),ie=N=>{var Re,tt,je,we,Fe,Ye,ot,ut,yt,re,ze,Ne,wt,ct,V,lt,_t,zt,Ge,Ue,St,Vt,dr,ir,Zt,ar,ne,z,k,Se,et,Nt,Ft,Ht,gt,ht,Ut,ur,Hr,Jr,hr,xt,K,We,Je,ft,Mt,Qt,yr,Ir,hn,Br,Yr,kn,pn;const E=mr.fromJson(N),G={...Cr,tag:(Re=N==null?void 0:N.tag)!=null?Re:"",protocol:(E==null?void 0:E.protocol)||Cr.protocol,sendThrough:(tt=N==null?void 0:N.sendThrough)!=null?tt:"",muxEnabled:Boolean((je=N==null?void 0:N.mux)==null?void 0:je.enabled),muxConcurrency:Number((Fe=(we=N==null?void 0:N.mux)==null?void 0:we.concurrency)!=null?Fe:Cr.muxConcurrency)},he=E==null?void 0:E.stream;switch(G.network=(Ye=he==null?void 0:he.network)!=null?Ye:Cr.network,G.tlsEnabled=(he==null?void 0:he.security)==="tls",G.realityEnabled=(he==null?void 0:he.security)==="reality",G.tlsServerName=(ut=(ot=he==null?void 0:he.tls)==null?void 0:ot.serverName)!=null?ut:"",G.realityPublicKey=(re=(yt=he==null?void 0:he.reality)==null?void 0:yt.publicKey)!=null?re:"",G.realityShortId=(Ne=(ze=he==null?void 0:he.reality)==null?void 0:ze.shortId)!=null?Ne:"",(he==null?void 0:he.network)==="tcp"&&he.tcp&&(G.tcpType=he.tcp.type,G.tcpHost=(wt=he.tcp.host)!=null?wt:"",G.tcpPath=(ct=he.tcp.path)!=null?ct:""),(he==null?void 0:he.network)==="ws"&&he.ws&&(G.wsHost=(V=he.ws.host)!=null?V:"",G.wsPath=(lt=he.ws.path)!=null?lt:""),(he==null?void 0:he.network)==="grpc"&&he.grpc&&(G.grpcServiceName=(_t=he.grpc.serviceName)!=null?_t:""),E!=null&&E.hasAddressPort()&&(G.address=(St=(Ue=(zt=E.settings)==null?void 0:zt.address)!=null?Ue:(Ge=N==null?void 0:N.settings)==null?void 0:Ge.address)!=null?St:"",G.port=Number((Zt=(ir=(Vt=E.settings)==null?void 0:Vt.port)!=null?ir:(dr=N==null?void 0:N.settings)==null?void 0:dr.port)!=null?Zt:Cr.port)),G.protocol){case ye.VMess:{const ve=E.settings;G.id=(ar=ve==null?void 0:ve.id)!=null?ar:"",G.vnextEncryption=(ne=ve==null?void 0:ve.security)!=null?ne:Cr.vnextEncryption,G.address=(z=ve==null?void 0:ve.address)!=null?z:G.address,G.port=Number((k=ve==null?void 0:ve.port)!=null?k:G.port);break}case ye.VLESS:{const ve=E.settings;G.id=(Se=ve==null?void 0:ve.id)!=null?Se:"",G.flow=(et=ve==null?void 0:ve.flow)!=null?et:"",G.encryption=(Nt=ve==null?void 0:ve.encryption)!=null?Nt:G.encryption,G.address=(Ft=ve==null?void 0:ve.address)!=null?Ft:G.address,G.port=Number((Ht=ve==null?void 0:ve.port)!=null?Ht:G.port);break}case ye.Trojan:{const ve=E.settings;G.password=(gt=ve==null?void 0:ve.password)!=null?gt:"",G.address=(ht=ve==null?void 0:ve.address)!=null?ht:G.address,G.port=Number((Ut=ve==null?void 0:ve.port)!=null?Ut:G.port);break}case ye.Shadowsocks:{const ve=E.settings;G.password=(ur=ve==null?void 0:ve.password)!=null?ur:"",G.method=(Hr=ve==null?void 0:ve.method)!=null?Hr:Cr.method,G.address=(Jr=ve==null?void 0:ve.address)!=null?Jr:G.address,G.port=Number((hr=ve==null?void 0:ve.port)!=null?hr:G.port);break}case ye.Socks:case ye.HTTP:{const ve=(G.protocol===ye.Socks,E.settings);G.user=(xt=ve==null?void 0:ve.user)!=null?xt:"",G.pass=(K=ve==null?void 0:ve.pass)!=null?K:"",G.address=(We=ve==null?void 0:ve.address)!=null?We:G.address,G.port=Number((Je=ve==null?void 0:ve.port)!=null?Je:G.port);break}case ye.DNS:{const ve=E.settings;G.dnsNetwork=(ft=ve==null?void 0:ve.network)!=null?ft:Cr.dnsNetwork,G.dnsAddress=(Mt=ve==null?void 0:ve.address)!=null?Mt:"",G.dnsPort=Number((Qt=ve==null?void 0:ve.port)!=null?Qt:Cr.dnsPort);break}case ye.Freedom:{const ve=E.settings;G.freedomStrategy=(yr=ve==null?void 0:ve.domainStrategy)!=null?yr:"";break}case ye.Blackhole:{const ve=E.settings;G.blackholeResponse=(Ir=ve==null?void 0:ve.type)!=null?Ir:"";break}case ye.Wireguard:{const ve=E.settings;G.wireguardSecret=(hn=ve==null?void 0:ve.secretKey)!=null?hn:"",G.wireguardAddress=(Br=ve==null?void 0:ve.address)!=null?Br:"";const Vr=(kn=(Yr=ve==null?void 0:ve.peers)==null?void 0:Yr.map($r=>{var Nn,Cn,tn;return{publicKey:(Nn=$r.publicKey)!=null?Nn:"",allowedIPs:Array.isArray($r.allowedIPs)?$r.allowedIPs.join(","):"",endpoint:(Cn=$r.endpoint)!=null?Cn:"",keepAlive:Number((tn=$r.keepAlive)!=null?tn:0)}}))!=null?kn:[];G.wireguardPeers=Vr.length>0?Vr:Cr.wireguardPeers;break}}return((pn=N==null?void 0:N.mux)==null?void 0:pn.concurrency)!=null&&(G.muxConcurrency=Number(N.mux.concurrency)),(!G.wireguardPeers||G.wireguardPeers.length===0)&&(G.wireguardPeers=Cr.wireguardPeers),G},q=N=>{Ce(N);try{const E=JSON.parse(N);X(null),Te(E),Y.current=!0;const G=ie(E);m(G)}catch(E){X(E.message)}},B=()=>{const N=_.trim();if(!N){X(a("pages.outbound.configEmpty","Please paste a config link"));return}const E=mr.fromLink(N);if(!E){X(a("pages.outbound.invalidConfig","Unsupported or invalid config link")),l({status:"error",duration:2500,position:"top",title:a("pages.outbound.configParseFailedTitle","Conversion failed"),description:a("pages.outbound.configParseFailedDesc","Could not parse the provided config link.")});return}const G=E.toJson(),he=JSON.stringify(G,null,2);P(""),q(he),l({status:"success",duration:2e3,position:"top",title:a("pages.outbound.configConvertedTitle","Config converted"),description:a("pages.outbound.configConvertedDesc","Configuration applied to the form.")})},ue=g(async N=>{var G;const E=xs(N);try{await i(E),l({title:r==="edit"?a("pages.xray.outbound.updated","Outbound updated"):a("pages.xray.outbound.addOutbound"),status:"success",duration:2e3,position:"top"}),s()}catch(he){l({title:((G=he==null?void 0:he.data)==null?void 0:G.detail)||(he==null?void 0:he.message)||a("pages.xray.outbound.saveFailed","Unable to save outbound"),status:"error",duration:3e3,position:"top"})}}),be=()=>{s()},Ie=N=>{if(Ae(N),N===1){const E=xs(y());Te(E);const G=JSON.stringify(E,null,2);Ce(he=>he===G?he:G),X(null)}};return n(Kt,{size:"4xl",isOpen:t,onClose:be,scrollBehavior:"inside",children:[e(Dt,{bg:"blackAlpha.400",backdropFilter:"blur(8px)"}),n(qt,{as:"form",onSubmit:ue,children:[e(Tt,{children:r==="edit"?a("pages.xray.outbound.editOutbound","Edit Outbound"):a("pages.xray.outbound.addOutbound")}),e(Jt,{}),e(It,{children:n(hs,{variant:"enclosed",colorScheme:"primary",index:fe,onChange:Ie,children:[n(ps,{children:[e(or,{children:a("form")}),e(or,{children:a("json")})]}),n(ms,{children:[e(lr,{children:n(me,{spacing:6,align:"stretch",children:[n(L,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.basicSettings","Basic settings")}),n(me,{spacing:3,align:"stretch",children:[n(x,{isRequired:!0,children:[e(I,{children:a("pages.xray.outbound.tag")}),e(De,{size:"sm",placeholder:"outbound-tag",...p("tag",{required:ke})})]}),n(U,{children:[n(x,{isRequired:!0,children:[e(I,{children:a("protocol")}),e(Ze,{size:"sm",...p("protocol"),children:te.map(N=>e("option",{value:N,children:N},N))})]}),n(x,{children:[e(I,{children:a("pages.xray.outbound.sendThrough")}),e(De,{size:"sm",placeholder:"0.0.0.0",...p("sendThrough")})]})]})]})]}),R&&n(L,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.endpoint","Endpoint")}),n(me,{spacing:3,align:"stretch",children:[n(x,{isRequired:R,children:[e(I,{children:a("pages.outbound.address","Address")}),e(De,{size:"sm",placeholder:"example.com",...p("address",{required:R?ke:!1})})]}),n(U,{children:[n(x,{isRequired:R,children:[e(I,{children:a("pages.outbound.port","Port")}),e(De,{size:"sm",type:"number",min:1,max:65535,...p("port",{required:R?ke:!1,valueAsNumber:!0,min:{value:1,message:W},max:{value:65535,message:W}})})]}),le?n(x,{isRequired:le,children:[e(I,{children:"ID"}),e(De,{size:"sm",placeholder:"UUID",...p("id",{required:le?ke:!1})})]}):w?n(x,{isRequired:w,children:[e(I,{children:a("password")}),e(De,{size:"sm",placeholder:"password",...p("password",{required:w?ke:!1})})]}):n(x,{children:[e(I,{children:a("username")}),e(De,{size:"sm",placeholder:"username",...p("user")})]})]}),oe===ye.Shadowsocks&&n(x,{isRequired:H,children:[e(I,{children:a("pages.outbound.method","Method")}),e(Ze,{size:"sm",...p("method",{required:H?ke:!1}),children:Object.values(uc).map(N=>e("option",{value:N,children:N},N))})]}),oe===ye.VLESS&&n(U,{children:[n(x,{children:[e(I,{children:a("pages.outbound.encryption","Encryption")}),e(De,{size:"sm",placeholder:"none",...p("encryption")})]}),n(x,{children:[e(I,{children:"Flow"}),e(De,{size:"sm",placeholder:"xtls-rprx-vision",...p("flow")})]})]}),oe===ye.VMess&&n(x,{children:[e(I,{children:a("pages.outbound.security","User security")}),e(De,{size:"sm",placeholder:"auto",...p("vnextEncryption")})]})]})]}),oe===ye.DNS&&n(L,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.dnsSettings","DNS settings")}),n(U,{children:[n(x,{children:[e(I,{children:a("pages.outbound.network")}),n(Ze,{size:"sm",...p("dnsNetwork"),children:[e("option",{value:"udp",children:"udp"}),e("option",{value:"tcp",children:"tcp"})]})]}),n(x,{isRequired:ce,children:[e(I,{children:a("pages.outbound.port")}),e(De,{size:"sm",type:"number",min:1,max:65535,...p("dnsPort",{required:ce?ke:!1,valueAsNumber:!0,min:{value:1,message:W},max:{value:65535,message:W}})})]})]}),n(x,{mt:3,isRequired:ce,children:[e(I,{children:a("pages.outbound.address")}),e(De,{size:"sm",placeholder:"8.8.8.8",...p("dnsAddress",{required:ce?ke:!1})})]})]}),oe===ye.Freedom&&n(L,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.freedom","Freedom options")}),n(x,{children:[e(I,{children:a("pages.outbound.strategy","Strategy")}),e(De,{size:"sm",placeholder:"UseIP",...p("freedomStrategy")})]})]}),oe===ye.Blackhole&&n(L,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.blackhole","Blackhole options")}),n(x,{children:[e(I,{children:a("pages.outbound.response")}),e(De,{size:"sm",placeholder:"none",...p("blackholeResponse")})]})]}),oe===ye.Wireguard&&n(L,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.wireguard","Wireguard")}),n(me,{spacing:3,align:"stretch",children:[n(x,{children:[e(I,{children:a("pages.outbound.secretKey","Secret key")}),e(De,{size:"sm",...p("wireguardSecret")})]}),n(x,{children:[e(I,{children:a("pages.outbound.address")}),e(De,{size:"sm",placeholder:"10.0.0.1/32",...p("wireguardAddress")})]}),n(me,{spacing:3,align:"stretch",children:[n(U,{justify:"space-between",children:[e(h,{fontWeight:"semibold",children:a("pages.outbound.peer","Peers")}),e(Be,{size:"sm","aria-label":a("add"),icon:e(Zm,{boxSize:3}),onClick:()=>F({publicKey:"",allowedIPs:"0.0.0.0/0,::/0",endpoint:"",keepAlive:0})})]}),D.map((N,E)=>n(L,{borderWidth:"1px",borderRadius:"md",p:3,bg:c,children:[n(U,{children:[n(x,{children:[e(I,{children:a("pages.outbound.publicKey","Public key")}),e(De,{size:"sm",...p(`wireguardPeers.${E}.publicKey`)})]}),D.length>1&&e(Be,{mt:6,size:"sm","aria-label":a("delete"),icon:e(jm,{boxSize:3}),onClick:()=>Z(E)})]}),n(U,{mt:2,children:[n(x,{children:[e(I,{children:a("pages.outbound.allowedIPs","Allowed IPs")}),e(De,{size:"sm",...p(`wireguardPeers.${E}.allowedIPs`)})]}),n(x,{children:[e(I,{children:a("pages.outbound.endpoint","Endpoint")}),e(De,{size:"sm",...p(`wireguardPeers.${E}.endpoint`)})]})]}),n(x,{mt:2,children:[e(I,{children:a("pages.outbound.keepAlive","Keep alive")}),e(De,{size:"sm",type:"number",...p(`wireguardPeers.${E}.keepAlive`,{valueAsNumber:!0})})]})]},N.id))]})]})]}),n(L,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.transport","Transport")}),n(me,{spacing:3,align:"stretch",children:[n(x,{children:[e(I,{children:a("pages.outbound.network")}),n(Ze,{size:"sm",...p("network"),onChange:N=>{p("network").onChange(N)},children:[e("option",{value:"tcp",children:"tcp"}),e("option",{value:"ws",children:"ws"}),e("option",{value:"grpc",children:"grpc"})]})]}),v==="tcp"&&n(U,{children:[n(x,{children:[e(I,{children:a("pages.outbound.tcpHeader","Header")}),n(Ze,{size:"sm",...p("tcpType"),children:[e("option",{value:"none",children:"none"}),e("option",{value:"http",children:"http"})]})]}),Q==="http"&&n($t,{children:[n(x,{children:[e(I,{children:a("host")}),e(De,{size:"sm",...p("tcpHost")})]}),n(x,{children:[e(I,{children:a("path")}),e(De,{size:"sm",...p("tcpPath")})]})]})]}),v==="ws"&&n(U,{children:[n(x,{children:[e(I,{children:a("host")}),e(De,{size:"sm",...p("wsHost")})]}),n(x,{children:[e(I,{children:a("path")}),e(De,{size:"sm",...p("wsPath")})]})]}),v==="grpc"&&n(x,{children:[e(I,{children:a("serviceName")}),e(De,{size:"sm",...p("grpcServiceName")})]})]})]}),n(L,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.security")}),n(U,{children:[n(x,{display:"flex",alignItems:"center",children:[e(I,{mb:"0",children:"TLS"}),e(vt,{size:"sm",isChecked:M,onChange:N=>{const E=N.target.checked;A("tlsEnabled",E),E&&A("realityEnabled",!1)}})]}),n(x,{display:"flex",alignItems:"center",children:[e(I,{mb:"0",children:"Reality"}),e(vt,{size:"sm",isChecked:T,onChange:N=>{const E=N.target.checked;A("realityEnabled",E),E&&A("tlsEnabled",!1)}})]})]}),M&&n(x,{mt:3,children:[e(I,{children:"SNI"}),e(De,{size:"sm",placeholder:"example.com",...p("tlsServerName")})]}),T&&n(me,{spacing:3,align:"stretch",mt:3,children:[n(x,{children:[e(I,{children:"SNI"}),e(De,{size:"sm",...p("tlsServerName")})]}),n(x,{children:[e(I,{children:a("pages.outbound.publicKey")}),e(De,{size:"sm",...p("realityPublicKey")})]}),n(x,{children:[e(I,{children:a("pages.outbound.shortId")}),e(De,{size:"sm",...p("realityShortId")})]})]})]}),n(L,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.mux")}),n(x,{display:"flex",alignItems:"center",children:[e(I,{mb:"0",children:a("pages.outbound.enableMux")}),e(vt,{size:"sm",...p("muxEnabled")})]}),_e&&n(x,{mt:3,children:[e(I,{children:a("pages.outbound.concurrency")}),e(De,{size:"sm",type:"number",...p("muxConcurrency",{valueAsNumber:!0})})]})]})]})}),e(lr,{children:n(me,{align:"stretch",spacing:3,children:[n(x,{children:[e(I,{children:a("pages.outbound.configToJson","Config to JSON")}),n(U,{align:"start",spacing:3,children:[e(Rr,{value:_,onChange:N=>P(N.target.value),placeholder:a("pages.outbound.configPlaceholder","Paste vmess/vless/trojan/ss link here"),rows:3,fontFamily:"mono",fontSize:"sm",spellCheck:!1,flex:"1"}),e(O,{size:"sm",colorScheme:"primary",onClick:B,children:a("pages.outbound.convertConfig","Convert")})]})]}),e(L,{height:"420px",children:e(Ua,{json:Pe,onChange:q})}),$&&e(h,{fontSize:"sm",color:"red.500",children:$})]})})]})]})}),n(Wt,{gap:3,children:[e(O,{variant:"outline",onClick:be,children:a("cancel")}),e(O,{colorScheme:"primary",type:"submit",isDisabled:!f,children:a(r==="edit"?"save":"add")})]})]})]})},tg=["tcp","udp","http","quic","grpc"],rg=["http","tls","bittorrent","quic"],ng=["field","chained"],sg=["","hybrid","linear"],xc={type:"field",domainMatcher:"",outboundTag:"",balancerTag:"",inboundTags:[],networks:[],protocols:[],sourceIps:"",sourcePort:"",domain:"",ip:"",user:"",port:"",attrs:[]},vs=t=>t?Array.isArray(t)?t.join(", "):t:"",Gs=t=>t.split(/[\s,]+/).map(s=>s.trim()).filter(Boolean),ig=t=>{var r,o,i,a;if(!t)return{...xc};const s=t.attrs?Object.entries(t.attrs).map(([l,c])=>({key:l,value:c==null?"":String(c)})):[];return{type:(r=t.type)!=null?r:"field",domainMatcher:(o=t.domainMatcher)!=null?o:"",outboundTag:(i=t.outboundTag)!=null?i:"",balancerTag:(a=t.balancerTag)!=null?a:"",inboundTags:Array.isArray(t.inboundTag)?t.inboundTag:[],networks:Array.isArray(t.network)?t.network:[],protocols:Array.isArray(t.protocol)?t.protocol:[],sourceIps:vs(t.source),sourcePort:vs(t.sourcePort),domain:vs(t.domain),ip:vs(t.ip),user:vs(t.user),port:vs(t.port),attrs:s}},ag=t=>{const s={};t.type&&(s.type=t.type),t.domainMatcher&&(s.domainMatcher=t.domainMatcher),t.outboundTag&&(s.outboundTag=t.outboundTag),t.balancerTag&&(s.balancerTag=t.balancerTag),t.inboundTags.length&&(s.inboundTag=t.inboundTags),t.networks.length&&(s.network=t.networks),t.protocols.length&&(s.protocol=t.protocols);const r=Gs(t.sourceIps);r.length&&(s.source=r);const o=Gs(t.sourcePort);o.length&&(s.sourcePort=o);const i=Gs(t.domain);i.length&&(s.domain=i);const a=Gs(t.ip);a.length&&(s.ip=a);const l=Gs(t.user);l.length&&(s.user=l);const c=t.port.trim();if(c&&(s.port=c),t.attrs.length){const u={};t.attrs.forEach(({key:p,value:m})=>{!p.trim()||(u[p.trim()]=m)}),Object.keys(u).length&&(s.attrs=u)}return s.type||(s.type="field"),s},og=({isOpen:t,mode:s,initialRule:r,availableInboundTags:o,availableOutboundTags:i,availableBalancerTags:a,onSubmit:l,onClose:c})=>{const{t:u}=qe(),p=Le("white","gray.900"),{control:m,register:g,handleSubmit:S,reset:y,formState:{isSubmitting:A}}=en({defaultValues:xc}),{fields:f,append:D,remove:F}=ks({control:m,name:"attrs"});d.exports.useEffect(()=>{t&&y(ig(r))},[t,r,y]);const Z=()=>D({key:"",value:""}),ae=()=>{c()},v=S(T=>{const Q=ag(T);l(Q),ae()}),M=d.exports.useMemo(()=>s==="edit"?u("pages.xray.rules.edit","Edit Rule"):u("pages.xray.rules.add","Add Rule"),[s,u]);return n(Kt,{isOpen:t,onClose:ae,size:"xl",scrollBehavior:"inside",children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(qt,{as:"form",onSubmit:v,bg:p,children:[e(Tt,{children:M}),e(Jt,{}),e(It,{children:n(ge,{spacing:5,children:[n(x,{children:[e(I,{children:u("pages.xray.rules.type","Rule Type")}),e(Ze,{...g("type"),size:"sm",children:ng.map(T=>e("option",{value:T,children:T||u("core.none","None")},T))})]}),n(x,{children:[e(I,{children:u("pages.xray.rules.outboundTag","Outbound Tag")}),e(Ze,{...g("outboundTag"),size:"sm",placeholder:u("core.none","None"),children:i.map(T=>e("option",{value:T,children:T},T))})]}),n(x,{children:[e(I,{children:u("pages.xray.rules.balancer","Balancer Tag")}),e(Ze,{...g("balancerTag"),size:"sm",placeholder:u("core.none","None"),children:a.map(T=>e("option",{value:T,children:T},T))})]}),n(x,{children:[e(I,{children:u("pages.xray.rules.inboundTag","Inbound Tags")}),e(kt,{control:m,name:"inboundTags",render:({field:T})=>e($i,{...T,children:e(_s,{spacing:3,children:o.map(Q=>e(Fn,{children:e(vr,{value:Q,children:Q})},Q))})})})]}),e(Wn,{}),n(x,{children:[e(I,{children:u("pages.xray.rules.domainMatcher","Domain Matcher")}),e(Ze,{...g("domainMatcher"),size:"sm",children:sg.map(T=>e("option",{value:T,children:T||u("core.default","Default")},T||"empty"))})]}),n(x,{children:[e(I,{children:u("pages.xray.rules.network","Network")}),e(kt,{control:m,name:"networks",render:({field:T})=>e($i,{...T,children:e(_s,{spacing:3,children:tg.map(Q=>e(Fn,{children:e(vr,{value:Q,children:Q})},Q))})})})]}),n(x,{children:[e(I,{children:u("pages.xray.rules.protocol","Protocol")}),e(kt,{control:m,name:"protocols",render:({field:T})=>e($i,{...T,children:e(_s,{spacing:3,children:rg.map(Q=>e(Fn,{children:e(vr,{value:Q,children:Q})},Q))})})})]}),n(x,{children:[e(I,{children:u("pages.xray.rules.source","Source IPs")}),e(Rr,{...g("sourceIps"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(x,{children:[e(I,{children:u("pages.xray.rules.sourcePort","Source Ports")}),e(Rr,{...g("sourcePort"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(x,{children:[e(I,{children:u("pages.xray.rules.ip","Destination IPs")}),e(Rr,{...g("ip"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(x,{children:[e(I,{children:u("pages.xray.rules.domain","Domains")}),e(Rr,{...g("domain"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(x,{children:[e(I,{children:u("pages.xray.rules.user","Users")}),e(Rr,{...g("user"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(x,{children:[e(I,{children:u("pages.xray.rules.port","Ports")}),e(Rr,{...g("port"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),e(Wn,{}),n(L,{children:[n(x,{children:[e(I,{children:u("pages.xray.rules.attrs","Attributes")}),e(O,{onClick:Z,size:"xs",leftIcon:e(Tn,{width:16}),variant:"outline",colorScheme:"primary",children:u("core.add","Add")})]}),n(ge,{spacing:2,mt:3,children:[f.length===0&&e(h,{fontSize:"sm",color:"gray.500",children:u("pages.xray.rules.attrsHelper","No custom attributes defined.")}),f.map((T,Q)=>n(U,{spacing:2,align:"flex-start",children:[e(De,{size:"sm",placeholder:u("pages.inbounds.stream.general.name","Key"),...g(`attrs.${Q}.key`)}),e(De,{size:"sm",placeholder:u("pages.inbounds.stream.general.value","Value"),...g(`attrs.${Q}.value`)}),e(Be,{"aria-label":"Remove attribute",icon:e(Qi,{width:16}),size:"sm",variant:"ghost",onClick:()=>F(Q)})]},T.id))]})]})]})}),n(Wt,{gap:3,children:[e(O,{variant:"outline",onClick:ae,children:u("cancel")}),e(O,{colorScheme:"primary",type:"submit",isLoading:A,children:s==="edit"?u("pages.xray.rules.edit","Save Changes"):u("pages.xray.rules.add","Add Rule")})]})]})]})},lg=({isOpen:t,onClose:s,form:r,setBalancersData:o,balancerIndex:i})=>{const{t:a}=qe(),l=en({defaultValues:{tag:"",strategy:"random",selector:"",fallbackTag:""}}),c=l.handleSubmit(u=>{const p={tag:u.tag,strategy:{type:u.strategy},selector:u.selector?u.selector.split(","):[],fallbackTag:u.fallbackTag},m=r.getValues("config.routing.balancers")||[];i!==void 0?m[i]=p:m.push(p),r.setValue("config.routing.balancers",m,{shouldDirty:!0}),o(m.map((g,S)=>{var y;return{key:S,tag:g.tag||"",strategy:((y=g.strategy)==null?void 0:y.type)||"random",selector:g.selector||[],fallbackTag:g.fallbackTag||""}})),s()});return n(Kt,{isOpen:t,onClose:s,size:"sm",children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(qt,{mx:"3",children:[e(Tt,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:a(i!==void 0?"pages.xray.balancer.editBalancer":"pages.xray.balancer.addBalancer")})}),e(Jt,{mt:3}),e(It,{children:e("form",{onSubmit:c,children:n(me,{spacing:4,children:[n(x,{children:[e(I,{children:a("pages.xray.balancer.tag")}),e(De,{...l.register("tag"),size:"sm",placeholder:"balancer-tag"})]}),n(x,{children:[e(I,{children:a("pages.xray.balancer.balancerStrategy")}),e(Ze,{...l.register("strategy"),size:"sm",children:["random","roundRobin","leastLoad","leastPing"].map(u=>e("option",{value:u,children:u},u))})]}),n(x,{children:[e(I,{children:a("pages.xray.balancer.balancerSelectors")}),e(De,{...l.register("selector"),size:"sm",placeholder:"tag1,tag2"})]}),n(x,{children:[e(I,{children:a("pages.xray.balancer.fallbackTag")}),e(De,{...l.register("fallbackTag"),size:"sm",placeholder:"fallback-tag"})]}),e(O,{type:"submit",colorScheme:"primary",size:"sm",children:a(i!==void 0?"pages.xray.balancer.editBalancer":"pages.xray.balancer.addBalancer")})]})})})]})]})},cg=({isOpen:t,onClose:s,form:r,setDnsServers:o,dnsIndex:i})=>{const{t:a}=qe(),l=en({defaultValues:{address:"",domains:"",expectIPs:""}}),c=l.handleSubmit(u=>{const p={address:u.address,domains:u.domains?u.domains.split(","):[],expectIPs:u.expectIPs?u.expectIPs.split(","):[]},m=r.getValues("config.dns.servers")||[];i!==void 0?m[i]=p:m.push(p),r.setValue("config.dns.servers",m,{shouldDirty:!0}),o(m),s()});return n(Kt,{isOpen:t,onClose:s,size:"sm",children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(qt,{mx:"3",children:[e(Tt,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:a(i!==void 0?"pages.xray.dns.edit":"pages.xray.dns.add")})}),e(Jt,{mt:3}),e(It,{children:e("form",{onSubmit:c,children:n(me,{spacing:4,children:[n(x,{children:[e(I,{children:a("pages.xray.dns.address")}),e(De,{...l.register("address"),size:"sm",placeholder:"8.8.8.8"})]}),n(x,{children:[e(I,{children:a("pages.xray.dns.domains")}),e(De,{...l.register("domains"),size:"sm",placeholder:"example.com,*.example.com"})]}),n(x,{children:[e(I,{children:a("pages.xray.dns.expectIPs")}),e(De,{...l.register("expectIPs"),size:"sm",placeholder:"1.1.1.1,2.2.2.2"})]}),e(O,{type:"submit",colorScheme:"primary",size:"sm",children:a(i!==void 0?"pages.xray.dns.edit":"pages.xray.dns.add")})]})})})]})]})},dg=({isOpen:t,onClose:s,form:r,setFakeDns:o,fakeDnsIndex:i})=>{const{t:a}=qe(),l=en({defaultValues:{ipPool:"",poolSize:""}}),c=l.handleSubmit(u=>{const p={ipPool:u.ipPool,poolSize:parseInt(u.poolSize,10)},m=r.getValues("config.fakedns")||[];i!==void 0?m[i]=p:m.push(p),r.setValue("config.fakedns",m.length>0?m:null,{shouldDirty:!0}),o(m),s()});return n(Kt,{isOpen:t,onClose:s,size:"sm",children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(qt,{mx:"3",children:[e(Tt,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:a(i!==void 0?"pages.xray.fakedns.edit":"pages.xray.fakedns.add")})}),e(Jt,{mt:3}),e(It,{children:e("form",{onSubmit:c,children:n(me,{spacing:4,children:[n(x,{children:[e(I,{children:a("pages.xray.fakedns.ipPool")}),e(De,{...l.register("ipPool"),size:"sm",placeholder:"192.168.0.0/16"})]}),n(x,{children:[e(I,{children:a("pages.xray.fakedns.poolSize")}),e(De,{...l.register("poolSize"),size:"sm",placeholder:"100"})]}),e(O,{type:"submit",colorScheme:"primary",size:"sm",children:a(i!==void 0?"pages.xray.fakedns.edit":"pages.xray.fakedns.add")})]})})})]})]})},Oa={tag:"warp",privateKey:"",publicKey:"",endpoint:"engage.cloudflareclient.com:2408",addressV4:"",addressV6:"",reserved:"",mtu:1420,domainStrategy:"ForceIP",notes:""},Zo=t=>{var u,p,m,g,S,y,A,f,D,F,Z,ae,v;if(!t)return{...Oa};const s=(u=t.settings)!=null?u:{},o=(p=(Array.isArray(s.peers)?s.peers:[])[0])!=null?p:{},i=Array.isArray(s.address)?s.address:[],a=(g=(m=i.find(M=>typeof M=="string"&&M.endsWith("/32")))==null?void 0:m.replace("/32",""))!=null?g:"",l=(y=(S=i.find(M=>typeof M=="string"&&M.endsWith("/128")))==null?void 0:S.replace("/128",""))!=null?y:"",c=Array.isArray(s.reserved)?s.reserved.filter(M=>Number.isFinite(Number(M))).join(","):"";return{tag:(A=t.tag)!=null?A:"warp",privateKey:(D=(f=s.secretKey)!=null?f:s.privateKey)!=null?D:"",publicKey:(F=o.publicKey)!=null?F:"",endpoint:typeof o.endpoint=="string"?o.endpoint:"engage.cloudflareclient.com:2408",addressV4:a,addressV6:l,reserved:c,mtu:(Z=s.mtu)!=null?Z:1420,domainStrategy:(ae=s.domainStrategy)!=null?ae:"ForceIP",notes:typeof t.notes=="string"?t.notes:(v=s.notes)!=null?v:""}},ug=t=>{const s=[];t.addressV4.trim()&&s.push(`${t.addressV4.trim()}/32`),t.addressV6.trim()&&s.push(`${t.addressV6.trim()}/128`);const r=t.reserved.split(",").map(a=>Number(a.trim())).filter(a=>Number.isFinite(a)),i=mr.fromJson({tag:t.tag.trim()||"warp",protocol:"wireguard",settings:{mtu:t.mtu||1420,secretKey:t.privateKey.trim(),address:s,reserved:r,domainStrategy:t.domainStrategy||"ForceIP",noKernelTun:!1,peers:[{publicKey:t.publicKey.trim(),endpoint:t.endpoint.trim()}]}}).toJson();return t.notes.trim()?i.notes=t.notes.trim():delete i.notes,i},hg=t=>{if(!t)return[];try{const s=atob(t);return Array.from(s).map(r=>r.charCodeAt(0))}catch{return[]}},pg=t=>{if(!t)return"";if(typeof t=="string")return t;if(typeof t=="object"&&t!==null){const s=t;return s.host?s.port?`${s.host}:${s.port}`:s.host:""}return""},mg=(t,s)=>{var p,m,g,S,y,A,f,D,F,Z,ae;if(!t||!(s!=null&&s.config))return null;const r=s.config,o=[],i=(m=(p=r.interface)==null?void 0:p.addresses)!=null?m:{};i.v4&&o.push(`${i.v4}/32`),i.v6&&o.push(`${i.v6}/128`);const l=(g=(Array.isArray(r.peers)?r.peers:[])[0])!=null?g:{},c=(y=(S=l.allowed_ips)!=null?S:l.allowedIPs)!=null?y:["0.0.0.0/0","::/0"];return mr.fromJson({tag:"warp",protocol:"wireguard",settings:{mtu:(f=(A=r.interface)==null?void 0:A.mtu)!=null?f:1420,secretKey:t.private_key,address:o,reserved:hg(r.client_id),domainStrategy:"ForceIP",noKernelTun:!1,peers:[{publicKey:(F=(D=l.public_key)!=null?D:t.public_key)!=null?F:"",endpoint:pg(l.endpoint),allowedIPs:c,keepAlive:(ae=(Z=l.keep_alive)!=null?Z:l.keepAlive)!=null?ae:0}]}})},jo=t=>{if(!t)return"-";try{return new Date(t).toLocaleString()}catch{return t}},ka=t=>typeof t!="number"||Number.isNaN(t)||t<=0?"-":ss.sizeFormat(t),_r=({label:t,value:s})=>{const r=Le("gray.500","gray.400");return n(L,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:r,letterSpacing:"wide",children:t}),e(h,{fontWeight:"semibold",fontFamily:"mono",overflowWrap:"anywhere",children:s||"-"})]})},gg=({isOpen:t,onClose:s,initialOutbound:r,onSave:o,onDelete:i})=>{var _,P,Y,te,ie;const{t:a}=qe(),l=sr(),[c,u]=d.exports.useState({...Oa}),[p,m]=d.exports.useState(null),[g,S]=d.exports.useState(null),[y,A]=d.exports.useState(null),[f,D]=d.exports.useState(""),[F,Z]=d.exports.useState(!1),[ae,v]=d.exports.useState(!1),[M,T]=d.exports.useState(!1),[Q,_e]=d.exports.useState(!1),[ke,W]=d.exports.useState(!1);d.exports.useEffect(()=>{fm()},[]);const oe=d.exports.useCallback(async()=>{var q,B;Z(!0);try{const ue=await Ee("/core/warp",{method:"GET"});m((q=ue.account)!=null?q:null),S(null),A(null)}catch(ue){l({title:a("pages.xray.warp.loadFailed","Failed to load WARP account."),description:((B=ue==null?void 0:ue.data)==null?void 0:B.detail)||(ue==null?void 0:ue.message),status:"error",duration:4e3,isClosable:!0,position:"top"})}finally{Z(!1)}},[l,a]);d.exports.useEffect(()=>{t&&oe().catch(()=>{})},[t,oe]),d.exports.useEffect(()=>{t&&u(Zo(r))},[r,t]),d.exports.useEffect(()=>{var q;D((q=p==null?void 0:p.license_key)!=null?q:"")},[p]);const R=(q,B)=>{u(ue=>({...ue,[q]:B}))},le=Le("gray.600","gray.300"),w=Le("gray.200","whiteAlpha.200"),H=()=>{const q=Ma();R("privateKey",q.privateKey),R("publicKey",q.publicKey),l({title:a("pages.xray.warp.keysGenerated","WireGuard key pair generated."),status:"info",duration:2500,isClosable:!0,position:"top"})},ce=()=>{const q=Array.from({length:3},()=>Math.floor(Math.random()*256));R("reserved",q.join(","))},j=d.exports.useCallback((q,B)=>{if(!q||!B){A(null);return}const ue=mg(q,B);ue&&(A(ue),u(Zo(ue.toJson())))},[]),fe=async()=>{var q;v(!0);try{const B=Ma(),ue=await Ee("/core/warp/register",{method:"POST",body:{private_key:B.privateKey,public_key:B.publicKey}});m(ue.account),S(ue.config),j(ue.account,ue.config),l({title:a("pages.xray.warp.registerSuccess","WARP device registered."),status:"success",duration:4e3,isClosable:!0,position:"top"})}catch(B){l({title:a("pages.xray.warp.registerFailed","Failed to register WARP device."),description:((q=B==null?void 0:B.data)==null?void 0:q.detail)||(B==null?void 0:B.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{v(!1)}},Ae=async()=>{var q;if(!p){l({title:a("pages.xray.warp.accountMissing","Create a WARP device first."),status:"warning",duration:3e3,isClosable:!0,position:"top"});return}_e(!0);try{const B=await Ee("/core/warp/config",{method:"GET"});S(B.config),j(p,B.config),l({title:a("pages.xray.warp.infoFetched","WARP information refreshed."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(B){l({title:a("pages.xray.warp.infoFailed","Unable to fetch WARP info."),description:((q=B==null?void 0:B.data)==null?void 0:q.detail)||(B==null?void 0:B.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{_e(!1)}},Pe=async()=>{var q;if(!!f.trim()){T(!0);try{const B=await Ee("/core/warp/license",{method:"POST",body:{license_key:f.trim()}});m(B.account),l({title:a("pages.xray.warp.licenseUpdated","License updated."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(B){l({title:a("pages.xray.warp.licenseFailed","Failed to update license."),description:((q=B==null?void 0:B.data)==null?void 0:q.detail)||(B==null?void 0:B.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{T(!1)}}},Te=async()=>{var q;W(!0);try{await Ee("/core/warp",{method:"DELETE"}),m(null),S(null),A(null),i(),l({title:a("pages.xray.warp.accountRemoved","WARP account removed."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(B){l({title:a("pages.xray.warp.removeFailed","Failed to remove WARP account."),description:((q=B==null?void 0:B.data)==null?void 0:q.detail)||(B==null?void 0:B.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{W(!1)}},J=()=>{if(!y)return;const q=y.toJson();o(q),l({title:a("pages.xray.warp.outboundApplied","WARP outbound updated."),status:"success",duration:2500,isClosable:!0,position:"top"})},Ce=()=>{i(),u({...Oa}),l({title:a("pages.xray.warp.removeOutbound","Outbound removed."),status:"info",duration:2500,isClosable:!0,position:"top"})},$=()=>{if(!c.privateKey.trim()||!c.publicKey.trim()||!c.endpoint.trim()){l({title:a("pages.xray.warp.validationMissing","Private key, public key, and endpoint are required."),status:"error",isClosable:!0,duration:3500,position:"top"});return}const q=ug(c);o(q),s()},X=d.exports.useMemo(()=>Boolean(r),[r]);return n(Kt,{isOpen:t,onClose:s,size:"xl",scrollBehavior:"inside",children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(8px)"}),n(qt,{children:[e(Tt,{children:a("pages.xray.warp.manage","Manage WARP")}),e(Jt,{}),e(It,{children:n(me,{spacing:5,align:"stretch",children:[n(Mr,{status:"info",borderRadius:"md",children:[e(Ur,{}),e(Bn,{children:a("pages.xray.warp.manualNote","Provide the credentials exported from Cloudflare WARP (e.g. via warp-cli). You can generate a WireGuard key pair locally, but you still need reserved bytes and endpoints from the official client.")})]}),e(L,{borderWidth:"1px",borderColor:w,borderRadius:"lg",p:4,children:p?n(me,{spacing:4,align:"stretch",children:[n(He,{columns:{base:1,md:2},spacing:4,children:[e(_r,{label:a("pages.xray.warp.accessToken","Access token"),value:p.access_token||"-"}),e(_r,{label:a("pages.xray.warp.deviceId","Device ID"),value:p.device_id||"-"}),e(_r,{label:a("pages.xray.warp.licenseKey","License key"),value:p.license_key||"-"}),e(_r,{label:a("pages.xray.warp.privateKey","Private key"),value:p.private_key||"-"}),e(_r,{label:a("pages.xray.warp.registeredAt","Registered at"),value:jo(p.created_at)}),e(_r,{label:a("pages.xray.warp.updatedAt","Updated at"),value:jo(p.updated_at)})]}),n(U,{spacing:3,flexWrap:"wrap",children:[e(O,{variant:"outline",onClick:Ae,isLoading:Q,children:a("pages.xray.warp.fetchInfo","Refresh info")}),e(O,{variant:"ghost",colorScheme:"red",onClick:Te,isLoading:ke,children:a("pages.xray.warp.removeAccount","Remove account")})]})]}):n(me,{spacing:3,align:"stretch",children:[e(h,{fontSize:"sm",color:le,children:a("pages.xray.warp.registerDescription","No Cloudflare WARP device has been registered yet. The dashboard can generate a WireGuard key pair locally and register a new device via Cloudflare's API.")}),e(O,{colorScheme:"primary",onClick:fe,isLoading:ae||F,children:a("pages.xray.warp.registerAction","Create WARP device")})]})}),p&&n(L,{borderWidth:"1px",borderColor:w,borderRadius:"lg",p:4,children:[e(h,{fontWeight:"semibold",mb:2,children:a("pages.xray.warp.licenseSection","WARP+/License key")}),n(U,{spacing:3,align:"stretch",flexWrap:"wrap",children:[e(De,{value:f,onChange:q=>D(q.target.value),placeholder:"ABCD-1234...",size:"sm"}),e(O,{colorScheme:"primary",onClick:Pe,isLoading:M,isDisabled:!f.trim(),children:a("pages.xray.warp.updateLicense","Update license")})]}),e(h,{fontSize:"xs",color:le,mt:2,children:a("pages.xray.warp.licenseHint","Optional Cloudflare WARP+ license. Leave empty if you only need the free tier.")})]}),n(L,{borderWidth:"1px",borderColor:w,borderRadius:"lg",p:4,children:[n(U,{justify:"space-between",align:"center",mb:2,children:[e(h,{fontWeight:"semibold",children:a("pages.xray.warp.remoteConfig","Remote configuration")}),g?e(cn,{colorScheme:g.enabled?"green":"yellow",children:g.enabled?a("core.active","Active"):a("core.pending","Pending")}):e(cn,{colorScheme:"gray",children:a("core.empty","Empty")})]}),g?n(ge,{spacing:4,children:[n(He,{columns:{base:1,md:2},spacing:4,children:[e(_r,{label:a("core.name","Name"),value:(_=g.name)!=null?_:"-"}),e(_r,{label:a("core.model","Model"),value:(P=g.model)!=null?P:"-"}),e(_r,{label:a("core.status","Status"),value:g.enabled?a("core.enabled","Enabled"):a("core.disabled","Disabled")}),e(_r,{label:a("core.id","ID"),value:(Y=g.id)!=null?Y:"-"})]}),g.account&&n($t,{children:[e(Wn,{}),n(He,{columns:{base:1,md:3},spacing:4,children:[e(_r,{label:a("core.type","Type"),value:(te=g.account.account_type)!=null?te:"-"}),e(_r,{label:a("core.role","Role"),value:(ie=g.account.role)!=null?ie:"-"}),e(_r,{label:a("pages.xray.warp.premiumData","WARP+ data"),value:ka(g.account.premium_data)}),e(_r,{label:a("core.quota","Quota"),value:ka(g.account.quota)}),e(_r,{label:a("core.usage","Usage"),value:ka(g.account.usage)})]})]}),n(U,{spacing:3,flexWrap:"wrap",children:[e(O,{colorScheme:"primary",onClick:J,isDisabled:!y,children:a("pages.xray.warp.applyGenerated","Apply generated outbound")}),e(O,{variant:"ghost",onClick:()=>S(null),children:a("core.reset","Reset")})]})]}):e(h,{fontSize:"sm",color:le,children:a("pages.xray.warp.remoteEmpty","Fetch the remote configuration to generate an outbound automatically.")})]}),n(L,{borderWidth:"1px",borderColor:w,borderRadius:"lg",p:4,children:[e(h,{fontWeight:"semibold",mb:2,children:a("pages.xray.warp.manualTitle","Manual outbound")}),n(ge,{spacing:4,children:[n(x,{isRequired:!0,children:[e(I,{children:a("pages.xray.outbound.tag","Tag")}),e(De,{size:"sm",value:c.tag,onChange:q=>R("tag",q.target.value),placeholder:"warp"})]}),n(x,{isRequired:!0,children:[e(I,{children:a("pages.xray.warp.privateKey")}),e(Rr,{size:"sm",value:c.privateKey,onChange:q=>R("privateKey",q.target.value),rows:2})]}),n(x,{isRequired:!0,children:[e(I,{children:a("pages.xray.warp.publicKey")}),e(Rr,{size:"sm",value:c.publicKey,onChange:q=>R("publicKey",q.target.value),rows:2})]}),n(x,{children:[e(O,{size:"sm",colorScheme:"primary",onClick:H,children:a("pages.xray.warp.generateKeys","Generate Keys")}),e(h,{fontSize:"xs",color:le,mt:1,children:a("pages.xray.warp.generateKeysHint","Overrides the current key pair.")})]}),n(x,{isRequired:!0,children:[e(I,{children:a("pages.xray.warp.endpoint")}),e(De,{size:"sm",value:c.endpoint,onChange:q=>R("endpoint",q.target.value),placeholder:"engage.cloudflareclient.com:2408"})]}),n(x,{children:[e(I,{children:a("pages.xray.warp.addressV4","Client IPv4")}),e(De,{size:"sm",value:c.addressV4,onChange:q=>R("addressV4",q.target.value),placeholder:"172.16.0.2"}),e(nr,{children:a("pages.xray.warp.addressV4Hint","Optional /32 address from the WARP profile.")})]}),n(x,{children:[e(I,{children:a("pages.xray.warp.addressV6","Client IPv6")}),e(De,{size:"sm",value:c.addressV6,onChange:q=>R("addressV6",q.target.value),placeholder:"2606:4700:****:****::****"})]}),n(x,{children:[e(I,{children:a("pages.xray.warp.reserved")}),e(De,{size:"sm",value:c.reserved,onChange:q=>R("reserved",q.target.value),placeholder:"0,0,0"}),e(nr,{children:a("pages.xray.warp.reservedHint","Comma separated integers (usually three numbers) derived from the client_id.")}),e(O,{size:"xs",mt:2,variant:"ghost",onClick:ce,children:a("pages.xray.warp.randomReserved","Insert random reserved bytes")})]}),n(x,{children:[e(I,{children:a("pages.xray.warp.mtu","MTU")}),e(vn,{size:"sm",min:576,max:1600,value:c.mtu,onChange:(q,B)=>R("mtu",B||1420),children:e(xn,{})})]}),n(x,{children:[e(I,{children:a("pages.xray.warp.notes","Notes (optional)")}),e(Rr,{size:"sm",rows:2,value:c.notes,onChange:q=>R("notes",q.target.value)})]})]})]})]})}),n(Wt,{display:"flex",justifyContent:"space-between",children:[X?e(O,{colorScheme:"red",variant:"outline",onClick:Ce,children:a("delete")}):e("span",{}),n(U,{spacing:3,children:[e(O,{variant:"ghost",onClick:s,children:a("cancel")}),e(O,{colorScheme:"primary",onClick:$,children:a(X?"save":"add")})]})]})]})]})},Xs=se(Tn,{baseStyle:{w:3.5,h:3.5}}),Qs=se(wn,{baseStyle:{w:4,h:4}}),Zs=se(Vn,{baseStyle:{w:4,h:4}}),el=se(Vl,{baseStyle:{w:4,h:4}}),tl=se($l,{baseStyle:{w:4,h:4}}),rl=se(dn,{baseStyle:{w:4,h:4}}),fg=se(Ud,{baseStyle:{w:4,h:4}}),bg=se(Od,{baseStyle:{w:4,h:4}}),yg=se(Wl,{baseStyle:{w:4,h:4}}),Sg=se(Kl,{baseStyle:{w:4,h:4}}),xg=se(Ba,{baseStyle:{w:4,h:4}}),vg=se(Wd,{baseStyle:{w:4,h:4}}),wg=se(Fd,{baseStyle:{w:4,h:4}}),kg=se(Hd,{baseStyle:{w:4,h:4}}),Cg=se(Bd,{baseStyle:{w:4,h:4}}),nl=se(Vd,{baseStyle:{w:4,h:4}}),js={colorScheme:"primary",size:"xs",variant:"solid",fontSize:"xs",px:3,h:7},Mi=t=>JSON.stringify(t!=null?t:{}),sl=t=>Array.isArray(t)?t.join(","):t!=null?t:"",_g=[{label:"Apple",value:"geosite:apple"},{label:"Meta",value:"geosite:meta"},{label:"Google",value:"geosite:google"},{label:"OpenAI",value:"geosite:openai"},{label:"Spotify",value:"geosite:spotify"},{label:"Netflix",value:"geosite:netflix"},{label:"Reddit",value:"geosite:reddit"},{label:"Speedtest",value:"geosite:speedtest"}],vc="/var/lib/rebecca/xray-core",Ag=`${vc}/access.log`,Dg=`${vc}/error.log`,Ui=({title:t,children:s})=>{const r=Le("gray.50","whiteAlpha.100"),o=Le("gray.200","whiteAlpha.300");return n(L,{borderWidth:"1px",borderColor:o,borderRadius:"lg",overflow:"hidden",children:[e(L,{bg:r,px:{base:3,md:4},py:2,children:e(h,{fontWeight:"semibold",fontSize:{base:"sm",md:"md"},children:t})}),e(L,{overflowX:"auto",children:e(as,{variant:"simple",size:"sm",minW:{base:"100%",md:"unset"},children:e(sn,{children:s})})})]})},Kr=({label:t,controlId:s,children:r})=>{const o=Le("gray.700","whiteAlpha.800");return n(Ot,{display:{base:"block",md:"table-row"},_notFirst:{borderTopWidth:{base:"1px",md:"0"},borderColor:"gray.200",_dark:{borderColor:"whiteAlpha.200"}},children:[e(Me,{width:{base:"100%",md:"40%"},py:3,pr:{base:0,md:4},display:{base:"block",md:"table-cell"},children:e(I,{htmlFor:s,mb:{base:2,md:0},color:o,children:t})}),e(Me,{py:3,display:{base:"block",md:"table-cell"},children:e(x,{id:s,display:"flex",flexDir:{base:"column",md:"row"},alignItems:{base:"flex-start",md:"center"},gap:{base:2,md:4},w:"full",children:r(s)})})]})},ei=({children:t})=>{const s=Le("gray.200","whiteAlpha.200"),r=Le("white","blackAlpha.400"),o=Le("sm","none");return e(L,{borderWidth:"1px",borderColor:s,borderRadius:"xl",bg:r,boxShadow:o,overflow:"hidden",children:e(L,{overflowX:"auto",children:t})})},ti=({children:t,...s})=>{const r=Le("gray.50","whiteAlpha.100"),o=Le("gray.200","whiteAlpha.300"),i=Le("gray.300","whiteAlpha.300"),a=Le("gray.100","whiteAlpha.200"),l=Le("gray.50","whiteAlpha.100");return e(as,{size:"sm",w:"full",...s,sx:{borderCollapse:"separate",borderSpacing:0,"th, td":{borderRight:"1px solid",borderColor:o},"th:first-of-type, td:first-of-type":{borderLeft:"1px solid",borderColor:o},"thead th":{bg:r,borderBottom:"1px solid",borderBottomColor:i,textTransform:"none",fontWeight:"semibold",fontSize:"sm",letterSpacing:"normal"},"tbody td":{borderBottom:"1px solid",borderBottomColor:a,fontSize:"sm",verticalAlign:"top"},"tbody tr:last-of-type td":{borderBottom:"none"},"tbody tr:hover":{bg:l}},children:t})},Ig=()=>{var Ii,Pi,Ei,Fs,Hs;const{t}=qe(),{fetchCoreSettings:s,updateConfig:r,isLoading:o,config:i,isPostLoading:a,restartCore:l}=Jm(),{userData:c,getUserIsSuccess:u}=xr(),{onEditingCore:p}=Lt(),m=u&&Boolean((Ii=c.permissions)==null?void 0:Ii.sections.xray),{data:g}=fr(["server-ips"],()=>Ee("/core/ips"),{staleTime:5*60*1e3,enabled:m}),S=sr(),{isOpen:y,onOpen:A,onClose:f}=rr(),{isOpen:D,onOpen:F,onClose:Z}=rr(),{isOpen:ae,onOpen:v,onClose:M}=rr(),{isOpen:T,onOpen:Q,onClose:_e}=rr(),{isOpen:ke,onOpen:W,onClose:oe}=rr(),{isOpen:R,onOpen:le,onClose:w}=rr(),H=en({defaultValues:{config:i||{outbounds:[],routing:{rules:[],balancers:[]},dns:{servers:[]}}}}),ce=d.exports.useRef(Mi(H.getValues("config"))),j=er({control:H.control,name:"config"}),fe=d.exports.useMemo(()=>Mi(j)!==ce.current,[j]),[Ae,Pe]=d.exports.useState([]),[Te,J]=d.exports.useState([]),[Ce,$]=d.exports.useState([]),[X,_]=d.exports.useState([]),[P,Y]=d.exports.useState([]),[te,ie]=d.exports.useState([]),[q,B]=d.exports.useState(null),[ue,be]=d.exports.useState(null),[Ie,N]=d.exports.useState(!1),[E,G]=d.exports.useState("xraySetting"),[he,Re]=d.exports.useState(""),tt=Or({base:!0,md:!1}),[je,we]=d.exports.useState(0),[Fe,Ye]=d.exports.useState(""),[ot,ut]=d.exports.useState(""),yt=d.exports.useCallback(b=>b.map((C,de)=>{var Xe,dt;return{key:`${de}-${(dt=(Xe=C.tag)!=null?Xe:C.protocol)!=null?dt:"outbound"}`,...C}}),[]),re=d.exports.useCallback(b=>{Pe(yt(b))},[yt]),ze=d.exports.useCallback(()=>{const b=H.getValues("config.outbounds");return Array.isArray(b)?JSON.parse(JSON.stringify(b)):[]},[H]),Ne=d.exports.useCallback(b=>{H.setValue("config.outbounds",b,{shouldDirty:!0}),re(b),we(C=>C+1)},[H,re]),wt=d.exports.useCallback(b=>b.map((C,de)=>{var Xe,dt,Qe,Pt,Pr,Gn,Ln,Bs,Vs,$s,Ks,pe,bt,nt,At;return{key:`${de}-${(dt=(Xe=C.outboundTag)!=null?Xe:C.balancerTag)!=null?dt:"rule"}`,source:(Qe=C.source)!=null?Qe:[],sourcePort:(Pt=C.sourcePort)!=null?Pt:[],network:(Pr=C.network)!=null?Pr:[],protocol:(Gn=C.protocol)!=null?Gn:[],attrs:C.attrs?JSON.stringify(C.attrs,null,2):"",ip:(Ln=C.ip)!=null?Ln:[],domain:(Bs=C.domain)!=null?Bs:[],port:(Vs=C.port)!=null?Vs:[],inboundTag:($s=C.inboundTag)!=null?$s:[],user:(Ks=C.user)!=null?Ks:[],outboundTag:(pe=C.outboundTag)!=null?pe:"",balancerTag:(bt=C.balancerTag)!=null?bt:"",type:(nt=C.type)!=null?nt:"field",domainMatcher:(At=C.domainMatcher)!=null?At:""}}),[]),ct=d.exports.useCallback(b=>{J(wt(b))},[wt]),V=d.exports.useCallback(b=>{H.setValue("config.routing.rules",b,{shouldDirty:!0}),ct(b),we(C=>C+1)},[H,ct]),lt=d.exports.useCallback(()=>{const b=H.getValues("config.routing.rules");return Array.isArray(b)?JSON.parse(JSON.stringify(b)):[]},[H]);d.exports.useEffect(()=>{const b=()=>{N(Boolean(document.fullscreenElement))};return document.addEventListener("fullscreenchange",b),()=>{document.removeEventListener("fullscreenchange",b)}},[]),d.exports.useEffect(()=>{if(!m){p(!1);return}return p(!0),s().then(()=>{console.log("Core settings fetched successfully")}).catch(b=>{S({title:t("core.errorFetchingConfig"),description:b.message,status:"error",isClosable:!0,position:"top",duration:3e3})}),()=>p(!1)},[m,s,p,S,t]),d.exports.useEffect(()=>{var b,C,de,Xe;i&&(H.reset({config:i}),ce.current=Mi(i),re((i==null?void 0:i.outbounds)||[]),ct(((b=i==null?void 0:i.routing)==null?void 0:b.rules)||[]),$(((de=(C=i==null?void 0:i.routing)==null?void 0:C.balancers)==null?void 0:de.map((dt,Qe)=>{var Pt;return{key:Qe,tag:dt.tag||"",strategy:((Pt=dt.strategy)==null?void 0:Pt.type)||"random",selector:dt.selector||[],fallbackTag:dt.fallbackTag||""}}))||[]),_(((Xe=i==null?void 0:i.dns)==null?void 0:Xe.servers)||[]),Y((i==null?void 0:i.fakedns)||[]),Re(i!=null&&i.observatory?"observatory":i!=null&&i.burstObservatory?"burstObservatory":""),we(dt=>dt+1))},[i,H,re,ct]);const{mutate:_t,isLoading:zt}=Ar(l,{onSuccess:()=>{S({title:t("core.restartSuccess"),status:"success",isClosable:!0,position:"top",duration:3e3})},onError:b=>{var C,de;S({title:t("core.generalErrorMessage"),description:((de=(C=b.response)==null?void 0:C.data)==null?void 0:de.detail)||b.message,status:"error",isClosable:!0,position:"top",duration:3e3})}}),Ge=H.handleSubmit(({config:b})=>{r(b).then(()=>{H.reset({config:b}),ce.current=Mi(b),S({title:t("core.successMessage"),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(C=>{let de=t("core.generalErrorMessage");typeof C.response._data.detail=="object"&&(de=C.response._data.detail[Object.keys(C.response._data.detail)[0]]),typeof C.response._data.detail=="string"&&(de=C.response._data.detail),S({title:de,status:"error",isClosable:!0,position:"top",duration:3e3})})}),Ue=async()=>{const b=await Ee("/panel/xray/getOutboundsTraffic");b!=null&&b.success&&ie(b.obj)},St=()=>{be(null),f()},Vt=()=>{be(null),A()},dr=b=>{be(b),A()},ir=b=>{const C=ze();b<0||b>=C.length||(C.splice(b,1),Ne(C))},Zt=(b,C)=>{const de=ze();if(b<0||b>=de.length||C<0||C>=de.length)return;const[Xe]=de.splice(b,1);de.splice(C,0,Xe),Ne(de)},ar=b=>{Zt(b,b-1)},ne=b=>{Zt(b,b+1)},z=()=>{B(null),F()},k=b=>{B(b),F()},Se=b=>{const C=lt();C.splice(b,1),V(C)},et=(b,C)=>{const de=lt();if(b<0||b>=de.length||C<0||C>=de.length)return;const[Xe]=de.splice(b,1);de.splice(C,0,Xe),V(de)},Nt=b=>{const C=lt();q!==null&&q>=0&&q<C.length?C[q]=b:C.push(b),V(C),B(null)},Ft=()=>{B(null),Z()},Ht=()=>{v()},gt=b=>{v()},ht=b=>{const C=[...Ce],de=C.splice(b,1)[0];H.setValue("config.routing.balancers",C,{shouldDirty:!0}),$(C);const Xe={...H.getValues("config")};Xe.observatory&&(Xe.observatory.subjectSelector=Xe.observatory.subjectSelector.filter(dt=>dt!==de.tag)),Xe.burstObservatory&&(Xe.burstObservatory.subjectSelector=Xe.burstObservatory.subjectSelector.filter(dt=>dt!==de.tag)),H.setValue("config",Xe,{shouldDirty:!0})},Ut=()=>{Q()},ur=b=>{Q()},Hr=b=>{const C=[...X];C.splice(b,1),H.setValue("config.dns.servers",C,{shouldDirty:!0}),_(C)},Jr=()=>{W()},hr=b=>{W()},xt=b=>{const C=[...P];C.splice(b,1),H.setValue("config.fakedns",C.length>0?C:null,{shouldDirty:!0}),Y(C)},K=b=>{var C,de,Xe,dt,Qe;switch(b.protocol){case"vmess":case"vless":return((C=b.settings.vnext)==null?void 0:C.map(Pt=>`${Pt.address}:${Pt.port}`))||[];case"http":case"socks":case"shadowsocks":case"trojan":return((de=b.settings.servers)==null?void 0:de.map(Pt=>`${Pt.address}:${Pt.port}`))||[];case"dns":return[`${(Xe=b.settings)==null?void 0:Xe.address}:${(dt=b.settings)==null?void 0:dt.port}`];case"wireguard":return((Qe=b.settings.peers)==null?void 0:Qe.map(Pt=>Pt.endpoint))||[];default:return[]}},We=b=>{const C=te.find(de=>de.tag===b.tag);return C?`${ss.sizeFormat(C.up)} / ${ss.sizeFormat(C.down)}`:`${ss.sizeFormat(0)} / ${ss.sizeFormat(0)}`},Je=d.exports.useMemo(()=>Array.isArray(j==null?void 0:j.outbounds)?j.outbounds:[],[j]),ft=d.exports.useMemo(()=>{var b;return Array.isArray((b=j==null?void 0:j.routing)==null?void 0:b.rules)?j.routing.rules:[]},[j]),Mt=d.exports.useMemo(()=>{var b;return Array.from(new Set(((b=j==null?void 0:j.inbounds)!=null?b:[]).map(C=>C==null?void 0:C.tag).filter(C=>Boolean(C))))},[j]),Qt=d.exports.useMemo(()=>Array.from(new Set(Je.map(b=>b==null?void 0:b.tag).filter(b=>Boolean(b)))),[Je]),yr=d.exports.useMemo(()=>{var b,C;return Array.from(new Set(((C=(b=j==null?void 0:j.routing)==null?void 0:b.balancers)!=null?C:[]).map(de=>de==null?void 0:de.tag).filter(de=>Boolean(de))))},[j]),Ir=d.exports.useMemo(()=>Je.length===0?-1:Je.findIndex(b=>(b==null?void 0:b.protocol)==="freedom"),[Je]),hn=d.exports.useMemo(()=>{var C,de;if(Ir<0)return"";const b=Je[Ir];return(de=(C=b==null?void 0:b.settings)==null?void 0:C.domainStrategy)!=null?de:""},[Ir,Je]),Br=b=>{const C=H.getValues("config")||{},de=Array.isArray(C.outbounds)?JSON.parse(JSON.stringify(C.outbounds)):[],Xe=de.findIndex(Pt=>(Pt==null?void 0:Pt.protocol)==="freedom");if(Xe===-1)return;const dt={...de[Xe]},Qe={...dt.settings||{}};b?Qe.domainStrategy=b:delete Qe.domainStrategy,dt.settings=Qe,de[Xe]=dt,H.setValue("config.outbounds",de,{shouldDirty:!0}),Pe(de.map((Pt,Pr)=>({key:Pr,...Pt}))),we(Pt=>Pt+1)},Yr=d.exports.useMemo(()=>{var b;return(b=Je.find(C=>(C==null?void 0:C.tag)==="warp"))!=null?b:null},[Je]),pn=d.exports.useMemo(()=>Je.findIndex(b=>(b==null?void 0:b.tag)==="warp"),[Je])!==-1,ve=d.exports.useMemo(()=>{const b=ft.find(C=>C.outboundTag==="warp");return Array.isArray(b==null?void 0:b.domain)?b.domain:[]},[ft]),Vr=b=>{const C=b.map(Qe=>Qe.trim()).filter((Qe,Pt,Pr)=>Qe.length>0&&Pr.indexOf(Qe)===Pt),de=lt(),Xe=de.findIndex(Qe=>Qe.outboundTag==="warp");if(C.length===0){Xe!==-1&&(de.splice(Xe,1),V(de));return}const dt={type:"field",outboundTag:"warp",domain:C};Xe!==-1?de[Xe]={...de[Xe],...dt}:de.push(dt),V(de)},$r=b=>{const C=b.trim();if(!!C){if(ve.includes(C)){S({title:t("pages.xray.warp.domainExists","This domain already exists in the list."),status:"warning",duration:3e3,isClosable:!0,position:"top"});return}Vr([...ve,C])}},Nn=b=>{Vr(ve.filter(C=>C!==b))},Cn=d.exports.useMemo(()=>_g.filter(b=>!ve.includes(b.value)),[ve]),tn=Le("white","blackAlpha.400"),gs=Le("gray.200","whiteAlpha.200"),Gr=Le("gray.600","gray.300"),Yn=b=>{var dt;const C=ze(),de=(dt=b.tag)!=null?dt:"warp",Xe=C.findIndex(Qe=>(Qe==null?void 0:Qe.tag)===de);Xe>=0?C[Xe]=b:C.push(b),Ne(C)},_n=()=>{const b=ze(),C=b.findIndex(de=>(de==null?void 0:de.tag)==="warp");C!==-1&&(b.splice(C,1),Ne(b),Vr([]),Ye(""),ut(""))},Bt=b=>{const C=ze();ue!==null&&ue>=0&&ue<C.length?C[ue]=b:C.push(b),Ne(C),be(null)},mn=()=>{w()},Gt=()=>{document.fullscreenElement?document.exitFullscreen().then(()=>{N(!1)}).catch(b=>{console.error("Error exiting fullscreen:",b)}):document.documentElement.requestFullscreen().then(()=>{N(!0)}).catch(b=>{console.error("Error entering fullscreen:",b)})},gn=()=>{var C,de,Xe,dt;const b=H.getValues("config")||{};switch(E){case"inboundSettings":return JSON.stringify((C=b.inbounds)!=null?C:[],null,2);case"outboundSettings":return JSON.stringify((de=b.outbounds)!=null?de:[],null,2);case"routingRuleSettings":return JSON.stringify((dt=(Xe=b.routing)==null?void 0:Xe.rules)!=null?dt:[],null,2);case"xraySetting":default:return JSON.stringify(b!=null?b:{},null,2)}},An=b=>{var C,de,Xe,dt;try{const Qe=JSON.parse(b),Pt={...H.getValues("config")||{}};switch(E){case"inboundSettings":Pt.inbounds=Qe;break;case"outboundSettings":Pt.outbounds=Qe,re(Qe);break;case"routingRuleSettings":Pt.routing||(Pt.routing={}),Pt.routing.rules=Qe,ct(Qe);break;case"xraySetting":default:H.setValue("config",Qe,{shouldDirty:!0}),re((Qe==null?void 0:Qe.outbounds)||[]),ct(((C=Qe==null?void 0:Qe.routing)==null?void 0:C.rules)||[]),$(((Xe=(de=Qe==null?void 0:Qe.routing)==null?void 0:de.balancers)==null?void 0:Xe.map((Pr,Gn)=>{var Ln;return{key:Gn,tag:Pr.tag||"",strategy:((Ln=Pr.strategy)==null?void 0:Ln.type)||"random",selector:Pr.selector||[],fallbackTag:Pr.fallbackTag||""}}))||[]),_(((dt=Qe==null?void 0:Qe.dns)==null?void 0:dt.servers)||[]),Y((Qe==null?void 0:Qe.fakedns)||[]);return}H.setValue("config",Pt,{shouldDirty:!0})}catch{}},fn=()=>{var C,de;const b=H.getValues("config")||{};return he==="observatory"?JSON.stringify((C=b.observatory)!=null?C:{},null,2):he==="burstObservatory"?JSON.stringify((de=b.burstObservatory)!=null?de:{},null,2):""},bn=b=>{try{const C=JSON.parse(b),de={...H.getValues("config")||{}};he==="observatory"&&(de.observatory=C),he==="burstObservatory"&&(de.burstObservatory=C),H.setValue("config",de,{shouldDirty:!0})}catch{}},Rn=b=>!b&&b!==0?[]:Array.isArray(b)?b.map(C=>typeof C=="string"?C.trim():String(C)).filter(Boolean):typeof b=="string"?b.split(",").map(C=>C.trim()).filter(Boolean):[String(b)],wr=(b,C="blue")=>{const de=Rn(b);return de.length?e(Xm,{chips:de,color:C}):e(h,{color:"gray.400",children:"-"})},fs=b=>{if(b==null||b===""||typeof b=="string"&&!b.trim())return e(h,{color:"gray.400",children:"-"});const C=typeof b=="string"?b:String(b);return C.length>30?e(wa,{text:C,label:t("details")}):e(h,{children:C})},sa=b=>{if(!b)return e(h,{color:"gray.400",children:"-"});try{const C=JSON.parse(b);if(C&&typeof C=="object"&&!Array.isArray(C)){const de=Object.entries(C);return de.length?e(L,{display:"flex",flexWrap:"wrap",gap:"1",children:de.map(([Xe,dt])=>e(rt,{colorScheme:"purple",size:"sm",children:`${Xe}: ${String(dt)}`},Xe))}):e(h,{color:"gray.400",children:"-"})}}catch{}return e(h,{fontFamily:"mono",fontSize:"xs",whiteSpace:"pre-wrap",children:b})};if(!u)return e(me,{spacing:4,align:"center",py:10,children:e(Et,{size:"lg"})});if(!m)return n(me,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.xraySettings","Xray settings")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("xraySettings.noPermission","You do not have permission to manage Xray settings.")})]});const ia=fn(),aa=gn();return n(me,{spacing:6,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.coreSettings")}),e(h,{color:"gray.600",_dark:{color:"gray.300"},fontSize:"sm",children:t("pages.xray.coreDescription")}),e(ge,{direction:{base:"column",sm:"row"},spacing:{base:3,sm:4},justifyContent:"space-between",alignItems:{base:"stretch",sm:"center"},children:n(ge,{direction:{base:"column",sm:"row"},spacing:3,flexWrap:"wrap",w:"full",children:[e(O,{size:"sm",colorScheme:"primary",isLoading:a,isDisabled:!fe||a,onClick:Ge,w:{base:"full",sm:"auto"},children:t("core.save")}),e(O,{size:"sm",leftIcon:e(rl,{}),isLoading:zt,onClick:()=>_t(),variant:"outline",w:{base:"full",sm:"auto"},children:t(zt?"core.restarting":"core.restartCore")})]})}),n(hs,{variant:"enclosed",colorScheme:"primary",isLazy:!0,isManual:!0,children:[n(ps,{overflowX:"auto",flexWrap:{base:"wrap",md:"nowrap"},gap:{base:2,md:0},pb:{base:1,md:0},sx:{"&::-webkit-scrollbar":{display:"none"},button:{flexShrink:0,fontSize:"sm",minW:"max-content",px:3,py:2,"@media (min-width: 48em)":{fontSize:"md",px:4,py:3}}},children:[e(or,{children:n(U,{spacing:2,align:"center",children:[e(yg,{}),e(h,{as:"span",children:t("pages.xray.basicTemplate")})]})}),e(or,{children:n(U,{spacing:2,align:"center",children:[e(Sg,{}),e(h,{as:"span",children:t("pages.xray.Routings")})]})}),e(or,{children:n(U,{spacing:2,align:"center",children:[e(xg,{}),e(h,{as:"span",children:t("pages.xray.Outbounds")})]})}),e(or,{children:n(U,{spacing:2,align:"center",children:[e(vg,{}),e(h,{as:"span",children:t("pages.xray.Balancers")})]})}),e(or,{children:n(U,{spacing:2,align:"center",children:[e(wg,{}),e(h,{as:"span",children:t("DNS")})]})}),e(or,{children:n(U,{spacing:2,align:"center",children:[e(kg,{}),e(h,{as:"span",children:t("pages.xray.advancedTemplate")})]})}),e(or,{children:n(U,{spacing:2,align:"center",children:[e(Cg,{}),e(h,{as:"span",children:t("pages.xray.logs")})]})})]}),n(ms,{children:[e(lr,{children:n(me,{spacing:4,align:"stretch",children:[n(Ui,{title:t("pages.xray.serverIPs","Server IPs"),children:[e(Kr,{label:"IPv4",controlId:"server-ipv4",children:b=>e(wa,{text:(g==null?void 0:g.ipv4)||"Loading..."})}),e(Kr,{label:"IPv6",controlId:"server-ipv6",children:b=>e(wa,{text:(g==null?void 0:g.ipv6)||"Loading..."})})]}),n(Ui,{title:t("pages.xray.generalConfigs"),children:[e(Kr,{label:t("pages.xray.FreedomStrategy"),controlId:"freedom-domain-strategy",children:b=>n(Ze,{id:b,size:"sm",maxW:"220px",value:hn,onChange:C=>Br(C.target.value),isDisabled:Ir===-1,children:[e("option",{value:"",children:t("core.default","Default")}),["AsIs","UseIP","UseIPv4","UseIPv6","UseIPv6v4","UseIPv4v6"].map(C=>e("option",{value:C,children:C},C))]})}),e(Kr,{label:t("pages.xray.RoutingStrategy"),controlId:"routing-domain-strategy",children:b=>e(kt,{name:"config.routing.domainStrategy",control:H.control,render:({field:C})=>e(Ze,{...C,id:b,size:"sm",maxW:"220px",children:["AsIs","IPIfNonMatch","IPOnDemand"].map(de=>e("option",{value:de,children:de},de))})})})]}),e(L,{borderWidth:"1px",borderColor:gs,borderRadius:"lg",bg:tn,p:{base:3,md:4},children:n(me,{align:"stretch",spacing:3,children:[n(U,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"semibold",children:t("pages.xray.warpRouting")}),e(O,{variant:"outline",size:"sm",leftIcon:e(nl,{}),onClick:le,children:pn?t("pages.xray.warp.manage","Manage WARP"):t("pages.xray.warp.create","Create WARP")})]}),e(h,{fontSize:"sm",color:Gr,children:t("pages.xray.warpRoutingDesc")}),n(_s,{children:[ve.length===0&&e(Fn,{children:e(rt,{colorScheme:"gray",variant:"subtle",children:e(ci,{children:t("core.empty","Empty")})})}),ve.map(b=>e(Fn,{children:n(rt,{colorScheme:"primary",borderRadius:"full",children:[e(ci,{children:b}),e(Vi,{"aria-label":t("core.remove"),onClick:()=>Nn(b)})]})},b))]}),n(U,{spacing:3,flexWrap:"wrap",children:[e(Ze,{placeholder:t("core.select"),size:"sm",maxW:"240px",value:Fe,onChange:b=>{const{value:C}=b.target;C&&$r(C),Ye("")},isDisabled:Cn.length===0,children:Cn.map(b=>e("option",{value:b.value,children:b.label},b.value))}),n(U,{spacing:2,maxW:"320px",flex:"1",children:[e(De,{size:"sm",value:ot,onChange:b=>ut(b.target.value),placeholder:"geosite:google"}),e(O,{size:"sm",colorScheme:"primary",onClick:()=>{$r(ot),ut("")},isDisabled:!ot.trim(),children:t("core.add")})]})]})]})}),n(Ui,{title:t("pages.xray.statistics"),children:[e(Kr,{label:t("pages.xray.statsInboundUplink"),controlId:"stats-inbound-uplink",children:b=>e(kt,{name:"config.policy.system.statsInboundUplink",control:H.control,render:({field:C})=>e(vt,{id:b,isChecked:!!C.value,onChange:de=>C.onChange(de.target.checked)})})}),e(Kr,{label:t("pages.xray.statsInboundDownlink"),controlId:"stats-inbound-downlink",children:b=>e(kt,{name:"config.policy.system.statsInboundDownlink",control:H.control,render:({field:C})=>e(vt,{id:b,isChecked:!!C.value,onChange:de=>C.onChange(de.target.checked)})})}),e(Kr,{label:t("pages.xray.statsOutboundUplink"),controlId:"stats-outbound-uplink",children:b=>e(kt,{name:"config.policy.system.statsOutboundUplink",control:H.control,render:({field:C})=>e(vt,{id:b,isChecked:!!C.value,onChange:de=>C.onChange(de.target.checked)})})}),e(Kr,{label:t("pages.xray.statsOutboundDownlink"),controlId:"stats-outbound-downlink",children:b=>e(kt,{name:"config.policy.system.statsOutboundDownlink",control:H.control,render:({field:C})=>e(vt,{id:b,isChecked:!!C.value,onChange:de=>C.onChange(de.target.checked)})})})]}),n(Ui,{title:t("pages.xray.logConfigs"),children:[e(Kr,{label:t("pages.xray.logLevel"),controlId:"log-level",children:b=>e(kt,{name:"config.log.loglevel",control:H.control,render:({field:C})=>e(Ze,{...C,id:b,size:"sm",maxW:"220px",children:["none","debug","info","warning","error"].map(de=>e("option",{value:de,children:de},de))})})}),e(Kr,{label:t("pages.xray.accessLog"),controlId:"access-log",children:b=>e(kt,{name:"config.log.access",control:H.control,render:({field:C})=>n(Ze,{...C,id:b,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["none",Ag].map(de=>e("option",{value:de,children:de},de))]})})}),e(Kr,{label:t("pages.xray.errorLog"),controlId:"error-log",children:b=>e(kt,{name:"config.log.error",control:H.control,render:({field:C})=>n(Ze,{...C,id:b,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["none",Dg].map(de=>e("option",{value:de,children:de},de))]})})}),e(Kr,{label:t("pages.xray.maskAddress"),controlId:"mask-address",children:b=>e(kt,{name:"config.log.maskAddress",control:H.control,render:({field:C})=>n(Ze,{...C,id:b,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["quarter","half","full"].map(de=>e("option",{value:de,children:de},de))]})})}),e(Kr,{label:t("pages.xray.dnsLog"),controlId:"dns-log",children:b=>e(kt,{name:"config.log.dnsLog",control:H.control,render:({field:C})=>e(vt,{id:b,isChecked:!!C.value,onChange:de=>C.onChange(de.target.checked)})})})]})]})}),e(lr,{children:n(me,{spacing:4,align:"stretch",children:[e(O,{leftIcon:e(Xs,{}),...js,onClick:z,children:t("pages.xray.rules.add")}),e(ei,{children:n(ti,{minW:"1100px",children:[n(yn,{children:[n(Ot,{children:[e(Ke,{rowSpan:2,w:"80px",children:t("common.index",{defaultValue:"#"})}),e(Ke,{colSpan:2,children:t("pages.xray.rules.sourceGroup",{defaultValue:"Source"})}),e(Ke,{colSpan:3,children:t("pages.xray.rules.networkGroup",{defaultValue:"Network"})}),e(Ke,{colSpan:3,children:t("pages.xray.rules.destinationGroup",{defaultValue:"Destination"})}),e(Ke,{colSpan:2,children:t("pages.xray.rules.inboundGroup",{defaultValue:"Inbound"})}),e(Ke,{rowSpan:2,children:t("pages.xray.rules.outbound")}),e(Ke,{rowSpan:2,children:t("pages.xray.rules.balancer",{defaultValue:"Balancer"})}),e(Ke,{rowSpan:2,children:t("actions",{defaultValue:"Actions"})})]}),n(Ot,{children:[e(Ke,{children:t("IP",{defaultValue:"IP"})}),e(Ke,{children:t("port",{defaultValue:"Port"})}),e(Ke,{children:t("network",{defaultValue:"Network"})}),e(Ke,{children:t("pages.xray.rules.protocol",{defaultValue:"Protocol"})}),e(Ke,{children:t("pages.xray.rules.attrs",{defaultValue:"Attrs"})}),e(Ke,{children:t("IP",{defaultValue:"IP"})}),e(Ke,{children:t("pages.xray.rules.domain",{defaultValue:"Domain"})}),e(Ke,{children:t("port",{defaultValue:"Port"})}),e(Ke,{children:t("pages.xray.rules.inboundTag",{defaultValue:"Inbound Tag"})}),e(Ke,{children:t("pages.xray.rules.user",{defaultValue:"Client"})})]})]}),n(sn,{children:[Te.length===0&&e(Ot,{children:e(Me,{colSpan:14,children:e(h,{textAlign:"center",color:"gray.500",children:t("pages.xray.rules.empty",{defaultValue:"No routing rules defined yet."})})})}),Te.map((b,C)=>n(Ot,{children:[e(Me,{children:n(me,{align:"flex-start",spacing:1,children:[e(h,{fontWeight:"semibold",children:C+1}),n(U,{spacing:1,children:[e(Be,{"aria-label":"move up",icon:e(el,{}),size:"xs",variant:"ghost",isDisabled:C===0,onClick:()=>et(C,C-1)}),e(Be,{"aria-label":"move down",icon:e(tl,{}),size:"xs",variant:"ghost",isDisabled:C===Te.length-1,onClick:()=>et(C,C+1)})]})]})}),e(Me,{children:wr(b.source,"blue")}),e(Me,{children:fs(b.sourcePort)}),e(Me,{children:wr(b.network,"purple")}),e(Me,{children:wr(b.protocol,"green")}),e(Me,{children:sa(b.attrs)}),e(Me,{children:wr(b.ip,"blue")}),e(Me,{children:wr(b.domain,"blue")}),e(Me,{children:fs(b.port)}),e(Me,{children:wr(b.inboundTag,"teal")}),e(Me,{children:wr(b.user,"cyan")}),e(Me,{children:fs(b.outboundTag)}),e(Me,{children:fs(b.balancerTag)}),e(Me,{children:n(U,{spacing:1,children:[e(Be,{"aria-label":"edit",icon:e(Zs,{}),size:"xs",variant:"ghost",onClick:()=>k(C)}),e(Be,{"aria-label":"delete",icon:e(Qs,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>Se(C)})]})})]},b.key))]})]})})]})}),e(lr,{children:n(me,{spacing:4,align:"stretch",children:[n(U,{children:[e(O,{leftIcon:e(Xs,{}),...js,onClick:Vt,children:t("pages.xray.outbound.addOutbound")}),e(O,{leftIcon:e(nl,{}),size:"xs",variant:"ghost",onClick:le,children:pn?t("pages.xray.warp.manage","Manage WARP"):t("pages.xray.warp.create","Create WARP")}),e(O,{leftIcon:e(rl,{}),size:"xs",variant:"ghost",onClick:Ue,children:t("refresh")})]}),e(ei,{children:n(ti,{minW:"880px",children:[e(yn,{children:n(Ot,{children:[e(Ke,{children:"#"}),e(Ke,{children:t("pages.xray.outbound.tag")}),e(Ke,{children:t("protocol")}),e(Ke,{children:t("pages.xray.outbound.address")}),e(Ke,{children:t("pages.inbounds.traffic")})]})}),e(sn,{children:Ae.map((b,C)=>{var de,Xe,dt;return n(Ot,{children:[e(Me,{children:n(U,{children:[e(h,{children:C+1}),e(Be,{"aria-label":t("pages.xray.outbound.moveUp","Move up"),icon:e(el,{}),size:"xs",variant:"ghost",isDisabled:C===0,onClick:()=>ar(C)}),e(Be,{"aria-label":t("pages.xray.outbound.moveDown","Move down"),icon:e(tl,{}),size:"xs",variant:"ghost",isDisabled:C===Ae.length-1,onClick:()=>ne(C)}),e(Be,{"aria-label":"edit",icon:e(Zs,{}),size:"xs",variant:"ghost",onClick:()=>dr(C)}),e(Be,{"aria-label":"delete",icon:e(Qs,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>ir(C)})]})}),e(Me,{children:b.tag}),n(Me,{children:[e(rt,{colorScheme:"purple",children:b.protocol}),["vmess","vless","trojan","shadowsocks"].includes(b.protocol)&&n($t,{children:[e(rt,{colorScheme:"blue",children:(de=b.streamSettings)==null?void 0:de.network}),((Xe=b.streamSettings)==null?void 0:Xe.security)==="tls"&&e(rt,{colorScheme:"green",children:"tls"}),((dt=b.streamSettings)==null?void 0:dt.security)==="reality"&&e(rt,{colorScheme:"green",children:"reality"})]})]}),e(Me,{children:K(b).map(Qe=>e(h,{children:Qe},Qe))}),e(Me,{children:e(rt,{colorScheme:"green",children:We(b)})})]},b.key)})})]})})]})}),e(lr,{children:n(me,{spacing:4,align:"stretch",children:[e(O,{leftIcon:e(Xs,{}),...js,onClick:Ht,children:t("pages.xray.balancer.addBalancer")}),e(ei,{children:n(ti,{minW:"680px",children:[e(yn,{children:n(Ot,{children:[e(Ke,{children:"#"}),e(Ke,{children:t("pages.xray.balancer.tag")}),e(Ke,{children:t("pages.xray.balancer.balancerStrategy")}),e(Ke,{children:t("pages.xray.balancer.balancerSelectors")})]})}),e(sn,{children:Ce.map((b,C)=>n(Ot,{children:[e(Me,{children:n(U,{children:[e(h,{children:C+1}),e(Be,{"aria-label":"edit",icon:e(Zs,{}),size:"xs",variant:"ghost",onClick:()=>gt()}),e(Be,{"aria-label":"delete",icon:e(Qs,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>ht(C)})]})}),e(Me,{children:b.tag}),e(Me,{children:e(rt,{colorScheme:b.strategy==="random"?"purple":"green",children:b.strategy==="random"?"Random":b.strategy==="roundRobin"?"Round Robin":b.strategy==="leastLoad"?"Least Load":"Least Ping"})}),e(Me,{children:b.selector.map(de=>e(rt,{colorScheme:"blue",m:1,children:de},de))})]},b.key))})]})}),(((Pi=H.getValues("config"))==null?void 0:Pi.observatory)||((Ei=H.getValues("config"))==null?void 0:Ei.burstObservatory))&&n(me,{spacing:3,align:"stretch",children:[e(fi,{onChange:b=>{Re(b),we(C=>C+1)},value:he,children:n(U,{spacing:3,children:[((Fs=H.getValues("config"))==null?void 0:Fs.observatory)&&e(Lr,{value:"observatory",children:"Observatory"}),((Hs=H.getValues("config"))==null?void 0:Hs.burstObservatory)&&e(Lr,{value:"burstObservatory",children:"Burst Observatory"})]})}),e(L,{h:"300px",children:e(Ua,{json:ia,onChange:b=>bn(b)},`obs-${he}-${je}`)})]})]})}),e(lr,{children:n(me,{spacing:4,align:"stretch",children:[n(x,{display:"flex",alignItems:"center",children:[e(I,{children:t("pages.xray.dns.enable")}),e(kt,{name:"config.dns",control:H.control,render:({field:b})=>e(vt,{isChecked:!!b.value,onChange:C=>{const de={...H.getValues("config")};C.target.checked?de.dns={servers:[],queryStrategy:"UseIP",tag:"dns_inbound"}:(delete de.dns,delete de.fakedns),H.setValue("config",de,{shouldDirty:!0}),_([]),Y([])}})})]}),X.length>0&&n($t,{children:[e(O,{leftIcon:e(Xs,{}),...js,onClick:Ut,children:t("pages.xray.dns.add")}),e(ei,{children:n(ti,{minW:"720px",children:[e(yn,{children:n(Ot,{children:[e(Ke,{children:"#"}),e(Ke,{children:t("pages.xray.outbound.address")}),e(Ke,{children:t("pages.xray.dns.domains")}),e(Ke,{children:t("pages.xray.dns.expectIPs")})]})}),e(sn,{children:X.map((b,C)=>n(Ot,{children:[e(Me,{children:n(U,{children:[e(h,{children:C+1}),e(Be,{"aria-label":"edit",icon:e(Zs,{}),size:"xs",variant:"ghost",onClick:()=>ur()}),e(Be,{"aria-label":"delete",icon:e(Qs,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>Hr(C)})]})}),e(Me,{children:typeof b=="object"?b.address:b}),e(Me,{children:typeof b=="object"?sl(b.domains):""}),e(Me,{children:typeof b=="object"?sl(b.expectIPs):""})]},C))})]})})]}),P.length>0&&n($t,{children:[e(O,{leftIcon:e(Xs,{}),...js,onClick:Jr,children:t("pages.xray.fakedns.add")}),e(ei,{children:n(ti,{minW:"520px",children:[e(yn,{children:n(Ot,{children:[e(Ke,{children:"#"}),e(Ke,{children:t("pages.xray.fakedns.ipPool")}),e(Ke,{children:t("pages.xray.fakedns.poolSize")})]})}),e(sn,{children:P.map((b,C)=>n(Ot,{children:[e(Me,{children:n(U,{children:[e(h,{children:C+1}),e(Be,{"aria-label":"edit",icon:e(Zs,{}),size:"xs",variant:"ghost",onClick:()=>hr()}),e(Be,{"aria-label":"delete",icon:e(Qs,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>xt(C)})]})}),e(Me,{children:b.ipPool}),e(Me,{children:b.poolSize})]},C))})]})})]})]})}),e(lr,{children:n(me,{spacing:4,align:"stretch",children:[n(L,{px:2,children:[e(h,{fontWeight:"semibold",children:t("pages.xray.Template")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:t("pages.xray.TemplateDesc")})]}),e(L,{px:2,children:e(fi,{onChange:b=>{G(b),we(C=>C+1)},value:E,children:n(U,{spacing:3,wrap:"wrap",children:[e(Lr,{value:"xraySetting",children:t("pages.xray.completeTemplate")}),e(Lr,{value:"inboundSettings",children:t("pages.xray.Inbounds")}),e(Lr,{value:"outboundSettings",children:t("pages.xray.Outbounds")}),e(Lr,{value:"routingRuleSettings",children:t("pages.xray.Routings")})]})})}),n(L,{position:"relative",w:"100%",h:"calc(100vh - 350px)",minH:"400px",children:[e(Be,{position:Ie?"fixed":"absolute",top:2,right:2,"aria-label":Ie?"Exit Full Screen":"Full Screen",icon:Ie?e(bg,{}):e(fg,{}),onClick:Gt,zIndex:Ie?1101:10}),e(L,{w:Ie?"100vw":"100%",h:Ie?"100vh":"100%",position:Ie?"fixed":"relative",top:Ie?0:"auto",left:Ie?0:"auto",zIndex:Ie?1e3:"auto",children:e(Ua,{json:aa,onChange:b=>{An(b)}},`advanced-${E}-${je}`)}),Ie&&tt&&e(O,{position:"fixed",bottom:4,left:"50%",transform:"translateX(-50%)",zIndex:1102,size:"sm",colorScheme:"primary",onClick:Gt,children:t("pages.xray.exitFullscreen","Exit full screen")})]})]})}),e(lr,{children:e(L,{children:e(Sc,{showTitle:!1})})})]})]}),e(eg,{isOpen:y,onClose:St,mode:ue!==null?"edit":"create",initialOutbound:ue!==null?Je[ue]:null,onSubmitOutbound:Bt}),e(og,{isOpen:D,mode:q!==null?"edit":"create",initialRule:q!==null&&ft[q]||null,availableInboundTags:Mt,availableOutboundTags:Qt,availableBalancerTags:yr,onSubmit:Nt,onClose:Ft}),e(gg,{isOpen:R,onClose:mn,initialOutbound:Yr,onSave:Yn,onDelete:_n}),e(lg,{isOpen:ae,onClose:M,form:H,setBalancersData:$}),e(cg,{isOpen:T,onClose:_e,form:H,setDnsServers:_}),e(dg,{isOpen:ke,onClose:oe,form:H,setFakeDns:Y})]})},Oi="__no_service__",Pg=({isOpen:t,onClose:s,onSubmit:r,isSaving:o,allHosts:i,allAdmins:a,initialService:l})=>{var Ae,Pe,Te,J,Ce;const{t:c}=qe(),[u,p]=d.exports.useState((Ae=l==null?void 0:l.name)!=null?Ae:""),[m,g]=d.exports.useState((Pe=l==null?void 0:l.description)!=null?Pe:""),[S,y]=d.exports.useState((Te=l==null?void 0:l.flow)!=null?Te:""),[A,f]=d.exports.useState((J=l==null?void 0:l.admin_ids)!=null?J:[]),[D,F]=d.exports.useState((Ce=l==null?void 0:l.hosts.map($=>$.id))!=null?Ce:[]),[Z,ae]=d.exports.useState(""),[v,M]=d.exports.useState(""),[T,Q]=d.exports.useState(null),_e=sr();d.exports.useEffect(()=>{var $,X,_,P,Y;t&&(p(($=l==null?void 0:l.name)!=null?$:""),g((X=l==null?void 0:l.description)!=null?X:""),y((_=l==null?void 0:l.flow)!=null?_:""),f((P=l==null?void 0:l.admin_ids)!=null?P:[]),F((Y=l==null?void 0:l.hosts.map(te=>te.id))!=null?Y:[]),ae(""),M(""))},[t,l]);const ke=d.exports.useMemo(()=>new Map(i.map($=>[$.id,$])),[i]),W=d.exports.useMemo(()=>i.filter($=>!D.includes($.id)&&!$.isDisabled),[i,D]),oe=d.exports.useMemo(()=>{const $=v.trim().toLowerCase();return $?W.filter(X=>{const _=X.label.toLowerCase(),P=X.inboundTag.toLowerCase(),Y=X.protocol.toLowerCase();return _.includes($)||P.includes($)||Y.includes($)}):W},[W,v]),R=d.exports.useMemo(()=>{const $=Z.trim().toLowerCase();return $?a.filter(X=>X.username.toLowerCase().includes($)):a},[Z,a]),le=d.exports.useMemo(()=>new Set(A),[A]),w=()=>{const $=A.length===a.length&&a.length>0;f($?[]:a.map(X=>X.id))},H=$=>{f(X=>X.includes($)?X.filter(_=>_!==$):[...X,$])},ce=$=>{F(X=>X.includes($)?X.filter(_=>_!==$):[...X,$])},j=($,X)=>{F(_=>{const P=_.indexOf($);if(P===-1)return _;const Y=X==="up"?P-1:P+1;if(Y<0||Y>=_.length)return _;const te=[..._];return[te[P],te[Y]]=[te[Y],te[P]],te})},fe=async()=>{if(!u.trim()){_e({status:"warning",title:c("services.validation.nameRequired","Service name is required")});return}if(!D.length){_e({status:"warning",title:c("services.validation.hostRequired","Please select at least one host")});return}const $=D.map((X,_)=>({host_id:X,sort:_}));await r({name:u.trim(),description:(m==null?void 0:m.trim())||null,flow:S!=null&&S.trim()?S.trim():null,admin_ids:A,hosts:$},l==null?void 0:l.id)};return n(Kt,{isOpen:t,onClose:s,size:"5xl",children:[e(Dt,{}),n(qt,{children:[e(Tt,{children:l?c("services.editTitle","Edit Service"):c("services.createTitle","Create Service")}),e(Jt,{}),e(It,{children:n(ge,{spacing:6,children:[n(U,{spacing:4,children:[e(Sr,{label:c("services.fields.name","Name"),value:u,onChange:$=>p($.target.value),maxLength:128,isRequired:!0}),e(Sr,{label:c("services.fields.description","Description"),value:m!=null?m:"",onChange:$=>g($.target.value),maxLength:256})]}),n(x,{maxW:{base:"100%",md:"320px"},children:[e(I,{children:c("services.fields.flow","Flow")}),e(Ze,{value:S,onChange:$=>y($.target.value),placeholder:c("services.flow.placeholder","No flow"),children:e("option",{value:"xtls-rprx-vision",children:"xtls-rprx-vision"})}),e(nr,{children:c("services.flow.helper","Applies to supported protocols (e.g. VLESS/Trojan)")})]}),n(L,{children:[e(h,{fontWeight:"medium",mb:2,children:c("services.fields.admins","Admins")}),n(ge,{spacing:3,children:[e(vr,{isChecked:A.length===a.length&&a.length>0,onChange:w,isDisabled:a.length===0,children:c("services.selectAllAdmins","Select all admins")}),e(Sr,{value:Z,onChange:$=>ae($.target.value),placeholder:c("services.searchAdmins","Search admins"),size:"sm",clearable:!0}),e(me,{align:"stretch",spacing:2,maxH:"200px",overflowY:"auto",borderWidth:"1px",borderRadius:"md",p:3,children:a.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noAdminsFound","No admins available")}):R.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noAdminsMatching","No admins match your search")}):R.map($=>{const X=le.has($.id);return e(L,{borderWidth:"1px",borderRadius:"md",px:3,py:2,borderColor:X?"primary.400":"gray.200",bg:X?"primary.50":"transparent",_hover:{borderColor:"primary.300",cursor:"pointer"},_dark:{borderColor:X?"primary.300":"gray.600",bg:X?"gray.700":"transparent"},transition:"all 0.1s ease-in-out",onClick:()=>H($.id),onKeyDown:_=>{(_.key==="Enter"||_.key===" ")&&(_.preventDefault(),H($.id))},role:"button",tabIndex:0,children:n(pt,{align:"center",justify:"space-between",children:[e(h,{fontWeight:"medium",children:$.username}),X&&e(cn,{colorScheme:"primary",children:c("services.selected","Selected")})]})},$.id)})})]}),e(h,{fontSize:"sm",color:"gray.500",mt:1,children:c("services.adminHint","Selected admins can create users for this service")})]}),n(gi,{templateColumns:{base:"1fr",md:"1fr 1fr"},gap:4,children:[e(on,{children:n(Fr,{variant:"outline",h:"full",children:[e(As,{children:e(h,{fontWeight:"semibold",children:c("services.availableHosts","Available Hosts")})}),e(Pn,{children:n(ge,{spacing:3,children:[e(Sr,{value:v,onChange:$=>M($.target.value),placeholder:c("services.searchHosts","Search hosts"),size:"sm",clearable:!0}),e(me,{align:"stretch",spacing:2,maxH:"300px",overflowY:"auto",children:W.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noHostsLeft","All hosts are selected")}):oe.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noHostsMatching","No hosts match your search")}):oe.map($=>n(L,{borderWidth:"1px",borderRadius:"md",px:3,py:2,borderColor:T===$.id?"primary.400":"gray.200",_hover:{borderColor:"primary.300",cursor:"pointer"},onMouseEnter:()=>Q($.id),onMouseLeave:()=>Q(null),onClick:()=>ce($.id),children:[e(h,{fontWeight:"medium",children:$.label}),n(h,{fontSize:"sm",color:"gray.500",children:[$.protocol.toUpperCase()," - ",$.inboundTag]})]},$.id))})]})})]})}),e(on,{children:n(Fr,{variant:"outline",h:"full",children:[e(As,{children:e(h,{fontWeight:"semibold",children:c("services.selectedHosts","Selected Hosts")})}),e(Pn,{children:n(me,{align:"stretch",spacing:2,maxH:"300px",overflowY:"auto",children:[D.length===0&&e(h,{fontSize:"sm",color:"gray.500",children:c("services.noHostsSelected","Choose hosts from the left list")}),D.map(($,X)=>{const _=ke.get($);return _?e($d.div,{layout:!0,children:n(pt,{align:"center",justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,gap:3,children:[n(L,{children:[n(U,{spacing:2,align:"center",children:[e(h,{fontWeight:"medium",children:_.label}),_.isDisabled&&e(cn,{colorScheme:"red",children:c("services.hostDisabled","Disabled")})]}),n(h,{fontSize:"sm",color:"gray.500",children:[_.protocol.toUpperCase()," - ",_.inboundTag]})]}),n(U,{spacing:1,children:[e(mt,{label:c("services.moveUp","Move up"),children:e(Be,{"aria-label":"Move up",size:"sm",variant:"ghost",icon:e(Vl,{width:16}),onClick:()=>j($,"up"),isDisabled:X===0})}),e(mt,{label:c("services.moveDown","Move down"),children:e(Be,{"aria-label":"Move down",size:"sm",variant:"ghost",icon:e($l,{width:16}),onClick:()=>j($,"down"),isDisabled:X===D.length-1})}),e(mt,{label:c("services.removeHost","Remove host"),children:e(Be,{"aria-label":"Remove",size:"sm",variant:"ghost",icon:e(wn,{width:16}),onClick:()=>ce($)})})]})]})},$):null})]})})]})})]})]})}),e(Wt,{children:n(U,{justify:"flex-end",w:"full",children:[e(O,{onClick:s,children:c("cancel")}),e(O,{colorScheme:"primary",onClick:fe,isLoading:o,children:c(l?"saveChanges":"create")})]})})]})]})},Eg=()=>{var be,Ie,N;const{t}=qe(),s=sr(),{userData:r,getUserIsSuccess:o}=xr(),i=o&&Boolean((be=r.permissions)==null?void 0:be.sections.services),a=Hn(),l=un(),c=ic(),{inbounds:u,refetchUsers:p}=Lt(),m=rr(),[g,S]=d.exports.useState(null);d.exports.useEffect(()=>{!o||!i||(a.fetchServices(),l.fetchAdmins({limit:500,offset:0}),yi(),c.fetchHosts())},[o,i]);const y=d.exports.useMemo(()=>l.admins.slice().sort((E,G)=>E.username.localeCompare(G.username)).map(E=>({id:E.id,username:E.username})),[l.admins]),A=d.exports.useMemo(()=>{var G,he;const E=[];for(const[Re,tt]of Object.entries(c.hosts)){const je=(G=Array.from(u.values()).flat().find(Fe=>Fe.tag===Re))!=null?G:null,we=(he=je==null?void 0:je.protocol)!=null?he:"unknown";tt.forEach(Fe=>{Fe.id!=null&&E.push({id:Fe.id,label:Fe.remark,inboundTag:Re,protocol:we,isDisabled:Boolean(Fe.is_disabled)})})}return E},[c.hosts,u]),f=()=>{S(null),m.onOpen()},D=async E=>{try{const G=await a.fetchServiceDetail(E);S(G),m.onOpen()}catch{s({status:"error",title:t("services.fetchFailed","Unable to fetch service details")})}},F=async(E,G)=>{var he,Re;try{G?(await a.updateService(G,E),s({status:"success",title:t("services.updated","Service updated")})):(await a.createService(E),s({status:"success",title:t("services.created","Service created")})),p(!0),m.onClose()}catch(tt){s({status:"error",title:(Re=(he=tt==null?void 0:tt.data)==null?void 0:he.detail)!=null?Re:t("services.saveFailed","Failed to save service")})}},Z=async E=>{var G,he;try{const Re=await a.fetchServiceDetail(E);fe(Re),Y()}catch(Re){s({status:"error",title:(he=(G=Re==null?void 0:Re.data)==null?void 0:G.detail)!=null?he:t("services.deleteFailed","Unable to delete service")})}},ae=async E=>{var G,he;try{await a.resetServiceUsage(E),s({status:"success",title:t("services.resetSuccess","Usage reset")})}catch(Re){s({status:"error",title:(he=(G=Re==null?void 0:Re.data)==null?void 0:G.detail)!=null?he:t("services.resetFailed","Failed to reset usage")})}},[v,M]=d.exports.useState(null),[T,Q]=d.exports.useState(!1),{isOpen:_e,onOpen:ke,onClose:W}=rr(),oe=d.exports.useRef(null),R=E=>{M(E),ke()},le=async()=>{if(v!=null){Q(!0);try{await ae(v)}finally{Q(!1),W()}}},w=v!=null?(Ie=a.services.find(E=>E.id===v))==null?void 0:Ie.name:void 0,H=()=>{fe(null),te()},ce=async()=>{var G,he;if(!j)return;const E={mode:j.user_count?Ae:"delete_users",unlink_admins:Te,target_service_id:null};E.mode==="transfer_users"&&(E.target_service_id=Ce!=null?Ce:null),_(!0);try{await a.deleteService(j.id,E),s({status:"success",title:t("services.deleted","Service removed")}),p(!0),H()}catch(Re){s({status:"error",title:(he=(G=Re==null?void 0:Re.data)==null?void 0:G.detail)!=null?he:t("services.deleteFailed","Unable to delete service")})}finally{_(!1)}},[j,fe]=d.exports.useState(null),[Ae,Pe]=d.exports.useState("transfer_users"),[Te,J]=d.exports.useState(!1),[Ce,$]=d.exports.useState(null),[X,_]=d.exports.useState(!1),{isOpen:P,onOpen:Y,onClose:te}=rr(),ie=d.exports.useMemo(()=>j?a.services.filter(E=>E.id!==j.id):a.services,[j,a.services]);d.exports.useEffect(()=>{if(j){const E=j.user_count>0;Pe(E?"transfer_users":"delete_users"),J(j.admin_ids.length>0),$(null)}},[j]),d.exports.useEffect(()=>{Ae==="delete_users"&&$(null)},[Ae]);const q=E=>e(Nl,{borderWidth:"1px",borderRadius:"lg",borderColor:"gray.200",_dark:{borderColor:"whiteAlpha.200",bg:"gray.800"},mb:2,children:({isExpanded:G})=>n($t,{children:[n(Rl,{px:4,py:3,display:"flex",alignItems:"flex-start",gap:3,children:[n(L,{flex:"1",textAlign:"left",children:[e(h,{fontWeight:"semibold",children:E.name}),E.description&&e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},noOfLines:G?3:1,mt:1,children:E.description})]}),n(me,{spacing:1,align:"flex-end",fontSize:"xs",color:"gray.500",children:[n(U,{spacing:1,children:[n(h,{fontWeight:"medium",children:[t("services.columns.hosts","Hosts"),":"]}),e(h,{fontWeight:"semibold",color:"gray.700",_dark:{color:"gray.200"},children:E.host_count})]}),n(U,{spacing:1,children:[n(h,{fontWeight:"medium",children:[t("services.columns.users","Users"),":"]}),e(h,{fontWeight:"semibold",color:"gray.700",_dark:{color:"gray.200"},children:E.user_count})]})]}),e(Kd,{})]}),e(Ll,{pt:0,pb:4,children:n(ge,{spacing:4,children:[n(He,{columns:2,spacing:3,children:[n(L,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.columns.usage","Usage")}),e(h,{fontWeight:"semibold",children:$e(E.used_traffic)})]}),n(L,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.columns.lifetime","Lifetime")}),e(h,{fontWeight:"semibold",children:$e(E.lifetime_used_traffic)})]})]}),n(ge,{spacing:2,children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.actions","Actions")}),n(U,{spacing:2,flexWrap:"wrap",children:[e(mt,{label:t("services.view","View"),children:e(Be,{"aria-label":"View",icon:e(mi,{width:18}),size:"sm",variant:"outline",onClick:he=>{he.stopPropagation(),a.fetchServiceDetail(E.id)}})}),e(mt,{label:t("services.edit","Edit"),children:e(Be,{"aria-label":"Edit",icon:e(Ia,{width:18}),size:"sm",variant:"outline",onClick:he=>{he.stopPropagation(),D(E.id)},isDisabled:!i})}),e(mt,{label:t("services.resetUsage","Reset usage"),children:e(Be,{"aria-label":"Reset usage",icon:e(dn,{width:18}),size:"sm",variant:"outline",onClick:he=>{he.stopPropagation(),R(E.id)},isDisabled:!i})}),e(mt,{label:t("services.delete","Delete"),children:e(Be,{"aria-label":"Delete",icon:e(wn,{width:18}),size:"sm",variant:"outline",colorScheme:"red",onClick:he=>{he.stopPropagation(),Z(E.id)},isDisabled:!i})})]})]})]})})]})},`service-accordion-${E.id}`),B=E=>n(Ot,{children:[e(Me,{children:n(me,{align:"start",spacing:0,children:[e(h,{fontWeight:"semibold",children:E.name}),E.description&&e(h,{fontSize:"sm",color:"gray.500",children:E.description})]})}),e(Me,{children:E.host_count}),e(Me,{children:E.user_count}),e(Me,{children:$e(E.used_traffic)}),e(Me,{children:$e(E.lifetime_used_traffic)}),e(Me,{children:n(U,{spacing:2,children:[e(mt,{label:t("services.view","View"),children:e(Be,{"aria-label":"View",icon:e(mi,{width:18}),size:"sm",variant:"ghost",onClick:()=>a.fetchServiceDetail(E.id)})}),i&&n($t,{children:[e(mt,{label:t("services.edit","Edit"),children:e(Be,{"aria-label":"Edit",icon:e(Ia,{width:18}),size:"sm",variant:"ghost",onClick:()=>D(E.id)})}),e(mt,{label:t("services.resetUsage","Reset usage"),children:e(Be,{"aria-label":"Reset usage",icon:e(dn,{width:18}),size:"sm",variant:"ghost",onClick:()=>R(E.id)})}),e(mt,{label:t("services.delete","Delete"),children:e(Be,{"aria-label":"Delete",icon:e(wn,{width:18}),size:"sm",variant:"ghost",onClick:()=>Z(E.id)})})]})]})})]},E.id),ue=a.serviceDetail;return o?i?n(me,{spacing:4,align:"stretch",children:[n(pt,{direction:{base:"column",md:"row"},justify:"space-between",align:{base:"flex-start",md:"center"},gap:{base:3,md:0},children:[n(L,{children:[e(h,{as:"h1",fontSize:"2xl",fontWeight:"semibold",children:t("services.title","Services")}),e(h,{fontSize:"sm",color:"gray.500",children:t("services.subtitle","Group hosts, assign admins, and monitor usage per service.")})]}),i&&e(O,{leftIcon:e(Tn,{width:18}),colorScheme:"primary",onClick:f,size:"sm",alignSelf:{base:"flex-start",md:"center"},w:{base:"auto",md:"auto"},px:{base:4,md:5},children:t("services.addService","New Service")})]}),e(Fr,{variant:"outline",children:e(Pn,{children:a.isLoading?e(pt,{justify:"center",py:10,children:e(Et,{})}):n($t,{children:[e(zl,{allowToggle:!0,display:{base:"block",md:"none"},children:a.services.map(q)}),e(L,{display:{base:"none",md:"block"},overflowX:"auto",children:n(as,{variant:"simple",children:[e(yn,{children:n(Ot,{children:[e(Ke,{children:t("services.columns.name","Name")}),e(Ke,{children:t("services.columns.hosts","Hosts")}),e(Ke,{children:t("services.columns.users","Users")}),e(Ke,{children:t("services.columns.usage","Usage")}),e(Ke,{children:t("services.columns.lifetime","Lifetime")}),e(Ke,{children:t("services.columns.actions","Actions")})]})}),e(sn,{children:a.services.map(B)})]})})]})})}),ue&&n(Fr,{variant:"outline",children:[e(As,{children:n(pt,{justify:"space-between",align:"center",children:[n(L,{children:[e(h,{fontWeight:"semibold",children:ue.name}),ue.description&&e(h,{fontSize:"sm",color:"gray.500",children:ue.description}),ue.flow&&n(h,{fontSize:"sm",color:"gray.500",children:[t("services.currentFlow","Flow"),": ",ue.flow]})]}),e(cn,{colorScheme:"primary",children:t("services.usersCount","{{count}} users",{count:ue.user_count})})]})}),e(Pn,{children:n(He,{columns:{base:1,md:2},spacing:6,children:[n(L,{children:[e(h,{fontWeight:"medium",mb:2,children:t("services.admins","Admins")}),e(ge,{spacing:2,children:ue.admins.length===0?e(h,{fontSize:"sm",color:"gray.500",children:t("services.noAdmins","No admins assigned")}):ue.admins.map(E=>n(pt,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(h,{fontWeight:"medium",children:E.username}),n(h,{fontSize:"sm",color:"gray.500",children:[$e(E.used_traffic)," /"," ",$e(E.lifetime_used_traffic)]})]},E.id))})]}),n(L,{children:[e(h,{fontWeight:"medium",mb:2,children:t("services.hosts","Hosts")}),e(ge,{spacing:2,children:ue.hosts.map(E=>n(pt,{borderWidth:"1px",borderRadius:"md",px:3,py:2,justify:"space-between",align:"center",children:[n(L,{children:[e(h,{fontWeight:"medium",children:E.remark}),n(h,{fontSize:"sm",color:"gray.500",children:[E.inbound_protocol.toUpperCase()," - ",E.inbound_tag]})]}),n(cn,{colorScheme:"gray",children:["#",E.sort+1]})]},E.id))})]})]})})]}),e(Ts,{isOpen:_e,leastDestructiveRef:oe,onClose:W,isCentered:!0,motionPreset:"slideInBottom",children:e(Dt,{children:n(zs,{mx:{base:4,sm:0},children:[e(Tt,{fontSize:"lg",fontWeight:"bold",children:t("services.resetUsage","Reset usage")}),e(It,{children:t("services.resetUsageConfirm","Reset usage for {{name}}?",{name:w!=null?w:t("services.thisService","this service")})}),n(Wt,{children:[e(O,{ref:oe,onClick:W,children:t("cancel","Cancel")}),e(O,{colorScheme:"primary",ml:3,onClick:le,isLoading:T,children:t("services.resetUsage","Reset usage")})]})]})})}),n(Kt,{isOpen:P,onClose:H,size:"lg",children:[e(Dt,{bg:"blackAlpha.300",backdropFilter:"blur(6px)"}),n(qt,{children:[n(Tt,{children:[t("services.deleteDialogTitle","Delete Service"),j?` \u2013 ${j.name}`:""]}),e(Jt,{}),e(It,{children:j?n(me,{align:"stretch",spacing:4,children:[e(h,{children:t("services.deleteDialogDescription",{defaultValue:'Deleting the service "{{name}}" cannot be undone. Choose how linked resources should be handled.',name:j.name})}),j.admin_ids.length>0?e(vr,{isChecked:Te,onChange:E=>J(E.target.checked),children:t("services.unlinkAdminsOption","Unlink all admins automatically")}):e(h,{fontSize:"sm",color:"gray.500",children:t("services.noAdminsLinked","No admins are currently linked.")}),j.user_count>0?n(me,{align:"stretch",spacing:3,children:[e(h,{fontWeight:"semibold",children:t("services.userDeletePrompt",{defaultValue:"This service has {{count}} linked users. Choose how to handle them.",count:j.user_count})}),e(fi,{value:Ae,onChange:E=>Pe(E),children:n(ge,{align:"flex-start",spacing:2,children:[e(Lr,{value:"delete_users",children:t("services.deleteUsersOption","Delete linked users with the service")}),e(Lr,{value:"transfer_users",children:t("services.transferUsersOption","Keep linked users (move them to No service or another service)")})]})}),Ae==="transfer_users"&&n(x,{children:[e(I,{children:t("services.selectTargetService","Target service")}),n(Ze,{placeholder:t("services.selectServicePlaceholder","Select a service"),value:Ce===null?Oi:(N=Ce==null?void 0:Ce.toString())!=null?N:Oi,onChange:E=>{const G=E.target.value;if(!G||G===Oi){$(null);return}$(Number(G))},children:[e("option",{value:Oi,children:t("services.noServiceTargetOption","Move users to No service (default)")}),ie.map(E=>e("option",{value:E.id,children:E.name},E.id))]}),e(nr,{children:t("services.transferUsersHint","Users will be unassigned from this service by default. Select another service if you want to move them elsewhere.")})]})]}):n(Mr,{status:"info",borderRadius:"md",children:[e(Ur,{}),e(Bn,{children:t("services.noUsersLinked","This service has no linked users.")})]})]}):e(h,{children:t("services.loading","Loading...")})}),n(Wt,{gap:3,children:[e(O,{variant:"ghost",onClick:H,children:t("cancel","Cancel")}),e(O,{colorScheme:"red",onClick:ce,isLoading:X,isDisabled:!j,children:t("services.delete","Delete")})]})]})]}),e(Pg,{isOpen:m.isOpen,onClose:m.onClose,onSubmit:F,isSaving:a.isSaving,allHosts:A,allAdmins:y,initialService:g!=null?g:void 0})]}):n(me,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("services.title","Services")}),e(h,{fontSize:"sm",color:"gray.500",children:t("services.noPermission","You do not have permission to view this section.")})]}):e(pt,{justify:"center",align:"center",h:"full",py:10,children:e(Et,{})})};Oe.extend(Os);const rn=t=>{const s=t.unit==="hour"?"hour":"day",r=Oe().utc().endOf(s),o=Math.max(t.amount-1,0),i=r.subtract(o,t.unit).startOf(s);return{key:t.key,start:i.toDate(),end:r.toDate(),unit:t.unit}},Cs=(t,s)=>{const r=Oe(t),o=Oe(s),[i,a]=r.isBefore(o)?[r,o]:[o,r],l=i.startOf("day"),c=a.endOf("day"),u=l.isSame(c,"day");return{key:"custom",start:l.toDate(),end:c.toDate(),unit:u?"hour":"day"}};Oe.extend(Os);const il=se(wi,{baseStyle:{w:4,h:4}}),Tg=se(Xa,{baseStyle:{w:4,h:4}}),zg=t=>{if(!t)return t;const s=t.includes(" "),r=s?t.replace(" ","T"):t,o=Oe.utc(r);return o.isValid()?s?o.local().format("MM-DD HH:mm"):o.format("YYYY-MM-DD"):t},al=t=>Oe(t).utc().format("YYYY-MM-DDTHH:mm:ss")+"Z",ol=t=>Oe(t).utc().format("YYYY-MM-DDTHH:mm:ss")+"Z",Wi=t=>{if(!t)return 0;const r=t.includes(" ")?t.replace(" ","T"):`${t}T00:00`;return Oe.utc(r).valueOf()},Ng=(t,s)=>{const r=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:s,labels:{style:{colors:s.map(()=>r)}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:o=>$e(Number(o)||0,1),style:{colors:[r]}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:o=>$e(Number(o)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},Rg=(t,s)=>({labels:s,legend:{position:"bottom",labels:{colors:t==="dark"?"#d8dee9":"#1a202c"}},tooltip:{y:{formatter:r=>$e(Number(r)||0,2),title:{formatter:(r,o)=>{var i,a,l,c;return(c=(l=(a=(i=o==null?void 0:o.w)==null?void 0:i.globals)==null?void 0:a.labels)==null?void 0:l[o.seriesIndex])!=null?c:r}}}},colors:["#3182CE","#63B3ED","#ED8936","#38A169","#9F7AEA","#F6AD55","#4299E1","#E53E3E","#D53F8C","#805AD5"]}),Lg=()=>{var $,X,_;const{t}=qe(),{colorMode:s}=jr(),{admins:r}=un(),o="auto-end",i=($=Or({base:"bottom",md:"auto-end"}))!=null?$:o,[a,l]=d.exports.useState([]),[c,u]=d.exports.useState([]),[p,m]=d.exports.useState(null),[g,S]=d.exports.useState([]),[y,A]=d.exports.useState(!1),f=d.exports.useMemo(()=>[{key:"7h",label:"7h",amount:7,unit:"hour"},{key:"1d",label:"1d",amount:1,unit:"day"},{key:"3d",label:"3d",amount:3,unit:"day"},{key:"1w",label:"1w",amount:7,unit:"day"},{key:"1m",label:"1m",amount:30,unit:"day"},{key:"3m",label:"3m",amount:90,unit:"day"}],[]),[D,F]=d.exports.useState(()=>{const P=Oe().utc().endOf("day");return{start:P.subtract(30,"day").startOf("day").toDate(),end:P.toDate(),presetKey:"1m"}}),[Z,ae]=d.exports.useState(D.presetKey||"custom"),[v,M]=d.exports.useState(null),[T,Q]=d.exports.useState([]),[_e,ke]=d.exports.useState(!1),[W,oe]=d.exports.useState(!1),[R,le]=d.exports.useState([D.start,D.end]);d.exports.useMemo(()=>{var P;return(P=c.find(Y=>Y.id===p))!=null?P:null},[c,p]);const w=d.exports.useMemo(()=>{if(!p)return a;const P=new Set(g.map(te=>te.username).filter(te=>Boolean(te))),Y=a.filter(te=>P.has(te.username));return Y.length?Y:a},[a,p,g]),H=d.exports.useMemo(()=>g.reduce((P,Y)=>P+(Y.used_traffic||0),0),[g]),ce=d.exports.useMemo(()=>g.map(P=>P.used_traffic||0),[g]),j=d.exports.useMemo(()=>g.map(P=>P.username||t("services.unassignedAdmin","Unassigned")),[g,t]),fe=d.exports.useMemo(()=>Rg(s,j),[s,j]);d.exports.useEffect(()=>{let P=!1;return(async()=>{var te;try{const ie=await Ee("/v2/services",{query:{limit:500}});if(P||!ie)return;const q=(te=ie.services)!=null?te:[];u(q),m(B=>B!==null?B:q.length?q[0].id:null)}catch{P||u([])}})(),()=>{P=!0}},[]),d.exports.useEffect(()=>{if(!p){S([]);return}let P=!1;return A(!0),Ee(`/v2/services/${p}/usage/admins`,{query:{start:al(D.start),end:ol(D.end)}}).then(Y=>{var te;P||!Y||S((te=Y.admins)!=null?te:[])}).catch(()=>{P||S([])}).finally(()=>{P||A(!1)}),()=>{P=!0}},[p,D.start,D.end]),d.exports.useEffect(()=>{let P=!1;return(async()=>{try{const te=await Ee("/admins");if(P)return;Array.isArray(te)?l(te):l(te.admins||[])}catch(te){console.error("Failed to load all admins:",te),l(r||[])}})(),()=>{P=!0}},[r]),d.exports.useEffect(()=>{if(!v)return;let P=!1;ke(!0);const Y=Oe(D.start).isSame(D.end,"day"),te={start:al(D.start),end:ol(D.end)};Y&&(te.granularity="hour");const ie=Y?"chart":"daily";return console.debug("AdminsUsage: fetching usage",{selectedAdmin:v,endpoint:ie,query:te}),Ee(`/admin/${encodeURIComponent(v)}/usage/${ie}`,{query:te}).then(q=>{if(P)return;const B=Array.isArray(q==null?void 0:q.usages)?q.usages:[];console.debug("AdminsUsage: response usages",{length:B.length,endpoint:ie});let ue;if(Y){const be=new Map;B.forEach(N=>{var he,Re;const E=typeof(N==null?void 0:N.date)=="string"?N.date:"";if(!E)return;const G=(he=be.get(E))!=null?he:0;be.set(E,G+Number((Re=N==null?void 0:N.used_traffic)!=null?Re:0))});const Ie=Array.from(be.entries());Ie.sort((N,E)=>{const[G]=N,[he]=E;return Wi(G)-Wi(he)}),ue=Ie.map(([N,E])=>({date:N,used_traffic:E}))}else{const be=B.map(Ie=>{var N,E;return{date:(N=Ie==null?void 0:Ie.date)!=null?N:"",used_traffic:Number((E=Ie==null?void 0:Ie.used_traffic)!=null?E:0)}});be.sort((Ie,N)=>Wi(Ie.date)-Wi(N.date)),ue=be}Q(ue)}).catch(q=>{P||(console.error("Error fetching admin usage:",q),Q([]))}).finally(()=>{P||ke(!1)}),()=>{P=!0}},[v,D]),d.exports.useEffect(()=>{if(!w||w.length===0)return;w.some(Y=>Y.username===v)||M(w[0].username)},[w,v]);const Ae=d.exports.useMemo(()=>T.map(P=>zg(P.date)),[T]),Pe=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:T.map(P=>P.used_traffic)}],[T,t]),Te=d.exports.useMemo(()=>({options:Ng(s,Ae),series:Pe}),[s,Ae,Pe]),J=d.exports.useMemo(()=>T.reduce((P,Y)=>P+Number(Y.used_traffic||0),0),[T]),Ce=d.exports.useMemo(()=>{const P=Oe(D.start).format("YYYY-MM-DD"),Y=Oe(D.end).format("YYYY-MM-DD");return P===Y?P:`${P} - ${Y}`},[D.start,D.end]);return n(me,{spacing:4,align:"stretch",children:[n(L,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(ge,{direction:{base:"column",md:"row"},spacing:{base:4,md:6},justifyContent:"space-between",alignItems:{base:"stretch",md:"center"},children:[n(me,{align:"start",spacing:1,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:t("admins.serviceUsageTitle","Service usage distribution")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.serviceUsageHint","Pick a service to see how its usage is split between admins.")})]}),n(ge,{direction:{base:"column",sm:"row"},spacing:3,align:{base:"stretch",sm:"center"},children:[e(Ze,{value:p!=null?p:"",onChange:P=>{const Y=Number(P.target.value);m(Number.isNaN(Y)?null:Y)},minW:{sm:"220px"},placeholder:t("admins.selectService","Select service"),isDisabled:!c.length,children:c.map(P=>e("option",{value:P.id,children:P.name},P.id))}),n(U,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[e(il,{}),n(h,{children:[t("services.totalUsage","Total"),":"," ",e(se.span,{fontWeight:"medium",children:$e(H,2)})]})]})]})]}),n(ge,{mt:6,direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},align:{base:"stretch",lg:"center"},children:[e(L,{flex:"1",children:y?n(me,{spacing:3,py:8,children:[e(Et,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):g.length&&H>0?e(an,{type:"donut",height:320,options:fe,series:ce}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})}),e(me,{flex:"1",align:"stretch",spacing:2,children:g.length?g.map(P=>{var q;const Y=P.username||t("services.unassignedAdmin","Unassigned"),te=Boolean(P.username),ie=v===P.username&&te;return e(O,{size:"sm",variant:ie?"solid":"outline",colorScheme:"primary",justifyContent:"space-between",onClick:()=>{te&&P.username&&M(P.username)},isDisabled:!te,children:n(U,{justify:"space-between",w:"full",children:[e(h,{children:Y}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:$e(P.used_traffic||0,2)})]})},`${(q=P.admin_id)!=null?q:"na"}-${Y}`)}):e(h,{color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]}),n(L,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(ge,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(me,{align:"start",spacing:1,children:[n(U,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("admins.dailyUsage","Daily usage")}),e(mt,{label:t("admins.dailyUsageTooltip","Total data usage per day for the selected admin and time range"),children:e(il,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})})]}),n(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("admins.selectedAdmin","Admin"),":"," ",e(se.span,{fontWeight:"medium",children:v!=null?v:"-"})," ",t("nodes.totalLabel","Total"),":"," ",e(se.span,{fontWeight:"medium",children:$e(J||0,2)})]})]}),n(ge,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(ge,{direction:{base:"column",sm:"row"},spacing:2,flex:"1",justifyContent:{sm:"flex-end"},children:f.map(P=>e(O,{size:"sm",onClick:()=>{ae(P.key);const Y=rn(P);F({start:Y.start,end:Y.end,presetKey:P.key})},variant:Z===P.key?"solid":"outline",colorScheme:"primary",w:{base:"full",sm:"auto"},children:P.label},P.key))}),n(ge,{direction:{base:"column",sm:"row"},spacing:2,alignItems:{base:"stretch",sm:"center"},children:[n($n,{placement:i,isOpen:W,onClose:()=>{oe(!1)},closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e(Kn,{children:e(O,{size:"sm",variant:"outline",leftIcon:e(Tg,{}),w:{base:"full",sm:"auto"},onClick:()=>{if(W){oe(!1);return}le([D.start,D.end]),oe(!0)},children:Ce})}),n(qn,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(us,{}),n(Jn,{px:3,py:3,children:[e(L,{overflowX:"auto",maxW:"full",children:e(Ai,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(X=R[0])!=null?X:void 0,endDate:(_=R[1])!=null?_:void 0,calendarClassName:"usage-range-datepicker",onChange:P=>{const[Y,te]=P!=null?P:[null,null];if(le([Y,te]),Y&&te){const ie=Cs(Y,te);ae("custom"),F({start:ie.start,end:ie.end,presetKey:"custom"}),oe(!1)}}})}),e(h,{mt:2,fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:t("nodes.customRangeHint","Select a start and end date")})]})]})]}),e(Ze,{value:v!=null?v:"",onChange:P=>M(P.target.value||null),w:{base:"full",sm:"auto",md:"220px"},minW:{md:"200px"},isDisabled:!w.length,children:w.map(P=>e("option",{value:P.username,children:P.username},P.username))})]})]})]}),e(L,{mt:6,children:_e?n(me,{spacing:3,children:[e(Et,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):Te.series&&Te.series.length?e(an,{options:Te.options,series:Te.series,type:"area",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]})};Oe.extend(Os);const Mg=se(Xa,{baseStyle:{w:4,h:4}}),Ca=se(wi,{baseStyle:{w:4,h:4}}),_a=[{key:"24h",label:"24h",amount:24,unit:"hour"},{key:"7d",label:"7d",amount:7,unit:"day"},{key:"30d",label:"30d",amount:30,unit:"day"},{key:"90d",label:"90d",amount:90,unit:"day"}],ll=t=>Oe(t).utc().format("YYYY-MM-DDTHH:mm:ssZ"),cl=t=>Oe(t).utc().format("YYYY-MM-DDTHH:mm:ssZ"),dl=(t,s)=>{if(!t)return t;const r=Oe.utc(t);return r.isValid()?s==="hour"?r.local().format("MM-DD HH:mm"):r.format("YYYY-MM-DD"):t},ul=(t,s,r)=>{const o=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:s,labels:{style:{colors:s.map(()=>o)},rotate:0},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:i=>$e(Number(i)||0,1),style:{colors:[o]}},title:{text:r,style:{color:o}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:i=>$e(Number(i)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},Ug=(t,s)=>({labels:s,legend:{position:"bottom",labels:{colors:t==="dark"?"#d8dee9":"#1a202c"}},tooltip:{y:{formatter:r=>$e(Number(r)||0,2),title:{formatter:(r,o)=>{var i,a,l,c;return(c=(l=(a=(i=o==null?void 0:o.w)==null?void 0:i.globals)==null?void 0:a.labels)==null?void 0:l[o.seriesIndex])!=null?c:r}}}},colors:["#3182CE","#63B3ED","#ED8936","#38A169","#9F7AEA","#F6AD55","#4299E1","#E53E3E","#D53F8C","#805AD5"]}),Og=({services:t,selectedServiceId:s})=>{var E,G,he,Re,tt,je;const{t:r}=qe(),{colorMode:o}=jr(),i="auto-end",a=(E=Or({base:"bottom",md:"auto-end"}))!=null?E:i,l=d.exports.useMemo(()=>t.map(we=>({id:we.id,name:we.name})),[t]),c=d.exports.useMemo(()=>s||(l.length?l[0].id:null),[s,l]),u=(G=_a.find(we=>we.key==="30d"))!=null?G:_a[0],[p,m]=d.exports.useState(c),[g,S]=d.exports.useState(()=>rn(u)),[y,A]=d.exports.useState(u.key),[f,D]=d.exports.useState([null,null]),[F,Z]=d.exports.useState(!1),[ae,v]=d.exports.useState([]),[M,T]=d.exports.useState("day"),[Q,_e]=d.exports.useState([]),[ke,W]=d.exports.useState(!1),[oe,R]=d.exports.useState(!1),[le,w]=d.exports.useState(null),[H,ce]=d.exports.useState([]),[j,fe]=d.exports.useState("day"),[Ae,Pe]=d.exports.useState(""),[Te,J]=d.exports.useState(!1);d.exports.useEffect(()=>{m(c)},[c]),d.exports.useEffect(()=>{if(!p){v([]),_e([]),ce([]),w(null),Pe("");return}const we={start:ll(g.start),end:cl(g.end)},Fe=g.unit==="hour"?"hour":"day";let Ye=!1;return W(!0),Ee(`/v2/services/${p}/usage/timeseries`,{query:{...we,granularity:Fe}}).then(ot=>{var ut,yt;Ye||!ot||(v((ut=ot.points)!=null?ut:[]),T((yt=ot.granularity)!=null?yt:Fe))}).catch(()=>{Ye||(v([]),T(Fe))}).finally(()=>{Ye||W(!1)}),R(!0),Ee(`/v2/services/${p}/usage/admins`,{query:we}).then(ot=>{var ut;Ye||!ot||_e((ut=ot.admins)!=null?ut:[])}).catch(()=>{Ye||_e([])}).finally(()=>{Ye||R(!1)}),()=>{Ye=!0}},[p,g.start,g.end,g.unit]),d.exports.useEffect(()=>{if(!p){w(null),ce([]),Pe("");return}if(!Q.length){w(null);return}w(we=>{var ut,yt;const Fe=Q.map(re=>re.admin_id);if(we===null){if(Fe.includes(null))return we}else if(Fe.includes(we))return we;const Ye=Q.find(re=>(re.used_traffic||0)>0);if(Ye)return(ut=Ye.admin_id)!=null?ut:null;const ot=Q[0];return(yt=ot==null?void 0:ot.admin_id)!=null?yt:null})},[Q,p]),d.exports.useEffect(()=>{if(!p){ce([]),Pe(""),fe("day");return}if(le===void 0)return;if(!Q.length&&le===null){ce([]),Pe("");return}const we=g.unit==="hour"?"hour":"day",Fe=le===null?"null":Number.isFinite(le)?String(le):"null";let Ye=!1;return J(!0),Ee(`/v2/services/${p}/usage/admin-timeseries`,{query:{start:ll(g.start),end:cl(g.end),granularity:we,admin_id:Fe}}).then(ot=>{var ut,yt,re;Ye||!ot||(ce((ut=ot.points)!=null?ut:[]),fe((yt=ot.granularity)!=null?yt:we),Pe((re=ot.username)!=null?re:""))}).catch(()=>{Ye||(ce([]),Pe(""),fe(we))}).finally(()=>{Ye||J(!1)}),()=>{Ye=!0}},[Q,g.end,g.start,g.unit,le,p]);const Ce=d.exports.useMemo(()=>{const we=Oe(g.start).format("YYYY-MM-DD"),Fe=Oe(g.end).format("YYYY-MM-DD");return`${we} \u2013 ${Fe}`},[g.start,g.end]),$=d.exports.useMemo(()=>ae.map(we=>dl(we.timestamp,M)),[ae,M]),X=d.exports.useMemo(()=>[{name:r("services.usageSeries","Usage"),data:ae.map(we=>we.used_traffic)}],[ae,r]),_=d.exports.useMemo(()=>ul(o,$,r("services.usageYAxis","Usage")),[$,o,r]),P=d.exports.useMemo(()=>Q.map(we=>({value:we.admin_id===null?"null":String(we.admin_id),label:we.username||r("services.unassignedAdmin","Unassigned")})),[Q,r]),Y=d.exports.useMemo(()=>{var Fe,Ye;const we=le===null?"null":String(le);return(Ye=(Fe=P.find(ot=>ot.value===we))==null?void 0:Fe.label)!=null?Ye:le===null?r("services.unassignedAdmin","Unassigned"):""},[P,le,r]),te=d.exports.useMemo(()=>H.map(we=>dl(we.timestamp,j)),[H,j]),ie=d.exports.useMemo(()=>[{name:r("services.usageSeries","Usage"),data:H.map(we=>we.used_traffic)}],[H,r]),q=d.exports.useMemo(()=>ul(o,te,r("services.usageYAxis","Usage")),[te,o,r]),B=d.exports.useMemo(()=>H.reduce((we,Fe)=>we+(Fe.used_traffic||0),0),[H]),ue=d.exports.useMemo(()=>Q.map(we=>we.used_traffic),[Q]),be=d.exports.useMemo(()=>Q.map(we=>we.username||r("services.unassignedAdmin","Unassigned")),[Q,r]),Ie=d.exports.useMemo(()=>Ug(o,be),[o,be]),N=d.exports.useMemo(()=>Q.reduce((we,Fe)=>we+(Fe.used_traffic||0),0),[Q]);return l.length===0?n(me,{spacing:2,align:"stretch",mt:4,children:[e(h,{fontWeight:"semibold",children:r("services.usageAnalyticsTitle","Usage Analytics")}),e(L,{borderWidth:"1px",borderRadius:"md",p:6,children:e(h,{color:"gray.500",children:r("services.noServicesAvailable","No services available")})})]}):n(me,{spacing:4,align:"stretch",children:[n(U,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:r("services.usageAnalyticsTitle","Usage Analytics")}),n(ge,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},align:{base:"stretch",md:"center"},children:[e(Ze,{value:p!=null?p:"",onChange:we=>m(Number(we.target.value)||null),minW:{md:"220px"},children:l.map(we=>e("option",{value:we.id,children:we.name},we.id))}),e(ge,{direction:{base:"column",sm:"row"},spacing:2,children:_a.map(we=>e(O,{size:"sm",variant:y===we.key?"solid":"outline",colorScheme:"primary",onClick:()=>{A(we.key),S(rn(we))},children:we.label},we.key))}),n($n,{placement:a,isOpen:F,onClose:()=>Z(!1),closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e(Kn,{children:e(O,{size:"sm",variant:"outline",leftIcon:e(Mg,{}),onClick:()=>{D([g.start,g.end]),Z(we=>!we)},children:Ce})}),n(qn,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(us,{}),n(Jn,{px:3,py:3,children:[e(L,{overflowX:"auto",maxW:"full",children:e(Ai,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(he=f[0])!=null?he:void 0,endDate:(Re=f[1])!=null?Re:void 0,calendarClassName:"usage-range-datepicker",onChange:we=>{const[Fe,Ye]=we!=null?we:[null,null];if(D([Fe,Ye]),Fe&&Ye){const ot=Cs(Fe,Ye);A("custom"),S(ot),Z(!1)}}})}),e(h,{mt:2,fontSize:"xs",color:"gray.500",children:r("nodes.customRangeHint","Select a start and end date")})]})]})]})]})]}),n(L,{borderWidth:"1px",borderRadius:"md",p:4,children:[n(U,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(h,{fontWeight:"semibold",children:r("services.usageOverTime","Usage over time")}),n(U,{fontSize:"sm",color:"gray.500",children:[e(Ca,{}),n(h,{children:[r("services.totalUsage","Total")," ",e(se.span,{fontWeight:"medium",children:$e(ae.reduce((we,Fe)=>we+(Fe.used_traffic||0),0),2)})]})]})]}),e(L,{mt:4,children:ke?n(me,{spacing:3,py:10,children:[e(Et,{}),e(h,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):ae.length?e(an,{type:"area",height:360,options:_,series:X}):e(h,{textAlign:"center",color:"gray.500",children:r("noData")})})]}),n(L,{borderWidth:"1px",borderRadius:"md",p:4,children:[n(ge,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(me,{align:"start",spacing:1,children:[e(mt,{label:r("services.adminUsageTrendHint","Daily usage for the selected admin within this service."),placement:"top",fontSize:"sm",children:n(U,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:r("services.adminUsageTrend","Admin usage over time")}),e(Ca,{color:"gray.500","aria-label":"info",cursor:"help"})]})}),n(h,{fontSize:"sm",color:"gray.500",children:[r("services.selectedAdmin","Admin"),":"," ",e(se.span,{fontWeight:"medium",children:Y||Ae||"-"})," ",r("services.totalUsage","Total"),":"," ",e(se.span,{fontWeight:"medium",children:$e(B||0,2)})]})]}),e(ge,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:e(Ze,{size:"sm",minW:{md:"200px"},value:le===null?"null":String(le),onChange:we=>{const Fe=we.target.value;if(Fe==="null"){w(null);return}const Ye=Number(Fe);w(Number.isNaN(Ye)?null:Ye)},isDisabled:P.length===0,children:P.map(we=>e("option",{value:we.value,children:we.label},we.value))})})]}),e(L,{mt:4,children:Te?n(me,{spacing:3,py:10,children:[e(Et,{}),e(h,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):(je=(tt=ie[0])==null?void 0:tt.data)!=null&&je.length?e(an,{type:"area",height:360,options:q,series:ie}):e(h,{textAlign:"center",color:"gray.500",children:r("noData")})})]}),n(L,{borderWidth:"1px",borderRadius:"md",p:4,children:[n(U,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(h,{fontWeight:"semibold",children:r("services.adminUsageDistribution","Admin usage distribution")}),n(U,{fontSize:"sm",color:"gray.500",children:[e(Ca,{}),n(h,{children:[r("services.totalUsage","Total")," ",e(se.span,{fontWeight:"medium",children:$e(N,2)})]})]})]}),n(ge,{mt:4,direction:{base:"column",lg:"row"},spacing:6,align:{base:"stretch",lg:"center"},children:[e(L,{flex:"1",children:oe?n(me,{spacing:3,py:8,children:[e(Et,{}),e(h,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):Q.length&&N>0?e(an,{type:"donut",height:320,options:Ie,series:ue}):e(h,{textAlign:"center",color:"gray.500",children:r("noData")})}),e(me,{flex:"1",align:"stretch",spacing:2,children:Q.length?Q.map(we=>{var Fe;return n(U,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(h,{fontWeight:"medium",children:we.username||r("services.unassignedAdmin","Unassigned")}),e(h,{fontSize:"sm",color:"gray.500",children:$e(we.used_traffic||0,2)})]},`${(Fe=we.admin_id)!=null?Fe:"na"}-${we.username}`)}):e(h,{color:"gray.500",children:r("noData")})})]})]})]})};Oe.extend(Os);const Wg=se(Xa,{baseStyle:{w:4,h:4}}),Fi=se(wi,{baseStyle:{w:4,h:4}}),ri={key:"30d",label:"30d",amount:30,unit:"day"},hl=t=>{if(!t)return t;const s=t.includes(" "),r=s?t.replace(" ","T"):t,o=Oe.utc(r);return o.isValid()?s?o.local().format("MM-DD HH:mm"):o.format("YYYY-MM-DD"):t},ni=t=>Oe(t).utc().format("YYYY-MM-DDTHH:mm:ss"),si=t=>Oe(t).utc().format("YYYY-MM-DDTHH:mm:ss"),pl=(t,s)=>{const r=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:s,labels:{style:{colors:s.map(()=>r)}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:o=>$e(Number(o)||0,1),style:{colors:[r]}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:o=>$e(Number(o)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},Hi=({presets:t,range:s,onPresetChange:r,onCustomChange:o})=>{var A,f,D;const{t:i}=qe(),a="auto-end",l=(A=Or({base:"bottom",md:"auto-end"}))!=null?A:a,c=Oe(s.start).format("YYYY-MM-DD"),u=Oe(s.end).format("YYYY-MM-DD"),p=c===u?c:`${c} - ${u}`,[m,g]=d.exports.useState(!1),[S,y]=d.exports.useState([s.start,s.end]);return d.exports.useEffect(()=>{m||y([s.start,s.end])},[m,s.start,s.end]),n(ge,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(ge,{direction:{base:"column",sm:"row"},spacing:2,flexWrap:"wrap",justifyContent:{sm:"flex-end"},w:"full",children:t.map(F=>e(O,{size:"sm",onClick:()=>r(F.key),colorScheme:"primary",variant:s.key===F.key?"solid":"outline",w:{base:"full",sm:"auto"},children:F.label},F.key))}),n($n,{placement:l,isOpen:m,onClose:()=>{g(!1)},closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e(Kn,{children:e(O,{size:"sm",variant:"outline",leftIcon:e(Wg,{}),w:{base:"full",sm:"auto"},onClick:()=>{if(m){g(!1);return}y([s.start,s.end]),g(!0)},children:p})}),n(qn,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(us,{}),n(Jn,{px:3,py:3,children:[e(L,{overflowX:"auto",maxW:"full",children:e(Ai,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(f=S[0])!=null?f:void 0,endDate:(D=S[1])!=null?D:void 0,calendarClassName:"usage-range-datepicker",onChange:F=>{const[Z,ae]=F!=null?F:[null,null];y([Z,ae]),Z&&ae&&(o(Z,ae),g(!1))}})}),e(h,{mt:2,fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:i("nodes.customRangeHint","Select a start and end date")})]})]})]})]})},Fg=()=>{var zt,Ge,Ue,St,Vt,dr,ir,Zt,ar;const{t}=qe(),s=sr(),{colorMode:r}=jr(),{data:o}=ja(),{fetchNodesUsage:i}=Di(),{userData:a}=xr(),l=d.exports.useMemo(()=>[{key:"24h",label:t("nodes.range24h","Last 24 hours"),amount:24,unit:"hour"},{key:"7d",label:t("nodes.range7d","Last 7 days"),amount:7,unit:"day"},{key:"30d",label:t("nodes.range30d","Last 30 days"),amount:30,unit:"day"},{key:"90d",label:t("nodes.range90d","Last 90 days"),amount:90,unit:"day"}],[t]),c=(Ge=(zt=l.find(ne=>ne.key==="30d"))!=null?zt:l[0])!=null?Ge:ri,[u,p]=d.exports.useState(()=>rn(c)),[m,g]=d.exports.useState([]),[S,y]=d.exports.useState(!1),[A,f]=d.exports.useState(()=>rn(c)),[D,F]=d.exports.useState(null),[Z,ae]=d.exports.useState(!1),[v,M]=d.exports.useState([]),[T,Q]=d.exports.useState(null),[_e,ke]=d.exports.useState(()=>rn(c)),[W,oe]=d.exports.useState(()=>rn(c)),[R,le]=d.exports.useState([]),[w,H]=d.exports.useState(null),[ce,j]=d.exports.useState(null),[fe,Ae]=d.exports.useState([]),[Pe,Te]=d.exports.useState([]),[J,Ce]=d.exports.useState(!1),[$,X]=d.exports.useState(null),[_,P]=d.exports.useState(!1),[Y,te]=d.exports.useState([]),[ie,q]=d.exports.useState(null),B=d.exports.useCallback(ne=>ne?(Array.isArray(ne)?ne:Object.values(ne)).map(k=>{var Se,et,Nt,Ft;return{nodeId:Number((Se=k==null?void 0:k.node_id)!=null?Se:0),nodeName:(et=k==null?void 0:k.node_name)!=null?et:t("nodes.unknownNode","Unknown"),total:Number((Nt=k==null?void 0:k.uplink)!=null?Nt:0)+Number((Ft=k==null?void 0:k.downlink)!=null?Ft:0)}}):[],[t]),ue=d.exports.useCallback(ne=>{var k;const z=(k=l.find(Se=>Se.key===ne))!=null?k:ri;p(rn(z))},[l]),be=d.exports.useCallback((ne,z)=>{const k=Cs(ne,z);p(k)},[]),Ie=d.exports.useCallback(ne=>{var k;const z=(k=l.find(Se=>Se.key===ne))!=null?k:ri;f(rn(z))},[l]),N=d.exports.useCallback((ne,z)=>{const k=Cs(ne,z);f(k)},[]),E=d.exports.useCallback(ne=>{var k;const z=(k=l.find(Se=>Se.key===ne))!=null?k:ri;oe(rn(z))},[l]),G=d.exports.useCallback((ne,z)=>{const k=Cs(ne,z);oe(k)},[]),he=d.exports.useCallback(ne=>{var k;const z=(k=l.find(Se=>Se.key===ne))!=null?k:ri;ke(rn(z))},[l]),Re=d.exports.useCallback((ne,z)=>{const k=Cs(ne,z);ke(k)},[]),tt=d.exports.useMemo(()=>m.reduce((ne,z)=>ne+z.total,0),[m]),je=d.exports.useMemo(()=>{const ne=m.map(k=>k.total),z=m.map(k=>k.nodeName);return Xi(r,`${t("userDialog.total")} ${$e(tt||0,2)}`,ne,z)},[r,m,t,tt]),we=d.exports.useMemo(()=>v.map(ne=>hl(ne.date)),[v]),Fe=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:v.map(ne=>ne.used_traffic)}],[v,t]),Ye=d.exports.useMemo(()=>v.reduce((ne,z)=>ne+z.used_traffic,0),[v]),ot=d.exports.useMemo(()=>({options:pl(r,we),series:Fe}),[r,we,Fe]),ut=d.exports.useMemo(()=>Pe.reduce((ne,z)=>ne+z.total,0),[Pe]),yt=d.exports.useMemo(()=>{const ne=Pe.map(k=>k.total),z=Pe.map(k=>k.nodeName);return Xi(r,`${t("userDialog.total")} ${$e(ut||0,2)}`,ne,z)},[Pe,r,t,ut]),re=d.exports.useMemo(()=>Y.map(ne=>hl(ne.date)),[Y]),ze=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:Y.map(ne=>ne.used_traffic)}],[Y,t]),Ne=d.exports.useMemo(()=>Y.reduce((ne,z)=>ne+z.used_traffic,0),[Y]),wt=d.exports.useMemo(()=>({options:pl(r,re),series:ze}),[r,re,ze]),ct=d.exports.useMemo(()=>{const ne=[],z=new Set;return m.forEach(k=>{k.nodeId>0&&!z.has(k.nodeId)&&(z.add(k.nodeId),ne.push({value:k.nodeId,label:k.nodeName}))}),Array.isArray(o)&&o.forEach(k=>{(k==null?void 0:k.id)&&!z.has(k.id)&&(z.add(k.id),ne.push({value:k.id,label:k.name}))}),ne.sort((k,Se)=>k.label.localeCompare(Se.label))},[m,o]),V=d.exports.useMemo(()=>{const ne=[],z=new Set;return fe.forEach(k=>{z.has(k.nodeId)||(z.add(k.nodeId),ne.push({value:k.nodeId,label:k.nodeName}))}),z.has(0)||ne.push({value:0,label:t("nodes.masterNode","Master")}),Array.isArray(o)&&o.forEach(k=>{(k==null?void 0:k.id)&&!z.has(k.id)&&(z.add(k.id),ne.push({value:k.id,label:k.name}))}),ne.sort((k,Se)=>k.label.localeCompare(Se.label))},[fe,o,t]),lt=d.exports.useMemo(()=>R.map(ne=>({value:ne,label:ne})),[R]),_t=d.exports.useMemo(()=>{const ne=new Map;return Array.isArray(o)&&o.forEach(z=>{(z==null?void 0:z.id)!=null&&ne.set(z.id,z.name)}),ne},[o]);return d.exports.useEffect(()=>{let ne=!1;return y(!0),i({start:ni(u.start),end:si(u.end)}).then(z=>{if(ne)return;const k=B(z==null?void 0:z.usages);g(k)}).catch(z=>{ne||(console.error("Error fetching usage data:",z),g([]),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{ne||y(!1)}),()=>{ne=!0}},[i,u,B,s,t]),d.exports.useEffect(()=>{var z,k;const ne=Boolean((k=(z=a.permissions)==null?void 0:z.admin_management)==null?void 0:k[br.View])||a.role===Ve.FullAccess;!(a!=null&&a.username)||(H(Se=>Se!=null?Se:a.username),j(Se=>Se!=null?Se:a.username),ne||le([a.username]))},[a]),d.exports.useEffect(()=>{var k,Se;const ne=Boolean((Se=(k=a==null?void 0:a.permissions)==null?void 0:k.admin_management)==null?void 0:Se[br.View])||(a==null?void 0:a.role)===Ve.FullAccess;if(!(a!=null&&a.username)||!ne)return;let z=!1;return Ee("/admins").then(et=>{if(z)return;const Ft=(Array.isArray(et)?et:Array.isArray(et==null?void 0:et.admins)?et.admins:[]).map(gt=>gt==null?void 0:gt.username).filter(gt=>typeof gt=="string"),Ht=Array.from(new Set(Ft)).sort((gt,ht)=>gt.localeCompare(ht));if(!Ht.length&&(a==null?void 0:a.username)){le([a.username]);return}le(Ht),H(gt=>{var ht,Ut;return gt&&Ht.includes(gt)?gt:(Ut=(ht=Ht[0])!=null?ht:gt)!=null?Ut:null}),j(gt=>{var ht,Ut;return gt&&Ht.includes(gt)?gt:(Ut=(ht=Ht[0])!=null?ht:gt)!=null?Ut:null})}).catch(et=>{console.error("Error fetching admins:",et)}),()=>{z=!0}},[(Ue=a==null?void 0:a.permissions)==null?void 0:Ue.admin_management,a==null?void 0:a.role,a==null?void 0:a.username]),d.exports.useEffect(()=>{var z,k;if(D!==null)return;const ne=(z=m.filter(Se=>Se.nodeId>0).sort((Se,et)=>et.total-Se.total)[0])==null?void 0:z.nodeId;if(ne&&ne>0){F(ne);return}if(Array.isArray(o)&&o.length){const Se=(k=o[0])==null?void 0:k.id;Se&&F(Se)}},[D,m,o]),d.exports.useEffect(()=>{X(null)},[w]),d.exports.useEffect(()=>{if(!w){Ae([]),X(null);return}let ne=!1;const z={start:ni(W.start),end:si(W.end)};return Ee(`/admin/${encodeURIComponent(w)}/usage/nodes`,{query:z}).then(k=>{if(ne)return;const Se=B(k==null?void 0:k.usages);Ae(Se),X(et=>{var Ft,Ht,gt;if(et!==null)return et;const Nt=(Ft=Se.filter(ht=>ht.nodeId!==0).sort((ht,Ut)=>Ut.total-ht.total)[0])==null?void 0:Ft.nodeId;return typeof Nt=="number"?Nt:(gt=(Ht=Se[0])==null?void 0:Ht.nodeId)!=null?gt:0})}).catch(k=>{ne||(console.error("Error fetching daily admin nodes:",k),Ae([]),X(null),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}),()=>{ne=!0}},[w,W,B,s,t]),d.exports.useEffect(()=>{if(!ce){Te([]),Ce(!1);return}let ne=!1;return Ce(!0),Ee(`/admin/${encodeURIComponent(ce)}/usage/nodes`,{query:{start:ni(_e.start),end:si(_e.end)}}).then(z=>{if(ne)return;const k=B(z==null?void 0:z.usages);Te(k)}).catch(z=>{ne||(console.error("Error fetching admin totals nodes:",z),Te([]),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{ne||Ce(!1)}),()=>{ne=!0}},[ce,_e,B,s,t]),d.exports.useEffect(()=>{if(D===null){M([]),Q(null);return}let ne=!1;ae(!0);const z={start:ni(A.start),end:si(A.end)};return A.unit==="hour"&&(z.granularity="hour"),Ee(`/node/${D}/usage/daily`,{query:z}).then(k=>{var Ft,Ht,gt;if(ne)return;const et=(Array.isArray(k==null?void 0:k.usages)?k.usages:[]).map(ht=>{var Ut,ur;return{date:(Ut=ht==null?void 0:ht.date)!=null?Ut:"",used_traffic:Number((ur=ht==null?void 0:ht.used_traffic)!=null?ur:0)}});M(et);const Nt=(Ht=(Ft=k==null?void 0:k.node_name)!=null?Ft:_t.get(D))!=null?Ht:t("nodes.unknownNode","Unknown");Q({nodeName:Nt,nodeId:(gt=k==null?void 0:k.node_id)!=null?gt:D})}).catch(k=>{ne||(console.error("Error fetching node daily usage:",k),M([]),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{ne||ae(!1)}),()=>{ne=!0}},[D,A,_t,s,t]),d.exports.useEffect(()=>{if(!w){te([]),q(null);return}if($===null){te([]),q(null);return}let ne=!1;P(!0);const z={start:ni(W.start),end:si(W.end)};return $!=null&&(z.node_id=$),W.unit==="hour"&&(z.granularity="hour"),Ee(`/admin/${encodeURIComponent(w)}/usage/chart`,{query:z}).then(k=>{var Nt,Ft,Ht,gt;if(ne)return;const et=(Array.isArray(k==null?void 0:k.usages)?k.usages:[]).map(ht=>{var Ut,ur;return{date:(Ut=ht==null?void 0:ht.date)!=null?Ut:"",used_traffic:Number((ur=ht==null?void 0:ht.used_traffic)!=null?ur:0)}});te(et),q({nodeName:(Ht=(Ft=k==null?void 0:k.node_name)!=null?Ft:(Nt=V.find(ht=>ht.value===$))==null?void 0:Nt.label)!=null?Ht:null,nodeId:(gt=k==null?void 0:k.node_id)!=null?gt:$})}).catch(k=>{ne||(console.error("Error fetching admin usage chart:",k),te([]),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{ne||P(!1)}),()=>{ne=!0}},[w,$,W,V,t,s]),n(me,{spacing:6,align:"stretch",children:[n(L,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(ge,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"center"},w:"full",children:[n(me,{align:"start",spacing:1,children:[e(mt,{label:t("nodes.trafficOverviewTooltip","Total usage per node over the chosen range."),placement:"top",fontSize:"sm",children:n(U,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.trafficOverview","Traffic overview")}),e(Fi,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),n(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.totalLabel","Total"),": "," ",e(se.span,{fontWeight:"medium",children:$e(tt||0,2)})]})]}),e(Hi,{presets:l,range:u,onPresetChange:ue,onCustomChange:be})]}),e(L,{mt:6,children:S?n(me,{spacing:3,children:[e(Et,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):je.series.length?e(an,{options:je.options,series:je.series,type:"donut",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),n(L,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(ge,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(me,{align:"start",spacing:1,children:[e(mt,{label:t("nodes.perDayUsageTooltip","Daily traffic aggregated for the selected node within the chosen range."),placement:"top",fontSize:"sm",children:n(U,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.perDayUsage","Per day usage")}),e(Fi,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),n(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedNode","Node"),": "," ",e(se.span,{fontWeight:"medium",children:(St=T==null?void 0:T.nodeName)!=null?St:t("nodes.unknownNode","Unknown")})," ",t("nodes.totalLabel","Total"),": "," ",e(se.span,{fontWeight:"medium",children:$e(Ye||0,2)})]})]}),n(ge,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(Ze,{size:"sm",minW:{md:"180px"},w:{base:"full",md:"auto"},value:D!=null?D:"",onChange:ne=>{const z=ne.target.value;if(!z){F(null);return}const k=Number(z);F(Number.isFinite(k)&&k>0?k:null)},placeholder:t("nodes.selectNode","Select node"),children:ct.map(ne=>e("option",{value:ne.value,children:ne.label},ne.value))}),e(Hi,{presets:l,range:A,onPresetChange:Ie,onCustomChange:N})]})]}),e(L,{mt:6,children:Z?n(me,{spacing:3,children:[e(Et,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):(dr=(Vt=Fe[0])==null?void 0:Vt.data)!=null&&dr.length?e(an,{options:ot.options,series:ot.series,type:"area",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),n(L,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(ge,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(me,{align:"start",spacing:1,children:[e(mt,{label:t("nodes.adminUsageChartTooltip","Usage trend for the selected admin and node."),placement:"top",fontSize:"sm",children:n(U,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.adminUsageChart","Admin usage chart")}),e(Fi,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),n(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedAdmin","Admin"),": "," ",e(se.span,{fontWeight:"medium",children:w!=null?w:"-"})," ",t("nodes.selectedNode","Node"),": "," ",e(se.span,{fontWeight:"medium",children:(ir=ie==null?void 0:ie.nodeName)!=null?ir:t("nodes.unknownNode","Unknown")})," ",t("nodes.totalLabel","Total"),": "," ",e(se.span,{fontWeight:"medium",children:$e(Ne||0,2)})]})]}),n(ge,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(Ze,{size:"sm",minW:{md:"160px"},w:{base:"full",md:"auto"},value:w!=null?w:"",onChange:ne=>H(ne.target.value||null),isDisabled:lt.length===0,children:lt.map(ne=>e("option",{value:ne.value,children:ne.label},ne.value))}),e(Ze,{size:"sm",minW:{md:"180px"},w:{base:"full",md:"auto"},value:$!=null?$:"",onChange:ne=>{const z=ne.target.value;if(z===""){X(null);return}const k=Number(z);X(Number.isNaN(k)?null:k)},placeholder:t("nodes.selectNode","Select node"),children:V.map(ne=>e("option",{value:ne.value,children:ne.label},ne.value))}),e(Hi,{presets:l,range:W,onPresetChange:E,onCustomChange:G})]})]}),e(L,{mt:6,children:_?n(me,{spacing:3,children:[e(Et,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):(ar=(Zt=ze[0])==null?void 0:Zt.data)!=null&&ar.length?e(an,{options:wt.options,series:wt.series,type:"area",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),n(L,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(ge,{direction:{base:"column",md:"row"},spacing:{base:4,md:6},justifyContent:"space-between",alignItems:{base:"stretch",md:"flex-start"},w:"full",children:[n(me,{align:"start",spacing:1,children:[e(mt,{label:t("nodes.perAdminUsageTooltip","Total usage by node for the selected admin."),placement:"top",fontSize:"sm",children:n(U,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.perAdminUsage","Per admin usages")}),e(Fi,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),n(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedAdmin","Admin"),": "," ",e(se.span,{fontWeight:"medium",children:ce!=null?ce:"-"})," ",t("nodes.totalLabel","Total"),": "," ",e(se.span,{fontWeight:"medium",children:$e(ut||0,2)})]})]}),n(ge,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(Ze,{size:"sm",minW:{md:"160px"},w:{base:"full",md:"auto"},value:ce!=null?ce:"",onChange:ne=>j(ne.target.value||null),isDisabled:lt.length===0,children:lt.map(ne=>e("option",{value:ne.value,children:ne.label},ne.value))}),e(Hi,{presets:l,range:_e,onPresetChange:he,onCustomChange:Re})]})]}),e(L,{mt:6,children:J?n(me,{spacing:3,children:[e(Et,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):yt.series.length?e(an,{options:yt.options,series:yt.series,type:"donut",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]})},Hg=()=>{var l;const{t}=qe(),{userData:s,getUserIsSuccess:r}=xr(),o=Boolean(r&&((l=s.permissions)==null?void 0:l.sections.usage)),i=Hn(c=>c.services),a=Hn(c=>c.fetchServices);return d.exports.useEffect(()=>{o&&a({limit:500})},[a,o]),r?o?n(me,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("usage.title","Usage Analytics")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("usage.description","Track usage trends across services, admins, and nodes from a single place.")}),n(hs,{variant:"enclosed",colorScheme:"primary",children:[n(ps,{children:[e(or,{children:t("usage.tabs.services","Services")}),e(or,{children:t("usage.tabs.admins","Admins")}),e(or,{children:t("usage.tabs.nodes","Nodes")})]}),n(ms,{children:[e(lr,{px:0,children:e(Og,{services:i})}),e(lr,{px:0,children:e(Lg,{})}),e(lr,{px:0,children:e(Fg,{})})]})]})]}):n(me,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("usage.title","Usage Analytics")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("usage.noPermission","You do not have permission to view usage analytics.")})]}):e(pt,{justify:"center",align:"center",py:10,children:e(Et,{})})},wc="__dot__",Wa=t=>t.replace(/\./g,wc),ws=t=>t.replace(new RegExp(wc,"g"),"."),Bg=t=>{const s={},r=(o,i)=>{if(i!==void 0){if(typeof i=="boolean"){s[ws(o)]=i;return}if(typeof i=="string"){if(i==="")return;i==="true"||i==="false"?s[ws(o)]=i==="true":s[ws(o)]=Boolean(i);return}if(typeof i=="number"){s[ws(o)]=i!==0;return}if(Array.isArray(i)){s[ws(o)]=i.length>0;return}if(i&&typeof i=="object"){Object.entries(i).forEach(([a,l])=>{const c=o?`${o}.${a}`:a;r(c,l)});return}s[ws(o)]=Boolean(i)}};return Object.entries(t).forEach(([o,i])=>{r(o,i)}),s},kc=[{key:"users",titleKey:"settings.telegram.groups.users",defaultTitle:"User events",events:[{key:"user.created",labelKey:"settings.telegram.events.userCreated",defaultLabel:"User created",hintKey:"settings.telegram.events.userCreatedHint",defaultHint:"Notify when a user is created."},{key:"user.updated",labelKey:"settings.telegram.events.userUpdated",defaultLabel:"User updated",hintKey:"settings.telegram.events.userUpdatedHint",defaultHint:"Notify when a user is updated."},{key:"user.deleted",labelKey:"settings.telegram.events.userDeleted",defaultLabel:"User deleted",hintKey:"settings.telegram.events.userDeletedHint",defaultHint:"Notify when a user is deleted."},{key:"user.status_change",labelKey:"settings.telegram.events.userStatusChange",defaultLabel:"User status change",hintKey:"settings.telegram.events.userStatusChangeHint",defaultHint:"Notify when a user's status changes."},{key:"user.usage_reset",labelKey:"settings.telegram.events.userUsageReset",defaultLabel:"User usage reset",hintKey:"settings.telegram.events.userUsageResetHint",defaultHint:"Notify when a user's usage is reset manually."},{key:"user.auto_reset",labelKey:"settings.telegram.events.userAutoReset",defaultLabel:"User auto reset",hintKey:"settings.telegram.events.userAutoResetHint",defaultHint:"Notify when a user's usage is reset automatically by the next plan."},{key:"user.subscription_revoked",labelKey:"settings.telegram.events.userSubscriptionRevoked",defaultLabel:"Subscription revoked",hintKey:"settings.telegram.events.userSubscriptionRevokedHint",defaultHint:"Notify when a user's subscription is revoked."}]},{key:"admins",titleKey:"settings.telegram.groups.admins",defaultTitle:"Admin events",events:[{key:"admin.created",labelKey:"settings.telegram.events.adminCreated",defaultLabel:"Admin created",hintKey:"settings.telegram.events.adminCreatedHint",defaultHint:"Notify when an admin is created."},{key:"admin.updated",labelKey:"settings.telegram.events.adminUpdated",defaultLabel:"Admin updated",hintKey:"settings.telegram.events.adminUpdatedHint",defaultHint:"Notify when an admin's settings change."},{key:"admin.deleted",labelKey:"settings.telegram.events.adminDeleted",defaultLabel:"Admin deleted",hintKey:"settings.telegram.events.adminDeletedHint",defaultHint:"Notify when an admin is deleted."},{key:"admin.usage_reset",labelKey:"settings.telegram.events.adminUsageReset",defaultLabel:"Admin usage reset",hintKey:"settings.telegram.events.adminUsageResetHint",defaultHint:"Notify when an admin's usage is reset."},{key:"admin.limit.data",labelKey:"settings.telegram.events.adminDataLimit",defaultLabel:"Admin data limit reached",hintKey:"settings.telegram.events.adminDataLimitHint",defaultHint:"Notify when an admin reaches their data limit."},{key:"admin.limit.users",labelKey:"settings.telegram.events.adminUsersLimit",defaultLabel:"Admin users limit reached",hintKey:"settings.telegram.events.adminUsersLimitHint",defaultHint:"Notify when an admin reaches their users limit."}]},{key:"nodes",titleKey:"settings.telegram.groups.nodes",defaultTitle:"Node events",events:[{key:"node.created",labelKey:"settings.telegram.events.nodeCreated",defaultLabel:"Node created",hintKey:"settings.telegram.events.nodeCreatedHint",defaultHint:"Notify when a node is created."},{key:"node.deleted",labelKey:"settings.telegram.events.nodeDeleted",defaultLabel:"Node deleted",hintKey:"settings.telegram.events.nodeDeletedHint",defaultHint:"Notify when a node is deleted."},{key:"node.usage_reset",labelKey:"settings.telegram.events.nodeUsageReset",defaultLabel:"Node usage reset",hintKey:"settings.telegram.events.nodeUsageResetHint",defaultHint:"Notify when a node's usage is reset."},{key:"node.status.connected",labelKey:"settings.telegram.events.nodeStatusConnected",defaultLabel:"Node connected",hintKey:"settings.telegram.events.nodeStatusConnectedHint",defaultHint:"Notify when a node connects."},{key:"node.status.connecting",labelKey:"settings.telegram.events.nodeStatusConnecting",defaultLabel:"Node connecting",hintKey:"settings.telegram.events.nodeStatusConnectingHint",defaultHint:"Notify when a node is connecting."},{key:"node.status.error",labelKey:"settings.telegram.events.nodeStatusError",defaultLabel:"Node error",hintKey:"settings.telegram.events.nodeStatusErrorHint",defaultHint:"Notify when a node reports an error."},{key:"node.status.disabled",labelKey:"settings.telegram.events.nodeStatusDisabled",defaultLabel:"Node disabled",hintKey:"settings.telegram.events.nodeStatusDisabledHint",defaultHint:"Notify when a node is disabled."},{key:"node.status.limited",labelKey:"settings.telegram.events.nodeStatusLimited",defaultLabel:"Node limited",hintKey:"settings.telegram.events.nodeStatusLimitedHint",defaultHint:"Notify when a node is limited."}]},{key:"login",titleKey:"settings.telegram.groups.login",defaultTitle:"Login events",events:[{key:"login",labelKey:"settings.telegram.events.login",defaultLabel:"Login notifications",hintKey:"settings.telegram.events.loginHint",defaultHint:"Notify about administrator login attempts."}]},{key:"errors",titleKey:"settings.telegram.groups.errors",defaultTitle:"Error events",events:[{key:"errors.node",labelKey:"settings.telegram.events.nodeErrors",defaultLabel:"Node error logs",hintKey:"settings.telegram.events.nodeErrorsHint",defaultHint:"Notify about node errors reported by the system."}]}],Vg=kc.flatMap(t=>t.events.map(s=>s.key)),ml=se(dn,{baseStyle:{w:4,h:4}}),gl=se(qd,{baseStyle:{w:4,h:4}}),Aa=t=>{var o,i,a,l;const s={};Object.entries(t.forum_topics||{}).forEach(([c,u])=>{var p;s[c]={title:(p=u.title)!=null?p:"",topic_id:u.topic_id!=null?String(u.topic_id):""}});const r={};return Vg.forEach(c=>{var m;const u=Wa(c),p=(m=t.event_toggles)==null?void 0:m[c];r[u]=p===void 0?!0:Boolean(p)}),Object.entries(t.event_toggles||{}).forEach(([c,u])=>{const p=Wa(c);p in r||(r[p]=Boolean(u))}),{api_token:(o=t.api_token)!=null?o:"",use_telegram:(i=t.use_telegram)!=null?i:!0,proxy_url:(a=t.proxy_url)!=null?a:"",admin_chat_ids:(t.admin_chat_ids||[]).join(", "),logs_chat_id:t.logs_chat_id!=null?String(t.logs_chat_id):"",logs_chat_is_forum:t.logs_chat_is_forum,default_vless_flow:(l=t.default_vless_flow)!=null?l:"",forum_topics:s,event_toggles:r}},Da=({disabled:t,message:s,children:r})=>n(L,{position:"relative",children:[e(L,{pointerEvents:t?"none":"auto",filter:t?"blur(1.2px)":"none",opacity:t?.55:1,transition:"all 0.2s ease",children:r}),t&&e(pt,{position:"absolute",inset:0,align:"center",justify:"center",textAlign:"center",fontWeight:"semibold",color:"white",px:6,borderRadius:"inherit",bg:"blackAlpha.400",backdropFilter:"blur(2px)",children:e(h,{children:s})})]}),$g=t=>t.split(/[\s,]+/).map(s=>s.trim()).filter(s=>s.length>0).map(s=>Number(s)).filter(s=>Number.isFinite(s)),Kg=()=>{var le,w,H,ce,j;const{t}=qe(),s=sr(),{userData:r,getUserIsSuccess:o}=xr(),i=o&&Boolean((le=r.permissions)==null?void 0:le.sections.integrations),a=Ga(),{data:l,isLoading:c,refetch:u}=fr("telegram-settings",qh,{refetchOnWindowFocus:!1,enabled:i}),{data:p,isLoading:m,refetch:g}=fr("panel-settings",Qa,{refetchOnWindowFocus:!1,enabled:i}),S=fr("maintenance-info",()=>Ee("/maintenance/info"),{refetchOnWindowFocus:!1,enabled:i}),[y,A]=d.exports.useState((w=p==null?void 0:p.use_nobetci)!=null?w:!1);d.exports.useEffect(()=>{p&&A(p.use_nobetci)},[p]);const f=Ar(()=>Ee("/maintenance/update",{method:"POST"}),{onSuccess:()=>{tr(t("settings.panel.updateTriggered","Panel update started"),s),S.refetch()},onError:fe=>{jt(fe,s)}}),D=Ar(()=>Ee("/maintenance/restart",{method:"POST"}),{onSuccess:()=>{tr(t("settings.panel.restartTriggered","Panel restart started"),s),S.refetch()},onError:fe=>{jt(fe,s)}}),{register:F,control:Z,handleSubmit:ae,reset:v,watch:M,formState:{isDirty:T}}=en({defaultValues:Aa(l!=null?l:{api_token:null,use_telegram:!0,proxy_url:null,admin_chat_ids:[],logs_chat_id:null,logs_chat_is_forum:!1,default_vless_flow:null,forum_topics:{},event_toggles:{}})});d.exports.useEffect(()=>{l&&v(Aa(l))},[l,v]);const Q=Ar(Jh,{onSuccess:fe=>{v(Aa(fe)),a.setQueryData("telegram-settings",fe),s({title:t("settings.savedSuccess"),status:"success",duration:3e3})},onError:()=>{s({title:t("errors.generic","Something went wrong"),status:"error"})}}),_e=Ar(Yh,{onSuccess:fe=>{A(fe.use_nobetci),a.setQueryData("panel-settings",fe),s({title:t("settings.panel.saved","Panel settings saved"),status:"success",duration:3e3})},onError:()=>{s({title:t("errors.generic","Something went wrong"),status:"error"})}}),ke=fe=>{const Ae=Bg(fe.event_toggles||{}),Pe={api_token:fe.api_token.trim()||null,use_telegram:fe.use_telegram,proxy_url:fe.proxy_url.trim()||null,admin_chat_ids:$g(fe.admin_chat_ids),logs_chat_id:fe.logs_chat_id.trim()?Number(fe.logs_chat_id.trim()):null,logs_chat_is_forum:fe.logs_chat_is_forum,default_vless_flow:fe.default_vless_flow.trim()||null,forum_topics:Object.fromEntries(Object.entries(fe.forum_topics||{}).map(([Te,J])=>[Te,{title:J.title,topic_id:J.topic_id.trim()?Number(J.topic_id.trim()):void 0}])),event_toggles:Ae};Q.mutate(Pe)},W=M("forum_topics"),oe=M("use_telegram"),R=t("settings.telegram.disabledOverlay","Telegram bot is disabled. Enable it to edit these settings.");return o?i?n(L,{px:{base:4,md:8},py:{base:6,md:8},children:[e(jn,{size:"lg",mb:4,children:t("settings.integrations","Master Settings")}),n(hs,{colorScheme:"primary",children:[n(ps,{children:[e(or,{children:t("settings.panel.tabTitle","Panel")}),e(or,{children:t("settings.telegram","Telegram")}),e(or,{isDisabled:!0,children:t("settings.tabs.comingSoon","Coming Soon")})]}),n(ms,{children:[e(lr,{px:{base:0,md:2},children:m&&p===void 0?e(pt,{align:"center",justify:"center",py:12,children:e(Et,{size:"lg"})}):n(ge,{spacing:6,align:"stretch",children:[e(h,{fontSize:"sm",color:"gray.500",children:t("settings.panel.description","Control dashboard-specific behaviors that affect all admins.")}),e(L,{borderWidth:"1px",borderRadius:"lg",p:4,children:n(pt,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[n(L,{children:[e(jn,{size:"sm",mb:1,children:t("settings.panel.useNobetciTitle","Enable Nobetci integration")}),e(h,{fontSize:"sm",color:"gray.500",children:t("settings.panel.useNobetciDescription","Show Nobetci options when creating or editing nodes.")})]}),e(vt,{isChecked:y,onChange:fe=>A(fe.target.checked),isDisabled:_e.isLoading||m})]})}),n(L,{borderWidth:"1px",borderRadius:"lg",p:4,children:[n(pt,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[n(L,{children:[e(jn,{size:"sm",mb:1,children:t("settings.panel.maintenanceTitle","Maintenance status")}),e(h,{fontSize:"sm",color:"gray.500",children:t("settings.panel.maintenanceDescription","Inspect which container images are currently used by the panel and node.")})]}),e(O,{variant:"outline",size:"sm",leftIcon:e(dn,{width:16,height:16}),onClick:()=>S.refetch(),isLoading:S.isFetching,children:t("actions.refresh","Refresh")})]}),e(ge,{spacing:2,mt:4,children:S.isLoading&&!S.data?e(pt,{align:"center",justify:"center",py:4,children:e(Et,{size:"sm"})}):n($t,{children:[n(L,{children:[e(h,{fontWeight:"semibold",children:t("settings.panel.panelVersion","Panel image")}),e(h,{fontSize:"sm",color:"gray.500",children:(ce=(H=S.data)==null?void 0:H.panel)!=null&&ce.image?`${S.data.panel.image}${S.data.panel.tag?` (${S.data.panel.tag})`:""}`:t("settings.panel.versionUnknown","Unknown")})]}),n(L,{children:[e(h,{fontWeight:"semibold",children:t("settings.panel.nodeVersion","Node image")}),e(h,{fontSize:"sm",color:"gray.500",children:(j=S.data)!=null&&j.node?S.data.node.image?`${S.data.node.image}${S.data.node.tag?` (${S.data.node.tag})`:""}`:t("settings.panel.versionUnknown","Unknown"):t("settings.panel.nodeVersionUnavailable","Node deployment not detected")})]})]})}),n(ge,{spacing:2,mt:4,children:[e(h,{fontSize:"sm",color:"gray.500",children:t("settings.panel.maintenanceActionsDescription","Use the maintenance service to pull the latest images and restart the containers from the panel.")}),n(U,{spacing:3,flexWrap:"wrap",children:[e(O,{size:"sm",colorScheme:"yellow",leftIcon:e(Ba,{width:16,height:16}),onClick:()=>f.mutate(),isLoading:f.isLoading,children:t("settings.panel.updateAction","Update panel")}),e(O,{size:"sm",colorScheme:"red",leftIcon:e(Kl,{width:16,height:16}),onClick:()=>D.mutate(),isLoading:D.isLoading,children:t("settings.panel.restartAction","Restart panel")})]})]})]}),n(pt,{gap:3,justify:"flex-end",children:[e(O,{variant:"outline",leftIcon:e(ml,{}),onClick:()=>g(),isDisabled:_e.isLoading,children:t("actions.refresh","Refresh")}),e(O,{colorScheme:"primary",leftIcon:e(gl,{}),onClick:()=>_e.mutate({use_nobetci:y}),isLoading:_e.isLoading,isDisabled:_e.isLoading||p===void 0||y===p.use_nobetci,children:t("settings.save","Save Settings")})]})]})}),e(lr,{px:{base:0,md:2},children:c&&!l?e(pt,{align:"center",justify:"center",py:12,children:e(Et,{size:"lg"})}):e("form",{onSubmit:ae(ke),children:n(me,{align:"stretch",spacing:6,children:[e(h,{fontSize:"sm",color:"gray.500",children:t("settings.telegram.description","Manage Telegram bot integration settings and notification preferences.")}),n(pt,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[n(L,{children:[e(jn,{size:"sm",mb:1,children:t("settings.telegram.enableBot","Enable Telegram bot")}),e(h,{fontSize:"sm",color:"gray.500",children:t("settings.telegram.enableBotDescription","Turn the bot on or off without clearing the API token.")})]}),e(kt,{control:Z,name:"use_telegram",render:({field:fe})=>e(vt,{isChecked:fe.value,onChange:Ae=>fe.onChange(Ae.target.checked)})})]}),e(Da,{disabled:!oe,message:R,children:e(L,{borderWidth:"1px",borderRadius:"lg",p:4,children:n(He,{columns:{base:1,md:2},spacing:6,children:[n(x,{children:[e(I,{children:t("settings.telegram.apiToken","Bot API Token")}),e(De,{placeholder:"123456:ABC",...F("api_token")})]}),n(x,{children:[e(I,{children:t("settings.telegram.proxyUrl","Proxy URL")}),e(De,{placeholder:"socks5://user:pass@host:port",...F("proxy_url")})]}),n(x,{children:[e(I,{children:t("settings.telegram.adminChatIds","Admin Chat IDs")}),e(De,{placeholder:"12345, 67890",...F("admin_chat_ids")}),e(nr,{children:t("settings.telegram.adminChatIdsHint","Comma-separated numeric IDs.")})]}),n(x,{children:[e(I,{children:t("settings.telegram.logsChatId","Logs Chat ID")}),e(De,{placeholder:"-100123456789",...F("logs_chat_id")}),e(nr,{children:t("settings.telegram.logsChatIdHint","Use the numeric id of the target group or channel.")})]}),n(x,{display:"flex",alignItems:"center",children:[e(I,{htmlFor:"logs_chat_is_forum",mb:"0",children:t("settings.telegram.logsChatIsForum","Logs chat is a forum")}),e(kt,{control:Z,name:"logs_chat_is_forum",render:({field:fe})=>e(vt,{id:"logs_chat_is_forum",isChecked:fe.value,onChange:fe.onChange})})]}),n(x,{children:[e(I,{children:t("settings.telegram.defaultVlessFlow","Default VLESS Flow")}),e(De,{placeholder:"xtls-rprx-vision",...F("default_vless_flow")})]})]})})}),e(Da,{disabled:!oe,message:R,children:n(L,{children:[e(jn,{size:"sm",mb:4,children:t("settings.telegram.forumTopics","Forum Topics")}),W&&Object.keys(W).length>0?e(ge,{spacing:4,children:Object.entries(W).map(([fe])=>n(L,{borderWidth:"1px",borderRadius:"lg",p:4,children:[n(h,{fontWeight:"medium",mb:3,children:[t("settings.telegram.topicKey","Topic"),": ",fe]}),n(He,{columns:{base:1,md:2},spacing:4,children:[n(x,{children:[e(I,{children:t("settings.telegram.topicTitle","Topic Title")}),e(De,{...F(`forum_topics.${fe}.title`)})]}),n(x,{children:[e(I,{children:t("settings.telegram.topicId","Topic ID")}),e(De,{type:"number",...F(`forum_topics.${fe}.topic_id`)}),e(nr,{children:t("settings.telegram.topicIdHint","Leave empty to let the bot (re)create it.")})]})]})]},fe))}):e(h,{color:"gray.500",children:t("settings.telegram.emptyTopics","No topics available.")})]})}),e(Da,{disabled:!oe,message:R,children:n(L,{children:[e(jn,{size:"sm",mb:2,children:t("settings.telegram.notificationsTitle","Notifications")}),e(h,{fontSize:"sm",color:"gray.500",mb:4,children:t("settings.telegram.notificationsDescription","Choose which events should trigger Telegram notifications.")}),e(ge,{spacing:4,children:kc.map(fe=>n(L,{borderWidth:"1px",borderRadius:"lg",p:4,children:[e(h,{fontWeight:"semibold",mb:3,children:t(fe.titleKey,fe.defaultTitle)}),e(He,{columns:{base:1,md:2},spacing:4,children:fe.events.map(Ae=>n(x,{display:"flex",alignItems:"center",justifyContent:"space-between",gap:4,children:[n(L,{flex:"1",children:[e(h,{fontWeight:"medium",children:t(Ae.labelKey,Ae.defaultLabel)}),e(h,{fontSize:"sm",color:"gray.500",children:t(Ae.hintKey,Ae.defaultHint)})]}),e(kt,{control:Z,name:`event_toggles.${Wa(Ae.key)}`,render:({field:Pe})=>e(vt,{isChecked:Boolean(Pe.value),onChange:Te=>Pe.onChange(Te.target.checked)})})]},Ae.key))})]},fe.key))})]})}),n(pt,{gap:3,justify:"flex-end",children:[e(O,{variant:"outline",leftIcon:e(ml,{}),onClick:()=>u(),isDisabled:Q.isLoading,children:t("actions.refresh","Refresh")}),e(O,{colorScheme:"primary",leftIcon:e(gl,{}),type:"submit",isLoading:Q.isLoading,isDisabled:!T&&!Q.isLoading,children:t("settings.save","Save Settings")})]})]})})}),e(lr,{children:e(h,{color:"gray.500",children:t("settings.tabs.comingSoon","Coming Soon")})})]})]})]}):n(me,{spacing:4,align:"stretch",children:[e(jn,{size:"lg",children:t("header.integrationSettings","Integration settings")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("integrations.noPermission","You do not have permission to manage integration settings.")})]}):e(pt,{align:"center",justify:"center",py:12,children:e(Et,{size:"lg"})})},qg=async()=>{try{const t=Gi();if(!t)throw console.warn("No authentication token found"),new Error("No token available");const s=await Ee("/admin",{headers:{Authorization:`Bearer ${t}`}});if(s&&typeof s=="object"&&"error"in s)throw new Error(`API error: ${s.error||"Unknown error"}`);return s}catch(t){throw console.error("Loader error:",t),t}},Jg=Jd([{path:"/",element:e(th,{}),errorElement:e(yo,{}),loader:qg,children:[{index:!0,element:e(vh,{})},{path:"users",element:e(vp,{})},{path:"admins",element:e(Up,{})},{path:"usage",element:e(Hg,{})},{path:"services",element:e(Eg,{})},{path:"hosts",element:e(Dm,{})},{path:"node-settings",element:e(qm,{})},{path:"integrations",element:e(Kg,{})},{path:"xray-settings",element:e(Ig,{})},{path:"xray-logs",element:e(Sc,{})}]},{path:"/login/",element:e(yo,{})}]);function Yg(){return e(Yd,{router:Jg})}Oe.extend(Gd);Oe.extend(Xd);Oe.extend(Os);Oe.extend(Qd);Oe.extend(Zd);Ki(jd.get()||"light");eu.createRoot(document.getElementById("root")).render(e(Ji.StrictMode,{children:e(tu,{theme:nu,children:e(ru,{client:ii,children:e(Yg,{})})})}));
